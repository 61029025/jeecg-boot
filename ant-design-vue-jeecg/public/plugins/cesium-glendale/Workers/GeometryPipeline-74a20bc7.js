define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian3-e5933291","./ComponentDatatype-6d99a1ee","./Matrix4-a018fd55","./Cartesian2-b1f4b655","./Transforms-b0e569fa","./GeometryAttribute-95a2a7cd","./AttributeCompression-2d47cb6b","./EncodedCartesian3-48cbf07c","./IndexDatatype-53503fee","./IntersectionTests-9d7ddacd","./Plane-6e6a4f39"],function(e,_,t,q,U,M,Y,Z,w,G,P,l,S,H,a){"use strict";var x=new U.Cartesian3,I=new U.Cartesian3,O=new U.Cartesian3;var s={calculateACMR:function(e){var t=(e=_.defaultValue(e,_.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=_.defaultValue(e.cacheSize,24),n=t.length;if(!_.defined(r))for(var i=r=0,s=t[i];i<n;)r<s&&(r=s),s=t[++i];for(var o=[],u=0;u<r+1;u++)o[u]=0;for(var p=a+1,d=0;d<n;++d)p-o[t[d]]>a&&(o[t[d]]=p,++p);return(p-a+1)/(n/3)}};s.tipsify=function(e){var t=(e=_.defaultValue(e,_.defaultValue.EMPTY_OBJECT)).indices,r=e.maximumIndex,a=_.defaultValue(e.cacheSize,24);function n(e,t,r,a,n,i,s){for(var o,u=-1,p=-1,d=0;d<r.length;){var l=r[d];a[l].numLiveTriangles&&(o=0,n-a[l].timeStamp+2*a[l].numLiveTriangles<=t&&(o=n-a[l].timeStamp),(p<o||-1===p)&&(p=o,u=l)),++d}return-1===u?function(e,t,r){for(;1<=t.length;){var a=t[t.length-1];if(t.splice(t.length-1,1),0<e[a].numLiveTriangles)return a}for(;b<r;){if(0<e[b].numLiveTriangles)return++b-1;++b}return-1}(a,i,s):u}var i=t.length,s=0,o=0,u=t[o],p=i;if(_.defined(r))s=r+1;else{for(;o<p;)s<u&&(s=u),u=t[++o];if(-1===s)return 0;++s}for(var d=[],l=0;l<s;l++)d[l]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var f=o=0;o<p;)d[t[o]].vertexTriangles.push(f),++d[t[o]].numLiveTriangles,d[t[o+1]].vertexTriangles.push(f),++d[t[o+1]].numLiveTriangles,d[t[o+2]].vertexTriangles.push(f),++d[t[o+2]].numLiveTriangles,++f,o+=3;var y,c,v,m,C=0,h=a+1,b=1,g=[],A=[],T=0,x=[],P=i/3,w=[];for(l=0;l<P;l++)w[l]=!1;for(;-1!==C;){g=[],m=(c=d[C]).vertexTriangles.length;for(var S=0;S<m;++S)if(!w[f=c.vertexTriangles[S]]){w[f]=!0,o=f+f+f;for(var I=0;I<3;++I)v=t[o],g.push(v),A.push(v),x[T]=v,++T,--(y=d[v]).numLiveTriangles,h-y.timeStamp>a&&(y.timeStamp=h,++h),++o}C=n(0,a,g,d,h,A,s)}return x};var r={};function o(e,t,r,a,n){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=n,e[t++]=n,e[t]=r}function c(e){var t,r,a={};for(t in e){e.hasOwnProperty(t)&&_.defined(e[t])&&_.defined(e[t].values)&&(r=e[t],a[t]=new G.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}))}return a}r.toWireframe=function(e){var t=e.indices;if(_.defined(t)){switch(e.primitiveType){case G.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=S.IndexDatatype.createTypedArray(t,r),n=0,i=0;i<t;i+=3,n+=6)o(a,n,e[i],e[i+1],e[i+2]);return a}(t);break;case G.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var r=6*(t-2),a=S.IndexDatatype.createTypedArray(t,r);o(a,0,e[0],e[1],e[2]);for(var n=6,i=3;i<t;++i,n+=6)o(a,n,e[i-1],e[i],e[i-2]);return a}return new Uint16Array}(t);break;case G.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,r=6*(t-1),a=S.IndexDatatype.createTypedArray(t,r),n=e[0],i=0,s=1;s<t;++s,i+=6)o(a,i,n,e[s],e[s+1]);return a}return new Uint16Array}(t)}e.primitiveType=G.PrimitiveType.LINES}return e},r.createLineSegmentsForVectors=function(e,t,r){t=_.defaultValue(t,"normal"),r=_.defaultValue(r,1e4);for(var a,n=e.attributes.position.values,i=e.attributes[t].values,s=n.length,o=new Float64Array(2*s),u=0,p=0;p<s;p+=3)o[u++]=n[p],o[u++]=n[p+1],o[u++]=n[p+2],o[u++]=n[p]+i[p]*r,o[u++]=n[p+1]+i[p+1]*r,o[u++]=n[p+2]+i[p+2]*r;var d=e.boundingSphere;return _.defined(d)&&(a=new w.BoundingSphere(d.center,d.radius+r)),new G.Geometry({attributes:{position:new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:o})},primitiveType:G.PrimitiveType.LINES,boundingSphere:a})},r.createAttributeLocations=function(e){for(var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],a=e.attributes,n={},i=0,s=r.length,o=0;o<s;++o){var u=r[o];_.defined(a[u])&&(n[u]=i++)}for(t in a)a.hasOwnProperty(t)&&!_.defined(n[t])&&(n[t]=i++);return n},r.reorderForPreVertexCache=function(e){var t=G.Geometry.computeNumberOfVertices(e),r=e.indices;if(_.defined(r)){for(var a=new Int32Array(t),n=0;n<t;n++)a[n]=-1;for(var i,s=r,o=s.length,u=S.IndexDatatype.createTypedArray(t,o),p=0,d=0,l=0;p<o;)-1!==(i=a[s[p]])?u[d]=i:(a[i=s[p]]=l,u[d]=l,++l),++p,++d;e.indices=u;var f,y=e.attributes;for(f in y)if(y.hasOwnProperty(f)&&_.defined(y[f])&&_.defined(y[f].values)){for(var c=y[f],v=c.values,m=0,C=c.componentsPerAttribute,h=M.ComponentDatatype.createTypedArray(c.componentDatatype,l*C);m<t;){var b=a[m];if(-1!==b)for(var g=0;g<C;g++)h[C*b+g]=v[C*m+g];++m}c.values=h}}return e},r.reorderForPostVertexCache=function(e,t){var r=e.indices;if(e.primitiveType===G.PrimitiveType.TRIANGLES&&_.defined(r)){for(var a=r.length,n=0,i=0;i<a;i++)r[i]>n&&(n=r[i]);e.indices=s.tipsify({indices:r,maximumIndex:n,cacheSize:t})}return e},r.fitToUnsignedShortIndices=function(e){var t=[],r=G.Geometry.computeNumberOfVertices(e);if(_.defined(e.indices)&&r>=q.CesiumMath.SIXTY_FOUR_KILOBYTES){var a,n=[],i=[],s=0,o=c(e.attributes),u=e.indices,p=u.length;e.primitiveType===G.PrimitiveType.TRIANGLES?a=3:e.primitiveType===G.PrimitiveType.LINES?a=2:e.primitiveType===G.PrimitiveType.POINTS&&(a=1);for(var d=0;d<p;d+=a){for(var l=0;l<a;++l){var f=u[d+l],y=n[f];_.defined(y)||(y=s++,n[f]=y,function(e,t,r){for(var a in t)if(t.hasOwnProperty(a)&&_.defined(t[a])&&_.defined(t[a].values))for(var n=t[a],i=0;i<n.componentsPerAttribute;++i)e[a].values.push(n.values[r*n.componentsPerAttribute+i])}(o,e.attributes,f)),i.push(y)}s+a>=q.CesiumMath.SIXTY_FOUR_KILOBYTES&&(t.push(new G.Geometry({attributes:o,indices:i,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),n=[],i=[],s=0,o=c(e.attributes))}0!==i.length&&t.push(new G.Geometry({attributes:o,indices:i,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var v=new U.Cartesian3,m=new Z.Cartographic;r.projectTo2D=function(e,t,r,a,n){for(var i=e.attributes[t],s=(n=_.defined(n)?n:new w.GeographicProjection).ellipsoid,o=i.values,u=new Float64Array(o.length),p=0,d=0;d<o.length;d+=3){var l=U.Cartesian3.fromArray(o,d,v),f=s.cartesianToCartographic(l,m),y=n.project(f,v);u[p++]=y.x,u[p++]=y.y,u[p++]=y.z}return e.attributes[r]=i,e.attributes[a]=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u}),delete e.attributes[t],e};var f={high:0,low:0};r.encodeAttribute=function(e,t,r,a){for(var n=e.attributes[t],i=n.values,s=i.length,o=new Float32Array(s),u=new Float32Array(s),p=0;p<s;++p)l.EncodedCartesian3.encode(i[p],f),o[p]=f.high,u[p]=f.low;var d=n.componentsPerAttribute;return e.attributes[r]=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:d,values:o}),e.attributes[a]=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:d,values:u}),delete e.attributes[t],e};var i=new U.Cartesian3;function n(e,t){if(_.defined(t))for(var r=t.values,a=r.length,n=0;n<a;n+=3)U.Cartesian3.unpack(r,n,i),Y.Matrix4.multiplyByPoint(e,i,i),U.Cartesian3.pack(i,r,n)}function u(e,t){if(_.defined(t))for(var r=t.values,a=r.length,n=0;n<a;n+=3)U.Cartesian3.unpack(r,n,i),Y.Matrix3.multiplyByVector(e,i,i),i=U.Cartesian3.normalize(i,i),U.Cartesian3.pack(i,r,n)}var p=new Y.Matrix4,d=new Y.Matrix3;r.transformToWorldCoordinates=function(e){var t=e.modelMatrix;if(Y.Matrix4.equals(t,Y.Matrix4.IDENTITY))return e;var r=e.geometry.attributes;n(t,r.position),n(t,r.prevPosition),n(t,r.nextPosition),(_.defined(r.normal)||_.defined(r.tangent)||_.defined(r.bitangent))&&(Y.Matrix4.inverse(t,p),Y.Matrix4.transpose(p,p),Y.Matrix4.getMatrix3(p,d),u(d,r.normal),u(d,r.tangent),u(d,r.bitangent));var a=e.geometry.boundingSphere;return _.defined(a)&&(e.geometry.boundingSphere=w.BoundingSphere.transform(a,t,a)),e.modelMatrix=Y.Matrix4.clone(Y.Matrix4.IDENTITY),e};var E=new U.Cartesian3;function y(e,t){var r,a,n,i,s,o,u=e.length,p=(e[0].modelMatrix,_.defined(e[0][t].indices)),d=e[0][t].primitiveType,l=function(e,t){var r,a=e.length,n={},i=e[0][t].attributes;for(r in i)if(i.hasOwnProperty(r)&&_.defined(i[r])&&_.defined(i[r].values)){for(var s=i[r],o=s.values.length,u=!0,p=1;p<a;++p){var d=e[p][t].attributes[r];if(!_.defined(d)||s.componentDatatype!==d.componentDatatype||s.componentsPerAttribute!==d.componentsPerAttribute||s.normalize!==d.normalize){u=!1;break}o+=d.values.length}u&&(n[r]=new G.GeometryAttribute({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:M.ComponentDatatype.createTypedArray(s.componentDatatype,o)}))}return n}(e,t);for(r in l)if(l.hasOwnProperty(r))for(n=l[r].values,y=g=0;y<u;++y)for(s=(i=e[y][t].attributes[r].values).length,a=0;a<s;++a)n[g++]=i[a];if(p){for(var f=0,y=0;y<u;++y)f+=e[y][t].indices.length;var c=G.Geometry.computeNumberOfVertices(new G.Geometry({attributes:l,primitiveType:G.PrimitiveType.POINTS})),v=S.IndexDatatype.createTypedArray(c,f),m=0,C=0;for(y=0;y<u;++y){for(var h=e[y][t].indices,b=h.length,g=0;g<b;++g)v[m++]=C+h[g];C+=G.Geometry.computeNumberOfVertices(e[y][t])}o=v}var A,T=new U.Cartesian3,x=0;for(y=0;y<u;++y){if(A=e[y][t].boundingSphere,!_.defined(A)){T=void 0;break}U.Cartesian3.add(A.center,T,T)}if(_.defined(T))for(U.Cartesian3.divideByScalar(T,u,T),y=0;y<u;++y){A=e[y][t].boundingSphere;var P=U.Cartesian3.magnitude(U.Cartesian3.subtract(A.center,T,E))+A.radius;x<P&&(x=P)}return new G.Geometry({attributes:l,indices:o,primitiveType:d,boundingSphere:_.defined(T)?new w.BoundingSphere(T,x):void 0})}r.combineInstances=function(e){for(var t=[],r=[],a=e.length,n=0;n<a;++n){var i=e[n];_.defined(i.geometry)?t.push(i):_.defined(i.westHemisphereGeometry)&&_.defined(i.eastHemisphereGeometry)&&r.push(i)}var s=[];return 0<t.length&&s.push(y(t,"geometry")),0<r.length&&(s.push(y(r,"westHemisphereGeometry")),s.push(y(r,"eastHemisphereGeometry"))),s};var A=new U.Cartesian3,T=new U.Cartesian3,N=new U.Cartesian3,L=new U.Cartesian3;r.computeNormal=function(e){for(var t=e.indices,r=e.attributes,a=r.position.values,n=r.position.values.length/3,i=t.length,s=new Array(n),o=new Array(i/3),u=new Array(i),p=0;p<n;p++)s[p]={indexOffset:0,count:0,currentCount:0};var d=0;for(p=0;p<i;p+=3){var l=t[p],f=t[p+1],y=t[p+2],c=3*l,v=3*f,m=3*y;T.x=a[c],T.y=a[1+c],T.z=a[2+c],N.x=a[v],N.y=a[1+v],N.z=a[2+v],L.x=a[m],L.y=a[1+m],L.z=a[2+m],s[l].count++,s[f].count++,s[y].count++,U.Cartesian3.subtract(N,T,N),U.Cartesian3.subtract(L,T,L),o[d]=U.Cartesian3.cross(N,L,new U.Cartesian3),d++}var C=0;for(p=0;p<n;p++)s[p].indexOffset+=C,C+=s[p].count;for(p=d=0;p<i;p+=3)p<=69?p%2==0?(u[(g=s[t[p]]).indexOffset+g.currentCount]=66===p?0:d+2,g.currentCount++,u[(g=s[t[p+1]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+2]]).indexOffset+g.currentCount]=66===p?0:d+2):(u[(g=s[t[p]]).indexOffset+g.currentCount]=69===p?0:d+2,g.currentCount++,u[(g=s[t[p+1]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+2]]).indexOffset+g.currentCount]=d):(u[(g=s[t[p]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+1]]).indexOffset+g.currentCount]=d,g.currentCount++,u[(g=s[t[p+2]]).indexOffset+g.currentCount]=d),g.currentCount++,d++;var h=new Float32Array(3*n);for(p=0;p<n;p++){var b=3*p,g=s[p];if(U.Cartesian3.clone(U.Cartesian3.ZERO,A),0<g.count){for(d=0;d<g.count;d++)U.Cartesian3.add(A,o[u[g.indexOffset+d]],A);U.Cartesian3.equalsEpsilon(U.Cartesian3.ZERO,A,q.CesiumMath.EPSILON10)&&U.Cartesian3.clone(o[u[g.indexOffset]],A)}U.Cartesian3.equalsEpsilon(U.Cartesian3.ZERO,A,q.CesiumMath.EPSILON10)&&(A.z=1),U.Cartesian3.normalize(A,A),h[b]=A.x,h[1+b]=A.y,h[2+b]=A.z}return e.attributes.normal=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:h}),e};var R=new U.Cartesian3,V=new U.Cartesian3,F=new U.Cartesian3;r.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,r=e.attributes.position.values,a=e.attributes.normal.values,n=e.attributes.st.values,i=e.attributes.position.values.length/3,s=t.length,o=new Array(3*i),u=0;u<o.length;u++)o[u]=0;for(u=0;u<s;u+=3){var p,d=t[u],l=t[u+1],f=t[u+2],y=3*l,c=3*f,v=2*d,m=2*l,C=2*f,h=r[p=3*d],b=r[p+1],g=r[p+2],A=n[v],T=n[1+v],x=n[1+m]-T,P=n[1+C]-T,w=1/((n[m]-A)*P-(n[C]-A)*x),S=(P*(r[y]-h)-x*(r[c]-h))*w,I=(P*(r[y+1]-b)-x*(r[c+1]-b))*w,O=(P*(r[y+2]-g)-x*(r[c+2]-g))*w;o[p]+=S,o[p+1]+=I,o[p+2]+=O,o[y]+=S,o[y+1]+=I,o[y+2]+=O,o[c]+=S,o[c+1]+=I,o[c+2]+=O}var E=new Float32Array(3*i),N=new Float32Array(3*i);for(u=0;u<i;u++){y=(p=3*u)+1,c=p+2;var L=U.Cartesian3.fromArray(a,p,R),z=U.Cartesian3.fromArray(o,p,F),D=U.Cartesian3.dot(L,z);U.Cartesian3.multiplyByScalar(L,D,V),U.Cartesian3.normalize(U.Cartesian3.subtract(z,V,z),z),E[p]=z.x,E[y]=z.y,E[c]=z.z,U.Cartesian3.normalize(U.Cartesian3.cross(L,z,z),z),N[p]=z.x,N[y]=z.y,N[c]=z.z}return e.attributes.tangent=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E}),e.attributes.bitangent=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:N}),e};var z=new Z.Cartesian2,D=new U.Cartesian3,B=new U.Cartesian3,k=new U.Cartesian3,W=new Z.Cartesian2;function C(e){switch(e.primitiveType){case G.PrimitiveType.TRIANGLE_FAN:return function(e){var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,n=3;n<t;++n)r[a++]=n-1,r[a++]=0,r[a++]=n;return e.indices=r,e.primitiveType=G.PrimitiveType.TRIANGLES,e}(e);case G.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,3<t&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,n=3;n<t-1;n+=2)r[a++]=n,r[a++]=n-1,r[a++]=n+1,n+2<t&&(r[a++]=n,r[a++]=n+1,r[a++]=n+2);return e.indices=r,e.primitiveType=G.PrimitiveType.TRIANGLES,e}(e);case G.PrimitiveType.TRIANGLES:return function(e){if(_.defined(e.indices))return e;for(var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e);case G.PrimitiveType.LINE_STRIP:return function(e){var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return e.indices=r,e.primitiveType=G.PrimitiveType.LINES,e}(e);case G.PrimitiveType.LINE_LOOP:return function(e){var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=G.PrimitiveType.LINES,e}(e);case G.PrimitiveType.LINES:return function(e){if(_.defined(e.indices))return e;for(var t=G.Geometry.computeNumberOfVertices(e),r=S.IndexDatatype.createTypedArray(t,t),a=0;a<t;++a)r[a]=a;return e.indices=r,e}(e)}return e}function h(e,t){Math.abs(e.y)<q.CesiumMath.EPSILON6&&(e.y=t?-q.CesiumMath.EPSILON6:q.CesiumMath.EPSILON6)}r.compressVertices=function(e){var t=e.attributes.extrudeDirection;if(_.defined(t)){for(var r=t.values,a=r.length/3,n=new Float32Array(2*a),i=0,s=0;s<a;++s)U.Cartesian3.fromArray(r,3*s,D),U.Cartesian3.equals(D,U.Cartesian3.ZERO)?i+=2:(W=P.AttributeCompression.octEncodeInRange(D,65535,W),n[i++]=W.x,n[i++]=W.y);return e.attributes.compressedAttributes=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:n}),delete e.attributes.extrudeDirection,e}var o=e.attributes.normal,u=e.attributes.st,p=_.defined(o),d=_.defined(u);if(!p&&!d)return e;var l,f,y,c,v=e.attributes.tangent,m=e.attributes.bitangent,C=_.defined(v),h=_.defined(m);p&&(l=o.values),d&&(f=u.values),C&&(y=v.values),h&&(c=m.values);var b=a=(p?l.length:f.length)/(p?3:2),g=d&&p?2:1;b*=g+=C||h?1:0;var A=new Float32Array(b),T=0;for(s=0;s<a;++s){d&&(Z.Cartesian2.fromArray(f,2*s,z),A[T++]=P.AttributeCompression.compressTextureCoordinates(z));var x=3*s;p&&_.defined(y)&&_.defined(c)?(U.Cartesian3.fromArray(l,x,D),U.Cartesian3.fromArray(y,x,B),U.Cartesian3.fromArray(c,x,k),P.AttributeCompression.octPack(D,B,k,z),A[T++]=z.x,A[T++]=z.y):(p&&(U.Cartesian3.fromArray(l,x,D),A[T++]=P.AttributeCompression.octEncodeFloat(D)),C&&(U.Cartesian3.fromArray(y,x,D),A[T++]=P.AttributeCompression.octEncodeFloat(D)),h&&(U.Cartesian3.fromArray(c,x,D),A[T++]=P.AttributeCompression.octEncodeFloat(D)))}return e.attributes.compressedAttributes=new G.GeometryAttribute({componentDatatype:M.ComponentDatatype.FLOAT,componentsPerAttribute:g,values:A}),p&&delete e.attributes.normal,d&&delete e.attributes.st,h&&delete e.attributes.bitangent,C&&delete e.attributes.tangent,e};var b=new U.Cartesian3;function g(e,t,r,a){U.Cartesian3.add(e,U.Cartesian3.multiplyByScalar(U.Cartesian3.subtract(t,e,b),e.y/(e.y-t.y),b),r),U.Cartesian3.clone(r,a),h(r,!0),h(a,!1)}var X=new U.Cartesian3,j=new U.Cartesian3,J=new U.Cartesian3,K=new U.Cartesian3,Q={positions:new Array(7),indices:new Array(9)};function $(e,t,r){if(!(0<=e.x||0<=t.x||0<=r.x)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return h(e,e.y<0),h(t,t.y<0),h(r,r.y<0);var a=Math.abs(e.y),n=Math.abs(t.y),i=Math.abs(r.y),s=n<a?i<a?q.CesiumMath.sign(e.y):q.CesiumMath.sign(r.y):i<n?q.CesiumMath.sign(t.y):q.CesiumMath.sign(r.y),o=s<0;h(e,o),h(t,o),h(r,o)}(e,t,r);var a=e.y<0,n=t.y<0,i=r.y<0,s=0;s+=a?1:0,s+=n?1:0,s+=i?1:0;var o=Q.indices;1==s?(o[1]=3,o[2]=4,o[5]=6,o[7]=6,o[8]=5,a?(g(e,t,X,J),g(e,r,j,K),o[0]=0,o[3]=1,o[4]=2,o[6]=1):n?(g(t,r,X,J),g(t,e,j,K),o[0]=1,o[3]=2,o[4]=0,o[6]=2):i&&(g(r,e,X,J),g(r,t,j,K),o[0]=2,o[3]=0,o[4]=1,o[6]=0)):2==s&&(o[2]=4,o[4]=4,o[5]=3,o[7]=5,o[8]=6,a?n?i||(g(r,e,X,J),g(r,t,j,K),o[0]=0,o[1]=1,o[3]=0,o[6]=2):(g(t,r,X,J),g(t,e,j,K),o[0]=2,o[1]=0,o[3]=2,o[6]=1):(g(e,t,X,J),g(e,r,j,K),o[0]=1,o[1]=2,o[3]=1,o[6]=0));var u=Q.positions;return u[0]=e,u[1]=t,u[2]=r,u.length=3,1!=s&&2!=s||(u[3]=X,u[4]=j,u[5]=J,u[6]=K,u.length=7),Q}}function ee(e,t){var r,a=e.attributes;if(0!==a.position.values.length){for(var n in a){a.hasOwnProperty(n)&&_.defined(a[n])&&_.defined(a[n].values)&&((r=a[n]).values=M.ComponentDatatype.createTypedArray(r.componentDatatype,r.values))}var i=G.Geometry.computeNumberOfVertices(e);return e.indices=S.IndexDatatype.createTypedArray(i,e.indices),t&&(e.boundingSphere=w.BoundingSphere.fromVertices(a.position.values)),e}}function te(e){var t,r,a=e.attributes,n={};for(t in a){a.hasOwnProperty(t)&&_.defined(a[t])&&_.defined(a[t].values)&&(r=a[t],n[t]=new G.GeometryAttribute({componentDatatype:r.componentDatatype,componentsPerAttribute:r.componentsPerAttribute,normalize:r.normalize,values:[]}))}return new G.Geometry({attributes:n,indices:[],primitiveType:e.primitiveType})}function re(e,t,r){var a=_.defined(e.geometry.boundingSphere);t=ee(t,a),r=ee(r,a),_.defined(r)&&!_.defined(t)?e.geometry=r:!_.defined(r)&&_.defined(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function ae(f,y){var c=new f,v=new f,m=new f;return function(e,t,r,a,n,i,s,o){var u=f.fromArray(n,e*y,c),p=f.fromArray(n,t*y,v),d=f.fromArray(n,r*y,m);f.multiplyByScalar(u,a.x,u),f.multiplyByScalar(p,a.y,p),f.multiplyByScalar(d,a.z,d);var l=f.add(u,p,u);f.add(l,d,l),o&&f.normalize(l,l),f.pack(l,i,s*y)}}var ne=ae(Y.Cartesian4,4),ie=ae(U.Cartesian3,3),se=ae(Z.Cartesian2,2),oe=function(e,t,r,a,n,i,s){var o=n[e]*a.x,u=n[t]*a.y,p=n[r]*a.z;i[s]=o+u+p>q.CesiumMath.EPSILON6?1:0},ue=new U.Cartesian3,pe=new U.Cartesian3,de=new U.Cartesian3,le=new U.Cartesian3;function fe(e,t,r,a,n,i,s,o,u,p,d,l,f,y,c,v){if(_.defined(i)||_.defined(s)||_.defined(o)||_.defined(u)||_.defined(p)||0!==y){var m,C,h,b,g=function(e,t,r,a,n){var i,s,o,u,p,d,l,f;if(_.defined(n)||(n=new U.Cartesian3),_.defined(t.z)){if(U.Cartesian3.equalsEpsilon(e,t,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_X,n);if(U.Cartesian3.equalsEpsilon(e,r,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_Y,n);if(U.Cartesian3.equalsEpsilon(e,a,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_Z,n);i=U.Cartesian3.subtract(r,t,x),s=U.Cartesian3.subtract(a,t,I),o=U.Cartesian3.subtract(e,t,O),u=U.Cartesian3.dot(i,i),p=U.Cartesian3.dot(i,s),d=U.Cartesian3.dot(i,o),l=U.Cartesian3.dot(s,s),f=U.Cartesian3.dot(s,o)}else{if(Z.Cartesian2.equalsEpsilon(e,t,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_X,n);if(Z.Cartesian2.equalsEpsilon(e,r,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_Y,n);if(Z.Cartesian2.equalsEpsilon(e,a,q.CesiumMath.EPSILON14))return U.Cartesian3.clone(U.Cartesian3.UNIT_Z,n);i=Z.Cartesian2.subtract(r,t,x),s=Z.Cartesian2.subtract(a,t,I),o=Z.Cartesian2.subtract(e,t,O),u=Z.Cartesian2.dot(i,i),p=Z.Cartesian2.dot(i,s),d=Z.Cartesian2.dot(i,o),l=Z.Cartesian2.dot(s,s),f=Z.Cartesian2.dot(s,o)}n.y=l*d-p*f,n.z=u*f-p*d;var y=u*l-p*p;return 0!==n.y&&(n.y/=y),0!==n.z&&(n.z/=y),n.x=1-n.y-n.z,n}(a,U.Cartesian3.fromArray(n,3*e,ue),U.Cartesian3.fromArray(n,3*t,pe),U.Cartesian3.fromArray(n,3*r,de),le);if(_.defined(i)&&ie(e,t,r,g,i,l.normal.values,v,!0),_.defined(p)&&(m=U.Cartesian3.fromArray(p,3*e,ue),C=U.Cartesian3.fromArray(p,3*t,pe),h=U.Cartesian3.fromArray(p,3*r,de),U.Cartesian3.multiplyByScalar(m,g.x,m),U.Cartesian3.multiplyByScalar(C,g.y,C),U.Cartesian3.multiplyByScalar(h,g.z,h),U.Cartesian3.equals(m,U.Cartesian3.ZERO)&&U.Cartesian3.equals(C,U.Cartesian3.ZERO)&&U.Cartesian3.equals(h,U.Cartesian3.ZERO)?((b=ue).x=0,b.y=0,b.z=0):(b=U.Cartesian3.add(m,C,m),U.Cartesian3.add(b,h,b),U.Cartesian3.normalize(b,b)),U.Cartesian3.pack(b,l.extrudeDirection.values,3*v)),_.defined(d)&&oe(e,t,r,g,d,l.applyOffset.values,v),_.defined(s)&&ie(e,t,r,g,s,l.tangent.values,v,!0),_.defined(o)&&ie(e,t,r,g,o,l.bitangent.values,v,!0),_.defined(u)&&se(e,t,r,g,u,l.st.values,v),0<y)for(var A=0;A<y;A++){var T=f[A];!function(e,t,r,a,n,i,s){var o=i.componentsPerAttribute,u=i.values,p=s.values;switch(o){case 4:ne(e,t,r,a,u,p,n,!1);break;case 3:ie(e,t,r,a,u,p,n,!1);break;case 2:se(e,t,r,a,u,p,n,!1);break;default:p[n]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}(e,t,r,g,v,c[T],l[T])}}}function ye(e,t,r,a,n,i){var s=e.position.values.length/3;if(-1===n)return e.position.values.push(i.x,i.y,i.z),t.push(s),s;var o=a[n],u=r[o];return-1===u?(r[o]=s,e.position.values.push(i.x,i.y,i.z),t.push(s),s):(t.push(u),u)}var ce={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ve(e){var t,r=e.geometry,a=r.attributes,n=a.position.values,i=_.defined(a.normal)?a.normal.values:void 0,s=_.defined(a.bitangent)?a.bitangent.values:void 0,o=_.defined(a.tangent)?a.tangent.values:void 0,u=_.defined(a.st)?a.st.values:void 0,p=_.defined(a.extrudeDirection)?a.extrudeDirection.values:void 0,d=_.defined(a.applyOffset)?a.applyOffset.values:void 0,l=r.indices,f=[];for(t in a)a.hasOwnProperty(t)&&!ce[t]&&_.defined(a[t])&&f.push(t);var y,c,v=f.length,m=te(r),C=te(r),h=[];h.length=n.length/3;var b=[];for(b.length=n.length/3,A=0;A<h.length;++A)h[A]=-1,b[A]=-1;for(var g=l.length,A=0;A<g;A+=3){var T=l[A],x=l[A+1],P=l[A+2],w=U.Cartesian3.fromArray(n,3*T),S=U.Cartesian3.fromArray(n,3*x),I=U.Cartesian3.fromArray(n,3*P),O=$(w,S,I);if(_.defined(O)&&3<O.positions.length)for(var E=O.positions,N=O.indices,L=N.length,z=0;z<L;++z){var D=N[z],M=E[D],G=M.y<0?(y=C.attributes,c=C.indices,h):(y=m.attributes,c=m.indices,b);fe(T,x,P,M,n,i,o,s,u,p,d,y,f,v,a,ye(y,c,G,l,D<3?A+D:-1,M))}else _.defined(O)&&(w=O.positions[0],S=O.positions[1],I=O.positions[2]),G=w.y<0?(y=C.attributes,c=C.indices,h):(y=m.attributes,c=m.indices,b),fe(T,x,P,w,n,i,o,s,u,p,d,y,f,v,a,ye(y,c,G,l,A,w)),fe(T,x,P,S,n,i,o,s,u,p,d,y,f,v,a,ye(y,c,G,l,A+1,S)),fe(T,x,P,I,n,i,o,s,u,p,d,y,f,v,a,ye(y,c,G,l,A+2,I))}re(e,C,m)}var me=a.Plane.fromPointNormal(U.Cartesian3.ZERO,U.Cartesian3.UNIT_Y),Ce=new U.Cartesian3,he=new U.Cartesian3;function be(e,t,r,a,n,i,s){var o;_.defined(s)&&(o=U.Cartesian3.fromArray(a,3*e,ue),U.Cartesian3.equalsEpsilon(o,r,q.CesiumMath.EPSILON10)?i.applyOffset.values[n]=s[e]:i.applyOffset.values[n]=s[t])}function ge(e){var t,r=e.geometry,a=r.attributes,n=a.position.values,i=_.defined(a.applyOffset)?a.applyOffset.values:void 0,s=r.indices,o=te(r),u=te(r),p=s.length,d=[];d.length=n.length/3;var l=[];for(l.length=n.length/3,t=0;t<d.length;++t)d[t]=-1,l[t]=-1;for(t=0;t<p;t+=2){var f=s[t],y=s[t+1],c=U.Cartesian3.fromArray(n,3*f,ue),v=U.Cartesian3.fromArray(n,3*y,pe);Math.abs(c.y)<q.CesiumMath.EPSILON6&&(c.y<0?c.y=-q.CesiumMath.EPSILON6:c.y=q.CesiumMath.EPSILON6),Math.abs(v.y)<q.CesiumMath.EPSILON6&&(v.y<0?v.y=-q.CesiumMath.EPSILON6:v.y=q.CesiumMath.EPSILON6);var m,C,h,b,g,A=o.attributes,T=o.indices,x=l,P=u.attributes,w=u.indices,S=d,I=H.IntersectionTests.lineSegmentPlane(c,v,me,de);_.defined(I)?(m=U.Cartesian3.multiplyByScalar(U.Cartesian3.UNIT_Y,5*q.CesiumMath.EPSILON9,Ce),c.y<0&&(U.Cartesian3.negate(m,m),A=u.attributes,T=u.indices,x=d,P=o.attributes,w=o.indices,S=l),C=U.Cartesian3.add(I,m,he),be(f,y,c,n,ye(A,T,x,s,t,c),A,i),be(f,y,C,n,ye(A,T,x,s,-1,C),A,i),U.Cartesian3.negate(m,m),U.Cartesian3.add(I,m,C),be(f,y,C,n,ye(P,w,S,s,-1,C),P,i),be(f,y,v,n,ye(P,w,S,s,t+1,v),P,i)):(g=c.y<0?(h=u.attributes,b=u.indices,d):(h=o.attributes,b=o.indices,l),be(f,y,c,n,ye(h,b,g,s,t,c),h,i),be(f,y,v,n,ye(h,b,g,s,t+1,v),h,i))}re(e,u,o)}var Ae=new Z.Cartesian2,Te=new Z.Cartesian2,xe=new U.Cartesian3,Pe=new U.Cartesian3,we=new U.Cartesian3,Se=new U.Cartesian3,Ie=new U.Cartesian3,Oe=new U.Cartesian3,Ee=new Y.Cartesian4;function Ne(e){for(var t=e.attributes,r=t.position.values,a=t.prevPosition.values,n=t.nextPosition.values,i=r.length,s=0;s<i;s+=3){var o,u,p=U.Cartesian3.unpack(r,s,xe);0<p.x||(o=U.Cartesian3.unpack(a,s,Pe),(p.y<0&&0<o.y||0<p.y&&o.y<0)&&(0<s-3?(a[s]=r[s-3],a[s+1]=r[s-2],a[s+2]=r[s-1]):U.Cartesian3.pack(p,a,s)),u=U.Cartesian3.unpack(n,s,we),(p.y<0&&0<u.y||0<p.y&&u.y<0)&&(s+3<i?(n[s]=r[s+3],n[s+1]=r[s+4],n[s+2]=r[s+5]):U.Cartesian3.pack(p,n,s)))}}var Le=5*q.CesiumMath.EPSILON9,ze=q.CesiumMath.EPSILON6;r.splitLongitude=function(e){var t=e.geometry,r=t.boundingSphere;if(_.defined(r)&&(0<r.center.x-r.radius||w.BoundingSphere.intersectPlane(r,a.Plane.ORIGIN_ZX_PLANE)!==w.Intersect.INTERSECTING))return e;if(t.geometryType!==G.GeometryType.NONE)switch(t.geometryType){case G.GeometryType.POLYLINES:!function(e){for(var t,r=e.geometry,a=r.attributes,n=a.position.values,i=a.prevPosition.values,s=a.nextPosition.values,o=a.expandAndWidth.values,u=_.defined(a.st)?a.st.values:void 0,p=_.defined(a.color)?a.color.values:void 0,d=te(r),l=te(r),f=!1,y=n.length/3,c=0;c<y;c+=4){var v=c,m=c+2,C=U.Cartesian3.fromArray(n,3*v,xe),h=U.Cartesian3.fromArray(n,3*m,Pe);if(Math.abs(C.y)<ze)for(C.y=ze*(h.y<0?-1:1),n[3*c+1]=C.y,n[3*(c+1)+1]=C.y,G=3*v;G<3*v+12;G+=3)i[G]=n[3*c],i[G+1]=n[3*c+1],i[G+2]=n[3*c+2];if(Math.abs(h.y)<ze)for(h.y=ze*(C.y<0?-1:1),n[3*(c+2)+1]=h.y,n[3*(c+3)+1]=h.y,G=3*v;G<3*v+12;G+=3)s[G]=n[3*(c+2)],s[G+1]=n[3*(c+2)+1],s[G+2]=n[3*(c+2)+2];var b=d.attributes,g=d.indices,A=l.attributes,T=l.indices,x=H.IntersectionTests.lineSegmentPlane(C,h,me,Se);if(_.defined(x)){f=!0;var P=U.Cartesian3.multiplyByScalar(U.Cartesian3.UNIT_Y,Le,Ie);C.y<0&&(U.Cartesian3.negate(P,P),b=l.attributes,g=l.indices,A=d.attributes,T=d.indices);var w=U.Cartesian3.add(x,P,Oe);b.position.values.push(C.x,C.y,C.z,C.x,C.y,C.z),b.position.values.push(w.x,w.y,w.z),b.position.values.push(w.x,w.y,w.z),b.prevPosition.values.push(i[3*v],i[3*v+1],i[3*v+2]),b.prevPosition.values.push(i[3*v+3],i[3*v+4],i[3*v+5]),b.prevPosition.values.push(C.x,C.y,C.z,C.x,C.y,C.z),b.nextPosition.values.push(w.x,w.y,w.z),b.nextPosition.values.push(w.x,w.y,w.z),b.nextPosition.values.push(w.x,w.y,w.z),b.nextPosition.values.push(w.x,w.y,w.z),U.Cartesian3.negate(P,P),U.Cartesian3.add(x,P,w),A.position.values.push(w.x,w.y,w.z),A.position.values.push(w.x,w.y,w.z),A.position.values.push(h.x,h.y,h.z,h.x,h.y,h.z),A.prevPosition.values.push(w.x,w.y,w.z),A.prevPosition.values.push(w.x,w.y,w.z),A.prevPosition.values.push(w.x,w.y,w.z),A.prevPosition.values.push(w.x,w.y,w.z),A.nextPosition.values.push(h.x,h.y,h.z,h.x,h.y,h.z),A.nextPosition.values.push(s[3*m],s[3*m+1],s[3*m+2]),A.nextPosition.values.push(s[3*m+3],s[3*m+4],s[3*m+5]);var S=Z.Cartesian2.fromArray(o,2*v,Ae),I=Math.abs(S.y);b.expandAndWidth.values.push(-1,I,1,I),b.expandAndWidth.values.push(-1,-I,1,-I),A.expandAndWidth.values.push(-1,I,1,I),A.expandAndWidth.values.push(-1,-I,1,-I);var O=U.Cartesian3.magnitudeSquared(U.Cartesian3.subtract(x,C,we));if(O/=U.Cartesian3.magnitudeSquared(U.Cartesian3.subtract(h,C,we)),_.defined(p)){for(var E=Y.Cartesian4.fromArray(p,4*v,Ee),N=Y.Cartesian4.fromArray(p,4*m,Ee),L=q.CesiumMath.lerp(E.x,N.x,O),z=q.CesiumMath.lerp(E.y,N.y,O),D=q.CesiumMath.lerp(E.z,N.z,O),M=q.CesiumMath.lerp(E.w,N.w,O),G=4*v;G<4*v+8;++G)b.color.values.push(p[G]);for(b.color.values.push(L,z,D,M),b.color.values.push(L,z,D,M),A.color.values.push(L,z,D,M),A.color.values.push(L,z,D,M),G=4*m;G<4*m+8;++G)A.color.values.push(p[G])}if(_.defined(u)){var R=Z.Cartesian2.fromArray(u,2*v,Ae),V=Z.Cartesian2.fromArray(u,2*(c+3),Te),F=q.CesiumMath.lerp(R.x,V.x,O);for(G=2*v;G<2*v+4;++G)b.st.values.push(u[G]);for(b.st.values.push(F,R.y),b.st.values.push(F,V.y),A.st.values.push(F,R.y),A.st.values.push(F,V.y),G=2*m;G<2*m+4;++G)A.st.values.push(u[G])}t=b.position.values.length/3-4,g.push(t,t+2,t+1),g.push(t+1,t+2,t+3),t=A.position.values.length/3-4,T.push(t,t+2,t+1),T.push(t+1,t+2,t+3)}else{var B,k=C.y<0?(B=l.attributes,l.indices):(B=d.attributes,d.indices);for(B.position.values.push(C.x,C.y,C.z),B.position.values.push(C.x,C.y,C.z),B.position.values.push(h.x,h.y,h.z),B.position.values.push(h.x,h.y,h.z),G=3*c;G<3*c+12;++G)B.prevPosition.values.push(i[G]),B.nextPosition.values.push(s[G]);for(G=2*c;G<2*c+8;++G)B.expandAndWidth.values.push(o[G]),_.defined(u)&&B.st.values.push(u[G]);if(_.defined(p))for(G=4*c;G<4*c+16;++G)B.color.values.push(p[G]);t=B.position.values.length/3-4,k.push(t,t+2,t+1),k.push(t+1,t+2,t+3)}}f&&(Ne(l),Ne(d)),re(e,l,d)}(e);break;case G.GeometryType.TRIANGLES:ve(e);break;case G.GeometryType.LINES:ge(e)}else C(t),t.primitiveType===G.PrimitiveType.TRIANGLES?ve(e):t.primitiveType===G.PrimitiveType.LINES&&ge(e);return e},e.GeometryPipeline=r});
