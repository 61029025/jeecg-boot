define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian3-e5933291","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./Matrix4-a018fd55","./RuntimeError-2109023a","./Cartesian2-b1f4b655","./Transforms-b0e569fa","./GeometryAttribute-95a2a7cd","./GeometryAttributes-4fcfcf40","./AttributeCompression-2d47cb6b","./GeometryPipeline-74a20bc7","./EncodedCartesian3-48cbf07c","./IndexDatatype-53503fee","./IntersectionTests-9d7ddacd","./Plane-6e6a4f39","./VertexFormat-7572c785","./arrayRemoveDuplicates-ebc732b0","./BoundingRectangle-9a1ea9aa","./EllipsoidTangentPlane-6d5e3584","./EllipsoidRhumbLine-cdd4405f","./PolygonPipeline-51e31fad","./PolylineVolumeGeometryLibrary-3bae379a","./EllipsoidGeodesic-1a54c615","./PolylinePipeline-1acb3556"],function(I,e,a,z,t,O,B,r,u,S,H,N,n,U,i,W,o,l,g,s,d,p,c,q,m,y,h){"use strict";var f={};function J(e,t){I.defined(f[e])||(f[e]=!0,console.warn(I.defaultValue(t,e)))}function v(e,t,r,n,i,a,o){var l=new N.GeometryAttributes;n.position&&(l.position=new H.GeometryAttribute({componentDatatype:O.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:e}));var s,d,p,c,m,u=t.length,g=e.length/3,y=(g-2*u)/(2*u),h=q.PolygonPipeline.triangulate(t),f=(y-1)*u*6+2*h.length,v=W.IndexDatatype.createTypedArray(g,f),x=2*u,b=0;for(G=0;G<y-1;G++){for(s=0;s<u-1;s++)m=(d=2*s+G*u*2)+x,c=(p=d+1)+x,v[b++]=p,v[b++]=d,v[b++]=c,v[b++]=c,v[b++]=d,v[b++]=m;c=(p=(d=2*u-2+G*u*2)+1)+x,m=d+x,v[b++]=p,v[b++]=d,v[b++]=c,v[b++]=c,v[b++]=d,v[b++]=m}if(n.st||n.tangent||n.bitangent){var P=new Float32Array(2*g),_=1/(y-1),E=Math.max(2,Math.ceil(a));E<=1e3&&(_=(y=E)/1e3);for(var L,T,F=1/r.height,C=r.height/2,w=0,G=0;G<y;G++){for(L=G*_,T=F*(t[0].y+C),P[w++]=L,P[w++]=T,s=1;s<u;s++)T=F*(t[s].y+C),P[w++]=L,P[w++]=T,P[w++]=L,P[w++]=T;T=F*(t[0].y+C),P[w++]=L,P[w++]=T}for(s=0;s<u;s++)L=0,T=F*(t[s].y+C),P[w++]=L,P[w++]=T;for(s=0;s<u;s++)L=(y-1)*_,T=F*(t[s].y+C),P[w++]=L,P[w++]=T;l.st=new H.GeometryAttribute({componentDatatype:O.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:new Float32Array(P)})}var k=g-2*u;for(G=0;G<h.length;G+=3){var V=h[G]+k,M=h[G+1]+k,R=h[G+2]+k;v[b++]=V,v[b++]=M,v[b++]=R,v[b++]=R+u,v[b++]=M+u,v[b++]=V+u}var A=function(e,t,r){var n=[],i=new B.Matrix4;I.defined(t)&&!t.equals(new B.Matrix4)&&B.Matrix4.inverse(t,i);for(var a=0;a<e.length/3;a++){var o=new z.Cartesian3(e[3*a],e[3*a+1],e[3*a+2]);1!==r&&B.Matrix4.multiplyByPoint(i,o,o),n.push(o.x,o.y,o.z)}for(var l=new z.Cartesian3(-1/0,-1/0,-1/0),s=new z.Cartesian3(1/0,1/0,1/0),d=0;d<n.length/3;d++){var p=new z.Cartesian3(n[3*d],n[3*d+1],n[3*d+2]);l.x=Math.max(l.x,p.x),l.y=Math.max(l.y,p.y),l.z=Math.max(l.z,p.z),s.x=Math.min(s.x,p.x),s.y=Math.min(s.y,p.y),s.z=Math.min(s.z,p.z)}return[l,s]}(e,i,o),D=new H.Geometry({attributes:l,indices:v,boundingSphere:S.BoundingSphere.fromVertices(e),MaxPoint:A[0],MinPoint:A[1],primitiveType:H.PrimitiveType.TRIANGLES});if(n.normal&&(D=U.GeometryPipeline.computeNormal(D,1==o?i:void 0)),n.tangent||n.bitangent){try{D=U.GeometryPipeline.computeTangentAndBitangent(D)}catch(e){J("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}n.tangent||(D.attributes.tangent=void 0),n.bitangent||(D.attributes.bitangent=void 0),n.st||(D.attributes.st=void 0)}return D}function x(e){var t,r=(e=I.defaultValue(e,I.defaultValue.EMPTY_OBJECT)).polylinePositions,n=e.shapePositions;this._positions=r,this._shape=n,this._ellipsoid=u.Ellipsoid.clone(I.defaultValue(e.ellipsoid,u.Ellipsoid.WGS84)),this._cornerType=I.defaultValue(e.cornerType,m.CornerType.ROUNDED),this._vertexFormat=g.VertexFormat.clone(I.defaultValue(e.vertexFormat,g.VertexFormat.DEFAULT)),this._granularity=I.defaultValue(e.granularity,a.CesiumMath.RADIANS_PER_DEGREE),I.defined(e.id)&&(t=e.id._polylineVolume.RootTransform,this._rootTransform=t),e.rootTransform&&(this._rootTransform=e.rootTransform),I.defined(e.isFromGLP)&&(this._isFromGLP=e.isFromGLP),this._workerName="createPolylineVolumeGeometry";var i=1+r.length*z.Cartesian3.packedLength;i+=1+n.length*u.Cartesian2.packedLength,I.defined(t)&&(i+=1+t.length),I.defined(e.rootTransform)&&(i+=1+e.rootTransform.length),I.defined(e.isFromGLP)&&(i+=1),this.packedLength=i+u.Ellipsoid.packedLength+g.VertexFormat.packedLength+2}J.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",J.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",J.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",J.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored",x.pack=function(e,t,r){var n;r=I.defaultValue(r,0);var i=e._positions,a=i.length;for(t[r++]=a,n=0;n<a;++n,r+=z.Cartesian3.packedLength)z.Cartesian3.pack(i[n],t,r);var o=e._shape,a=o.length;for(t[r++]=a,n=0;n<a;++n,r+=u.Cartesian2.packedLength)u.Cartesian2.pack(o[n],t,r);u.Ellipsoid.pack(e._ellipsoid,t,r),r+=u.Ellipsoid.packedLength,g.VertexFormat.pack(e._vertexFormat,t,r),r+=g.VertexFormat.packedLength,t[r++]=e._cornerType,t[r++]=e._granularity;var l=e._rootTransform;return I.defined(l)&&(B.Matrix4.pack(l,t,r++),r+=15),I.defined(e._isFromGLP)&&(t[r++]=e._isFromGLP),t};var b=u.Ellipsoid.clone(u.Ellipsoid.UNIT_SPHERE),P=new g.VertexFormat,_={polylinePositions:void 0,shapePositions:void 0,ellipsoid:b,vertexFormat:P,cornerType:void 0,granularity:void 0};x.unpack=function(e,t,r){t=I.defaultValue(t,0);for(var n=e[t++],i=new Array(n),a=0;a<n;++a,t+=z.Cartesian3.packedLength)i[a]=z.Cartesian3.unpack(e,t);n=e[t++];var o=new Array(n);for(a=0;a<n;++a,t+=u.Cartesian2.packedLength)o[a]=u.Cartesian2.unpack(e,t);var l=u.Ellipsoid.unpack(e,t,b);t+=u.Ellipsoid.packedLength;var s=g.VertexFormat.unpack(e,t,P);t+=g.VertexFormat.packedLength;var d,p=e[t++],c=e[t++],m=new B.Matrix4;return e.length>t&&(B.Matrix4.unpack(e,t++,m),t+=15),d=e.length>t?e[t++]:0,I.defined(r)?(r._positions=i,r._shape=o,r._ellipsoid=u.Ellipsoid.clone(l,r._ellipsoid),r._vertexFormat=g.VertexFormat.clone(s,r._vertexFormat),r._cornerType=p,r._granularity=c,r._rootTransform=m,r._isFromGLP=d,r):(_.polylinePositions=i,_.shapePositions=o,_.cornerType=p,_.granularity=c,_.rootTransform=m,_.isFromGLP=d,new x(_))};var E=new d.BoundingRectangle;return x.createGeometry=function(e){var t=e._positions,r=z.Cartesian3.distance(t[0],t[1]),n=s.arrayRemoveDuplicates(t,z.Cartesian3.equalsEpsilon),i=e._shape,i=m.PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(i);if(!(n.length<2||i.length<3)){q.PolygonPipeline.computeWindingOrder2D(i)===q.WindingOrder.CLOCKWISE&&i.reverse();var a=d.BoundingRectangle.fromPoints(i,E);return v(m.PolylineVolumeGeometryLibrary.computePositions(n,i,a,e,!0),i,a,e._vertexFormat,e._rootTransform,r,e._isFromGLP)}},function(e,t){return I.defined(t)&&(e=x.unpack(e,t)),e._ellipsoid=u.Ellipsoid.clone(e._ellipsoid),x.createGeometry(e)}});
