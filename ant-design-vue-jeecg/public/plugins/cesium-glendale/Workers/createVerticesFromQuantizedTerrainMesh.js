define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian3-e5933291","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./createTaskProcessorWorker","./Matrix4-a018fd55","./RuntimeError-2109023a","./Cartesian2-b1f4b655","./Transforms-b0e569fa","./AttributeCompression-2d47cb6b","./IndexDatatype-53503fee","./IntersectionTests-9d7ddacd","./Plane-6e6a4f39","./WebMercatorProjection-0e41bb58","./EllipsoidTangentPlane-6d5e3584","./OrientedBoundingBox-028c2054","./TerrainEncoding-cefb2ce3"],function(Te,e,pe,Ee,t,r,n,fe,i,ye,ve,Ne,we,o,a,xe,Me,be,Ce){"use strict";function Se(){e.DeveloperError.throwInstantiationError()}Object.defineProperties(Se.prototype,{errorEvent:{get:e.DeveloperError.throwInstantiationError},credit:{get:e.DeveloperError.throwInstantiationError},tilingScheme:{get:e.DeveloperError.throwInstantiationError},ready:{get:e.DeveloperError.throwInstantiationError},readyPromise:{get:e.DeveloperError.throwInstantiationError},hasWaterMask:{get:e.DeveloperError.throwInstantiationError},hasVertexNormals:{get:e.DeveloperError.throwInstantiationError},availability:{get:e.DeveloperError.throwInstantiationError}});var s=[];Se.getRegularGridIndices=function(e,t){var r=s[e];Te.defined(r)||(s[e]=r=[]);var n=r[t];return Te.defined(n)||p(e,t,n=e*t<pe.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var u=[];Se.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=u[e];Te.defined(r)||(u[e]=r=[]);var n,i,o,a,s,d,c=r[t];return Te.defined(c)||(n=Se.getRegularGridIndices(e,t),o=(i=T(e,t)).westIndicesSouthToNorth,a=i.southIndicesEastToWest,s=i.eastIndicesNorthToSouth,d=i.northIndicesWestToEast,c=r[t]={indices:n,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:s,northIndicesWestToEast:d}),c};var g=[];function T(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function p(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,c=i+1;r[n++]=i,r[n++]=s,r[n++]=c,r[n++]=c,r[n++]=s,r[n++]=d,++i}++i}}function d(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}Se.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=g[e];Te.defined(r)||(g[e]=r=[]);var n,i,o,a,s,d,c,u,h,l,I,m=r[t];return Te.defined(m)||(a=(n=e*t)+(o=2*e+2*t),s=(i=(e-1)*(t-1)*6)+6*Math.max(0,o-4),c=(d=T(e,t)).westIndicesSouthToNorth,u=d.southIndicesEastToWest,h=d.eastIndicesNorthToSouth,l=d.northIndicesWestToEast,p(e,t,I=we.IndexDatatype.createTypedArray(a,s),0),Se.addSkirtIndices(c,u,h,l,n,I,i),m=r[t]={indices:I,westIndicesSouthToNorth:c,southIndicesEastToWest:u,eastIndicesNorthToSouth:h,northIndicesWestToEast:l,indexCountWithoutSkirts:i}),m},Se.addSkirtIndices=function(e,t,r,n,i,o,a){var s=i;a=d(e,s,o,a),a=d(t,s+=e.length,o,a),a=d(r,s+=t.length,o,a),d(n,s+=r.length,o,a)},Se.heightmapTerrainQuality=.25,Se.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*Se.heightmapTerrainQuality/(t*r)},Se.prototype.requestTileGeometry=e.DeveloperError.throwInstantiationError,Se.prototype.getLevelMaximumGeometricError=e.DeveloperError.throwInstantiationError,Se.prototype.getTileDataAvailable=e.DeveloperError.throwInstantiationError,Se.prototype.loadTileDataAvailability=e.DeveloperError.throwInstantiationError;var Ae=32767,Pe=new Ee.Cartesian3,We=new Ee.Cartesian3,De=new Ee.Cartesian3,Be=new ye.Cartographic,Fe=new ye.Cartesian2,ke=new Ee.Cartesian3,Ve=new fe.Matrix4,_e=new fe.Matrix4;function He(e,t,r,n,i,o,a,s,d){var c=Number.POSITIVE_INFINITY,u=i.north,h=i.south,l=i.east,I=i.west;l<I&&(l+=pe.CesiumMath.TWO_PI);for(var m=e.length,g=0;g<m;++g){var T=e[g],p=r[T],E=n[T];Be.longitude=pe.CesiumMath.lerp(I,l,E.x),Be.latitude=pe.CesiumMath.lerp(h,u,E.y),Be.height=p-t;var f=o.cartographicToCartesian(Be,Pe);fe.Matrix4.multiplyByPoint(a,f,f),Ee.Cartesian3.minimumByComponent(f,s,s),Ee.Cartesian3.maximumByComponent(f,d,d),c=Math.min(c,Be.height)}return c}function Oe(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m){var g=Te.defined(a),T=d.north,p=d.south,E=d.east,f=d.west;E<f&&(E+=pe.CesiumMath.TWO_PI);for(var y=r.length,v=0;v<y;++v){var N=r[v],w=i[N],x=o[N];Be.longitude=pe.CesiumMath.lerp(f,E,x.x)+I,Be.latitude=pe.CesiumMath.lerp(p,T,x.y)+m,Be.height=w-c;var M,b,C,S,A,P=s.cartographicToCartesian(Be,Pe);g&&(M=2*N,Fe.x=a[M],Fe.y=a[1+M],1!==u&&(b=Ne.AttributeCompression.octDecode(Fe.x,Fe.y,ke),C=ve.Transforms.eastNorthUpToFixedFrame(Pe,s,_e),S=fe.Matrix4.inverseTransformation(C,Ve),fe.Matrix4.multiplyByPointAsVector(S,b,b),b.z*=u,Ee.Cartesian3.normalize(b,b),fe.Matrix4.multiplyByPointAsVector(C,b,b),Ee.Cartesian3.normalize(b,b),Ne.AttributeCompression.octEncode(b,Fe))),n.hasWebMercatorT&&(A=(xe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Be.latitude)-h)*l),t=n.encode(e,t,P,x,Be.height,Fe,A)}}function Ge(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),Te.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return n(function(e,t){var r,n,i=e.quantizedVertices,o=i.length/3,a=e.octEncodedNormals,s=e.westIndices.length+e.eastIndices.length+e.southIndices.length+e.northIndices.length,d=e.includeWebMercatorT,c=ye.Rectangle.clone(e.rectangle),u=c.west,h=c.south,l=c.east,I=c.north,m=ye.Ellipsoid.clone(e.ellipsoid),g=e.exaggeration,T=e.minimumHeight*g,p=e.maximumHeight*g,E=e.relativeToCenter,f=ve.Transforms.eastNorthUpToFixedFrame(E,m),y=fe.Matrix4.inverseTransformation(f,new fe.Matrix4);d&&(r=xe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(h),n=1/(xe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(I)-r));var v=i.subarray(0,o),N=i.subarray(o,2*o),w=i.subarray(2*o,3*o),x=Te.defined(a),M=new Array(o),b=new Array(o),C=new Array(o),S=d?new Array(o):[],A=We;A.x=Number.POSITIVE_INFINITY,A.y=Number.POSITIVE_INFINITY,A.z=Number.POSITIVE_INFINITY;var P=De;P.x=Number.NEGATIVE_INFINITY,P.y=Number.NEGATIVE_INFINITY,P.z=Number.NEGATIVE_INFINITY;for(var W=Number.POSITIVE_INFINITY,D=Number.NEGATIVE_INFINITY,B=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,k=0;k<o;++k){var V=v[k],_=N[k],H=V/Ae,O=_/Ae,G=pe.CesiumMath.lerp(T,p,w[k]/Ae);Be.longitude=pe.CesiumMath.lerp(u,l,H),Be.latitude=pe.CesiumMath.lerp(h,I,O),Be.height=G,W=Math.min(Be.longitude,W),D=Math.max(Be.longitude,D),B=Math.min(Be.latitude,B),F=Math.max(Be.latitude,F);var Y=m.cartographicToCartesian(Be);M[k]=new ye.Cartesian2(H,O),b[k]=G,C[k]=Y,d&&(S[k]=(xe.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Be.latitude)-r)*n),fe.Matrix4.multiplyByPoint(y,Y,Pe),Ee.Cartesian3.minimumByComponent(Pe,A,A),Ee.Cartesian3.maximumByComponent(Pe,P,P)}var z,R,L,U=Ge(e.westIndices,function(e,t){return M[e].y-M[t].y}),j=Ge(e.eastIndices,function(e,t){return M[t].y-M[e].y}),q=Ge(e.southIndices,function(e,t){return M[t].x-M[e].x}),Q=Ge(e.northIndices,function(e,t){return M[e].x-M[t].x});1!==g&&(R=ve.BoundingSphere.fromPoints(C),z=be.OrientedBoundingBox.fromRectangle(c,T,p,m)),(1!==g||T<0)&&(L=new Ce.EllipsoidalOccluder(m).computeHorizonCullingPointPossiblyUnderEllipsoid(E,C,T));var K=T,K=Math.min(K,He(e.westIndices,e.westSkirtHeight,b,M,c,m,y,A,P));K=Math.min(K,He(e.southIndices,e.southSkirtHeight,b,M,c,m,y,A,P)),K=Math.min(K,He(e.eastIndices,e.eastSkirtHeight,b,M,c,m,y,A,P)),K=Math.min(K,He(e.northIndices,e.northSkirtHeight,b,M,c,m,y,A,P));for(var X,Z,J,$,ee=new Me.AxisAlignedBoundingBox(A,P,E),te=new Ce.TerrainEncoding(ee,K,p,f,x,d),re=te.getStride(),ne=new Float32Array(o*re+s*re),ie=0,oe=0;oe<o;++oe){x&&(X=2*oe,Fe.x=a[X],Fe.y=a[1+X],1!==g&&(Z=Ne.AttributeCompression.octDecode(Fe.x,Fe.y,ke),J=ve.Transforms.eastNorthUpToFixedFrame(C[oe],m,_e),$=fe.Matrix4.inverseTransformation(J,Ve),fe.Matrix4.multiplyByPointAsVector($,Z,Z),Z.z*=g,Ee.Cartesian3.normalize(Z,Z),fe.Matrix4.multiplyByPointAsVector(J,Z,Z),Ee.Cartesian3.normalize(Z,Z),Ne.AttributeCompression.octEncode(Z,Fe))),ie=te.encode(ne,ie,C[oe],M[oe],b[oe],Fe,S[oe])}var ae=Math.max(0,2*(s-4)),se=e.indices.length+3*ae,de=we.IndexDatatype.createTypedArray(o+s,se);de.set(e.indices,0);var ce=1e-4*(D-W),ue=1e-4*(F-B),he=-ce,le=ce,Ie=ue,me=-ue,ge=o*re;return Oe(ne,ge,U,te,b,M,a,m,c,e.westSkirtHeight,g,r,n,he,0),Oe(ne,ge+=e.westIndices.length*re,q,te,b,M,a,m,c,e.southSkirtHeight,g,r,n,0,me),Oe(ne,ge+=e.southIndices.length*re,j,te,b,M,a,m,c,e.eastSkirtHeight,g,r,n,le,0),Oe(ne,ge+=e.eastIndices.length*re,Q,te,b,M,a,m,c,e.northSkirtHeight,g,r,n,0,Ie),Se.addSkirtIndices(U,q,j,Q,o,de,e.indices.length),t.push(ne.buffer,de.buffer),{vertices:ne.buffer,indices:de.buffer,westIndicesSouthToNorth:U,southIndicesEastToWest:q,eastIndicesNorthToSouth:j,northIndicesWestToEast:Q,vertexStride:re,center:E,minimumHeight:T,maximumHeight:p,boundingSphere:R,orientedBoundingBox:z,occludeePointInScaledSpace:L,encoding:te,indexCountWithoutSkirts:e.indices.length}})});
