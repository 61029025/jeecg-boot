var LMV=function(r){var n={};function s(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}return s.m=r,s.c=n,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s="./src/file-loaders/workers/MainWorker-web.js")}({"./extensions/CompGeom/fuzzy-math.js":function(t,e,r){"use strict";r.r(e),r.d(e,"TOL",function(){return n}),r.d(e,"isZero",function(){return s}),r.d(e,"isEqual",function(){return i});var n=1e-6;function s(t){return Math.abs(t)<n}function i(t,e){return s(t-e)}},"./extensions/CompGeom/point-list-3d.js":function(t,e,r){"use strict";r.r(e),r.d(e,"UniquePointList3D",function(){return n});var s=r("./extensions/CompGeom/fuzzy-math.js");function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var b={x:0,y:0,z:0},n=function(){function n(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.getVertex=t,this.bbox=e,this.boxSize=this.bbox.size().length(),r=r||s.TOL,this.precisionTolerance=0<r?r:-r*this.boxSize,this.scale=1/this.precisionTolerance,this.snapBaseX=this.bbox.min.x,this.snapBaseY=this.bbox.min.y,this.snapBaseZ=this.bbox.min.z,this.xymap={}}var t,e,r;return t=n,(e=[{key:"findOrAddPoint",value:function(t,e,r,n){for(var s,i=0|(t-this.snapBaseX)*this.scale,a=0|(e-this.snapBaseY)*this.scale,o=0|(r-this.snapBaseZ)*this.scale,u=1/0,h=i-1;h<=1+i;h++){var l=this.xymap[h];if(l)for(var c=a-1;c<=1+a;c++){var f=l[c];if(f)for(var d=o-1;d<=1+o;d++){var p,m=f[d];void 0!==m&&(this.getVertex(m,b),(p=(b.x-t)*(b.x-t)+(b.y-e)*(b.y-e)+(b.z-r)*(b.z-r))<u&&(s=m,u=p))}}}if(void 0!==(s=Math.sqrt(u)>this.precisionTolerance?void 0:s))return s;var g=this.xymap[i];return((g=g||(this.xymap[i]={}))[a]||(g[a]={}))[o]=n}}])&&i(t.prototype,e),r&&i(t,r),n}()},"./node_modules/isomorphic-ws/browser.js":function(r,t,e){!function(t){var e=null;"undefined"!=typeof WebSocket?e=WebSocket:"undefined"!=typeof MozWebSocket?e=MozWebSocket:void 0!==t?e=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?e=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(e=self.WebSocket||self.MozWebSocket),r.exports=e}.call(this,e("./node_modules/webpack/buildin/global.js"))},"./node_modules/node-libs-browser/mock/empty.js":function(t,e){},"./node_modules/pako/index.js":function(t,e,r){"use strict";var n={};(0,r("./node_modules/pako/lib/utils/common.js").assign)(n,r("./node_modules/pako/lib/deflate.js"),r("./node_modules/pako/lib/inflate.js"),r("./node_modules/pako/lib/zlib/constants.js")),t.exports=n},"./node_modules/pako/lib/deflate.js":function(t,e,r){"use strict";var a=r("./node_modules/pako/lib/zlib/deflate.js"),o=r("./node_modules/pako/lib/utils/common.js"),u=r("./node_modules/pako/lib/utils/strings.js"),n=r("./node_modules/pako/lib/zlib/messages.js"),s=r("./node_modules/pako/lib/zlib/zstream.js"),h=Object.prototype.toString,l=0,i=-1,c=0,f=8;function d(t){if(!(this instanceof d))return new d(t);this.options=o.assign({level:i,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},t||{});var e=this.options;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0,(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy))!==l)throw new Error(n[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){e="string"==typeof e.dictionary?u.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary;if((t=a.deflateSetDictionary(this.strm,e))!==l)throw new Error(n[t]);this._dict_set=!0}}function p(t,e){e=new d(e);if(e.push(t,!0),e.err)throw e.msg||n[e.err];return e.result}d.prototype.push=function(t,e){var r,n,s=this.strm,i=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=u.string2buf(t):"[object ArrayBuffer]"===h.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new o.Buf8(i),s.next_out=0,s.avail_out=i),1!==(r=a.deflate(s,n))&&r!==l)return this.onEnd(r),!(this.ended=!0)}while(0!==s.avail_out&&(0!==s.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(u.buf2binstring(o.shrinkBuf(s.output,s.next_out))):this.onData(o.shrinkBuf(s.output,s.next_out))),(0<s.avail_in||0===s.avail_out)&&1!==r);return 4===n?(r=a.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===l):2!==n||(this.onEnd(l),!(s.avail_out=0))},d.prototype.onData=function(t){this.chunks.push(t)},d.prototype.onEnd=function(t){t===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=d,e.deflate=p,e.deflateRaw=function(t,e){return(e=e||{}).raw=!0,p(t,e)},e.gzip=function(t,e){return(e=e||{}).gzip=!0,p(t,e)}},"./node_modules/pako/lib/inflate.js":function(t,e,r){"use strict";var c=r("./node_modules/pako/lib/zlib/inflate.js"),f=r("./node_modules/pako/lib/utils/common.js"),d=r("./node_modules/pako/lib/utils/strings.js"),p=r("./node_modules/pako/lib/zlib/constants.js"),n=r("./node_modules/pako/lib/zlib/messages.js"),s=r("./node_modules/pako/lib/zlib/zstream.js"),i=r("./node_modules/pako/lib/zlib/gzheader.js"),m=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=f.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;t=c.inflateInit2(this.strm,e.windowBits);if(t!==p.Z_OK)throw new Error(n[t]);if(this.header=new i,c.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=d.string2buf(e.dictionary):"[object ArrayBuffer]"===m.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=c.inflateSetDictionary(this.strm,e.dictionary))!==p.Z_OK))throw new Error(n[t])}function o(t,e){e=new a(e);if(e.push(t,!0),e.err)throw e.msg||n[e.err];return e.result}a.prototype.push=function(t,e){var r,n,s,i,a,o=this.strm,u=this.options.chunkSize,h=this.options.dictionary,l=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof t?o.input=d.binstring2buf(t):"[object ArrayBuffer]"===m.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new f.Buf8(u),o.next_out=0,o.avail_out=u),(r=(r=c.inflate(o,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&h?c.inflateSetDictionary(this.strm,h):r)===p.Z_BUF_ERROR&&!0===l&&(r=p.Z_OK,l=!1),r!==p.Z_STREAM_END&&r!==p.Z_OK)return this.onEnd(r),!(this.ended=!0)}while(o.next_out&&(0!==o.avail_out&&r!==p.Z_STREAM_END&&(0!==o.avail_in||n!==p.Z_FINISH&&n!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(s=d.utf8border(o.output,o.next_out),i=o.next_out-s,a=d.buf2string(o.output,s),o.next_out=i,o.avail_out=u-i,i&&f.arraySet(o.output,o.output,s,i,0),this.onData(a)):this.onData(f.shrinkBuf(o.output,o.next_out)))),0===o.avail_in&&0===o.avail_out&&(l=!0),(0<o.avail_in||0===o.avail_out)&&r!==p.Z_STREAM_END);return(n=r===p.Z_STREAM_END?p.Z_FINISH:n)===p.Z_FINISH?(r=c.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===p.Z_OK):n!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(o.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){t===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=f.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=a,e.inflate=o,e.inflateRaw=function(t,e){return(e=e||{}).raw=!0,o(t,e)},e.ungzip=o},"./node_modules/pako/lib/utils/common.js":function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;e.assign=function(t){for(var e,r,n=Array.prototype.slice.call(arguments,1);n.length;){var s=n.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var i in s)e=s,r=i,Object.prototype.hasOwnProperty.call(e,r)&&(t[i]=s[i])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,r,n,s){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),s);else for(var i=0;i<n;i++)t[s+i]=e[r+i]},flattenChunks:function(t){for(var e,r,n,s=0,i=0,a=t.length;i<a;i++)s+=t[i].length;for(n=new Uint8Array(s),i=e=0,a=t.length;i<a;i++)r=t[i],n.set(r,e),e+=r.length;return n}},i={arraySet:function(t,e,r,n,s){for(var i=0;i<n;i++)t[s+i]=e[r+i]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,s)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(n)},"./node_modules/pako/lib/utils/strings.js":function(t,e,r){"use strict";var u=r("./node_modules/pako/lib/utils/common.js"),s=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch(t){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){i=!1}for(var h=new u.Buf8(256),n=0;n<256;n++)h[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(t,e){if(e<65534&&(t.subarray&&i||!t.subarray&&s))return String.fromCharCode.apply(null,u.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}h[254]=h[254]=1,e.string2buf=function(t){for(var e,r,n,s,i=t.length,a=0,o=0;o<i;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<i&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),a+=r<128?1:r<2048?2:r<65536?3:4;for(e=new u.Buf8(a),o=s=0;s<a;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<i&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},e.buf2binstring=function(t){return l(t,t.length)},e.binstring2buf=function(t){for(var e=new u.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},e.buf2string=function(t,e){for(var r,n,s=e||t.length,i=new Array(2*s),a=0,o=0;o<s;)if((r=t[o++])<128)i[a++]=r;else if(4<(n=h[r]))i[a++]=65533,o+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&o<s;)r=r<<6|63&t[o++],n--;1<n?i[a++]=65533:r<65536?i[a++]=r:(r-=65536,i[a++]=55296|r>>10&1023,i[a++]=56320|1023&r)}return l(i,a)},e.utf8border=function(t,e){for(var r=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=r&&128==(192&t[r]);)r--;return!(r<0)&&0!==r&&r+h[t[r]]>e?r:e}},"./node_modules/pako/lib/zlib/adler32.js":function(t,e,r){"use strict";t.exports=function(t,e,r,n){for(var s=65535&t|0,i=t>>>16&65535|0,a=0;0!==r;){for(a=2e3<r?2e3:r,r-=a;i=i+(s=s+e[n++]|0)|0,--a;);s%=65521,i%=65521}return s|i<<16|0}},"./node_modules/pako/lib/zlib/constants.js":function(t,e,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},"./node_modules/pako/lib/zlib/crc32.js":function(t,e,r){"use strict";var o=function(){for(var t=[],e=0;e<256;e++){for(var r=e,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;t[e]=r}return t}();t.exports=function(t,e,r,n){var s=o,i=n+r;t^=-1;for(var a=n;a<i;a++)t=t>>>8^s[255&(t^e[a])];return-1^t}},"./node_modules/pako/lib/zlib/deflate.js":function(t,e,r){"use strict";var o,c=r("./node_modules/pako/lib/utils/common.js"),u=r("./node_modules/pako/lib/zlib/trees.js"),f=r("./node_modules/pako/lib/zlib/adler32.js"),d=r("./node_modules/pako/lib/zlib/crc32.js"),n=r("./node_modules/pako/lib/zlib/messages.js"),h=0,l=4,p=0,m=-2,g=-1,b=4,s=2,y=8,v=9,i=286,a=30,_=19,x=2*i+1,w=15,k=3,I=258,S=I+k+1,A=42,O=113,C=1,T=2,E=3,j=4;function z(t,e){return t.msg=n[e],e}function P(t){return(t<<1)-(4<t?9:0)}function M(t){for(var e=t.length;0<=--e;)t[e]=0}function L(t){var e=t.state,r=e.pending;0!==(r=r>t.avail_out?t.avail_out:r)&&(c.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function F(t,e){u._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,L(t.strm)}function V(t,e){t.pending_buf[t.pending++]=e}function U(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function B(t,e){var r,n,s=t.max_chain_length,i=t.strstart,a=t.prev_length,o=t.nice_match,u=t.strstart>t.w_size-S?t.strstart-(t.w_size-S):0,h=t.window,l=t.w_mask,c=t.prev,f=t.strstart+I,d=h[i+a-1],p=h[i+a];t.prev_length>=t.good_match&&(s>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(r=e)+a]===p&&h[r+a-1]===d&&h[r]===h[i]&&h[++r]===h[i+1]){for(i+=2,r++;h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&h[++i]===h[++r]&&i<f;);if(n=I-(f-i),i=f-I,a<n){if(t.match_start=e,o<=(a=n))break;d=h[i+a-1],p=h[i+a]}}}while((e=c[e&l])>u&&0!=--s);return a<=t.lookahead?a:t.lookahead}function D(t){var e,r,n,s,i,a,o,u,h,l=t.w_size;do{if(h=t.window_size-t.lookahead-t.strstart,t.strstart>=l+(l-S)){for(c.arraySet(t.window,t.window,l,l,0),t.match_start-=l,t.strstart-=l,t.block_start-=l,r=t.hash_size,e=r;n=t.head[--e],t.head[e]=l<=n?n-l:0,--r;);for(r=l,e=r;n=t.prev[--e],t.prev[e]=l<=n?n-l:0,--r;);h+=l}if(0===t.strm.avail_in)break;if(i=t.strm,a=t.window,o=t.strstart+t.lookahead,u=h,h=void 0,h=i.avail_in,r=0===(h=u<h?u:h)?0:(i.avail_in-=h,c.arraySet(a,i.input,i.next_in,h,o),1===i.state.wrap?i.adler=f(i.adler,a,h,o):2===i.state.wrap&&(i.adler=d(i.adler,a,h,o)),i.next_in+=h,i.total_in+=h,h),t.lookahead+=r,t.lookahead+t.insert>=k)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[s+k-1])&t.hash_mask,t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<k)););}while(t.lookahead<S&&0!==t.strm.avail_in)}function R(t,e){for(var r,n;;){if(t.lookahead<S){if(D(t),t.lookahead<S&&e===h)return C;if(0===t.lookahead)break}if(r=0,t.lookahead>=k&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-S&&(t.match_length=B(t,r)),t.match_length>=k)if(n=u._tr_tally(t,t.strstart-t.match_start,t.match_length-k),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=k){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(F(t,!1),0===t.strm.avail_out))return C}return t.insert=t.strstart<k-1?t.strstart:k-1,e===l?(F(t,!0),0===t.strm.avail_out?E:j):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?C:T}function N(t,e){for(var r,n,s;;){if(t.lookahead<S){if(D(t),t.lookahead<S&&e===h)return C;if(0===t.lookahead)break}if(r=0,t.lookahead>=k&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=k-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-S&&(t.match_length=B(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===k&&4096<t.strstart-t.match_start)&&(t.match_length=k-1)),t.prev_length>=k&&t.match_length<=t.prev_length){for(s=t.strstart+t.lookahead-k,n=u._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-k),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=s&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=k-1,t.strstart++,n&&(F(t,!1),0===t.strm.avail_out))return C}else if(t.match_available){if((n=u._tr_tally(t,0,t.window[t.strstart-1]))&&F(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return C}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=u._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<k-1?t.strstart:k-1,e===l?(F(t,!0),0===t.strm.avail_out?E:j):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?C:T}function W(t,e,r,n,s){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=s}function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new c.Buf16(2*x),this.dyn_dtree=new c.Buf16(2*(2*a+1)),this.bl_tree=new c.Buf16(2*(2*_+1)),M(this.dyn_ltree),M(this.dyn_dtree),M(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new c.Buf16(w+1),this.heap=new c.Buf16(2*i+1),M(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new c.Buf16(2*i+1),M(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function H(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=s,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?A:O,t.adler=2===e.wrap?0:1,e.last_flush=h,u._tr_init(e),p):z(t,m)}function q(t){var e=H(t);return e===p&&((t=t.state).window_size=2*t.w_size,M(t.head),t.max_lazy_match=o[t.level].max_lazy,t.good_match=o[t.level].good_length,t.nice_match=o[t.level].nice_length,t.max_chain_length=o[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=k-1,t.match_available=0,t.ins_h=0),e}function Z(t,e,r,n,s,i){if(!t)return m;var a=1;if(e===g&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),s<1||v<s||r!==y||n<8||15<n||e<0||9<e||i<0||b<i)return z(t,m);8===n&&(n=9);var o=new G;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+k-1)/k),o.window=new c.Buf8(2*o.w_size),o.head=new c.Buf16(o.hash_size),o.prev=new c.Buf16(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new c.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=i,o.method=r,q(t)}o=[new W(0,0,0,0,function(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(D(t),0===t.lookahead&&e===h)return C;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,F(t,!1),0===t.strm.avail_out))return C;if(t.strstart-t.block_start>=t.w_size-S&&(F(t,!1),0===t.strm.avail_out))return C}return t.insert=0,e===l?(F(t,!0),0===t.strm.avail_out?E:j):(t.strstart>t.block_start&&(F(t,!1),t.strm.avail_out),C)}),new W(4,4,8,4,R),new W(4,5,16,8,R),new W(4,6,32,32,R),new W(4,4,16,16,N),new W(8,16,32,32,N),new W(8,16,128,128,N),new W(8,32,128,256,N),new W(32,128,258,1024,N),new W(32,258,258,4096,N)],e.deflateInit=function(t,e){return Z(t,e,y,15,8,0)},e.deflateInit2=Z,e.deflateReset=q,e.deflateResetKeep=H,e.deflateSetHeader=function(t,e){return!t||!t.state||2!==t.state.wrap?m:(t.state.gzhead=e,p)},e.deflate=function(t,e){var r,n,s,i;if(!t||!t.state||5<e||e<0)return t?z(t,m):m;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&e!==l)return z(t,0===t.avail_out?-5:m);if(r.strm=t,a=r.last_flush,r.last_flush=e,r.status===A&&(2===r.wrap?(t.adler=0,V(r,31),V(r,139),V(r,8),r.gzhead?(V(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),V(r,255&r.gzhead.time),V(r,r.gzhead.time>>8&255),V(r,r.gzhead.time>>16&255),V(r,r.gzhead.time>>24&255),V(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),V(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(V(r,255&r.gzhead.extra.length),V(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=d(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(V(r,0),V(r,0),V(r,0),V(r,0),V(r,0),V(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),V(r,3),r.status=O)):(i=y+(r.w_bits-8<<4)<<8,i|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(i|=32),i+=31-i%31,r.status=O,U(r,i),0!==r.strstart&&(U(r,t.adler>>>16),U(r,65535&t.adler)),t.adler=1)),69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),L(t),n=r.pending,r.pending!==r.pending_buf_size));)V(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),L(t),n=r.pending,r.pending===r.pending_buf_size)){s=1;break}}while(s=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,V(r,s),0!==s);r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),0===s&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),L(t),n=r.pending,r.pending===r.pending_buf_size)){s=1;break}}while(s=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,V(r,s),0!==s);r.gzhead.hcrc&&r.pending>n&&(t.adler=d(t.adler,r.pending_buf,r.pending-n,n)),0===s&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&L(t),r.pending+2<=r.pending_buf_size&&(V(r,255&t.adler),V(r,t.adler>>8&255),t.adler=0,r.status=O)):r.status=O),0!==r.pending){if(L(t),0===t.avail_out)return r.last_flush=-1,p}else if(0===t.avail_in&&P(e)<=P(a)&&e!==l)return z(t,-5);if(666===r.status&&0!==t.avail_in)return z(t,-5);if(0!==t.avail_in||0!==r.lookahead||e!==h&&666!==r.status){var a=2===r.strategy?function(t,e){for(var r;;){if(0===t.lookahead&&(D(t),0===t.lookahead)){if(e===h)return C;break}if(t.match_length=0,r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(F(t,!1),0===t.strm.avail_out))return C}return t.insert=0,e===l?(F(t,!0),0===t.strm.avail_out?E:j):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?C:T}(r,e):3===r.strategy?function(t,e){for(var r,n,s,i,a=t.window;;){if(t.lookahead<=I){if(D(t),t.lookahead<=I&&e===h)return C;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=k&&0<t.strstart&&(n=a[s=t.strstart-1])===a[++s]&&n===a[++s]&&n===a[++s]){for(i=t.strstart+I;n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&n===a[++s]&&s<i;);t.match_length=I-(i-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=k?(r=u._tr_tally(t,1,t.match_length-k),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=u._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(F(t,!1),0===t.strm.avail_out))return C}return t.insert=0,e===l?(F(t,!0),0===t.strm.avail_out?E:j):t.last_lit&&(F(t,!1),0===t.strm.avail_out)?C:T}(r,e):o[r.level].func(r,e);if(a!==E&&a!==j||(r.status=666),a===C||a===E)return 0===t.avail_out&&(r.last_flush=-1),p;if(a===T&&(1===e?u._tr_align(r):5!==e&&(u._tr_stored_block(r,0,0,!1),3===e&&(M(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),L(t),0===t.avail_out))return r.last_flush=-1,p}return e!==l?p:r.wrap<=0?1:(2===r.wrap?(V(r,255&t.adler),V(r,t.adler>>8&255),V(r,t.adler>>16&255),V(r,t.adler>>24&255),V(r,255&t.total_in),V(r,t.total_in>>8&255),V(r,t.total_in>>16&255),V(r,t.total_in>>24&255)):(U(r,t.adler>>>16),U(r,65535&t.adler)),L(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?p:1)},e.deflateEnd=function(t){var e;return t&&t.state?(e=t.state.status)!==A&&69!==e&&73!==e&&91!==e&&103!==e&&e!==O&&666!==e?z(t,m):(t.state=null,e===O?z(t,-3):p):m},e.deflateSetDictionary=function(t,e){var r,n,s,i,a,o,u,h=e.length;if(!t||!t.state)return m;if(2===(i=(r=t.state).wrap)||1===i&&r.status!==A||r.lookahead)return m;for(1===i&&(t.adler=f(t.adler,e,h,0)),r.wrap=0,h>=r.w_size&&(0===i&&(M(r.head),r.strstart=0,r.block_start=0,r.insert=0),u=new c.Buf8(r.w_size),c.arraySet(u,e,h-r.w_size,r.w_size,0),e=u,h=r.w_size),a=t.avail_in,o=t.next_in,u=t.input,t.avail_in=h,t.next_in=0,t.input=e,D(r);r.lookahead>=k;){for(n=r.strstart,s=r.lookahead-(k-1);r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+k-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++,--s;);r.strstart=n,r.lookahead=k-1,D(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=k-1,r.match_available=0,t.next_in=o,t.input=u,t.avail_in=a,r.wrap=i,p},e.deflateInfo="pako deflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/gzheader.js":function(t,e,r){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},"./node_modules/pako/lib/zlib/inffast.js":function(t,e,r){"use strict";t.exports=function(t,e){var r,n,s,i,a,o,u=t.state,h=t.next_in,l=t.input,c=h+(t.avail_in-5),f=t.next_out,d=t.output,p=f-(e-t.avail_out),m=f+(t.avail_out-257),g=u.dmax,b=u.wsize,y=u.whave,v=u.wnext,_=u.window,x=u.hold,w=u.bits,k=u.lencode,I=u.distcode,S=(1<<u.lenbits)-1,A=(1<<u.distbits)-1;t:do{w<15&&(x+=l[h++]<<w,w+=8,x+=l[h++]<<w,w+=8),r=k[x&S];e:for(;;){if(x>>>=n=r>>>24,w-=n,0===(n=r>>>16&255))d[f++]=65535&r;else{if(!(16&n)){if(0==(64&n)){r=k[(65535&r)+(x&(1<<n)-1)];continue e}if(32&n){u.mode=12;break t}t.msg="invalid literal/length code",u.mode=30;break t}s=65535&r,(n&=15)&&(w<n&&(x+=l[h++]<<w,w+=8),s+=x&(1<<n)-1,x>>>=n,w-=n),w<15&&(x+=l[h++]<<w,w+=8,x+=l[h++]<<w,w+=8),r=I[x&A];r:for(;;){if(x>>>=n=r>>>24,w-=n,!(16&(n=r>>>16&255))){if(0==(64&n)){r=I[(65535&r)+(x&(1<<n)-1)];continue r}t.msg="invalid distance code",u.mode=30;break t}if(i=65535&r,w<(n&=15)&&(x+=l[h++]<<w,(w+=8)<n&&(x+=l[h++]<<w,w+=8)),g<(i+=x&(1<<n)-1)){t.msg="invalid distance too far back",u.mode=30;break t}if(x>>>=n,w-=n,(n=f-p)<i){if(n=i-n,y<n&&u.sane){t.msg="invalid distance too far back",u.mode=30;break t}if(o=_,(a=0)===v){if(a+=b-n,n<s){for(s-=n;d[f++]=_[a++],--n;);a=f-i,o=d}}else if(v<n){if(a+=b+v-n,(n-=v)<s){for(s-=n;d[f++]=_[a++],--n;);if(a=0,v<s){for(n=v,s-=n;d[f++]=_[a++],--n;);a=f-i,o=d}}}else if(a+=v-n,n<s){for(s-=n;d[f++]=_[a++],--n;);a=f-i,o=d}for(;2<s;)d[f++]=o[a++],d[f++]=o[a++],d[f++]=o[a++],s-=3;s&&(d[f++]=o[a++],1<s&&(d[f++]=o[a++]))}else{for(a=f-i;d[f++]=d[a++],d[f++]=d[a++],d[f++]=d[a++],s-=3,2<s;);s&&(d[f++]=d[a++],1<s&&(d[f++]=d[a++]))}break}}break}}while(h<c&&f<m);x&=(1<<(w-=(s=w>>3)<<3))-1,t.next_in=h-=s,t.next_out=f,t.avail_in=h<c?c-h+5:5-(h-c),t.avail_out=f<m?m-f+257:257-(f-m),u.hold=x,u.bits=w}},"./node_modules/pako/lib/zlib/inflate.js":function(t,e,r){"use strict";var T=r("./node_modules/pako/lib/utils/common.js"),E=r("./node_modules/pako/lib/zlib/adler32.js"),j=r("./node_modules/pako/lib/zlib/crc32.js"),z=r("./node_modules/pako/lib/zlib/inffast.js"),P=r("./node_modules/pako/lib/zlib/inftrees.js"),M=1,L=2,F=0,V=-2,U=1,n=852,s=592;function B(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function i(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new T.Buf16(320),this.work=new T.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function a(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=U,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new T.Buf32(n),e.distcode=e.distdyn=new T.Buf32(s),e.sane=1,e.back=-1,F):V}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,a(t)):V}function u(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?V:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,o(t))):V}function h(t,e){var r;return t?(r=new i,(t.state=r).window=null,(e=u(t,e))!==F&&(t.state=null),e):V}var D,R,N=!0;function W(t,e,r,n){var s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new T.Buf8(s.wsize)),n>=s.wsize?(T.arraySet(s.window,e,r-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(t=s.wsize-s.wnext,T.arraySet(s.window,e,r-n,t=n<t?n:t,s.wnext),(n-=t)?(T.arraySet(s.window,e,r-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=t,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=t))),0}e.inflateReset=o,e.inflateReset2=u,e.inflateResetKeep=a,e.inflateInit=function(t){return h(t,15)},e.inflateInit2=h,e.inflate=function(t,e){var r,n,s,i,a,o,u,h,l,c,f,d,p,m,g,b,y,v,_,x,w,k,I,S,A=0,O=new T.Buf8(4),C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return V;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,s=t.output,u=t.avail_out,i=t.next_in,n=t.input,o=t.avail_in,h=r.hold,l=r.bits,c=o,f=u,k=F;t:for(;;)switch(r.mode){case U:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(2&r.wrap&&35615===h){O[r.check=0]=255&h,O[1]=h>>>8&255,r.check=j(r.check,O,2,0),l=h=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&h)){t.msg="unknown compression method",r.mode=30;break}if(l-=4,w=8+(15&(h>>>=4)),0===r.wbits)r.wbits=w;else if(w>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<w,t.adler=r.check=1,r.mode=512&h?10:12,l=h=0;break;case 2:for(;l<16;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(r.flags=h,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(O[0]=255&h,O[1]=h>>>8&255,r.check=j(r.check,O,2,0)),l=h=0,r.mode=3;case 3:for(;l<32;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.head&&(r.head.time=h),512&r.flags&&(O[0]=255&h,O[1]=h>>>8&255,O[2]=h>>>16&255,O[3]=h>>>24&255,r.check=j(r.check,O,4,0)),l=h=0,r.mode=4;case 4:for(;l<16;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(O[0]=255&h,O[1]=h>>>8&255,r.check=j(r.check,O,2,0)),l=h=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(O[0]=255&h,O[1]=h>>>8&255,r.check=j(r.check,O,2,0)),l=h=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=o<(d=r.length)?o:d)&&(r.head&&(w=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),T.arraySet(r.head.extra,n,i,d,w)),512&r.flags&&(r.check=j(r.check,n,d,i)),o-=d,i+=d,r.length-=d),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(d=0;w=n[i+d++],r.head&&w&&r.length<65536&&(r.head.name+=String.fromCharCode(w)),w&&d<o;);if(512&r.flags&&(r.check=j(r.check,n,d,i)),o-=d,i+=d,w)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(d=0;w=n[i+d++],r.head&&w&&r.length<65536&&(r.head.comment+=String.fromCharCode(w)),w&&d<o;);if(512&r.flags&&(r.check=j(r.check,n,d,i)),o-=d,i+=d,w)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(h!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}l=h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}t.adler=r.check=B(h),l=h=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=u,t.next_in=i,t.avail_in=o,r.hold=h,r.bits=l,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){h>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}switch(r.last=1&h,--l,3&(h>>>=1)){case 0:r.mode=14;break;case 1:if(!function(t){if(N){var e;for(D=new T.Buf32(512),R=new T.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(P(M,t.lens,0,288,D,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;P(L,t.lens,0,32,R,0,t.work,{bits:5}),N=!1}t.lencode=D,t.lenbits=9,t.distcode=R,t.distbits=5}(r),r.mode=20,6!==e)break;h>>>=2,l-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}h>>>=2,l-=2;break;case 14:for(h>>>=7&l,l-=7&l;l<32;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&h,l=h=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(d=r.length){if(0===(d=u<(d=o<d?o:d)?u:d))break t;T.arraySet(s,n,i,d,a),o-=d,i+=d,u-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(r.nlen=257+(31&h),h>>>=5,l-=5,r.ndist=1+(31&h),h>>>=5,l-=5,r.ncode=4+(15&h),h>>>=4,l-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.lens[C[r.have++]]=7&h,h>>>=3,l-=3}for(;r.have<19;)r.lens[C[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,I={bits:r.lenbits},k=P(0,r.lens,0,19,r.lencode,0,r.work,I),r.lenbits=I.bits,k){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;b=(A=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&A,!((g=A>>>24)<=l);){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(y<16)h>>>=g,l-=g,r.lens[r.have++]=y;else{if(16===y){for(S=g+2;l<S;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(h>>>=g,l-=g,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}w=r.lens[r.have-1],d=3+(3&h),h>>>=2,l-=2}else if(17===y){for(S=g+3;l<S;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}l-=g,w=0,d=3+(7&(h>>>=g)),h>>>=3,l-=3}else{for(S=g+7;l<S;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}l-=g,w=0,d=11+(127&(h>>>=g)),h>>>=7,l-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=w}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,I={bits:r.lenbits},k=P(M,r.lens,0,r.nlen,r.lencode,0,r.work,I),r.lenbits=I.bits,k){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,I={bits:r.distbits},k=P(L,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,I),r.distbits=I.bits,k){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=u){t.next_out=a,t.avail_out=u,t.next_in=i,t.avail_in=o,r.hold=h,r.bits=l,z(t,f),a=t.next_out,s=t.output,u=t.avail_out,i=t.next_in,n=t.input,o=t.avail_in,h=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;b=(A=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&A,!((g=A>>>24)<=l);){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(b&&0==(240&b)){for(v=g,_=b,x=y;b=(A=r.lencode[x+((h&(1<<v+_)-1)>>v)])>>>16&255,y=65535&A,!(v+(g=A>>>24)<=l);){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}h>>>=v,l-=v,r.back+=v}if(h>>>=g,l-=g,r.back+=g,r.length=y,0===b){r.mode=26;break}if(32&b){r.back=-1,r.mode=12;break}if(64&b){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&b,r.mode=22;case 22:if(r.extra){for(S=r.extra;l<S;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;b=(A=r.distcode[h&(1<<r.distbits)-1])>>>16&255,y=65535&A,!((g=A>>>24)<=l);){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(0==(240&b)){for(v=g,_=b,x=y;b=(A=r.distcode[x+((h&(1<<v+_)-1)>>v)])>>>16&255,y=65535&A,!(v+(g=A>>>24)<=l);){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}h>>>=v,l-=v,r.back+=v}if(h>>>=g,l-=g,r.back+=g,64&b){t.msg="invalid distance code",r.mode=30;break}r.offset=y,r.extra=15&b,r.mode=24;case 24:if(r.extra){for(S=r.extra;l<S;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===u)break t;if(r.offset>(d=f-u)){if(d=r.offset-d,d>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),m=r.window}else m=s,p=a-r.offset,d=r.length;for(u<d&&(d=u),u-=d,r.length-=d;s[a++]=m[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===u)break t;s[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break t;o--,h|=n[i++]<<l,l+=8}if(f-=u,t.total_out+=f,r.total+=f,f&&(t.adler=r.check=(r.flags?j:E)(r.check,s,f,a-f)),f=u,(r.flags?h:B(h))!==r.check){t.msg="incorrect data check",r.mode=30;break}l=h=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break t;o--,h+=n[i++]<<l,l+=8}if(h!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}l=h=0}r.mode=29;case 29:k=1;break t;case 30:k=-3;break t;case 31:return-4;case 32:default:return V}return t.next_out=a,t.avail_out=u,t.next_in=i,t.avail_in=o,r.hold=h,r.bits=l,(r.wsize||f!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&W(t,t.output,t.next_out,f-t.avail_out)?(r.mode=31,-4):(c-=t.avail_in,f-=t.avail_out,t.total_in+=c,t.total_out+=f,r.total+=f,r.wrap&&f&&(t.adler=r.check=(r.flags?j:E)(r.check,s,f,t.next_out-f)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==c&&0===f||4===e)&&k===F?-5:k)},e.inflateEnd=function(t){if(!t||!t.state)return V;var e=t.state;return e.window&&(e.window=null),t.state=null,F},e.inflateGetHeader=function(t,e){return!t||!t.state||0==(2&(t=t.state).wrap)?V:((t.head=e).done=!1,F)},e.inflateSetDictionary=function(t,e){var r,n=e.length;return!t||!t.state||0!==(r=t.state).wrap&&11!==r.mode?V:11===r.mode&&E(1,e,n,0)!==r.check?-3:W(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,F)},e.inflateInfo="pako inflate (from Nodeca project)"},"./node_modules/pako/lib/zlib/inftrees.js":function(t,e,r){"use strict";var M=r("./node_modules/pako/lib/utils/common.js"),L=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],F=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],V=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],U=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,e,r,n,s,i,a,o){for(var u,h,l,c,f,d,p,m,g,b=o.bits,y=0,v=0,_=0,x=0,w=0,k=0,I=0,S=0,A=0,O=0,C=null,T=0,E=new M.Buf16(16),j=new M.Buf16(16),z=null,P=0,y=0;y<=15;y++)E[y]=0;for(v=0;v<n;v++)E[e[r+v]]++;for(w=b,x=15;1<=x&&0===E[x];x--);if(x<w&&(w=x),0===x)return s[i++]=20971520,s[i++]=20971520,o.bits=1,0;for(_=1;_<x&&0===E[_];_++);for(w<_&&(w=_),y=S=1;y<=15;y++)if(S<<=1,(S-=E[y])<0)return-1;if(0<S&&(0===t||1!==x))return-1;for(j[1]=0,y=1;y<15;y++)j[y+1]=j[y]+E[y];for(v=0;v<n;v++)0!==e[r+v]&&(a[j[e[r+v]]++]=v);if(d=0===t?(C=z=a,19):1===t?(C=L,T-=257,z=F,P-=257,256):(C=V,z=U,-1),y=_,f=i,I=v=O=0,l=-1,c=(A=1<<(k=w))-1,1===t&&852<A||2===t&&592<A)return 1;for(;;){for(p=y-I,g=a[v]<d?(m=0,a[v]):a[v]>d?(m=z[P+a[v]],C[T+a[v]]):(m=96,0),u=1<<y-I,h=1<<k,_=h;s[f+(O>>I)+(h-=u)]=p<<24|m<<16|g|0,0!==h;);for(u=1<<y-1;O&u;)u>>=1;if(0!==u?(O&=u-1,O+=u):O=0,v++,0==--E[y]){if(y===x)break;y=e[r+a[v]]}if(w<y&&(O&c)!==l){for(f+=_,S=1<<(k=y-(I=0===I?w:I));k+I<x&&!((S-=E[k+I])<=0);)k++,S<<=1;if(A+=1<<k,1===t&&852<A||2===t&&592<A)return 1;s[l=O&c]=w<<24|k<<16|f-i|0}}return 0!==O&&(s[f+O]=y-I<<24|64<<16|0),o.bits=w,0}},"./node_modules/pako/lib/zlib/messages.js":function(t,e,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},"./node_modules/pako/lib/zlib/trees.js":function(t,e,r){"use strict";var s=r("./node_modules/pako/lib/utils/common.js"),o=0,u=1;function n(t){for(var e=t.length;0<=--e;)t[e]=0}var i=0,a=29,h=256,l=h+1+a,c=30,f=19,g=2*l+1,b=15,d=16,p=7,m=256,y=16,v=17,_=18,x=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],w=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=new Array(2*(l+2));n(S);var A=new Array(2*c);n(A);var O=new Array(512);n(O);var C=new Array(256);n(C);var T=new Array(a);n(T);var E,j,z,P=new Array(c);function M(t,e,r,n,s){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=s,this.has_stree=t&&t.length}function L(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function F(t){return t<256?O[t]:O[256+(t>>>7)]}function V(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function U(t,e,r){t.bi_valid>d-r?(t.bi_buf|=e<<t.bi_valid&65535,V(t,t.bi_buf),t.bi_buf=e>>d-t.bi_valid,t.bi_valid+=r-d):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function B(t,e,r){U(t,r[2*e],r[2*e+1])}function D(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function R(t,e,r){for(var n,s=new Array(b+1),i=0,a=1;a<=b;a++)s[a]=i=i+r[a-1]<<1;for(n=0;n<=e;n++){var o=t[2*n+1];0!==o&&(t[2*n]=D(s[o]++,o))}}function N(t){for(var e=0;e<l;e++)t.dyn_ltree[2*e]=0;for(e=0;e<c;e++)t.dyn_dtree[2*e]=0;for(e=0;e<f;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*m]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function W(t){8<t.bi_valid?V(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function G(t,e,r,n){var s=2*e,i=2*r;return t[s]<t[i]||t[s]===t[i]&&n[e]<=n[r]}function H(t,e,r){for(var n=t.heap[r],s=r<<1;s<=t.heap_len&&(s<t.heap_len&&G(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!G(e,n,t.heap[s],t.depth));)t.heap[r]=t.heap[s],r=s,s<<=1;t.heap[r]=n}function q(t,e,r){var n,s,i,a,o=0;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*o]<<8|t.pending_buf[t.d_buf+2*o+1],s=t.pending_buf[t.l_buf+o],o++,0==n?B(t,s,e):(B(t,(i=C[s])+h+1,e),0!==(a=x[i])&&U(t,s-=T[i],a),B(t,i=F(--n),r),0!==(a=w[i])&&U(t,n-=P[i],a)),o<t.last_lit;);B(t,m,e)}function Z(t,e){var r,n,s,i=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,u=e.stat_desc.elems,h=-1;for(t.heap_len=0,t.heap_max=g,r=0;r<u;r++)0!==i[2*r]?(t.heap[++t.heap_len]=h=r,t.depth[r]=0):i[2*r+1]=0;for(;t.heap_len<2;)i[2*(s=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[s]=0,t.opt_len--,o&&(t.static_len-=a[2*s+1]);for(e.max_code=h,r=t.heap_len>>1;1<=r;r--)H(t,i,r);for(s=u;r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],H(t,i,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,i[2*s]=i[2*r]+i[2*n],t.depth[s]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,i[2*r+1]=i[2*n+1]=s,t.heap[1]=s++,H(t,i,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){for(var r,n,s,i,a,o=e.dyn_tree,u=e.max_code,h=e.stat_desc.static_tree,l=e.stat_desc.has_stree,c=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,d=e.stat_desc.max_length,p=0,m=0;m<=b;m++)t.bl_count[m]=0;for(o[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<g;r++)d<(m=o[2*o[2*(n=t.heap[r])+1]+1]+1)&&(m=d,p++),o[2*n+1]=m,u<n||(t.bl_count[m]++,i=0,f<=n&&(i=c[n-f]),a=o[2*n],t.opt_len+=a*(m+i),l&&(t.static_len+=a*(h[2*n+1]+i)));if(0!==p){do{for(m=d-1;0===t.bl_count[m];)m--}while(t.bl_count[m]--,t.bl_count[m+1]+=2,t.bl_count[d]--,0<(p-=2));for(m=d;0!==m;m--)for(n=t.bl_count[m];0!==n;)u<(s=t.heap[--r])||(o[2*s+1]!==m&&(t.opt_len+=(m-o[2*s+1])*o[2*s],o[2*s+1]=m),n--)}}(t,e),R(i,h,t.bl_count)}function X(t,e,r){var n,s,i=-1,a=e[1],o=0,u=7,h=4;for(0===a&&(u=138,h=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)s=a,a=e[2*(n+1)+1],++o<u&&s===a||(o<h?t.bl_tree[2*s]+=o:0!==s?(s!==i&&t.bl_tree[2*s]++,t.bl_tree[2*y]++):o<=10?t.bl_tree[2*v]++:t.bl_tree[2*_]++,i=s,h=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4))}function Y(t,e,r){var n,s,i=-1,a=e[1],o=0,u=7,h=4;for(0===a&&(u=138,h=3),n=0;n<=r;n++)if(s=a,a=e[2*(n+1)+1],!(++o<u&&s===a)){if(o<h)for(;B(t,s,t.bl_tree),0!=--o;);else 0!==s?(s!==i&&(B(t,s,t.bl_tree),o--),B(t,y,t.bl_tree),U(t,o-3,2)):o<=10?(B(t,v,t.bl_tree),U(t,o-3,3)):(B(t,_,t.bl_tree),U(t,o-11,7));i=s,h=(o=0)===a?(u=138,3):s===a?(u=6,3):(u=7,4)}}n(P);var J=!1;function Q(t,e,r,n){U(t,(i<<1)+(n?1:0),3),n=e,e=r,r=!0,W(t=t),r&&(V(t,e),V(t,~e)),s.arraySet(t.pending_buf,t.window,n,e,t.pending),t.pending+=e}e._tr_init=function(t){J||(function(){for(var t,e,r,n=new Array(b+1),s=0,i=0;i<a-1;i++)for(T[i]=s,t=0;t<1<<x[i];t++)C[s++]=i;for(C[s-1]=i,i=r=0;i<16;i++)for(P[i]=r,t=0;t<1<<w[i];t++)O[r++]=i;for(r>>=7;i<c;i++)for(P[i]=r<<7,t=0;t<1<<w[i]-7;t++)O[256+r++]=i;for(e=0;e<=b;e++)n[e]=0;for(t=0;t<=143;)S[2*t+1]=8,t++,n[8]++;for(;t<=255;)S[2*t+1]=9,t++,n[9]++;for(;t<=279;)S[2*t+1]=7,t++,n[7]++;for(;t<=287;)S[2*t+1]=8,t++,n[8]++;for(R(S,l+1,n),t=0;t<c;t++)A[2*t+1]=5,A[2*t]=D(t,5);E=new M(S,x,h+1,l,b),j=new M(A,w,0,c,b),z=new M(new Array(0),k,0,f,p)}(),J=!0),t.l_desc=new L(t.dyn_ltree,E),t.d_desc=new L(t.dyn_dtree,j),t.bl_desc=new L(t.bl_tree,z),t.bi_buf=0,t.bi_valid=0,N(t)},e._tr_stored_block=Q,e._tr_flush_block=function(t,e,r,n){var s,i,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){for(var e=4093624447,r=0;r<=31;r++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*r])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return u;for(r=32;r<h;r++)if(0!==t.dyn_ltree[2*r])return u;return o}(t)),Z(t,t.l_desc),Z(t,t.d_desc),a=function(t){var e;for(X(t,t.dyn_ltree,t.l_desc.max_code),X(t,t.dyn_dtree,t.d_desc.max_code),Z(t,t.bl_desc),e=f-1;3<=e&&0===t.bl_tree[2*I[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),s=t.opt_len+3+7>>>3,(i=t.static_len+3+7>>>3)<=s&&(s=i)):s=i=r+5,r+4<=s&&-1!==e?Q(t,e,r,n):4===t.strategy||i===s?(U(t,2+(n?1:0),3),q(t,S,A)):(U(t,4+(n?1:0),3),function(t,e,r,n){var s;for(U(t,e-257,5),U(t,r-1,5),U(t,n-4,4),s=0;s<n;s++)U(t,t.bl_tree[2*I[s]+1],3);Y(t,t.dyn_ltree,e-1),Y(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),q(t,t.dyn_ltree,t.dyn_dtree)),N(t),n&&W(t)},e._tr_tally=function(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(C[r]+h+1)]++,t.dyn_dtree[2*F(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function(t){U(t,2,3),B(t,m,S),16===(t=t).bi_valid?(V(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}},"./node_modules/pako/lib/zlib/zstream.js":function(t,e,r){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},"./node_modules/pend/index.js":function(t,e){function r(){this.pending=0,this.max=1/0,this.listeners=[],this.waiting=[],this.error=null}function n(e){e.pending+=1;var r=!1;return function(t){if(r)throw new Error("callback called twice");r=!0,e.error=e.error||t,--e.pending,0<e.waiting.length&&e.pending<e.max?s(e,e.waiting.shift()):0===e.pending&&(t=e.listeners,e.listeners=[],t.forEach(n))};function n(t){t(e.error)}}function s(t,e){e(n(t))}(t.exports=r).prototype.go=function(t){this.pending<this.max?s(this,t):this.waiting.push(t)},r.prototype.wait=function(t){0===this.pending?t(this.error):this.listeners.push(t)},r.prototype.hold=function(){return n(this)}},"./node_modules/webpack/buildin/amd-options.js":function(e,t){!function(t){e.exports=t}.call(this,{})},"./node_modules/webpack/buildin/global.js":function(t,e){var r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},"./node_modules/webpack/buildin/module.js":function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},"./src/analytics/index.js":function(t,e,r){"use strict";r.r(e),r.d(e,"analytics",function(){return u});var s=r("./src/logger/Logger.js"),i=r("./src/analytics/interface.js");function a(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.providerMap={},this.instances=[],this.superProps={},this.shouldTrack=!0,this.trackCache=[]}var e,r,n;return e=t,(r=[{key:"registerProvider",value:function(t){var e,r=this;t?t.name?((e=t.name.toLowerCase())in this.providerMap?s.logger.warn("Provider with name ".concat(t.name," already registered")):this.providerMap[e]=t,t=this.createInstance(t.name,t.defaultOptions),this.instances.push(t),this.shouldTrack&&this.init(t),0<this.trackCache.length&&(this.trackCache.forEach(function(t){var e=t.event,t=t.properties;r.track(e,t)}),this.trackCache=[])):s.logger.error("missing provider name"):s.logger.error("Undefined provider")}},{key:"init",value:function(t){t.initialized||(t.init(),t.register(this.superProps))}},{key:"createInstance",value:function(t,e){var r=t&&t.toLowerCase();if(r in this.providerMap){var n=this.providerMap[r],e=new n(e);if(!(e instanceof i.AnalyticsProviderInterface))throw new Error("not an analytics provider");return n.instanceCount=n.instanceCount||0,e.name="".concat(r,"-").concat(n.instanceCount),n.instanceCount++,e}s.logger.error("Unknown ".concat(t))}},{key:"optIn",value:function(t){var e=this;this.instances.forEach(function(t){return e.init(t)}),this._callMethod("optIn",t),this.shouldTrack=!0}},{key:"optOut",value:function(t){this._callMethod("optOut",t),this.shouldTrack=!1}},{key:"hasOptedOut",value:function(){return this._callMethod("hasOptedOut")}},{key:"getDistinctId",value:function(){return this._callMethod("getDistinctId")}},{key:"track",value:function(t,e){this.shouldTrack&&(0===this.instances.length?this.trackCache.push({event:t,properties:e}):this._callMethod("track",t,e))}},{key:"identify",value:function(t){this._callMethod("identify",t)}},{key:"_callMethod",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=e[0],s=e.slice(1,e.length);return this.instances.map(function(t){return{name:t.name,value:t[n].apply(t,a(s))}})}}])&&o(e.prototype,r),n&&o(e,n),t}())},"./src/analytics/interface.js":function(t,e,r){"use strict";function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e),r.d(e,"AnalyticsProviderInterface",function(){return n});var n=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t}var t,r,n;return t=e,n=[{key:"name",get:function(){return null}},{key:"defaultOptions",get:function(){return{}}}],(r=[{key:"init",value:function(){}},{key:"register",value:function(){}},{key:"optIn",value:function(t){}},{key:"optOut",value:function(t){}},{key:"hasOptedOut",value:function(){}},{key:"getDistinctId",value:function(){}},{key:"track",value:function(t,e){}},{key:"identify",value:function(t){}}])&&s(t.prototype,r),n&&s(t,n),e}()},"./src/compat.js":function(t,M,L){"use strict";L.r(M),function(t){function e(){return"undefined"!=typeof window&&null!==window?window:"undefined"!=typeof self&&null!==self?self:t}L.d(M,"getGlobal",function(){return e}),L.d(M,"isBrowser",function(){return r}),L.d(M,"isNodeJS",function(){return n}),L.d(M,"isIE11",function(){return s}),L.d(M,"isIE11Only",function(){return o}),L.d(M,"launchFullscreen",function(){return h}),L.d(M,"exitFullscreen",function(){return l}),L.d(M,"inFullscreen",function(){return c}),L.d(M,"fullscreenElement",function(){return f}),L.d(M,"isFullscreenAvailable",function(){return d}),L.d(M,"isFullscreenEnabled",function(){return p}),L.d(M,"getAndroidVersion",function(){return m}),L.d(M,"isTouchDevice",function(){return g}),L.d(M,"isIOSDevice",function(){return y}),L.d(M,"isAndroidDevice",function(){return x}),L.d(M,"isMobileDevice",function(){return w}),L.d(M,"isPhoneFormFactor",function(){return k}),L.d(M,"isSafari",function(){return I}),L.d(M,"isFirefox",function(){return S}),L.d(M,"isChrome",function(){return A}),L.d(M,"isMac",function(){return O}),L.d(M,"isWindows",function(){return C}),L.d(M,"ObjectAssign",function(){return T}),L.d(M,"disableDocumentTouchSafari",function(){return j}),L.d(M,"enableDocumentTouchSafari",function(){return z}),L.d(M,"touchStartToClick",function(){return P});var i=e(),a=i&&i.document,r="undefined"!=typeof navigator,n=function(){return!r},s=r&&!!navigator.userAgent.match(/Edge|Trident\/7\./),o=r&&!!navigator.userAgent.match(/Trident\/7\./);function u(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var r=a.createEvent("CustomEvent");return r.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),r}function h(t,e){t.requestFullscreen?t.requestFullscreen(e):t.mozRequestFullScreen?t.mozRequestFullScreen(e):t.webkitRequestFullscreen?t.webkitRequestFullscreen(e):t.msRequestFullscreen&&t.msRequestFullscreen(e)}function l(t){c(t)&&(t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen?t.webkitExitFullscreen():t.msExitFullscreen&&t.msExitFullscreen())}function c(t){return"webkitIsFullScreen"in t?!!t.webkitIsFullScreen:"fullscreenElement"in t?!!t.fullscreenElement:"mozFullScreenElement"in t?!!t.mozFullScreenElement:"msFullscreenElement"in t?!!t.msFullscreenElement:!!t.querySelector(".viewer-fill-browser")}function f(t){return t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement}function d(t){return t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.msRequestFullscreen}function p(t){return t.fullscreenEnabled||t.webkitFullscreenEnabled||t.mozFullScreenEnabled||t.msFullscreenEnabled}function m(t){t=(t=t||navigator.userAgent).match(/Android\s([0-9\.]*)/);return!!t&&t[1]}function g(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)}"undefined"!=typeof window&&s&&(u.prototype=i.CustomEvent.prototype,i.CustomEvent=u),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(t,e){if(!e||e>this.byteLength?e=this.byteLength:e<0&&(e=this.byteLength+e)<0&&(e=0),e<=(t=t<0&&(t=this.byteLength+t)<0?0:t))return new ArrayBuffer;for(var r=e-t,n=new Uint8Array(this,t,r),s=new Uint8Array(r),i=0;i<r;i++)s[i]=n[i];return s.buffer}),Math.log2=Math.log2||function(t){return Math.log(t)/Math.LN2},"undefined"!=typeof window&&(i.BlobBuilder=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder);var b=r&&(/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints);function y(){return b}var v,_=r&&-1!==navigator.userAgent.toLowerCase().indexOf("android");function x(){return _}function w(){return!!r&&(b||_)}function k(){return w()&&(i.matchMedia("(max-width: 750px)").matches||i.matchMedia("(max-height: 750px)").matches)}function I(){if(!r)return!1;var t=navigator.userAgent.toLowerCase();return-1!==t.indexOf("safari")&&-1===t.indexOf("chrome")}function S(){return!!r&&-1!==navigator.userAgent.toLowerCase().indexOf("firefox")}function A(){return!!r&&-1!==navigator.userAgent.toLowerCase().indexOf("chrome")}function O(){return!!r&&-1!==navigator.userAgent.toLowerCase().indexOf("mac os")}function C(){if(!r)return!1;var t=navigator.userAgent.toLowerCase();return-1!==t.indexOf("win32")||-1!==t.indexOf("windows")}function T(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function E(t){var e=i.hasOwnProperty("pageXOffset")?i.pageXOffset:a.documentElement.scrollLeft,r=i.hasOwnProperty("pageYOffset")?i.pageYOffset:a.documentElement.scrollTop,n=(void 0===t.pageX?t.changedTouches[0]:t).pageX,s=(void 0===t.pageY?t.changedTouches[0]:t).pageY,r=a.elementFromPoint(n-e,s-r);return!r||"CANVAS"!==r.nodeName||("true"!==r.getAttribute("data-viewer-canvas")||(t.preventDefault(),!1))}function j(){w()&&I()&&(a.documentElement.addEventListener("touchstart",E,!0),a.documentElement.addEventListener("touchmove",E,!0),a.documentElement.addEventListener("touchcanceled",E,!0),a.documentElement.addEventListener("touchend",E,!0))}function z(){w()&&I()&&(a.documentElement.removeEventListener("touchstart",E,!0),a.documentElement.removeEventListener("touchmove",E,!0),a.documentElement.removeEventListener("touchcanceled",E,!0),a.documentElement.removeEventListener("touchend",E,!0))}function P(t){t.target.className&&(-1<t.target.className.indexOf("fullscreen")||-1<t.target.className.indexOf("webvr"))||(t.preventDefault(),t.stopPropagation(),t.target.click())}(v=e()).performance||(v.performance=Date),Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},String.prototype.repeat=String.prototype.repeat||function(t){if(t<1)return"";for(var e="",r=this.valueOf();1<t;)1&t&&(e+=r),t>>=1,r+=r;return e+r},Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{value:function r(){var n=isNaN(arguments[0])?1:Number(arguments[0]);return n?Array.prototype.reduce.call(this,function(t,e){return Array.isArray(e)?t.push.apply(t,r.call(e,n-1)):t.push(e),t},[]):Array.prototype.slice.call(this)}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{enumerable:!1,value:function(t,e,r){r=void 0===r?this.length:r;for(var n=e=void 0===e?0:e;n<r;++n)this[n]=t}}),Int32Array.prototype.lastIndexOf=Int32Array.prototype.lastIndexOf||function(t,e){return Array.prototype.lastIndexOf.call(this,t,e)},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,value:function(t,e){for(var r=this.length,n=0;n<r;++n){var s=this[n];if(t.call(e,s,n,this))return s}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var s=arguments[n];if(null!=s)for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(r[i]=s[i])}return r},writable:!0,configurable:!0}),"undefined"==typeof window||!s&&!b||HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(s,i,a){var o=this;setTimeout(function(){for(var t=atob(o.toDataURL(i,a).split(",")[1]),e=t.length,r=new Uint8Array(e),n=0;n<e;n++)r[n]=t.charCodeAt(n);s(new Blob([r],{type:i||"image/png"}))})}}),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(t,e){if(e=void 0!==e?e:this.length,"[object Array]"===Object.prototype.toString.call(this))return _slice.call(this,t,e);var r,n,s=[],i=this.length,a=0<=(a=t||0)?a:Math.max(0,i+a),t="number"==typeof e?Math.min(e,i):i;if(0<(n=(t=e<0?i+e:t)-a))if(s=new Array(n),this.charAt)for(r=0;r<n;r++)s[r]=this.charAt(a+r);else for(r=0;r<n;r++)s[r]=this[a+r];return s})}.call(this,L("./node_modules/webpack/buildin/global.js"))},"./src/file-loaders/lmvtk/common/InputStream.js":function(t,e,r){"use strict";r.r(e),r.d(e,"InputStream",function(){return l});var n=r("./src/file-loaders/lmvtk/common/StringUtils.js"),r=new ArrayBuffer(8),o=new Uint8Array(r),s=new Uint16Array(r),i=new Int32Array(r),a=new Uint32Array(r),u=new Float32Array(r),h=new Float64Array(r);function l(t){this.buffer=t,this.offset=0,this.byteLength=t.length}l.prototype.seek=function(t){this.offset=t},l.prototype.getBytes=function(t){var e=new Uint8Array(this.buffer.buffer,this.offset,t);return this.offset+=t,e},l.prototype.getVarints=function(){for(var t,e=0,r=0;e|=(127&(t=this.buffer[this.offset++]))<<r,r+=7,128&t;);return e},l.prototype.getUint8=function(){return this.buffer[this.offset++]},l.prototype.getUint16=function(){return o[0]=this.buffer[this.offset++],o[1]=this.buffer[this.offset++],s[0]},l.prototype.getInt16=function(){var t=this.getUint16();return 32767<t&&(t|=4294901760),t},l.prototype.getInt32=function(){var t=this.buffer,e=o,r=this.offset;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this.offset+=4,i[0]},l.prototype.getUint32=function(){var t=this.buffer,e=o,r=this.offset;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this.offset+=4,a[0]},l.prototype.getFloat32=function(){var t=this.buffer,e=o,r=this.offset;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this.offset+=4,u[0]},l.prototype.getIndicesArray=function(t,e,r){for(var n=this.buffer,s=new Uint8Array(t,e,2*r),i=this.offset,a=0,o=2*r;a<o;a+=2)s[a]=n[i],s[a+1]=n[i+1],i+=4;this.offset=i},l.prototype.getVector3Array=function(t,e,r,n){var s=this.buffer,i=this.offset,a=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);if(3===n&&0===r){t=12*e;a.set(s.subarray(i,i+t)),this.offset+=t}else{n*=4;for(var o=4*r,u=0;u<e;u++){for(var h=0;h<12;h++)a[o+h]=s[i++];o+=n}this.offset=i}},l.prototype.getVector2Array=function(t,e,r,n){var s=this.buffer,i=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a=this.offset;n*=4;for(var o=4*r,u=0;u<e;u++){for(var h=0;h<8;h++)i[o+h]=s[a++];o+=n}this.offset=a},l.prototype.getVector4=function(t,e){for(var r=this.buffer,n=o,s=this.offset,i=u,a=0;a<4;a++)n[0]=r[s],n[1]=r[s+1],n[2]=r[s+2],n[3]=r[s+3],t[e+a]=i[0],s+=4;this.offset=s},l.prototype.getFloat64=function(){for(var t=this.buffer,e=o,r=this.offset,n=0;n<8;n++)e[n]=t[r+n];return this.offset+=8,h[0]},l.prototype.getString=function(t){var e=Object(n.utf8ArrayToString)(this.buffer,this.offset,t);return this.offset+=t,e},l.prototype.reset=function(t){this.buffer=t,this.offset=0,this.byteLength=t.length}},"./src/file-loaders/lmvtk/common/Propdb.js":function(t,e,r){"use strict";r.r(e),r.d(e,"PropertyDatabase",function(){return n});var A=r("./src/file-loaders/lmvtk/common/StringUtils.js"),O=r("./src/file-loaders/lmvtk/common/SearchUtils.js"),C=r("./src/file-loaders/lmvtk/common/PropdbEnums.js");function n(t){var y,v,_,e,x,r,i,a,o,d,w,n,s,u,h,p,m,l,c,k=this,f=!1,g=!1;for(c in t.attrs){"pdb version 2"===(y=Object(A.blobToJson)(t.attrs[c]))[0]&&(f=!0);for(var b=1;b<y.length;b++){switch("Layer"===y[b][0]&&(h=b),y[b][1]){case"__parent__":o=b;break;case"__child__":a=b;break;case"__name__":d=b;break;case"__instanceof__":w=b;break;case"__viewable_in__":n=b;break;case"__externalref__":s=b;break;case"__node_flags__":u=b}f&&y[b][2]===C.AttributeType.DbKey&&(y[b][6]=y[b][6]|C.AttributeFlags.afDirectStorage)}break}for(c in t.avs){(l=t.avs[c])[0]==="[".charCodeAt(0)?_=Object(A.parseIntArray)(t.avs[c],0):(_=l,g=!0),delete t.avs;break}for(c in t.offsets){(l=t.offsets[c])[0]==="[".charCodeAt(0)?(v=Object(A.parseIntArray)(l,1))[v.length-1]=_.length/2:v=new Int32Array(l.buffer,l.byteOffset,l.byteLength/4),delete t.offsets;break}for(c in t.values){e=t.values[c],x=Object(A.findValueOffsets)(e);break}for(c in this.setIdsBlob=function(t){r=t,i=Object(A.findValueOffsets)(t)},t.ids){this.setIdsBlob(t.ids[c]);break}this.getObjectCount=function(){return v.length-1},this.getValueAt=function(t){return Object(A.subBlobToJson)(e,x[t])},this.getIntValueAt=function(t){return Object(A.subBlobToJsonInt)(e,x[t])},this.getIdAt=function(t){return Object(A.subBlobToJson)(r,i[t])},this.externalIdsLoaded=function(){return Boolean(r)},this.getAttrValue=function(t,e,r){t=y[t];return t[6]&C.AttributeFlags.afDirectStorage&&t[2]===C.AttributeType.DbKey?e:r?this.getIntValueAt(e):this.getValueAt(e)},this._getObjectProperty=function(t,e){var r=y[t],n=r[5]||r[0],s=this.attributeHidden(t);return{displayName:n,displayValue:k.getAttrValue(t,e),displayCategory:r[1],attributeName:r[0],type:r[2],units:r[3],hidden:s,precision:r[7]||0,isGIM:8<r.length&&1===r[8]}},this.getObjectProperties=function(t,s,i,a){var o={dbId:t,properties:[]},u=!1,e=s&&-1!==s.indexOf("externalId"),r=this.externalIdsLoaded();e&&!r&&console.error("Requesting externalID requires loading of the externalID table");e=r&&(!s||e);if(e&&(o.externalId=this.getIdAt(t),s&&1===s.length))return o;var h=null;if(this.enumObjectProperties(t,function(t,e){var r,n;t!=w?(r=y[t],s&&-1===s.indexOf(r[0])&&-1===s.indexOf(r[5])||a&&(-1<a.indexOf(r[0])||-1<a.indexOf(r[5]))||(t==d?(n=k.getAttrValue(t,e),u=!0,o.name=n):(n=k.attributeHidden(t),i&&n||(n=k._getObjectProperty(t,e),o.properties.push(n))))):(e=k.getObjectProperties(k.getAttrValue(t,e),s,!0,a))&&e.properties&&(h=e)}),h){for(var n={},l=o.properties,c=0;c<l.length;c++)n[l[c].displayName]=1;o.name||(o.name=h.name);for(var f=h.properties,c=0;c<f.length;c++)n.hasOwnProperty(f[c].displayName)||l.push(f[c])}return!s||o.properties.length||e||u?o:null},this.getExternalIdMapping=function(t){var e={};if(i&&"length"in i)for(var r=1,n=i.length;r<n;++r){var s=this.getIdAt(r);t&&!0!==t[s]||(e[s]=r)}return e},this.findRootNodes=function(){var e=[],i=[];return this.enumObjects(function(t){var r=!1,n=!1,s=!1;k.enumObjectProperties(t,function(t,e){t==o?k.getAttrValue(t,e,!0)&&(n=!0):t==a?r=!0:t==d&&(s=!0)}),s&&!n&&(r?e:i).push(t)}),0<e.length?e:i},this.nodeHasChild=function(t){var e=!1;return this.enumObjectProperties(t,function(t){if(t===a)return e=!0}),e},this.getNodeNameAndChildren=function(r,n){var s,i,t=r.dbId;return this.enumObjectProperties(t,function(t,e){t===o||(t!=a||n?t===d?r.name=k.getAttrValue(t,e):t===u?r.flags=k.getAttrValue(t,e,!0):t===w&&(i=e):(e=k.getAttrValue(t,e,!0))!==r.dbId&&(e={dbId:e,parent:r.dbId},s?s.push(e):s=[e]))}),!r.name&&i&&(t={dbId:k.getAttrValue(w,i,!0),name:null,flags:null},k.getNodeNameAndChildren(t,!0),t.name&&!r.name&&(r.name=t.name)),s};this.buildObjectTree=function(t,e,r,n){var s;e&&(s=function(t){for(var e={},r=0,n=t.length;r<n;r++){var s=t[r];Array.isArray(s)||(s=[s]);for(var i=0;i<s.length;i++){var a=s[i],o=e[a];void 0===o?e[a]=r:Array.isArray(o)?o.push(r):e[a]=[o,r]}}return e}(e)),p={},m=0;n=this.buildObjectTreeRec(t,0,s,0,r,n);return 0<m&&console.warn("Property database integrity not guaranteed ("+m+")."),p=null,n},this.buildObjectTreeRec=function(t,e,r,n,s,i){if(p[t])return m++,0;p[t]=e||t,n>s[0]&&(s[0]=n);var a,o={dbId:t},u=this.getNodeNameAndChildren(o),h=[];if(u)for(var l=0;l<u.length;l++)this.buildObjectTreeRec(u[l].dbId,t,r,n+1,s,i)&&h.push(u[l].dbId);!r||void 0!==(f=r[t])&&(a=Array.isArray(f)?f:[f]);var c=o.flags||0;void 0===c&&(c=a&&a.length?6:(h.length,0));var f=h.length+(a?a.length:0);return f&&i.setNode(t,e,o.name,c,h,a),f},this.getSearchTerms=function(t){for(var e=(t=t.toLowerCase()).match(/"[^"]+"|[^\s]+/g)||[],r=e.length;r--;)e[r]=e[r].replace(/"/g,"");for(var n=[],r=0;r<e.length;r++)1<e[r].length&&n.push(e[r]);return n},this.bruteForceSearch=function(t,s,e){var r=this.getSearchTerms(t);if(0===r.length)return[];for(var n=[],i=null==e?void 0:e.searchHidden,a=null==e?void 0:e.includeInherited,o={},u=0;u<r.length;u++){for(var h=[],l=[],c=0,f=x.length;c<f;c++){var d=this.getValueAt(c);null!==d&&-1!==d.toString().toLowerCase().indexOf(r[u])&&l.push(c)}0!==l.length?(l.sort(function(t,e){return t-e}),this.enumObjects(function(n){k.enumObjectProperties(n,function(t,e){var r;if((a&&t===w&&(r=parseInt(k.getAttrValue(t,e)),o[r]=o[r]||[],o[r].push(n)),!i)&&k.attributeHidden(t))return;e=Object(O.binarySearch)(l,e);if(!(-1===e||s&&s.length&&-1===s.indexOf(y[t][0])))return h.push(n),!0})}),n.push(h)):n.push(h)}e=function(t,e){for(var r=new Set(t),n=0;n<t.length;++n){var s=t[n];if(s in e)for(var i=e[s],a=0;a<i.length;++a){var o=i[a];r.has(o)||(t.push(o),r.add(o))}}};if(1===n.length)return a&&e(n[0],o),n[0];for(var p={},m=n[0],c=0;c<m.length;c++)p[m[c]]=1;for(var g=1;g<n.length;g++){for(var m=n[g],b={},c=0;c<m.length;c++)1===p[m[c]]&&(b[m[c]]=1);p=b}h=[];for(u in p)h.push(parseInt(u));return a&&e(h,o),h},this.bruteForceFind=function(s){var e=[];return this.enumObjects(function(t){var n=!1;k.enumObjectProperties(t,function(t,e){var r=y[t],t=r[0],r=r[5];if(t===s||r===s)return n=!0}),n&&e.push(t)}),e},this.getLayerToNodeIdMapping=function(){var n={};return this.enumObjects(function(r){k.enumObjectProperties(r,function(t,e){if(t==h){e=k.getAttrValue(t,e);return Array.isArray(n[e])||(n[e]=[]),n[e].push(r),!0}})}),n},this.getAttributeDef=function(t){t=y[t];return{name:t[0],category:t[1],dataType:t[2],dataTypeContext:t[3],description:t[4],displayName:t[5],flags:t[6],precision:7<t.length?t[7]:0}},this.enumAttributes=function(t){for(var e=1;e<y.length&&!t(e,this.getAttributeDef(e),y[e]);e++);},this.enumObjectProperties=g?function(t,e){for(var r=v[t],n=v[t+1],s=_,i=0;r<n;){for(var a=s[r++],o=127&a,u=7;128&a;)o|=(127&(a=s[r++]))<<u,u+=7;for(i+=o,o=127&(a=s[r++]),u=7;128&a;)o|=(127&(a=s[r++]))<<u,u+=7;if(e(i,o))break}}:function(t,e){for(var r=2*v[t],n=2*v[t+1],s=r;s<n;s+=2)if(e(_[s],_[s+1]))break};var I={};function S(t,e,r){var n=v[t],s=v[t+1],i=_,a=[],o=[];r=r||{};for(var u=0;n<s;){for(var h,l=i[n++],c=127&l,f=7;128&l;)c|=(127&(l=i[n++]))<<f,f+=7;for(u+=c,c=127&(l=i[n++]),f=7;128&l;)c|=(127&(l=i[n++]))<<f,f+=7;u===w?(h=k.getAttrValue(u,c),o.push(h)):e&&!e[u]||(r[u]=c,a.push(u),a.push(c))}for(var d=0;d<o.length;d++){var p=o[d],m=I[p];m||(I[p]=m=S(p));for(var g=0;g<m.length;g+=2){var b=m[g],y=m[g+1];e&&!e[b]||r[b]||k.attributeHidden(b)||(r[b]=y,a.push(b),a.push(y))}}return a}this.getPropertiesSubsetWithInheritance=g?S:function(t,e,r){var n=2*v[t],s=2*v[t+1],i=[],a=[];r=r||{};for(var o=n;o<s;o+=2){var u,h=_[o],l=_[o+1];h===w?(u=k.getAttrValue(h,l),a.push(u)):e&&!e[h]||(r[h]=l,i.push(h),i.push(l))}for(var c=0;c<a.length;c++){var f=a[c],d=I[f];d||(I[f]=d=S(f));for(var p=0;p<d.length;p+=2){var m=d[p],g=d[p+1];e&&!e[m]||r[m]||k.attributeHidden(m)||(r[m]=g,i.push(m),i.push(g))}}return i},this.findLayers=function(){var t={name:"root",id:1,index:1,children:[],isLayer:!1,childCount:0};if(void 0===h)return t;var r=[],n=this;return this.enumObjects(function(t){n.enumObjectProperties(t,function(t,e){if(t===h){e=n.getValueAt(e);return-1===r.indexOf(e)&&r.push(e),!0}})}),r.sort(function(t,e){return t.localeCompare(e,void 0,{sensitivity:"base",numeric:!0})}),t.childCount=r.length,t.children=r.map(function(t,e){return{name:t,index:e+1,id:e+1,isLayer:!0}}),t},this.enumObjects=function(t,e,r){var n=v.length-1;e="number"==typeof e?Math.max(e,1):1,r="number"==typeof r?Math.min(n,r):n;for(var s=e;s<r&&!t(s);s++);},this.getAttrChild=function(){return a},this.getAttrParent=function(){return o},this.getAttrName=function(){return d},this.getAttrLayers=function(){return h},this.getAttrInstanceOf=function(){return w},this.getAttrViewableIn=function(){return n},this.getAttrXref=function(){return s},this.getAttrNodeFlags=function(){return u},this.attributeHidden=function(t){return 1&y[t][6]||t==o||t==a||t==n||t==s},this._attributeIsBlacklisted=function(t){var e=y[t],t=e[0];return"Dimensions"===e[1]&&-1!==C.RVT_DIM_PROPS.indexOf(t)},this._getAttributeAndValueIds=function(t,e){for(var r=this.getPropertiesSubsetWithInheritance(t),n=0;n<r.length;n+=2){var s=r[n];this._attributeIsBlacklisted(s)||this.attributeHidden(s)||e.push({attrId:s,valId:r[n+1]})}e.sort(function(t,e){return t.attrId-e.attrId})},this.findDifferences=function(t,e,r){var c={changedIds:[]},n=e&&e.dbIds,f=e&&e.listPropChanges;f&&(c.propChanges=[]);function s(t){var e=0,r=0;if(m.length=0,g.length=0,d._getAttributeAndValueIds(t,m,!0,b),p._getAttributeAndValueIds(t,g,!0,y),m.length&&g.length){for(var n=!1,s=void 0;e<m.length&&r<g.length;){var i=m[e],a=g[r],o=i&&i.attrId,u=i&&i.valId,h=a&&a.attrId,l=a&&a.valId;if(o!==h||u!==l){if(n=!0,!f)break;i=void 0===h||o<h,a=void 0;void 0===o||h<o?((a=p._getObjectProperty(h,l)).displayValueB=a.displayValue,a.displayValue=void 0,r++):i?((a=d._getObjectProperty(o,u)).displayValueB=void 0,e++):((a=d._getObjectProperty(o,u)).displayValueB=k.getAttrValue(h,l),e++,r++),(s=s||[]).push(a)}else e++,r++}n&&(c.changedIds.push(t),f&&c.propChanges.push(s))}}function i(t,e){(e=Math.floor(100*t/e))!=a&&(r&&r(e),a=e)}var d=this,p=t,m=[],g=[],b={result:[],dbId:-1},y={result:[],dbId:-1},a=-1;if(n)for(var o=0;o<n.length;o++)s(h=n[o]),i(o,n.length);else for(var u=Math.min(d.getObjectCount(),this.getObjectCount()),h=1;h<u;h++)s(h),i(h,u);return c},this.dtor=function(){i=r=x=e=_=v=y=null,u=s=n=w=d=o=a=0}}},"./src/file-loaders/lmvtk/common/PropdbEnums.js":function(t,e,r){"use strict";r.r(e),r.d(e,"AttributeType",function(){return n}),r.d(e,"AttributeFlags",function(){return s}),r.d(e,"RVT_DIM_PROPS",function(){return i});var n={Unknown:0,Boolean:1,Integer:2,Double:3,Float:4,BLOB:10,DbKey:11,String:20,LocalizableString:21,DateTime:22,GeoLocation:23,Position:24},s={afHidden:1,afDontIndex:2,afDirectStorage:4,afReadOnly:8},i=["Perimeter","Volume","Area","Length","Width","Height"]},"./src/file-loaders/lmvtk/common/SearchUtils.js":function(t,e,r){"use strict";function n(t,e){for(var r,n=0,s=t.length-1;n<=s;){if(e===t[r=(n+s)/2|0])return r;e<t[r]?s=r-1:n=1+r}return-1}r.r(e),r.d(e,"binarySearch",function(){return n})},"./src/file-loaders/lmvtk/common/StringUtils.js":function(t,e,r){"use strict";function a(t,e,r){for(var n,s,i,a="",o=r,u=0;u<o;)switch((n=t[e+u++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:s=t[e+u++],a+=String.fromCharCode((31&n)<<6|63&s);break;case 14:s=t[e+u++],i=t[e+u++],a+=String.fromCharCode((15&n)<<12|(63&s)<<6|(63&i)<<0)}return a}function o(t,e,r){for(var n,s,i,a="",o=[],u=r,h=0,l=0;l<u;){switch((n=t[e+l++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o.push(String.fromCharCode(n));break;case 12:case 13:s=t[e+l++],o.push(String.fromCharCode((31&n)<<6|63&s));break;case 14:s=t[e+l++],i=t[e+l++],o.push(String.fromCharCode((15&n)<<12|(63&s)<<6|(63&i)<<0))}(32768<=++h||u<=l)&&(a+=o.join(""),h=o.length=0)}return a}function n(t,e,r){var n,s,i=r||0,a=t.length;if(e)for(n=0;n<a;n++)1<=(s=t.charCodeAt(n))&&s<=127?e[i++]=s:(2047<s?(e[i++]=224|s>>12&15,e[i++]=128|s>>6&63):e[i++]=192|s>>6&31,e[i++]=128|s>>0&63);else for(n=0;n<a;n++)1<=(s=t.charCodeAt(n))&&s<=127?i++:i+=2047<s?3:2;return i-(r||0)}r.r(e),r.d(e,"utf8BlobToStr",function(){return a}),r.d(e,"safeUtf8BlobToStr",function(){return o}),r.d(e,"utf16to8",function(){return n}),r.d(e,"utf8ArrayToString",function(){return s}),r.d(e,"blobToJson",function(){return i}),r.d(e,"subBlobToJson",function(){return l}),r.d(e,"subBlobToJsonInt",function(){return c}),r.d(e,"parseIntArray",function(){return f}),r.d(e,"findValueOffsets",function(){return d});var u=!0,h=1048576;function s(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=t.length),u)return(h<r?o:a)(t,e,r);for(var n="",s=e,i=e+r;s<i;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}function i(t){t=s(t,0,t.length);return JSON.parse(t)}function l(t,e){if(void 0===e)return"";for(var r=e;r<t.length-1;){var n=t[r];if(44==n&&(10==t[r+1]||13==t[r+1]))break;if(10==n||13==n)break;r++}e=s(t,e,r-e);try{return JSON.parse(e)}catch(t){return console.error("Error parsing property blob to JSON : "+e),e}}function c(t,e){var r=0,n=e;for(34==t[n]&&n++;n<t.length-1;){var s=t[n];if(44==s&&(10==t[n+1]||13==t[n+1]))break;if(10==s||13==s||34==s)break;48<=s&&s<=57&&(r=10*r+(s-48)),n++}return r}function f(t,e){for(var r=0,n=0,s=t.length;n<s;n++)44==t[n]&&r++;r++;for(var i=new Uint32Array(r+(e?1:0)),n=0,a=t.length;91!=t[n]&&n<a;)n++;if(n==t.length)return null;n++;for(var o=!1,r=0,u=0;n<a;){var h=t[n];48<=h&&h<=57?(u=10*u+(h-48),o=!0):44==h||93==h?o&&(i[r++]=u,o=!1,u=0):(o=!1,u=0),n++}return i}function d(t){for(var e=0,r=t.length-1,n=0;n<r;n++)44!=t[n]||10!=t[n+1]&&13!=t[n+1]||e++;if(!e)return null;e++;for(var s=new Uint32Array(e),n=0,e=0;91!=t[n]&&n<r;)n++;s[e++]=++n;for(var i=!1;n<r;)10==t[n]||13==t[n]?i=!0:i&&(i=!1,s[e++]=n),n++;return s}},"./src/file-loaders/lmvtk/common/SvfPlacementUtils.js":function(t,e,r){"use strict";r.r(e),r.d(e,"derivePlacementTransform",function(){return a}),r.d(e,"calculatePlacementWithOffset",function(){return o}),r.d(e,"initPlacement",function(){return n}),r.d(e,"transformAnimations",function(){return l});var s=r("./src/wgs/scene/LmvVector3.js"),i=r("./src/wgs/scene/LmvBox3.js"),b=r("./src/wgs/scene/LmvMatrix4.js");function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t){switch(t){case"meter":case"meters":case"m":return 1;case"feet and inches":case"foot":case"feet":case"ft":return.3048;case"inch":case"inches":case"in":return.0254;case"centimeter":case"centimeters":case"cm":return.01;case"millimeter":case"millimeters":case"mm":return.001;default:return 1}}function a(t,e){var r;t.placementTransform=e.placementTransform,e.applyScaling&&(r="m",t.metadata["distance unit"]&&(r=t.metadata["distance unit"].value),t.scalingUnit=r,"object"===u(e.applyScaling)?(e.applyScaling.from&&(r=e.applyScaling.from),e.applyScaling.to&&(t.scalingUnit=e.applyScaling.to)):t.scalingUnit=e.applyScaling,1!=(i=h(r)/h(t.scalingUnit))&&(r=new b.LmvMatrix4(!0),(o=new b.LmvMatrix4(!0)).elements[0]=i,o.elements[5]=i,o.elements[10]=i,e.placementTransform&&r.copy(e.placementTransform),e.applyPlacementInModelUnits?e.placementTransform=o.multiply(r):e.placementTransform=r.multiply(o),t.placementTransform=e.placementTransform,t.scalingFactor=i));var n,s,i,a,o=t.metadata["custom values"];return o&&o.refPointTransform?(t.refPointTransform=new b.LmvMatrix4(!0),n=t.refPointTransform.elements,s=o.refPointTransform,n[0]=s[0],n[1]=s[1],n[2]=s[2],n[4]=s[3],n[5]=s[4],n[6]=s[5],n[8]=s[6],n[9]=s[7],n[10]=s[8],n[12]=s[9],n[13]=s[10],n[14]=s[11]):(n=(i=t.metadata.georeference)&&i.refPointLMV,s=0,o&&o.hasOwnProperty("angleToTrueNorth")&&(s=Math.PI/180*o.angleToTrueNorth),(n||s)&&((o=(i=new b.LmvMatrix4(!0)).elements)[0]=o[5]=Math.cos(s),o[1]=-Math.sin(s),o[4]=Math.sin(s),o=(a=new b.LmvMatrix4(!0)).elements,n&&(o[12]=-n[0],o[13]=-n[1],o[14]=-n[2]),t.refPointTransform=i.multiply(a))),e.applyRefPoint&&t.refPointTransform?(a=new b.LmvMatrix4(!0),e.placementTransform&&a.copy(e.placementTransform),a.multiply(t.refPointTransform),t.placementTransform=e.placementTransform=a):!e.applyRefPoint&&e.placementTransform&&(t.placementTransform=new b.LmvMatrix4(!0).copy(e.placementTransform)),t.placementTransform&&function(t){for(var e=t.elements,r=0;r<4;r++)for(var n=0;n<4;n++)if(r===n){if(1!==e[4*r+n])return}else if(0!==e[4*r+n])return;return 1}(t.placementTransform)&&(t.placementTransform=null),t.placementTransform}function o(t,e){var r,n=t.globalOffset;(n.x||n.y||n.z)&&(e?((r=new b.LmvMatrix4(!0)).copy(e),(e=r).elements[12]-=n.x,e.elements[13]-=n.y,e.elements[14]-=n.z):(e=new b.LmvMatrix4(!0)).makeTranslation(-n.x,-n.y,-n.z)),t.placementWithOffset=e}function n(t,e){var r,n;t.metadata&&(n=t.metadata["world bounding box"],r=new s.LmvVector3(n.minXYZ[0],n.minXYZ[1],n.minXYZ[2]),n=new s.LmvVector3(n.maxXYZ[0],n.maxXYZ[1],n.maxXYZ[2]),t.bbox=new i.LmvBox3(r,n),t.modelSpaceBBox=t.bbox.clone(),(n=a(t,e))&&!t.bbox.empty()&&t.bbox.applyMatrix4(n),e.globalOffset?t.globalOffset=e.globalOffset:t.globalOffset=t.bbox.center(),o(t,n),t.bbox.empty()||(t.bbox.min.sub(t.globalOffset),t.bbox.max.sub(t.globalOffset)),t.metadata.hasOwnProperty("double sided geometry")&&t.metadata["double sided geometry"].value&&(t.doubleSided=!0))}function y(t,e){t[0]-=e.x,t[1]-=e.y,t[2]-=e.z}function l(t){if(t.animations){var e=t.animations.animations;if(e)for(var r=t.globalOffset,n=(new b.LmvMatrix4).makeTranslation(r.x,r.y,r.z),s=(new b.LmvMatrix4).makeTranslation(-r.x,-r.y,-r.z),i=new b.LmvMatrix4,a=new b.LmvMatrix4,o=0;o<e.length;o++){var u=e[o];if(u.hierarchy)for(var h=0;h<u.hierarchy.length;h++){var l=u.hierarchy[h].keys;if(l)for(var c=0;c<l.length;c++){var f,d=l[c].pos;d&&(p=r,(f=l[c].rot)&&(i.makeRotationFromQuaternion({x:f[0],y:f[1],z:f[2],w:f[3]}),a.multiplyMatrices(n,i).multiply(s),p={x:a.elements[12],y:a.elements[13],z:a.elements[14]}),y(d,p));var p=l[c].target;p&&y(p,r);var m=l[c].points;if(m)for(var g=0;g<m.length;g++)y(m[g],r)}}}}}},"./src/file-loaders/lmvtk/common/VbUtils.js":function(t,e,r){"use strict";r.r(e),r.d(e,"VBUtils",function(){return n});var n={deduceUVRepetition:function(t){for(var e in t.vblayout)if(0==e.indexOf("uv")&&0!=e.indexOf("uvw"))for(var r=t.vblayout[e].offset,n=t.vbstride,s=t.vb,i=t.vb.length/n,a=0,o=r;a<i;a++,o+=n){var u=s[o],h=s[o+1];if(2<u||u<0||2<h||h<0){t.vblayout[e].isPattern=!0;break}}},computeBounds3D:function(t){for(var e=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,a=-1/0,o=t.vbstride,u=t.vblayout.position.offset,h=t.vb,l=t.vb.length/o,c=0,f=u;c<l;c++,f+=o)(b=h[f])<e&&(e=b),(y=h[f+1])<r&&(r=y),(v=h[f+2])<n&&(n=v),s<b&&(s=b),i<y&&(i=y),a<v&&(a=v);t.boundingBox={min:{x:e,y:r,z:n},max:{x:s,y:i,z:a}};var d=.5*(e+s),p=.5*(r+i),m=.5*(n+a),t=t.boundingSphere={};t.center={x:d,y:p,z:m};var g=0;for(c=0,f=u;c<l;c++,f+=o){var b,y,v,_=(b=h[f])-d,x=(y=h[f+1])-p,w=(v=h[f+2])-m,w=_*_+x*x+w*w;g<w&&(g=w)}t.radius=Math.sqrt(g)},bboxUnion:function(t,e){e.min.x<t.min.x&&(t.min.x=e.min.x),e.min.y<t.min.y&&(t.min.y=e.min.y),e.min.z<t.min.z&&(t.min.z=e.min.z),e.max.x>t.max.x&&(t.max.x=e.max.x),e.max.y>t.max.y&&(t.max.y=e.max.y),e.max.z>t.max.z&&(t.max.z=e.max.z)}}},"./src/file-loaders/lmvtk/common/VertexBufferBuilder.js":function(t,e,r){"use strict";r.r(e),r.d(e,"VertexBufferBuilder",function(){return n});var y=2*Math.PI,s=[0,1,3,0,3,2];function n(t,e,r,n){e=e||65536;this.FULL_COUNT=0|(r||32767),this.useInstancing=t,this.useCompactBuffers=n,this.stride=10,this.allocVcount=4*(this.useInstancing?e/4:e),this.vb=new ArrayBuffer(this.stride*this.allocVcount),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.ib=this.useInstancing?null:new Uint16Array(e),this.minLineWidth=Number.MAX_VALUE,this.reset(0)}n.prototype.reset=function(t){this.vcount=t,this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-1/0,this.dbIds={},this.lastDbId=null,this.colors={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0,this.hasLineStyles=!1,this.changeTracking={},this.stride=10},n.prototype.expandStride=function(){var t=this.stride;if(!(12<=t)){for(var e=this.stride+2,r=new ArrayBuffer(e*this.allocVcount),n=new Uint8Array(this.vb),s=new Uint8Array(r),i=0,a=this.vcount;i<a;i++)for(var o=i*t*4,u=i*e*4,h=0;h<4*t;h++)s[u+h]=n[o+h];this.vb=r,this.vbf=new Float32Array(r),this.vbi=new Int32Array(r),this.stride=e}},n.prototype.addToBounds=function(t,e){t<this.minx&&(this.minx=t),t>this.maxx&&(this.maxx=t),e<this.miny&&(this.miny=e),e>this.maxy&&(this.maxy=e)};var i=new Int32Array(1);function u(t){return i[0]=t,i[0]}n.prototype.trackChanges=function(r,t,e,n,s,i){var a;function o(t,e){void 0===a[t]?a[t]=r:a[t]===e&&(a[t+"Varies"]=!0)}e!==this.lastDbId&&(this.dbIds[u(e)]=1,this.lastDbId=e),i&&(this.hasLineStyles=!0),this.useCompactBuffers&&(a=this.changeTracking,o("geomType",r),o("color",t),o("dbId",e),o("layerId",n),o("viewportId",s),o("linePattern",i),this.colors[u(t)]=1)},n.prototype.setCommonVertexAttribs=function(t,e,r,n,s,i,a,o){this.trackChanges(r,n,s,i,a,o),i&=65535,a&=65535,this.vbi[t+8]=(e&=255)|(r&=255)<<8|(o&=255)<<16,this.vbi[t+6]=n,this.vbi[t+7]=s,this.vbi[t+9]=i|a<<16},n.prototype.addVertexTriangleGeom=function(t,e,r,n,s,i,a,o,u,h){for(var l=this.vcount,c=this.vbf,f=this.useInstancing?1:4,d=0;d<f;d++){var p=(l+d)*this.stride;c[p]=t,c[1+p]=e,c[2+p]=r,c[3+p]=n,c[4+p]=s,c[5+p]=i,this.setCommonVertexAttribs(p,0+d,5,a,o,u,h,0),this.vcount++}return l},n.prototype.addVertexLine=function(t,e,r,n,s,i,a,o,u,h,l){var c=this.vcount,f=this.vbf;0<=o&&0<i&&0<n&&(this.minLineWidth=Math.min(this.minLineWidth,i));for(var d=this.useInstancing?1:4,p=0;p<d;p++){var m=(c+p)*this.stride;f[m]=t,f[1+m]=e,f[2+m]=(r+Math.PI)/y,f[3+m]=n,f[4+m]=.5*i,f[5+m]=s,this.setCommonVertexAttribs(m,0+p,1,a,o,u,h,l),this.vcount++}return c},n.prototype.addVertexTexQuad=function(t,e,r,n,s,i,a,o,u){for(var h=this.vcount,l=this.vbf,c=this.useInstancing?1:4,f=0;f<c;f++){var d=(h+f)*this.stride;l[d]=t,l[1+d]=e,l[2+d]=s/y,l[3+d]=r,l[4+d]=n,this.setCommonVertexAttribs(d,0+f,4,i,a,o,u,0),this.vcount++}return h},n.prototype.addVertexArc=function(t,e,r,n,s,i,a,o,u,h,l,c){for(var f=this.vcount,d=this.vbf,p=s==i?2:3,m=this.useInstancing?1:4,g=0;g<m;g++){var b=(f+g)*this.stride;d[b]=t,d[1+b]=e,d[2+b]=r/y,d[3+b]=n/y,d[4+b]=.5*o,d[5+b]=s,3==p&&(d[10+b]=i,d[11+b]=a),this.setCommonVertexAttribs(b,0+g,p,u,h,l,c,0),this.vcount++}return f},n.prototype.addVertex=function(t,e,r,n,s,i){var a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;if(!this.useInstancing){var o=this.vcount,u=this.stride*o,h=this.vbf;return h[u]=t,h[1+u]=e,this.setCommonVertexAttribs(u,0,a,r,n,s,i,0),this.vcount++,o}},n.prototype.addVertexPolytriangle=function(t,e,r,n,s,i){this.useInstancing||(this.addVertex(t,e,r,n,s,i),this.addToBounds(t,e))},n.prototype.addVertexMSDFPolytriangle=function(t,e,r,n,s,i,a,o){this.addVertexTexPolytriangle(t,e,r,n,s,i,a,o,6)},n.prototype.addIndices=function(t,e){if(!this.useInstancing){var r=this.ib,n=this.icount;if(n+t.length>=r.length){for(var s=new Uint16Array(2*Math.max(t.length,r.length)),i=0;i<n;++i)s[i]=r[i];this.ib=r=s}for(i=0;i<t.length;++i)r[n+i]=e+t[i];this.icount+=t.length}},n.prototype.finalizeQuad=function(t){this.useInstancing||this.addIndices(s,t)},n.prototype.addSegment=function(t,e,r,n,s,i,a,o,u,h,l){var c=r-t,f=n-e,d=c||f?Math.atan2(f,c):0,f=c||f?Math.sqrt(c*c+f*f):0,l=this.addVertexLine(t,e,d,f,s,i,a,o,u,h,l);this.finalizeQuad(l),this.addToBounds(t,e),this.addToBounds(r,n)},n.prototype.addTriangleGeom=function(t,e,r,n,s,i,a,o,u,h){this.numTriangleGeoms++;h=this.addVertexTriangleGeom(t,e,r,n,s,i,a,o,u,h);this.finalizeQuad(h),this.addToBounds(t,e),this.addToBounds(r,n),this.addToBounds(s,i)},n.prototype.addArc=function(t,e,r,n,s,i,a,o,u,h,l,c){s==i?this.numCirculars++:(this.numEllipticals++,this.expandStride());var f=p(r,n);r=f.start,n=f.end,0==r&&0==n&&(n=y),1e-4<(f=Math.abs(r-n))&&1e-4<Math.abs(f-y)?(f=t+s*Math.cos(r),d=e+i*Math.sin(r),this.addSegment(f,d,f,d,0,o,u,h,l,c),f=t+s*Math.cos(n),d=e+i*Math.sin(n),this.addSegment(f,d,f,d,0,o,u,h,l,c)):(this.addToBounds(t-s,e-i),this.addToBounds(t+s,e+i));d=this.addVertexLine(t,e,0,1e-4,0,0,33554431,h,l,c);this.finalizeQuad(d);var d,c=this.addVertexArc(t,e,r,n,s,i,a,o,u,h,l,c);this.finalizeQuad(c)},n.prototype.addTexturedQuad=function(t,e,r,n,s,i,a,o,u){o=this.addVertexTexQuad(t,e,r,n,s,i,a,o,u);this.finalizeQuad(o);u=.5*Math.cos(s),o=.5*Math.sin(s),s=Math.abs(r*u)+Math.abs(n*o),u=Math.abs(r*o)+Math.abs(n*u);this.addToBounds(t-s,e-u),this.addToBounds(t+s,e+u)},n.prototype.addVertexImagePolytriangle=function(t,e,r,n,s,i,a,o){return this.addVertexTexPolytriangle(t,e,r,n,s,i,a,o,7)},n.prototype.addVertexTexPolytriangle=function(t,e,r,n,s,i,a,o,u){var h,l;this.useInstancing||(h=this.vcount,l=this.vbf,this.addVertex(t,e,s,i,a,o,u),l[h*this.stride+2]=r,l[h*this.stride+3]=n,this.addToBounds(t,e))},n.prototype.isFull=function(t){var e=this.useInstancing?4:1;return this.vcount*e+(t=t||3)>this.FULL_COUNT},n.prototype.makeCompactVertexLayout=function(){var t=Object.keys(this.colors),e=Object.keys(this.dbIds);if(10!==this.stride)return null;var r=t.length+e.length;if(65536<t.length+e.length)return null;for(var n=new Int32Array(r+1),s=1,i=n[0]=0;i<t.length;i++,s++)n[s]=parseInt(t[i]),this.colors[t[i]]=s;for(i=0;i<e.length;i++,s++)n[s]=parseInt(e[i]),this.dbIds[e[i]]=s;var a=new ArrayBuffer(24*this.vcount),o=new Int32Array(a),u=new Uint16Array(a),h=this.maxx-this.minx||1,l=this.maxy-this.miny||1,c=this.minx,f=this.miny,d=Math.max(h,l);function p(t){return 0|Math.round((t-c)/h*65535)}function m(t){return 0|Math.round((t-f)/l*65535)}function g(t){return 0|Math.round(t/d*65535)}function b(t){return 0|65535*t}function y(t){return t<0?32768+32767*Math.min(1,-t/1024):t&&(0|Math.round(t/d*32767)||1)}for(i=0;i<this.vcount;i++){var v=this.stride*i,_=6*i,x=2*_;switch(this.vbi[8+v]>>8&255){case 0:u[x]=p(this.vbf[v]),u[1+x]=m(this.vbf[1+v]);break;case 1:u[x]=p(this.vbf[v]),u[1+x]=m(this.vbf[1+v]),u[2+x]=b(this.vbf[2+v]),u[3+x]=g(this.vbf[3+v]),u[4+x]=y(this.vbf[4+v]);break;case 2:u[x]=p(this.vbf[v]),u[1+x]=m(this.vbf[1+v]),u[2+x]=b(this.vbf[2+v]),u[3+x]=b(this.vbf[3+v]),u[4+x]=y(this.vbf[4+v]),u[5+x]=g(this.vbf[5+v]);break;case 3:break;case 4:u[x]=p(this.vbf[v]),u[1+x]=m(this.vbf[1+v]),u[2+x]=b(this.vbf[2+v]),u[3+x]=g(this.vbf[3+v]),u[4+x]=g(this.vbf[4+v]);break;case 5:u[x]=p(this.vbf[v]),u[1+x]=m(this.vbf[1+v]),u[2+x]=p(this.vbf[2+v]),u[3+x]=m(this.vbf[3+v]),u[4+x]=p(this.vbf[4+v]),u[5+x]=m(this.vbf[5+v]);break;default:console.error("Unknown geometry type")}u[6+x]=this.colors[this.vbi[6+v]]||0,u[7+x]=this.dbIds[this.vbi[7+v]]||0,o[4+_]=this.vbi[8+v],o[5+_]=this.vbi[9+v]}r={};r.vb=new Float32Array(a),r.vbstride=6;a=this.useInstancing?1:0;return r.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:2,divisor:a,normalize:!0},fields2:{offset:1,itemSize:4,bytesPerItem:2,divisor:a,normalize:!0},uvIdColor:{offset:3,itemSize:2,bytesPerItem:2,divisor:a,normalize:!1},flags4b:{offset:4,itemSize:4,bytesPerItem:1,divisor:a,normalize:!1},layerVp4b:{offset:5,itemSize:4,bytesPerItem:1,divisor:a,normalize:!1}},r.unpackXform={x:h,y:l,z:c,w:f},r.texData=n,r},n.prototype.makeWideVertexLayout=function(){var t={};t.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),t.vbstride=this.stride;var e=this.useInstancing?1:0;return t.vblayout={fields1:{offset:0,itemSize:2,bytesPerItem:4,divisor:e,normalize:!1},fields2:{offset:2,itemSize:4,bytesPerItem:4,divisor:e,normalize:!1},color4b:{offset:6,itemSize:4,bytesPerItem:1,divisor:e,normalize:!0},dbId4b:{offset:7,itemSize:4,bytesPerItem:1,divisor:e,normalize:!1},flags4b:{offset:8,itemSize:4,bytesPerItem:1,divisor:e,normalize:!1},layerVp4b:{offset:9,itemSize:4,bytesPerItem:1,divisor:e,normalize:!1}},t.vblayout.extraParams={offset:this.stride-2,itemSize:2,bytesPerItem:4,divisor:e,normalize:!1},t},n.prototype.toMesh=function(){var t=null,t=(t=this.useCompactBuffers?this.makeCompactVertexLayout():t)||this.makeWideVertexLayout();this.useInstancing?(t.numInstances=this.vcount,n=new Int32Array([0,1,2,3]),t.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},t.vblayout.instFlags4b.array=n.buffer,t.indices=new Uint16Array(s)):t.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount)),t.dbIds=this.dbIds;var e=this.maxx-this.minx,r=this.maxy-this.miny,n=Math.max(e,r);t.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-n},max:{x:this.maxx,y:this.maxy,z:.001*n}};t.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(e*e+r*r)};return t};var p=function(e,r){function t(){function t(t,e){return Math.abs(t-e)<.001}t(e,0)&&(e=0),t(r,0)&&(r=0),t(e,y)&&(e=y),t(r,y)&&(r=y)}if(t(),r<e)for(;y<e;)e-=y,r-=y;else for(;y<r;)e-=y,r-=y;return t(),e<0&&0<r&&(e+=y),{start:e,end:r}}},"./src/file-loaders/lmvtk/f2d/CheckedInputStream.js":function(t,e,r){"use strict";function n(t){this.buffer=t,this.offset=0,this.byteLength=t.length,this.convBuf=new ArrayBuffer(8),this.convUint8=new Uint8Array(this.convBuf),this.convUint16=new Uint16Array(this.convBuf),this.convInt32=new Int32Array(this.convBuf),this.convUint32=new Uint32Array(this.convBuf)}function s(t){this.offset=t,this.message="try to access an offset that is out of bounds: "+this.offset,this.toString=function(){return this.message}}r.r(e),r.d(e,"CheckedInputStream",function(){return n}),n.prototype.boundsCheck=function(t){if(t>=this.byteLength)throw new s(t)},n.prototype.seek=function(t){this.boundsCheck(t),this.offset=t},n.prototype.getBytes=function(t){this.boundsCheck(this.offset+t);var e=new Uint8Array(this.buffer.buffer,this.offset,t);return this.offset+=t,e},n.prototype.skipBytes=function(t){this.boundsCheck(this.offset+t),this.offset+=t},n.prototype.getVarints=function(){for(var t,e=0,r=0;this.boundsCheck(this.offset),e|=(127&(t=this.buffer[this.offset++]))<<r,r+=7,128&t;);return e},n.prototype.getUint8=function(){return this.boundsCheck(this.offset+1),this.buffer[this.offset++]},n.prototype.getUint16=function(){return this.boundsCheck(this.offset+2),this.convUint8[0]=this.buffer[this.offset++],this.convUint8[1]=this.buffer[this.offset++],this.convUint16[0]},n.prototype.getInt16=function(){var t=this.getUint16();return 32767<t&&(t|=4294901760),t},n.prototype.getInt32=function(){this.boundsCheck(this.offset+4);var t=this.buffer,e=this.convUint8,r=this.offset;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this.offset+=4,this.convInt32[0]},n.prototype.getUint32=function(){this.boundsCheck(this.offset+4);var t=this.buffer,e=this.convUint8,r=this.offset;return e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2],e[3]=t[r+3],this.offset+=4,this.convUint32[0]},n.prototype.skipUint32=function(){this.boundsCheck(this.offset+4),this.offset+=4},n.prototype.getFloat32=function(){return this.boundsCheck(this.offset+4),this.offset+=4,0},n.prototype.getFloat64=function(){return this.boundsCheck(this.offset+8),this.offset+=8,0},n.prototype.skipFloat64=function(){this.boundsCheck(this.offset+8),this.offset+=8},n.prototype.reset=function(t){this.buffer=t,this.offset=0,this.byteLength=t.length}},"./src/file-loaders/lmvtk/f2d/F2d.js":function(t,e,r){"use strict";r.r(e),r.d(e,"F2dDataType",function(){return a}),r.d(e,"F2dSemanticType",function(){return k}),r.d(e,"F2dShadowRatio",function(){return p}),r.d(e,"restoreSignBitFromLSB",function(){return o}),r.d(e,"F2D",function(){return u});var v=r("./src/file-loaders/lmvtk/common/VertexBufferBuilder.js"),_=r("./src/wgs/scene/LmvBox3.js"),e=r("./src/wgs/scene/LmvVector3.js"),n=r("./src/file-loaders/lmvtk/common/VbUtils.js"),s=r("./src/file-loaders/lmvtk/common/InputStream.js"),w=r("./src/logger/Logger.js"),i=r("./src/file-loaders/net/ErrorCodes.js"),x=16383,a={dt_object:0,dt_void:1,dt_byte:2,dt_int:3,dt_float:4,dt_double:5,dt_varint:6,dt_point_varint:7,dt_byte_array:32,dt_int_array:33,dt_float_array:34,dt_double_array:35,dt_varint_array:36,dt_point_varint_array:37,dt_arc:38,dt_circle:39,dt_circular_arc:40,dt_string:63,dt_last_data_type:127},k={st_object_member:0,st_fill:1,st_fill_off:2,st_clip_off:3,st_layer:4,st_link:5,st_line_weight:6,st_miter_angle:7,st_miter_length:8,st_line_pattern_ref:9,st_back_color:10,st_color:11,st_markup:12,st_object_id:13,st_markup_id:14,st_reset_rel_offset:15,st_font_ref:16,st_begin_object:32,st_clip:33,st_line_caps:34,st_line_join:35,st_line_pattern_def:36,st_font_def:37,st_viewport:38,st_sheet:42,st_arc:43,st_polyline:44,st_raster:45,st_text:46,st_polytriangle:47,st_dot:48,st_end_object:63,st_last_semantic_type:127},p=.0075;function I(){return{arcs:0,circles:0,circ_arcs:0,viewports:0,clips:0,colors:0,db_ids:0,dots:0,fills:0,layers:0,line_caps:0,line_joins:0,line_patterns:0,line_pat_refs:0,plines:0,pline_points:0,line_weights:0,links:0,miters:0,ptris:0,ptri_indices:0,ptri_points:0,rasters:0,texts:0,strings:[]}}function o(t){return 1&t?-(t>>>1):t>>>1}function u(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if(this.metadata=e,this.scaleX=1,this.scaleY=1,this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.is2d=!0,this.layersMap={},this.fontDefs={},this.fontCount=0,this.fontId=0,this.manifestAvailable=!1,this.geomMetricsSum=0,this.objectMemberQueue=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[],viewables:[]},e){var s=e.page_dimensions;this.paperWidth=s.page_width,this.paperHeight=s.page_height,this.scaleX=this.paperWidth/s.plot_width,this.scaleY=this.paperHeight/s.plot_height,this.hidePaper=s.hide_paper;var i=this.paperWidth,a=this.paperHeight;this.bbox.max.x=i,this.bbox.max.y=a;var o,u,h=e.page_dimensions||{};isFinite(h.paper_rotation)&&0!==h.paper_rotation&&(o=h.paper_rotation*Math.PI/180,s=i*(u=Math.cos(o)),o=i*(i=Math.sin(o)),i=-a*i,u=a*u,this.bbox.min.x=Math.min(0,s,i,s+i),this.bbox.max.x=Math.max(0,s,i,s+i),this.bbox.min.y=Math.min(0,o,u,o+u),this.bbox.max.y=Math.max(0,o,u,o+u)),isFinite(h.paper_offset_x)&&0!==h.paper_offset_x&&(this.bbox.min.x+=h.paper_offset_x,this.bbox.max.x+=h.paper_offset_x),isFinite(h.paper_offset_y)&&0!==h.paper_offset_y&&(this.bbox.min.y+=h.paper_offset_y,this.bbox.max.y+=h.paper_offset_y);var l,c=0;for(l in this.layersMap[0]=c++,e.layers){var f=parseInt(l);this.layersMap[f]=c++}this.layerCount=c,this.createLayerGroups(e.layers),e.geom_metrics&&(d=Object.keys(e.geom_metrics).map(function(t){return e.geom_metrics[t]}),this.geomMetricsSum=d.reduce(function(t,e){return t+e}))}this.hidePaper=this.hidePaper||n.modelSpace,this.noShadow=!!n.noShadow,this.hasPageShadow=!1,this.opCount=0,this.excludeTextGeometry=n.excludeTextGeometry,this.extendStringsFetching=n.extendStringsFetching,this.fontFaces=[],this.fontFamilies=[],this.viewports=[{}],this.currentVpId=0,this.viewports[0].geom_metrics=this.currentGeomMetrics=I(),this.clips=[0],this.strings=[],this.stringDbIds=[],this.stringBoxes=[],this.extendStringsFetching&&(this.stringCharWidths=[],this.stringAngles=[],this.stringPositions=[],this.stringHeights=[]),this.currentStringNumber=-1,this.currentStringBox=new _.LmvBox3,this.linkBoxes=[],this.currentLinkBox=new _.LmvBox3,this.objectNumber=0,this.currentFakeId=-2,this.imageNumber=0,this.linkNumber=0,this.maxObjectNumber=0,this.objectStack=[],this.objectNameStack=[],this.parseObjState={polyTriangle:{},viewport:{},clip:{},raster:{},text:{},fontDef:{},uknown:{}},this.layer=0,this.bgColor="number"==typeof n.bgColor?n.bgColor:4294967295,this.contrastColor=this.color=this.fillColor=4278190080,this.hidePaper&&(this.contrastColor=4294967040),this.isMobile=n&&!!n.isMobile;var d=n&&!!n.isWebGL2,d=this.isMobile&&(d||1e7<this.geomMetricsSum),n=d&&n&&!!n.supportsInstancing,d=d;if(this.max_vcount=this.isMobile?x:void 0,this.currentVbb=new v.VertexBufferBuilder(n,void 0,this.max_vcount,d),this.meshes=[],this.numCircles=this.numEllipses=this.numPolylines=this.numLineSegs=0,this.numPolytriangles=this.numTriangles=0,this.error=!1,this.offsetX=0,this.offsetY=0,t){this.manifestAvailable=!0,this.imageId2URI={};for(var p=t.assets,m=0,g=p.length;m<g;++m){var b,y=p[m];-1!==y.mime.indexOf("image/")&&(b=(b=y.id).substr(0,b.indexOf(".")),this.imageId2URI[b]=r+y.URI),"Autodesk.CloudPlatform.PropertyAttributes"===y.type&&this.propertydb.attrs.push({path:y.URI}),"Autodesk.CloudPlatform.PropertyValues"===y.type&&this.propertydb.values.push({path:y.URI}),"Autodesk.CloudPlatform.PropertyIDs"===y.type&&this.propertydb.ids.push({path:y.URI}),"Autodesk.CloudPlatform.PropertyViewables"===y.type&&this.propertydb.viewables.push({path:y.URI}),"Autodesk.CloudPlatform.PropertyOffsets"===y.type&&-1===y.id.indexOf("rcv")&&this.propertydb.offsets.push({path:y.URI}),"Autodesk.CloudPlatform.PropertyAVs"===y.type&&this.propertydb.avs.push({path:y.URI})}}}u.prototype.load=function(t,e){e instanceof Uint8Array||(e=new Uint8Array(e)),this.data=e,this.parse(),this.stringBoxes.length&&((e=new Float32Array(this.stringBoxes.length)).set(this.stringBoxes),this.stringBoxes=e),t.loadDoneCB(!0)},u.prototype.loadFrames=function(t){var e=(this.loadContext=t).data;e?(e instanceof Uint8Array||(e=new Uint8Array(e)),this.data=e):t.finalFrame&&(this.data=null,this.stringBoxes.length&&((e=new Float32Array(this.stringBoxes.length)).set(this.stringBoxes),this.stringBoxes=e)),this.parseFrames(t.finalFrame),t.loadDoneCB(!0)},u.prototype.pushMesh=function(t){this.meshes.push(t),t.material={skipEllipticals:!this.currentVbb.numEllipticals,skipCircles:!this.currentVbb.numCirculars,skipTriangleGeoms:!this.currentVbb.numTriangleGeoms,useInstancing:this.currentVbb.useInstancing,unpackPositions:!!t.unpackXform},this.currentImage&&(t.material.image=this.currentImage,t.material.image.name=this.imageNumber++,this.currentImage=null)},u.prototype.flushBuffer=function(t,e){!this.currentVbb.vcount&&!e||(e||this.currentVbb.isFull(t))&&(this.currentVbb.vcount&&(t=this.currentVbb.toMesh(),n.VBUtils.bboxUnion(this.bbox,t.boundingBox),this.pushMesh(t),this.currentVbb.reset(0)),this.loadContext&&this.loadContext.loadDoneCB(!0,e))},u.prototype.tx=function(t){return this.sx(t)},u.prototype.ty=function(t){return this.sy(t)},u.prototype.sx=function(t){return t*this.scaleX},u.prototype.sy=function(t){return t*this.scaleY},u.prototype.invertColor=function(t){return(t>>24&255)<<24|255-(t>>16&255)<<16|255-(t>>8&255)<<8|255-(255&t)},u.prototype.mapColor=function(t,e){if(!this.hidePaper||0!==this.bgColor)return t;var r=255&t;return r<127||r==(65280&t)>>8&&r==(16711680&t)>>16&&e&&(t&=1442840575),t},u.prototype.parsePointPositions=function(){var t=this.stream.getVarints(),e=this.stream.getVarints(),t=o(t),e=o(e);return t+=this.offsetX,e+=this.offsetY,this.offsetX=t,this.offsetY=e,[this.tx(t),this.ty(e)]},u.prototype.parserAssert=function(t,e,r){return t!=e&&(w.logger.warn("Expect "+e+"; actual type is "+t+"; in function "+r),this.error=!0)},u.prototype.unhandledTypeWarning=function(t,e){w.logger.warn("Unhandled semantic type : "+e+" in function "+t)},u.prototype.parseObject=function(){var t=this.stream.getVarints();switch(this.objectStack.push(t),t){case k.st_sheet:this.objectNameStack.push("sheet"),this.objectMemberQueue.unshift("paperColor");break;case k.st_viewport:this.objectNameStack.push("viewport"),this.objectMemberQueue.unshift("units","transform");break;case k.st_clip:this.objectNameStack.push("clip"),this.objectMemberQueue.unshift("contourCounts","points","indices");break;case k.st_polytriangle:this.objectNameStack.push("polyTriangle"),this.objectMemberQueue.unshift("points","indices","colors");break;case k.st_raster:this.objectNameStack.push("raster"),this.objectMemberQueue.unshift("position","width","height","imageId");break;case k.st_text:this.currentStringNumber=this.strings.length,0===this.objectNumber&&(this.objectNumber=this.currentFakeId--),this.currentStringBox.makeEmpty(),this.objectNameStack.push("text"),this.objectMemberQueue.unshift("string","position","height","widthScale","rotation","oblique","charWidths");break;case k.st_font_def:this.objectNameStack.push("fontDef"),this.objectMemberQueue.unshift("name","fullName","flags","spacing","panose");break;case k.st_end_object:if(this.objectStack.pop(),this.objectStack.length){switch(this.objectStack.pop()){case k.st_polytriangle:this.actOnPolyTriangle();break;case k.st_viewport:this.actOnViewport();break;case k.st_clip:this.actOnClip();break;case k.st_raster:this.actOnRaster();break;case k.st_text:this.actOnText();break;case k.st_font_def:this.actOnFontDef()}var e,r=this.objectNameStack.pop(),n=this.parseObjState[r];for(e in n)n[e]=null}else this.parserAssert(0,1,"parseEndObject (Stack Empty)");this.objectMemberQueue.length=0;break;default:this.objectNameStack.push("unknown"),this.error=!0,this.unhandledTypeWarning("parseObject",t)}},u.prototype.initSheet=function(t){var e,r,n,s,i,a,o,u,h,l,c,f,d;this.hidePaper||(this.bgColor=t,this.metadata&&(e={x:0,y:0},r={x:u=this.paperWidth,y:0},n={x:0,y:l=this.paperHeight},o=this.metadata.page_dimensions||{},isFinite(o.paper_rotation)&&0!==o.paper_rotation&&(h=o.paper_rotation*Math.PI/180,a=Math.cos(h),i=Math.sin(h),r.y=u*i,r.x=u*a,n.x=-l*i,n.y=l*a),isFinite(o.paper_offset_x)&&0!==o.paper_offset_x&&(e.x=o.paper_offset_x),isFinite(o.paper_offset_y)&&0!==o.paper_offset_y&&(e.y=o.paper_offset_y),s=this.currentVbb,c=[e.x,e.y,e.x+r.x,e.y+r.y,e.x+r.x+n.x,e.y+r.y+n.y,e.x+n.x,e.y+n.y],f=[t,t,t,t],d=[0,1,2,0,2,3],this.noShadow||(i=r.x*(h=u*p)/u,a=r.y*h/u,o=n.x*h/l,t=n.y*h/l,u={x:e.x+i,y:e.y+a},h={x:e.x+r.x,y:e.y+r.y},l=4283782485,c=c.concat([u.x-o,u.y-t,u.x-o+r.x,u.y-t+r.y,u.x+r.x,u.y+r.y,u.x,u.y,h.x,h.y,h.x+i,h.y+a,h.x+i-o+n.x,h.y+a-t+n.y,h.x-o+n.x,h.y-t+n.y]),f=f.concat([l,l,l,l,l,l,l,l]),d=d.concat([4,5,6,4,6,7,8,9,10,8,10,11]),this.hasPageShadow=!0),this.addPolyTriangle(c,f,d,4294967295,-1,0,!1),s.addSegment(e.x,e.y,e.x+r.x,e.y+r.y,0,1e-6,4278190080,-1,0,this.currentVpId),s.addSegment(e.x+r.x,e.y+r.y,e.x+r.x+n.x,e.y+r.y+n.y,0,1e-6,4278190080,-1,0,this.currentVpId),s.addSegment(e.x+r.x+n.x,e.y+r.y+n.y,e.x+n.x,e.y+n.y,0,1e-6,4278190080,-1,0,this.currentVpId),s.addSegment(e.x+n.x,e.y+n.y,e.x,e.y,0,1e-6,4278190080,-1,0,this.currentVpId)))},u.prototype.setObjectMember=function(t){if(!this.objectMemberQueue.length)return w.logger.warn("Unexpected object member. "+t+" on object "+this.objectNameStack[this.objectNameStack.length-1]),!1;var e=this.objectMemberQueue.shift(),r=this.objectNameStack[this.objectNameStack.length-1];return"sheet"==r&&"paperColor"==e?(this.initSheet(t),!0):!!r&&(this.parseObjState[r][e]=t,!0)},u.prototype.parseString=function(){var t=this.stream,e=t.getVarints(),r=t.getVarints(),r=t.getString(r);if(e===k.st_object_member){if(this.setObjectMember(r))return}else w.logger.info("Unexpected opcode semantic type for string.");return r},u.prototype.actOnFontDef=function(){var t=this.parseObjState.fontDef;this.fontDefs[++this.fontCount]=t,this.fontId=this.fontCount},u.prototype.parsePoint=function(){var t=this.stream.getVarints(),e=this.parsePointPositions();if(t===k.st_object_member){if(this.setObjectMember(e))return}else w.logger.info("Unexpected opcode semantic type for point.");return e},u.prototype.parsePointsArray=function(){var t=this.stream,e=t.getVarints(),r=t.getVarints();if(r){r/=2;for(var n,s=[],i=0;i<r;++i)n=this.parsePointPositions(),s.push(n[0]),s.push(n[1]);switch(e){case k.st_polyline:return void this.actOnPolylinePointsArray(s);case k.st_dot:return void this.actOnDot(s);case k.st_object_member:if(this.setObjectMember(s))return;break;default:w.logger.info("Unexpected opcode semantic type for points array.")}return s}},u.prototype.parseIntArray=function(){for(var t=this.stream,e=t.getVarints(),r=t.getVarints(),n=[],s=0;s<r;++s)n.push(t.getUint32());if(e===k.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseIntArray",e);return n},u.prototype.parseDoubleArray=function(){for(var t=this.stream,e=t.getVarints(),r=t.getVarints(),n=[],s=0;s<r;++s)n.push(t.getFloat64());if(e===k.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseDoubleArray",e);return n},u.prototype.parseByteArray=function(){for(var t=this.stream,e=t.getVarints(),r=t.getVarints(),n=[],s=0;s<r;++s)n.push(t.getUint8());if(e===k.st_object_member){if(this.setObjectMember(n))return}else this.unhandledTypeWarning("parseByteArray",e);return n},u.prototype.parseVarintArray=function(){for(var t=this.stream,e=t.getVarints(),r=[],n=t.getVarints(),s=0;s<n;++s)r.push(t.getVarints());if(e===k.st_object_member){if(this.setObjectMember(r))return}else this.unhandledTypeWarning("parseVarIntArray",e);return r},u.prototype.parseInt=function(){var t=this.stream,e=t.getVarints(),r=t.getUint32();switch(e){case k.st_color:this.color=this.mapColor(r,!1),this.currentGeomMetrics.colors++;break;case k.st_fill:this.fill=!0,this.fillColor=this.mapColor(r,!0),this.currentGeomMetrics.fills++;break;case k.st_object_member:if(this.setObjectMember(r))return;default:this.unhandledTypeWarning("parseInt",e)}return r},u.prototype.parseVoid=function(){var t=this.stream.getVarints();t===k.st_fill_off?(this.fill=!1,this.currentGeomMetrics.fills++):this.unhandledTypeWarning("parseVoid",t)},u.prototype.parseVarint=function(){var t=this.stream,e=t.getVarints(),r=t.getVarints();switch(e){case k.st_line_weight:this.lineWeight=this.tx(r),this.currentGeomMetrics.line_weights++;break;case k.st_line_caps:this.currentGeomMetrics.line_caps++;break;case k.st_line_join:this.currentGeomMetrics.line_joins++;break;case k.st_object_id:case k.st_markup_id:this.objectNumber=r,this.maxObjectNumber=Math.max(this.maxObjectNumber,r),this.currentGeomMetrics.db_ids++;break;case k.st_link:this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.linkNumber=r;break;case k.st_layer:this.currentGeomMetrics.layers++,this.layer=this.layersMap[r];break;case k.st_font_ref:this.fontId=r;break;case k.st_object_member:if(this.setObjectMember(r))return}return r},u.prototype.parseFloat=function(){var t=this.stream,e=t.getVarints(),r=t.getFloat32();switch(e){case k.st_miter_angle:case k.st_miter_length:break;case k.st_object_member:if(this.setObjectMember(r))return}return r},u.prototype.parseCircularArc=function(){var t,e,r=this.stream,n=r.getVarints();this.parserAssert(n,k.st_arc,"parseCircularArc")||(t=this.parsePointPositions(),e=r.getVarints(),n=r.getFloat32(),r=r.getFloat32(),this.actOnCircularArc(t[0],t[1],n,r,this.sx(e)))},u.prototype.parseCircle=function(){var t=this.stream,e=t.getVarints();this.parserAssert(e,k.st_arc,"parseCircle")||(e=this.parsePointPositions(),t=t.getVarints(),this.actOnCompleteCircle(e[0],e[1],this.sx(t)))},u.prototype.parseArc=function(){var t,e,r,n,s=this.stream,i=s.getVarints();this.parserAssert(i,k.st_arc,"parseArc")||(t=this.parsePointPositions(),e=s.getVarints(),r=s.getVarints(),n=s.getFloat32(),i=s.getFloat32(),s=s.getFloat32(),this.actOnArc(t[0],t[1],i,s,this.sx(e),this.sy(r),n))},u.prototype.parseDataType=function(){var t=this.stream.getVarints();switch(t){case a.dt_void:this.parseVoid();break;case a.dt_int:this.parseInt();break;case a.dt_object:this.parseObject();break;case a.dt_varint:this.parseVarint();break;case a.dt_point_varint:this.parsePoint();break;case a.dt_float:this.parseFloat();break;case a.dt_point_varint_array:this.parsePointsArray();break;case a.dt_circular_arc:this.parseCircularArc();break;case a.dt_circle:this.parseCircle();break;case a.dt_arc:this.parseArc();break;case a.dt_int_array:this.parseIntArray();break;case a.dt_varint_array:this.parseVarintArray();break;case a.dt_byte_array:this.parseByteArray();break;case a.dt_string:this.parseString();break;case a.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,w.logger.info("Data type not supported yet: "+t)}},u.prototype.readHeader=function(){var t=this.stream=new s.InputStream(this.data),e=t.getString(3);if("F2D"!==e)return w.logger.error("Invalid F2D header : "+e,Object(i.errorCodeString)(i.ErrorCodes.BAD_DATA)),!1;e=t.getString(2);if("01"!==e)return w.logger.error("Only support f2d major version 1; actual version is : "+e,Object(i.errorCodeString)(i.ErrorCodes.BAD_DATA)),!1;if("."!==t.getString(1))return w.logger.error("Invalid version delimiter.",Object(i.errorCodeString)(i.ErrorCodes.BAD_DATA)),!1;t.getString(2);return!0},u.prototype.parse=function(){if(this.readHeader()){for(var t=this.stream;t.offset<t.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;this.linkNumber&&(this.linkBoxes[this.linkNumber]=this.currentLinkBox.clone(),this.currentLinkBox.makeEmpty()),this.flushBuffer(0,!0),this.currentVbb=null,this.stream=null,this.data=null,w.logger.info("F2d parse: data types count : "+this.opCount)}},u.prototype.parseFrames=function(t){if(this.data)for(var e=this.stream=new s.InputStream(this.data);e.offset<e.byteLength&&(this.parseDataType(),!this.error);)this.opCount++;else t||w.logger.warn("Unexpected F2D parse state: If there is no data, we only expect a flush command, but flush was false.");t&&this.flushBuffer(0,!0),this.stream=null,this.data=null},u.prototype.actOnPolylinePointsArray=function(t){this.flushBuffer();for(var e=t.length/2,r=0,n=t[0],s=t[1],i=1;i<e;++i){var a=t[2*i],o=t[2*i+1];this.currentVbb.addSegment(n,s,a,o,r,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId),r+=Math.sqrt((a-n)*(a-n)+(o-s)*(o-s)),n=a,s=o}this.numPolylines++,this.numLineSegs+=e-1,this.currentGeomMetrics.plines++,this.currentGeomMetrics.pline_points+=e-1},u.prototype.actOnDot=function(t){this.currentGeomMetrics.dots++;var e=t[0],t=t[1];this.actOnCompleteCircle(e,t,this.sx(1),!0)},u.prototype.actOnCompleteCircle=function(t,e,r,n){this.flushBuffer(),this.numCircles++,n||this.currentGeomMetrics.circles++,this.fill?this.currentVbb.addSegment(t,e,t,e,0,2*r,this.color,this.objectNumber,this.layer,this.currentVpId,!0,!1,!0):this.currentVbb.addArc(t,e,0,2*Math.PI,r,r,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},u.prototype.actOnCircularArc=function(t,e,r,n,s){this.numCircles++,this.currentGeomMetrics.circ_arcs++,this.flushBuffer(),this.currentVbb.addArc(t,e,r,n,s,s,0,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},u.prototype.actOnArc=function(t,e,r,n,s,i,a){this.numEllipses++,this.currentGeomMetrics.arcs++,this.flushBuffer(),this.currentVbb.addArc(t,e,r,n,s,i,a,this.lineWeight,this.color,this.objectNumber,this.layer,this.currentVpId)},u.prototype.actOnRaster=function(){var t,e,r,n,s;this.manifestAvailable&&(this.flushBuffer(4,!0),s=(n=this.parseObjState.raster).position,r=n.imageId,t=this.imageId2URI[r],e=this.sx(n.width),r=this.sy(n.height),n=s[0]+.5*e,s=s[1]-.5*r,this.currentVbb.addTexturedQuad(n,s,e,r,0,4278255615,this.objectNumber,this.layer,this.currentVpId),this.currentImage={dataURI:t},this.flushBuffer(0,!0),this.currentGeomMetrics.rasters++)},u.prototype.actOnClip=function(){var t=this.parseObjState.clip;this.parseObjState.clip={},this.clips.push(t),this.currentGeomMetrics.clips++},u.prototype.actOnText=function(){this.strings[this.currentStringNumber]=this.parseObjState.text.string,this.currentGeomMetrics.texts++,this.currentGeomMetrics.strings.push(this.parseObjState.text.string),this.stringDbIds[this.currentStringNumber]=this.objectNumber,this.stringBoxes.push(this.currentStringBox.min.x,this.currentStringBox.min.y,this.currentStringBox.max.x,this.currentStringBox.max.y),this.extendStringsFetching&&(this.stringCharWidths.push(this.parseObjState.text.charWidths),this.stringAngles.push(this.parseObjState.text.rotation),this.stringPositions.push(this.parseObjState.text.position),this.stringHeights.push(this.parseObjState.text.height)),this.currentStringBox.makeEmpty(),this.currentStringNumber=-1,this.objectNumber<-1&&(this.objectNumber=0)};var S=new e.LmvVector3;u.prototype.addPolyTriangle=function(i,a,t,o,u,h,e){var l=this,c=null,f=-1;function r(t,e){var r,n;e<t&&(n=t,t=e,e=n),c[t]?-1==(n=(r=c[t]).lastIndexOf(e))?r.push(e):r[n]=-1:c[t]=[e]}function n(t,e){e<t&&(r=t,t=e,e=r);var r=c[t];r&&-1!=r.indexOf(e)&&(l.flushBuffer(4),l.currentVbb.addSegment(i[2*t],i[2*t+1],i[2*e],i[2*e+1],0,f,l.mapColor(a?a[t]:o,!0),u,h,l.currentVpId),a&&a[t]!=a[e]&&w.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}if(this.objectStack[this.objectStack.length-1]==k.st_text&&(f=-.5),e)for(var c=new Array(i.length/2),s=0,d=t.length;s<d;s+=3){var p=t[s],m=t[s+1],g=t[s+2];r(p,m),r(m,g),r(g,p)}if(-1!==this.currentStringNumber||this.linkNumber)for(var b=i.length/2,s=0;s<b;++s)S.set(i[2*s],i[2*s+1],0),-1!==this.currentStringNumber&&this.currentStringBox.expandByPoint(S),this.linkNumber&&this.currentLinkBox.expandByPoint(S);if(this.currentVbb.useInstancing)for(b=t.length,s=0;s<b;s+=3){p=t[s],m=t[s+1],g=t[s+2];this.flushBuffer(4),this.currentVbb.addTriangleGeom(i[2*p],i[2*p+1],i[2*m],i[2*m+1],i[2*g],i[2*g+1],this.mapColor(a?a[p]:o,!0),u,h,this.currentVpId),e&&(n(p,m),n(m,g),n(g,p))}else{b=i.length/2;this.flushBuffer(b);for(var y=this.currentVbb,v=y.vcount,s=0;s<b;++s){var _=i[2*s],x=i[2*s+1];y.addVertexPolytriangle(_,x,this.mapColor(a?a[s]:o,!0),u,h,this.currentVpId)}y.addIndices(t,v),e&&function(){for(var t=0,e=c.length;t<e;t++){var r=c[t];if(r)for(var n=0;n<r.length;n++){var s=r[n];-1!=s&&(l.flushBuffer(4),l.currentVbb.addSegment(i[2*t],i[2*t+1],i[2*s],i[2*s+1],0,f,l.mapColor(a?a[t]:o,!0),u,h,l.currentVpId),a&&a[t]!=a[s]&&w.logger.warn("Gouraud triangle encountered. Will have incorrect antialiasing."))}}}()}},u.prototype.actOnPolyTriangle=function(){var t=this.parseObjState.polyTriangle;this.parseObjState.polyTriangle={};var e=t.points,r=t.indices,t=t.colors;if(e&&r){if(this.objectStack[this.objectStack.length-1]==k.st_text){if(this.excludeTextGeometry)return}else this.currentGeomMetrics.ptris++,this.currentGeomMetrics.ptri_points+=e.length/2,this.currentGeomMetrics.ptri_indices+=r.length;this.numPolytriangles++,this.numTriangles+=r.length/3,this.addPolyTriangle(e,t,r,this.color,this.objectNumber,this.layer,!0)}else w.logger.warn("Malformed polytriangle.")},u.prototype.actOnViewport=function(){var t=this.parseObjState.viewport;this.parseObjState.viewport={},t.geom_metrics=this.currentGeomMetrics=I(),this.viewports.push(t),this.currentVpId=this.viewports.length-1},u.prototype.createLayerGroups=function(t){var e,r=this.layersRoot={name:"root",id:"root",childrenByName:{},isLayer:!1},n=0,s=0;for(e in t){var i=parseInt(e),a=t[e],a="string"==typeof a?a:a.name,o=(a=a||e).split("|"),u=r;if(1<o.length)for(var h=0;h<o.length-1;++h){var l=o[h],c=u.childrenByName[l];c||(c={name:l,id:"group-"+n++,childrenByName:{},isLayer:!1},u.childrenByName[l]=c),u=c}u.childrenByName[a]={name:a,index:i,id:s++,childrenByName:{},isLayer:!0}}!function t(e){var r=Object.keys(e.childrenByName).map(function(t){return e.childrenByName[t]});if(delete e.childrenByName,r.length){e.children=r;for(var n=e.childCount=0;n<r.length;++n)e.childCount+=t(r[n]);r.sort(function(t,e){return t.isLayer&&!e.isLayer?-1:!t.isLayer&&e.isLayer?1:t.name.localeCompare(e.name,void 0,{sensitivity:"base",numeric:!0})})}return e.isLayer?1:e.childCount}(this.layersRoot)}},"./src/file-loaders/lmvtk/f2d/F2dGeometry.js":function(t,e,r){"use strict";r.r(e),r.d(e,"F2DGeometry",function(){return n});var s=r("./src/file-loaders/lmvtk/f2d/GeometryBuilder.js"),i=r("./src/file-loaders/lmvtk/common/InputStream.js"),a=r("./src/logger/Logger.js"),o=r("./src/file-loaders/net/ErrorCodes.js"),u=r("./src/file-loaders/lmvtk/f2d/F2d.js");function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.metadata=t,this.scaleX=1,this.scaleY=1,this.bbox={min:{x:0,y:0,z:0},max:{x:0,y:0,z:0}},this.fillColor=null,t&&(t=t.page_dimensions,this.setScale(t)),this.excludeTextGeometry=e.excludeTextGeometry||!0,this.dbId=0,this.maxDbId=0,this.geometry=new s.GeometryBuilder,this.error=!1,this.offsetX=0,this.offsetY=0}var t,e,n;return t=r,(e=[{key:"setScale",value:function(t){this.paperWidth=t.page_width,this.paperHeight=t.page_height,this.scaleX=this.paperWidth/t.plot_width,this.scaleY=this.paperHeight/t.plot_height}},{key:"load",value:function(t,e){e instanceof Uint8Array||(e=new Uint8Array(e)),this.data=e,this.parse(),t.loadDoneCB(!0)}},{key:"loadFrames",value:function(t){var e=(this.loadContext=t).data;e?(e instanceof Uint8Array||(e=new Uint8Array(e)),this.data=e):t.finalFrame&&(this.data=null),this.probeFrames(t.finalFrame),t.loadDoneCB(!0)}},{key:"sx",value:function(t){return t*this.scaleX}},{key:"sy",value:function(t){return t*this.scaleY}},{key:"parserAssert",value:function(t,e,r){return t!=e&&(a.logger.warn("Expect "+e+"; actual type is "+t+"; in function "+r),this.error=!0)}},{key:"parseDataType",value:function(){var t=this.stream.getVarints();switch(t){case u.F2dDataType.dt_void:this.parseVoid();break;case u.F2dDataType.dt_int:this.parseInt();break;case u.F2dDataType.dt_object:this.parseObject();break;case u.F2dDataType.dt_varint:this.parseVarint();break;case u.F2dDataType.dt_point_varint:this.parsePoint();break;case u.F2dDataType.dt_float:this.parseFloat();break;case u.F2dDataType.dt_point_varint_array:this.parsePointsArray();break;case u.F2dDataType.dt_circular_arc:this.parseCircularArc();break;case u.F2dDataType.dt_circle:this.parseCircle();break;case u.F2dDataType.dt_arc:this.parseArc();break;case u.F2dDataType.dt_int_array:this.parseIntArray();break;case u.F2dDataType.dt_varint_array:this.parseVarintArray();break;case u.F2dDataType.dt_byte_array:this.parseByteArray();break;case u.F2dDataType.dt_string:this.parseString();break;case u.F2dDataType.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,a.logger.info("Data type not supported yet: "+t)}}},{key:"readHeader",value:function(){var t=this.stream=new i.InputStream(this.data),e=t.getString(3);if("F2D"!==e)return a.logger.error("Invalid F2D header : "+e,Object(o.errorCodeString)(o.ErrorCodes.BAD_DATA)),!1;e=t.getString(2);if("01"!==e)return a.logger.error("Only support f2d major version 1; actual version is : "+e,Object(o.errorCodeString)(o.ErrorCodes.BAD_DATA)),!1;if("."!==t.getString(1))return a.logger.error("Invalid version delimiter.",Object(o.errorCodeString)(o.ErrorCodes.BAD_DATA)),!1;t.getString(2);return!0}},{key:"probe",value:function(){var t=this.stream;this.error=!1;try{for(;t.offset<t.byteLength&&(this.parseDataType(),!this.error););}catch(t){var e=t.toString(),r=t.stack?t.stack.toString():"...";a.logger.error("Error in F2DProbe.prototype.probe : "+e+" with stack : "+r)}}},{key:"parse",value:function(){this.readHeader()&&this.probe()}},{key:"parseFrames",value:function(){this.data&&(this.stream=new i.InputStream(this.data),this.probe()),this.stream=null,this.data=null}},{key:"parsePointPositions",value:function(){var t=this.stream.getVarints(),e=this.stream.getVarints(),t=Object(u.restoreSignBitFromLSB)(t),e=Object(u.restoreSignBitFromLSB)(e);return t+=this.offsetX,e+=this.offsetY,this.offsetX=t,this.offsetY=e,[this.sx(t),this.sy(e)]}},{key:"parseObject",value:function(){this.stream.getVarints()}},{key:"parseString",value:function(){var t=this.stream;t.getVarints();var e=t.getVarints();return t.getString(e)}},{key:"parsePoint",value:function(){this.stream.getVarints(),this.parsePointPositions()}},{key:"parsePointsArray",value:function(){var t=this.stream,e=t.getVarints(),r=t.getVarints();if(r){r/=2;for(var n,s=[],i=0;i<r;++i)n=this.parsePointPositions(),s.push(n[0]),s.push(n[1]);switch(e){case u.F2dSemanticType.st_polyline:return void this.actOnPolylinePointsArray(s);case u.F2dSemanticType.st_dot:return void this.actOnDot(s[0],s[1]);default:a.logger.info("Unexpected opcode semantic type for points array.")}}}},{key:"parseArray",value:function(t){var e=this.stream;e.getVarints();for(var r=e.getVarints(),n=0;n<r;++n)t()}},{key:"parseIntArray",value:function(){var t=this.stream;this.parseArray(t.getUint32.bind(t))}},{key:"parseDoubleArray",value:function(){var t=this.stream;this.parseArray(t.getFloat64.bind(t))}},{key:"parseByteArray",value:function(){var t=this.stream;this.parseArray(t.getUint8.bind(t))}},{key:"parseVarintArray",value:function(){var t=this.stream;this.parseArray(t.getVarints.bind(t))}},{key:"parseInt",value:function(){var t=this.stream.getVarints(),e=this.stream.getUint32();return t===u.F2dSemanticType.st_fill&&(this.fillColor=e),e}},{key:"parseFloat",value:function(){this.stream.getVarints(),this.stream.getFloat32()}},{key:"parseVoid",value:function(){this.stream.getVarints()===u.F2dSemanticType.st_fill_off&&(this.fillColor=null)}},{key:"parseVarint",value:function(){var t=this.stream,e=t.getVarints(),r=t.getVarints();switch(e){case u.F2dSemanticType.st_object_id:case u.F2dSemanticType.st_markup_id:this.dbId=r,this.maxDbId=Math.max(this.maxDbId,r)}}},{key:"parseCircularArc",value:function(){var t,e,r=this.stream,n=r.getVarints();this.parserAssert(n,u.F2dSemanticType.st_arc,"parseCircularArc")||(t=this.parsePointPositions(),e=r.getVarints(),n=r.getFloat32(),r=r.getFloat32(),this.actOnCircularArc(t[0],t[1],n,r,this.sx(e)))}},{key:"parseCircle",value:function(){var t=this.stream,e=t.getVarints();this.parserAssert(e,u.F2dSemanticType.st_arc,"parseCircle")||(e=this.parsePointPositions(),t=t.getVarints(),this.actOnCompleteCircle(e[0],e[1],this.sx(t)))}},{key:"parseArc",value:function(){var t,e,r,n,s=this.stream,i=s.getVarints();this.parserAssert(i,u.F2dSemanticType.st_arc,"parseArc")||(t=this.parsePointPositions(),e=s.getVarints(),r=s.getVarints(),n=s.getFloat32(),i=s.getFloat32(),s=s.getFloat32(),this.actOnArc(t[0],t[1],i,s,this.sx(e),this.sy(r),n))}},{key:"actOnPolylinePointsArray",value:function(t){this.geometry.addPolyLine(t,this.fillColor,this.dbId)}},{key:"actOnDot",value:function(t,e){this.actOnCompleteCircle(t,e,this.sx(1))}},{key:"actOnCompleteCircle",value:function(t,e,r){this.geometry.addCircularArc(t,e,r,0,2*Math.PI,this.dbId)}},{key:"actOnCircularArc",value:function(t,e,r,n,s){this.geometry.addCircularArc(t,e,s,r,n,this.dbId)}},{key:"actOnArc",value:function(t,e,r,n,s,i){this.geometry.addEllipticalArc(t,e,r,n,s,i,this.dbId)}},{key:"actOnPolyTriangle",value:function(){a.logger.warn("Polytriangles not currently supported.")}}])&&h(t.prototype,e),n&&h(t,n),r}()},"./src/file-loaders/lmvtk/f2d/F2dProbe.js":function(t,e,r){"use strict";r.r(e),r.d(e,"F2DProbe",function(){return a});var n=r("./src/file-loaders/lmvtk/f2d/CheckedInputStream.js"),e=r("./src/file-loaders/lmvtk/f2d/F2d.js"),s=r("./src/file-loaders/net/ErrorCodes.js"),i=r("./src/logger/Logger.js");function a(){this.data=null,this.frameStart=0,this.frameEnd=0,this.stream=null,this.opCount=0,this.marker={frameStart:this.frameStart,frameEnd:this.frameEnd}}a.prototype.load=function(t){return this.data=t,this.frameStart=0,this.stream?(this.stream.reset(this.data),this.stream.seek(0),this.frameEnd=0):(this.stream=new n.CheckedInputStream(this.data),this.stream.seek(8),this.frameStart=8,this.frameEnd=8),this.probe(),this.marker.frameStart=this.frameStart,this.marker.frameEnd=this.frameEnd,this.marker};var o=e.F2dDataType,u=e.F2dSemanticType;a.prototype.readColor=function(){var t=this.stream;t.getVarints(),t.getVarints(),t.skipUint32()},a.prototype.parsePointPositions=function(){this.stream.getVarints(),this.stream.getVarints()},a.prototype.unhandledTypeWarning=function(t,e){i.logger.warn("Unhandled semantic type when probing F2d : "+e+" in function "+t)},a.prototype.parseObject=function(){this.stream.getVarints()},a.prototype.parseString=function(){var t=this.stream;t.getVarints();var e=t.getVarints();t.skipBytes(e)},a.prototype.parsePoint=function(){this.stream.getVarints(),this.parsePointPositions()},a.prototype.parseVarintArray=function(){var t=this.stream;t.getVarints();for(var e=t.getVarints(),r=0;r<e;++r)t.getVarints()},a.prototype.parseByteArray=function(){var t=this.stream;t.getVarints();var e=t.getVarints();t.skipBytes(e)},a.prototype.parseEndOfObject=function(){var t=this.stream;t.getVarints(),t.getVarints()},a.prototype.parsePointsArray=function(t){var e=this.stream,r=(e.getVarints(),e.getVarints());if(r){r/=2;for(var n=0;n<r;++n)this.parsePointPositions()}},a.prototype.parsePoint=function(t){this.stream.getVarints();this.parsePointPositions()},a.prototype.parseInt=function(){var t=this.stream,e=t.getVarints();switch(e){case u.st_color:case u.st_fill:t.skipUint32();break;default:t.skipUint32(),this.unhandledTypeWarning("parseInt",e)}},a.prototype.parseVoid=function(){var t=this.stream.getVarints();t===u.st_fill_off||this.unhandledTypeWarning("parseVoid",t)},a.prototype.parseVarint=function(){this.stream.getVarints(),this.stream.getVarints()},a.prototype.parseIntArray=function(){var t=this.stream;t.getVarints();for(var e=t.getVarints(),r=0;r<e;++r)t.skipUint32()},a.prototype.parseFloat=function(){var t=this.stream;t.getVarints(),t.getFloat32()},a.prototype.parseDoubleArray=function(){var t=this.stream;t.getVarints();for(var e=t.getVarints(),r=0;r<e;++r)t.skipFloat64()},a.prototype.parseCircularArc=function(){var t=this.stream;t.getVarints(),this.parsePointPositions(),t.getVarints(),t.getFloat32(),t.getFloat32()},a.prototype.parseCircle=function(){var t=this.stream;t.getVarints(),this.parsePointPositions(),t.getVarints()},a.prototype.parseArc=function(){var t=this.stream;t.getVarints(),this.parsePointPositions(),t.getVarints(),t.getVarints(),t.getFloat32(),t.getFloat32(),t.getFloat32()},a.prototype.parseDataType=function(){var t=this.stream.getVarints();switch(t){case o.dt_void:this.parseVoid();break;case o.dt_int:this.parseInt();break;case o.dt_object:this.parseObject();break;case o.dt_varint:this.parseVarint();break;case o.dt_float:this.parseFloat();break;case o.dt_point_varint:this.parsePoint();break;case o.dt_point_varint_array:this.parsePointsArray();break;case o.dt_circular_arc:this.parseCircularArc();break;case o.dt_circle:this.parseCircle();break;case o.dt_arc:this.parseArc();break;case o.dt_varint_array:this.parseVarintArray();break;case o.dt_int_array:this.parseIntArray();break;case o.dt_byte_array:this.parseByteArray();break;case o.dt_string:this.parseString();break;case o.dt_double_array:this.parseDoubleArray();break;default:this.error=!0,i.logger.error("Bad op code encountered : "+t+" , bail out.",Object(s.errorCodeString)(s.ErrorCodes.BAD_DATA))}this.error||(this.frameEnd=this.stream.offset)},a.prototype.probe=function(){var t=this.stream;try{for(;t.offset<t.byteLength&&(this.parseDataType(),!this.error);)this.opCount++}catch(t){t.toString(),t.stack&&t.stack.toString()}}},"./src/file-loaders/lmvtk/f2d/GeometryBuilder.js":function(t,e,r){"use strict";function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(e),r.d(e,"GeometryBuilder",function(){return n});var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.numPolyLine=0,this.numEllipticals=0,this.numCirculars=0,this.numSegments=0,this.geometries=[]}var e,r,n;return e=t,(r=[{key:"addPolyLine",value:function(t,e,r){this.numPolyLine++;for(var n=t.length/2,s=[],i=0;i<n;i++)s.push({x:t[2*i],y:t[2*i+1]});r={type:"polyLine",vertices:s,fillColor:e,dbId:r};this.geometries.push(r)}},{key:"addSegment",value:function(t,e,r){this.numSegments++;r={type:"lineSegment",from:t,to:e,dbId:r};this.geometries.push(r)}},{key:"addCircularArc",value:function(t,e,r,n,s,i){this.numCirculars++;i={type:"circularCurve",circle:{center:[t,e],radius:r},startInRadians:n,endInRadians:s,dbId:i};this.geometries.push(i)}},{key:"addEllipticalArc",value:function(t,e,r,n,s,i,a){this.numEllipticals++;var o,o={ellipse:{center:[t,e],majorAxis:s,minorAxis:i,tiltInRadians:r},startInRadians:n,endInRadians:a,dbId:o};this.geometries.push(o)}}])&&s(e.prototype,r),n&&s(e,n),t}()},"./src/file-loaders/lmvtk/fusion/base64.js":function(t,p,m){!function(u,c){var f;function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t){var e="object"==d(p)&&p,r="object"==d(u)&&u&&u.exports==e&&u,n="object"==(void 0===c?"undefined":d(c))&&c;n.global!==n&&n.window!==n||(t=n);function s(t){this.message=t}(s.prototype=new Error).name="InvalidCharacterError";function h(t){throw new s(t)}var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=/<%= spaceCharacters %>/g,i={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&h("The string to be encoded contains characters outside of the Latin1 range.");for(var e,r,n,s,i=t.length%3,a="",o=-1,u=t.length-i;++o<u;)e=t.charCodeAt(o)<<16,r=t.charCodeAt(++o)<<8,n=t.charCodeAt(++o),a+=l.charAt((s=e+r+n)>>18&63)+l.charAt(s>>12&63)+l.charAt(s>>6&63)+l.charAt(63&s);return 2==i?(e=t.charCodeAt(o)<<8,r=t.charCodeAt(++o),a+=l.charAt((s=e+r)>>10)+l.charAt(s>>4&63)+l.charAt(s<<2&63)+"="):1==i&&(s=t.charCodeAt(o),a+=l.charAt(s>>2)+l.charAt(s<<4&63)+"=="),a},decode:function(t){var e=(t=String(t).replace(o,"")).length;(e=e%4==0?(t=t.replace(/==?$/,"")).length:e)%4!=1&&!/[^+a-zA-Z0-9/]/.test(t)||h("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,s=0,i="",a=-1;++a<e;)n=l.indexOf(t.charAt(a)),r=s%4?64*r+n:n,s++%4&&(i+=String.fromCharCode(255&r>>(-2*s&6)));return i},version:"<%= version %>"};if("object"==d(m("./node_modules/webpack/buildin/amd-options.js"))&&m("./node_modules/webpack/buildin/amd-options.js"))void 0===(f=function(){return i}.call(p,m,p,u))||(u.exports=f);else if(e&&!e.nodeType)if(r)r.exports=i;else for(var a in i)i.hasOwnProperty(a)&&(e[a]=i[a]);else t.base64=i}(this)}.call(this,m("./node_modules/webpack/buildin/module.js")(t),m("./node_modules/webpack/buildin/global.js"))},"./src/file-loaders/lmvtk/otg/HashStrings.js":function(t,e){for(var s=new Array(256),r=0;r<256;r++){var n=r.toString(16);1===n.length&&(n="0"+n),s[r]=n}var i=new Array(20);var o=new Array(10);function u(t){for(var e=10===t.length?i:[],r=0;r<t.length;r++){var n=t.charCodeAt(r);e[2*r]=s[255&n],e[2*r+1]=s[n>>8&255]}return e.join("")}function h(t){return 48<=t&&t<=57?t-48:65<=t&&t<=70?t-55:97<=t&&t<=102?t-87:0}t.exports={getHexStringPacked:function(t,e,r){for(var n=20===r?o:[],s=0;s<r;s+=2){var i=t[e+s],a=t[e+s+1];n[s/2]=a<<8|i}return String.fromCharCode.apply(null,n)},unpackHexString:u,hexToBin:function(t,e,r){for(var n=10===t.length?u(t):t,s=r,i=0;i<n.length;i+=2){var a=h(n.charCodeAt(i)),o=h(n.charCodeAt(i+1));e[s++]=a<<4|o}}}},"./src/file-loaders/lmvtk/otg/LocalDbCache.js":function(t,e,r){"use strict";r.r(e),r.d(e,"LocalDbCache",function(){return n});r("./src/file-loaders/lmvtk/common/StringUtils.js");var s=r("./src/compat.js");function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r("./node_modules/pako/index.js"),o="otg-content",u="otg-lru",n=function(){function r(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.db=null,this.readTransaction=null,this.loaded=!1,this.opening=!1,this.dbDisabled=this._isDbDisabled(t,e),!Object(s.isNodeJS)()&&this.dbDisabled&&console.log("IndexedDb disabled"),this.storeName=o,this.storeNameTimestamp=u,this.bothStoreNames=[this.storeName,this.storeNameTimestamp],this.useCompression=!0,this.pendingTimestampUpdates={},this.pendingTimestampCount=0,this.pendingStores=[],this._pendingCallbacks=[]}var t,e,n;return t=r,(e=[{key:"_isDbDisabled",value:function(t,e){return t||Object(s.isNodeJS)()||Object(s.isSafari)()||Object(s.isMobileDevice)()||s.isIE11&&e||"undefined"==typeof indexedDB}},{key:"notifyPendingCallbacks",value:function(e){var r=this;this._pendingCallbacks.forEach(function(t){return t(e,r.db)}),this._pendingCallbacks=[]}},{key:"open",value:function(t){var e=this;this.dbDisabled?t&&t():this.loaded?t&&t(null,this.db):this.opening?t&&this._pendingCallbacks.push(t):(this.opening=!0,(t=indexedDB.open("otg",1)).onerror=function(t){console.error("Failed to open or create cache database."),e.dbDisabled=!0,e.notifyPendingCallbacks(t)},t.onsuccess=function(t){e.opening=!1,e.db=t.target.result,e.db.onerror=function(t){console.error("Database error",t)},e.loaded=!0,e.notifyPendingCallbacks()},t.onupgradeneeded=function(t){console.log("Db upgrade",e.storeName);t=t.target.result;t.createObjectStore(o),t.createObjectStore(u).createIndex(u+"-index","t",{unique:!1})})}},{key:"deleteOld",value:function(s){var t,i,a=this;this.db?this.deleteInProgress||(this.deleteInProgress=!0,t=IDBKeyRange.upperBound(Date.now()-3e5,!0),i=[],this.db.transaction([this.storeNameTimestamp]).objectStore(this.storeNameTimestamp).index(this.storeNameTimestamp+"-index").openCursor(t).onsuccess=function(t){t=t.target.result;if(t&&i.length<200)return i.push(t.primaryKey),void t.continue();if(i.length){console.log("Deleting old objects.",i.length);t=a.db.transaction(a.bothStoreNames,"readwrite");t.oncomplete=function(t){a.deleteInProgress=!1,console.log("Delete done"),s&&s()},t.onerror=function(t){a.deleteInProgress=!1,console.error("Transaction error.",t)},t.onabort=function(t){a.deleteInProgress=!1;t=t.target.error;console.log("Failed to delete cached objects",t)};for(var e=t.objectStore(a.storeName),r=t.objectStore(a.storeNameTimestamp),n=0;n<i.length;n++)e.delete(i[n]),r.delete(i[n])}}):s()}},{key:"flush",value:function(e){var t,r=this;if(this.pendingStores.length){this.writeTransaction||(t=this.db.transaction(this.bothStoreNames,"readwrite"),e&&(t.oncomplete=function(t){e()}),t.onerror=function(t){console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=function(t){"QuotaExceededError"===t.target.error.name&&r.deleteOld(function(){}),e&&e(t.target.error)},this.writeTransaction=t);for(var n=0;n<this.pendingStores.length;n+=2){var s=this.pendingStores[n],i=this.pendingStores[n+1];if(i instanceof Uint8Array&&this.useCompression&&(31!==i[0]||139!==i[1]))try{i=a.gzip(i)}catch(t){console.error("Compression failed.")}this.writeTransaction.objectStore(this.storeName).put(i,s).onerror=function(t){console.error("Object store error.",t)},this.writeTransaction.objectStore(this.storeNameTimestamp).put({t:Date.now()},s)}this.pendingStores=[],this.writeTransaction=null}else e&&e()}},{key:"store",value:function(t,e,r){this.db?(this.pendingStores.push(t),this.pendingStores.push(e),this.pendingStores.length<200?r&&r():this.flush(r)):r&&r()}},{key:"flushTimestamps",value:function(e){var r=this,t=this.db.transaction([this.storeNameTimestamp],"readwrite");e&&(t.oncomplete=function(t){e()}),t.onerror=function(t){console.error("Transaction error.",t),e&&e(t.target.error)},t.onabort=function(t){"QuotaExceededError"===t.target.error.name&&(console.log("Quota exceeded"),r.deleteOld(function(){})),e&&e(t.target.error)};var n,s=t.objectStore(this.storeNameTimestamp);for(n in this.pendingTimestampUpdates)s.put({t:this.pendingTimestampUpdates[n]},n);this.pendingTimestampUpdates={},this.pendingTimestampCount=0}},{key:"_createReadTransaction",value:function(){var e=this,t=this.readTransaction=this.db.transaction(this.storeName);t.oncomplete=function(t){e.readTransaction=null},t.onerror=function(t){console.error("Transaction error.",comment,t),e.readTransaction=null},t.onabort=function(t){console.warn("Transaction abort",comment,t),e.readTransaction=null}}},{key:"get",value:function(e,r){var n,s=this;if(this.opening)return console.error("Tried to get IndexedDb resource while database was still opening"),void r(-1,null);if(this.db){this.readTransaction||this._createReadTransaction();try{n=this.readTransaction.objectStore(this.storeName).get(e)}catch(t){this._createReadTransaction(),n=this.readTransaction.objectStore(this.storeName).get(e)}n.onsuccess=function(t){if(t.target.result){t=t.target.result;if(31===t[0]&&139===t[1])try{t=a.ungzip(t)}catch(t){return console.error("Failed to decompress.",t),void r(t,null)}r(null,t),s.pendingTimestampUpdates[e]=Date.now(),s.pendingTimestampCount++}else r(-1,null)},n.onerror=function(t){r(t.target.errorCode)}}else r(-1,null)}},{key:"updatePendingTimestamps",value:function(){var e=this;this.db&&this.flush(function(t){t||e.flushTimestamps()})}},{key:"size",value:function(r){var n,s,t;this.db?(s=n=0,(t=this.db.transaction([this.storeName]).objectStore(this.storeName).openCursor()).onsuccess=function(t){var e=t.target.result;e?(t=e.value,n+=t.length,s++,e.continue()):r(null,{size:n,items:s})},t.onerror=function(t){r(t)}):r()}}])&&i(t.prototype,e),n&&i(t,n),r}()},"./src/file-loaders/lmvtk/otg/OtgFragInfo.js":function(t,e,r){"use strict";r.r(e),r.d(e,"OtgFragInfo",function(){return n});var f=r("./src/wgs/scene/LmvBox3.js");function d(t,e){this.min.x=t[e],this.min.y=t[e+1],this.min.z=t[e+2],this.max.x=t[e+3],this.max.y=t[e+4],this.max.z=t[e+5]}function p(t,e){t[e]=this.min.x,t[e+1]=this.min.y,t[e+2]=this.min.z,t[e+3]=this.max.x,t[e+4]=this.max.y,t[e+5]=this.max.z}function n(t,e){var r=t[1]<<8|t[0];this.boxStride=(r=r||28)/4,this.count=t.byteLength/r-1;var n=e.globalOffset||{x:0,y:0,z:0},s=e.fragmentTransformsOffset||{x:0,y:0,z:0};if(this.count){this.boxes=new Float32Array(t.buffer,r),this.flags=new Int32Array(t.buffer,r);var i=this.boxes;if(e.placementTransform)for(var a=new f.LmvBox3,o=0,u=0;u<this.count;u++,o+=this.boxStride)d.call(a,i,o),a.min.x+=s.x,a.min.y+=s.y,a.min.z+=s.z,a.max.x+=s.x,a.max.y+=s.y,a.max.z+=s.z,a.applyMatrix4(e.placementWithOffset),p.call(a,i,o);else for(var h=s.x-n.x,l=s.y-n.y,c=s.z-n.z,u=0,o=0;u<this.count;u++,o+=this.boxStride)i[o]+=h,i[o+1]+=l,i[o+2]+=c,i[o+3]+=h,i[o+4]+=l,i[o+5]+=c}this.hasPolygonCounts=!0,this.wantSort=!1}n.prototype.getCount=function(){return this.count},n.prototype.isTransparent=function(t){return!!(this.flags[t*this.boxStride+6]>>24)},n.prototype.getPolygonCount=function(t){return 16777215&this.flags[t*this.boxStride+6]}},"./src/file-loaders/lmvtk/otg/OtgGeomCodec.js":function(t,e,r){"use strict";r.r(e),r.d(e,"serializeLmvBufferGeom",function(){return a}),r.d(e,"readLmvBufferGeom",function(){return O});var n=r("./src/compat.js"),o=r("./src/file-loaders/lmvtk/common/InputStream.js"),s=r("./src/wgs/scene/LmvBox3.js"),h={Index:0,IndexEdges:1,Position:2,Normal:3,TextureUV:4,Color:5},i=0,e=1,u=2,l=3,c=4,f=5,d=6,p=7,m=8,r=9,g=10,b={TRIANGLES:0,LINES:1,POINTS:2,WIDE_LINES:3},y={position:h.Position,normal:h.Normal,index:h.Index,indexlines:h.IndexEdges,color:h.Color},v={};v[h.Position]="position",v[h.Normal]="normal",v[h.Index]="index",v[h.IndexEdges]="indexlines",v[h.Color]="color",v[h.TextureUV]="uv";var _={};function x(t){for(var e=[],r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);for(var n,r=0;r<e.length;r++)(s=e[r])[0]>s[1]&&(n=s[0],s[0]=s[1],s[1]=n);e.sort(function(t,e){return t[0]-e[0]});var s=e[0],i=0;t[i]=s[0],t[i+1]=s[1]-s[0],i+=2;for(r=1;r<e.length;r++,i+=2)s=e[r],t[i]=s[0]-e[r-1][0],t[i+1]=s[1]-s[0]}function w(t){if(t.length){t[1]+=t[0];for(var e=2;e<t.length;e+=2)t[e]+=t[e-2],t[e+1]+=t[e]}}function k(){}function I(t){this.buffer=t,this.readOffset=0,this.meshFlag=0,this.numBuffers=0,this.numAttributes=0,this.bufferOffsets=[],this.attributes=[],this.buffers=[]}function a(t){var e=new k,r=[];if(!t.vb)return console.error("Unexpected non-interleaved vertex buffer"),null;r=[t.vb.byteLength,t.ib.byteLength],t.iblines&&r.push(t.iblines.byteLength);var n=Object.keys(t.attributes),s=0;t.isLines&&(s|=b.LINES),t.isWideLines&&(s|=b.WIDE_LINES),t.isPoints&&(s|=b.POINTS),e.beginHeader(s,n.length,r);for(var i,a=0;a<n.length;a++){var o=t.attributes[n[a]],u=(u=n[a],(i=void 0)!==(i=y[u])?i:(0===u.indexOf("uv")||console.warn("Unknown attribute name"),h.TextureUV));"index"===n[a]?e.addAttribute(u,o,0,1):"indexlines"===n[a]?e.addAttribute(u,o,0,2):e.addAttribute(u,o,t.vbstride,0)}e.endHeader();r=Buffer.from(t.vb.buffer,t.vb.byteOffset,t.vb.byteLength);return e.addBuffer(r),(t.isLines?x:function(t){for(var e=[],r=0;r<t.length;r+=3)e.push([t[r],t[r+1],t[r+2]]);for(var n,s,r=0;r<e.length;r++)for(var i=e[r];i[0]>i[1]||i[0]>i[2];)s=void 0,s=(n=i)[0],n[0]=n[1],n[1]=n[2],n[2]=s;e.sort(function(t,e){return t[0]-e[0]});var i=e[0],a=0;for(t[a]=i[0],t[a+1]=i[1]-i[0],t[a+2]=i[2]-i[0],a+=3,r=1;r<e.length;r++,a+=3)i=e[r],t[a]=i[0]-e[r-1][0],t[a+1]=i[1]-i[0],t[a+2]=i[2]-i[0]})(t.ib),r=Buffer.from(t.ib.buffer,t.ib.byteOffset,t.ib.byteLength),e.addBuffer(r),t.iblines&&(x(t.iblines),r=Buffer.from(t.iblines.buffer,t.iblines.byteOffset,t.iblines.byteLength),e.addBuffer(r)),e.end()}_[i]=1,_[e]=2,_[u]=1,_[l]=2,_[c]=1,_[f]=2,_[d]=1,_[p]=2,_[m]=4,_[r]=4,_[g]=4,k.prototype.beginHeader=function(t,e,r){var n=8,s=r.length;for(n+=4*(s-1),n+=5*e;n%4!=0;)n++;for(var i=0,a=0;a<r.length;a++)i+=r[a];this.buffer=Buffer.alloc(n+i);for(a=this.writeOffset=0;a<4;a++)this.writeOffset=this.buffer.writeUInt8("OTG0".charCodeAt(a),this.writeOffset);this.writeOffset=this.buffer.writeUInt16LE(t,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(s,this.writeOffset),this.writeOffset=this.buffer.writeUInt8(e,this.writeOffset);for(var o=r[0],a=1;a<r.length;a++)this.writeOffset=this.buffer.writeUInt32LE(o,this.writeOffset),o+=r[a]},k.prototype.addAttribute=function(t,e,r,n){var s,i,a;this.writeOffset=this.buffer.writeUInt8(t,this.writeOffset),t===h.Index||t===h.IndexEdges?this.writeOffset=this.buffer.writeUInt8((i=l,1===(a=(s=e).bytesPerItem||2)?i=u:2===a?i=l:4===a&&(i=g),i<<4|15&s.itemSize),this.writeOffset):this.writeOffset=this.buffer.writeUInt8((a=m,1===(s=(i=e).bytesPerItem||4)?a=i.normalize?d:u:2===s&&(a=i.normalize?p:l),a<<4|15&i.itemSize),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(e.itemOffset||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(4*(r||0),this.writeOffset),this.writeOffset=this.buffer.writeUInt8(n,this.writeOffset)},k.prototype.endHeader=function(){for(;this.writeOffset%4!=0;)this.writeOffset=this.buffer.writeUInt8(0,this.writeOffset)},k.prototype.addBuffer=function(t){t.copy(this.buffer,this.writeOffset),this.writeOffset+=t.length},k.prototype.end=function(){return this.writeOffset!==this.buffer.length&&console.error("Incorrect encoding buffer size"),this.buffer},I.prototype.readNodeJS=function(){if("OTG0"!==this.buffer.toString("ascii",0,4))return console.error("Invalid OTG header"),!1;if(this.readOffset=4,this.meshFlag=this.buffer.readUInt16LE(this.readOffset),this.readOffset+=2,this.numBuffers=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numAttributes=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.numBuffers){this.bufferOffsets.push(0);for(var t=1;t<this.numBuffers;t++){var e=this.buffer.readUInt32LE(this.readOffset);this.readOffset+=4,this.bufferOffsets.push(e)}}for(t=0;t<this.numAttributes;t++){var r={};r.name=this.buffer.readUInt8(this.readOffset),this.readOffset++;var n=this.buffer.readUInt8(this.readOffset);this.readOffset++,r.itemSize=15&n,r.type=n>>4,r.bytesPerItem=_[r.type],r.normalize=r.type===c||r.type===f||r.type===d||r.type===p,r.itemOffset=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,r.itemStride=this.buffer.readUInt8(this.readOffset)/4,this.readOffset++,r.bufferIndex=this.buffer.readUInt8(this.readOffset),this.readOffset++,this.attributes.push(r)}for(;this.readOffset%4!=0;)this.readOffset++;for(t=0;t<this.bufferOffsets.length;t++){var s=this.readOffset+this.bufferOffsets[t],i=t<this.bufferOffsets.length-1?this.readOffset+this.bufferOffsets[t+1]:this.buffer.length;this.buffers.push(this.buffer.slice(s,i))}return!0},I.prototype.readWeb=function(){var t=new o.InputStream(this.buffer);if("OTG0"!==t.getString(4))return console.error("Invalid OTG header"),!1;if(this.meshFlag=t.getUint16(),this.numBuffers=t.getUint8(),this.numAttributes=t.getUint8(),this.numBuffers){this.bufferOffsets.push(0);for(var e=1;e<this.numBuffers;e++){var r=t.getUint32();this.bufferOffsets.push(r)}}for(e=0;e<this.numAttributes;e++){var n={};n.name=t.getUint8();var s=t.getUint8();n.itemSize=15&s,n.type=s>>4,n.bytesPerItem=_[n.type],n.normalize=n.type===c||n.type===f||n.type===d||n.type===p,n.itemOffset=t.getUint8()/4,n.itemStride=t.getUint8()/4,n.bufferIndex=t.getUint8(),this.attributes.push(n)}for(;t.offset%4!=0;)t.offset++;for(e=0;e<this.bufferOffsets.length;e++){var i=t.offset+this.bufferOffsets[e],a=e<this.bufferOffsets.length-1?t.offset+this.bufferOffsets[e+1]:t.byteLength;this.buffers.push(this.buffer.subarray(i,a))}return!0},I.prototype.read=function(){return Object(n.isNodeJS)()&&this.buffer instanceof Buffer?this.readNodeJS():this.readWeb()};var S=new s.LmvBox3;S.min.x=-.5,S.min.y=-.5,S.min.z=-.5,S.max.x=.5,S.max.y=.5,S.max.z=.5;var A={center:{x:0,y:0,z:0},radius:Math.sqrt(.75)};function O(t,e){var r=new I(t);if(!r.read())return console.error("Failed to parse OTG geometry"),null;for(var n={vblayout:{},vb:new Float32Array(r.buffers[0].buffer,r.buffers[0].byteOffset,r.buffers[0].byteLength/4),isLines:(3&r.meshFlag)===b.LINES,isWideLines:(3&r.meshFlag)===b.WIDE_LINES,isPoints:(3&r.meshFlag)===b.POINTS,boundingBox:S,boundingSphere:A},s=0;s<r.attributes.length;s++){var i,a,o=r.attributes[s];o.name===h.Index?(i=r.buffers[1],1===o.bytesPerItem?n.indices=i:2===o.bytesPerItem?n.indices=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(n.indices=new Uint32Array(i.buffer,i.byteOffset,i.byteLength/o.bytesPerItem)),(n.isLines?w:function(t){if(t.length){t[1]+=t[0],t[2]+=t[0];for(var e=3;e<t.length;e+=3)t[e]+=t[e-3],t[e+1]+=t[e],t[e+2]+=t[e]}})(n.indices)):o.name===h.IndexEdges?e||(a=r.buffers[2],1===o.bytesPerItem?n.iblines=a:2===o.bytesPerItem?n.iblines=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/o.bytesPerItem):4===o.bytesPerItem&&(n.iblines=new Uint32Array(a.buffer,a.byteOffset,a.byteLength/o.bytesPerItem)),w(n.iblines)):(a=o.name,a=(a=v[a])||(console.error("Unknown vertex attribute"),h.TextureUV),n.vbstride?n.vbstride!==o.itemStride&&console.error("Unexpected vertex buffer stride mismatch."):n.vbstride=o.itemStride,o.itemOffset>=o.itemStride||(n.vblayout[a]={bytesPerItem:o.bytesPerItem,offset:o.itemOffset,normalize:o.normalize,itemSize:o.itemSize}))}return{mesh:n,packId:0,meshIndex:0}}},"./src/file-loaders/lmvtk/otg/OtgWebSocket.js":function(t,e,r){function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r("./node_modules/isomorphic-ws/browser.js"),o=r("./src/file-loaders/lmvtk/otg/HashStrings.js").hexToBin,i=r("./src/file-loaders/lmvtk/otg/HashStrings.js").getHexStringPacked,u="undefined"!=typeof navigator;t.exports.OtgWs=function(){"use strict";function n(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.ws=null,this.numRequests=0,this.txMsg=0,this.rxMsg=0,this.authorizeUrns={},this._pendingCallbacks=[],this._retriedOpen=0,this._wsUsable=!t.disableWebSocket&&void 0!==a&&!!t.otg_ws,this.loadCB=e,this.errorCB=r,this._pendingMdata=[],this._pendingSends={g:[],m:[],t:[]},this.msgBuffer=new Uint8Array(201),this.addAuthorizeUrns(t)}var t,e,r;return t=n,(e=[{key:"notifyPendingCallbacks",value:function(e){this._pendingCallbacks.forEach(function(t){t(e)}),this._pendingCallbacks=[]}},{key:"addAuthorizeUrns",value:function(t){var e=this;t&&t.authorizeUrns&&t.authorizeUrns.forEach(function(t){e.authorizeUrns[t]=1})}},{key:"getWebSocket",value:function(){var t=this.ws;return t&&1===t.readyState?t:(t&&0===t.readyState&&console.warn("Reentry into getWebSocket. Should not happen."),null)}},{key:"startSession",value:function(t,e){var r,n;this._wsUsable?(this.addAuthorizeUrns(t),r=this,e&&r._pendingCallbacks.push(e),r._opening||((n=this.getWebSocket())?this.notifyPendingCallbacks(n):(t&&(this.loadContext=t),this.openWebSocket(function(t){r.flushEvent=setInterval(function(){r.ws&&r.flushSendQueue()},200),r.notifyPendingCallbacks(t)})))):e&&e(null)}},{key:"endSession",value:function(){var t,e=this;e.numRequests?console.warn("Messages still pending. Leaving WebSocket open."):((t=e.getWebSocket())&&1===t.readyState&&(console.log("Web socket close."),e._opening=!1,e._clientClose=!0,t.close(1e3),e.ws=null),e.flushEvent&&(clearInterval(e.flushEvent),e.flushEvent=null))}},{key:"openWebSocket",value:function(e){var r=this,n=this.loadContext,s=this;s._opening=!0;var t=n.otg_ws.replace("https:","wss:").replace("http:","ws:").replace(":7124",":7125");n.queryParams&&(t+="?"+n.queryParams);var i=new a(t,void 0,{headers:n.headers});i.addEventListener("open",function(){for(var t in s._opening=!1,s.ws=i,s.accountIdSent=null,i.binaryType="arraybuffer",u&&i.send("/headers/"+JSON.stringify(n.headers)),i.send("/options/"+JSON.stringify({batch_responses:!0})),s.batchResponses=!0,s.authorizeUrns)i.send("/auth/"+t);e(i)}),i.addEventListener("message",function(t){s.batchResponses?r.decodeBatchMessage(new Uint8Array(t.data)):r.decodeSingleItemMessage(new Uint8Array(t.data))}),i.addEventListener("close",function(t){s.numRequests&&console.log("Socket close",t.code,t.reason,"pending:",s.numRequests,"tx:",s.txMsg,"rx:",s.rxMsg),s._opening=!1,s.ws=null,!s._clientClose&&s.numRequests&&(console.log("Abnormal socket close. Retrying.",t.code,t.reason,"pending:",s.numRequests),s._retriedOpen++,s.numRequests=0,s._retriedOpen<=3?setTimeout(function(){s.openWebSocket(function(t){s.errorCB&&s.errorCB(s.loadContext)})},2e3):(console.error("Too many WebSocket failures. Giving up on mesh load."),s._wsUsable=!1,s.errorCB&&s.errorCB(s.loadContext))),s._clientClose=!1}),i.addEventListener("error",function(t){console.log("ws error, reverting to plain http.",t),s._opening=!1,s.ws=null,s._wsUsable=!1,s.notifyPendingCallbacks(s,i),s.errorCB&&s.errorCB(!0)})}},{key:"decodeSingleItemMessage",value:function(t,e){var r=i(t,0,20),t=new Uint8Array(t.buffer,t.byteOffset+20,t.length-20);this.numRequests--,this.rxMsg++,this.loadCB(t,r,this.loadContext,!1,e)}},{key:"decodeBatchMessage",value:function(t){var e=new Int32Array(t.buffer,0,3);if(827019343===e[0])for(var r=String.fromCharCode(255&e[1]),n=e[2],s=new Int32Array(t.buffer,12,n),i=12+4*n,a=0;a<s.length;a++){var o=s[a],u=a<s.length-1?s[a+1]:t.length-i,o=new Uint8Array(t.buffer,o+i,u-o);this.decodeSingleItemMessage(o,r)}else console.error("Invalid message format",e[0].toString(16),e[1],t)}},{key:"flushSendQueue",value:function(){var t,e=this;for(t in e._pendingSends){var r=e._pendingSends[t];if(r.length){e.txMsg+=r.length;var n=1+20*r.length;e.msgBuffer.length<n&&(e.msgBuffer=new Uint8Array(n));var s=e.msgBuffer;s[0]=t.charCodeAt(0);for(var i=0;i<r.length;i++)o(r[i],s,1+20*i);var a=this.getWebSocket();if(!a)return;a.send(new Uint8Array(s.buffer,0,n)),e._pendingSends[t]=[]}}}},{key:"requestResources",value:function(t,e,r){if(this.ws){var n=this;r=r||"g";for(var s=0;s<t.length;s++){n.numRequests++;var i=t[s],i=i.slice(i.indexOf("/cdn/")+5).split("/");n.accountIdSent!==i[1]&&(this.ws.send("/account_id/"+i[1]),n.accountIdSent=i[1]),n._pendingSends[r].push(e[s]),200<n._pendingSends[r].length&&n.flushSendQueue()}}else console.error("Trying to request resources over non-existent web socket,")}}])&&s(t.prototype,e),r&&s(t,r),n}()},"./src/file-loaders/lmvtk/svf/Cameras.js":function(t,e,r){"use strict";function n(t,e){var r=e.definition,e=t.seekToEntry(r);if(!e)return null;if(2<e.version)return null;r=t.stream,t={isPerspective:!r.getUint8(),position:t.readVector3f(),target:t.readVector3f(),up:t.readVector3f(),aspect:r.getFloat32(),fov:r.getFloat32()*(180/Math.PI)};return e.version<2&&(r.getFloat32(),r.getFloat32()),t.orthoScale=r.getFloat32(),t}r.r(e),r.d(e,"readCameraDefinition",function(){return n})},"./src/file-loaders/lmvtk/svf/Fragments.js":function(t,e,r){"use strict";r.r(e),r.d(e,"FragList",function(){return n}),r.d(e,"readGeometryMetadataIntoFragments",function(){return s}),r.d(e,"readGeometryMetadata",function(){return i}),r.d(e,"readFragments",function(){return a}),r.d(e,"filterFragments",function(){return o});var W=r("./src/wgs/scene/LmvBox3.js"),G=r("./src/wgs/scene/LmvMatrix4.js"),H=r("./src/wgs/scene/LmvVector3.js"),e=r("./src/compat.js"),q=r("./src/wgs/scene/MeshFlags.js"),Z=(Object(e.isMobileDevice)(),null),X=100;function n(){this.length=0,this.numLoaded=0,this.boxes=null,this.transforms=null,this.materials=null,this.packIds=null,this.entityIndexes=null,this.fragId2dbId=null,this.topoIndexes=null,this.visibilityFlags=null}function s(t,e){var r=e.geomDataIndexes.length,n=t.stream,s=0,i={},a=e.mesh2frag={};e.polygonCounts=e.geomDataIndexes;for(var o=0;o<r;o++){var u=e.geomDataIndexes[o];if(i[u]){var h=i[u];e.polygonCounts[o]=e.polygonCounts[h],e.packIds[o]=e.packIds[h],e.entityIndexes[o]=e.entityIndexes[h],s+=e.polygonCounts[o]}else{if(!t.seekToEntry(u))return;n.getUint8(),n.seek(n.offset+24),e.polygonCounts[o]=n.getUint16(),e.packIds[o]=parseInt(t.readString()),e.entityIndexes[o]=t.readU32V(),s+=e.polygonCounts[o],i[u]=o}h=e.packIds[o]+":"+e.entityIndexes[o],u=a[h];void 0===u?a[h]=o:Array.isArray(u)?u.push(o):a[h]=[u,o]}return i=e.geomDataIndexes=null,s}function i(t,e){var r=t.getEntryCounts(),n=t.stream;e.length=r;for(var s=e.fragTypes=new Uint8Array(r),i=e.primCounts=new Uint16Array(r),a=e.packIds=new Int32Array(r),o=e.entityIndexes=new Int32Array(r),u=0,h=r;u<h;u++){var l=t.seekToEntry(u);if(!l)return;if(s[u]=n.getUint8(),n.seek(n.offset+24),i[u]=n.getUint16(),a[u]=parseInt(t.readString()),o[u]=t.readU32V(),2<l.version){l=n.getInt32();if(-1!=l&&void 0===c)for(var c=e.topoIndexes=new Int32Array(r),f=0;f<u;f++)c[f]=-1;null!=c&&(c[u]=l)}}}function a(t,e,r,n,s,i,a,o){var u=function(t,e){var r=[];if(!e)return r;for(var n=t.getEntryCounts(),s=t.stream,i=0;i<n;i++){var a=t.seekToEntry(i);if(!a)return;if(5<a.version)return;4<a.version&&t.readU8(),t.readU32V(),2<a.version||t.readString(),t.readU32V(),t.readTransform(i,null,12*i);for(var o=0;o<6;o++)s.getFloat32();1<a.version&&(a=t.readU32V(),0<=e.indexOf(a)&&r.push(i))}return r}(t,i),i=u.length||t.getEntryCounts(),h=t.stream;Z&&Z<i&&(i=Z),e.totalLength=t.getEntryCounts(),e.length=i,e.numLoaded=0;var l,c,f=e.boxes=new(s?Float64Array:Float32Array)(6*i),d=e.transforms=new(s?Float64Array:Float32Array)(12*i),p=e.materials=new Int32Array(i),m=e.packIds=new Int32Array(i),g=e.entityIndexes=new Int32Array(i),b=e.geomDataIndexes=new Int32Array(i),y=e.fragId2dbId=new Int32Array(i),v=e.visibilityFlags=new Uint16Array(i),_=[0,0,0];n&&(l=new W.LmvBox3,c=new G.LmvMatrix4(!0).fromArray(n.elements));var x=!r&&a,w=d,k=12,I=9;x&&(s||(f=new Float64Array(6*i),w=new Float64Array(3*i),k=3,I=0));for(var S,A=0,O=e.length;A<O;A++){var C=u.length?t.seekToEntry(u[A]):t.seekToEntry(A);if(!C)return;if(5<C.version)return;var T=!0;4<C.version&&(T=0!=(1&t.readU8())),v[A]=T?q.MeshFlags.MESH_VISIBLE:0,p[A]=t.readU32V(),2<C.version?b[A]=t.readU32V():(m[A]=parseInt(t.readString()),g[A]=t.readU32V()),t.readTransform(A,d,12*A,n,r,_),x&&w!==d&&w.set(_,A*k+I),3<C.version?function(t,e){for(var r=6*t,n=0;n<6;n++)f[r++]=h.getFloat32()+e[n%3]}(A,_):function(t){for(var e=6*t,r=0;r<6;r++)f[e++]=h.getFloat32()}(A),S=A,n&&(l.setFromArray(f,S=6*S),l.applyMatrix4(c),l.copyToArray(f,S)),r&&(T=6*A,f[T++]-=r.x,f[T++]-=r.y,f[T++]-=r.z,f[T++]-=r.x,f[T++]-=r.y,f[T++]-=r.z),1<C.version&&(y[A]=t.readU32V())}if(x){for(var E=-1,j=-1,z=-1,P=f.length,M=0;M<P;M+=6)E=Math.max(E,f[M+3]-f[M]),j=Math.max(j,f[M+4]-f[M+1]),z=Math.max(z,f[M+5]-f[M+2]);a=a.size();if(a.x>E*X||a.y>j*X||a.z>z*X){for(var L=0,F=0,V=0,M=0;M<P;M+=3)L+=f[M],F+=f[M+1],V+=f[M+2];r=new H.LmvVector3(3*L/P,3*F/P,3*V/P)}else r=o;var U=e.boxes;for(M=0;M<P;M+=3)U[M]=f[M]-r.x,U[M+1]=f[M+1]-r.y,U[M+2]=f[M+2]-r.z;if(n&&w!==d)for(var B=new H.LmvVector3,A=0;A<O;++A){var D=A*k+I;B.fromArray(w,D).applyMatrix4(c).toArray(w,D)}for(A=0;A<O;++A){var R=12*A+9,N=A*k+I;d[R]=w[N]-r.x,d[1+R]=w[N+1]-r.y,d[2+R]=w[N+2]-r.z}}return e.finishLoading=!0,r}function o(t,e){t.length=e.length,t.numLoaded=0;for(var r=t.length,n=[1/0,1/0,1/0,-1/0,-1/0,-1/0],s=new Float32Array(6*r),i=new Float32Array(12*r),a=new Int32Array(r),o=new Int32Array(r),u=new Int32Array(r),h=new Uint16Array(r),l=new Int32Array(r),c=new Int32Array(r),f=t.geomDataIndexes?new Int32Array(r):null,d=t.topoIndexes?new Int32Array(r):null,p={},m=0;m<e.length;++m){for(var g=e[m],b=6*g,y=6*m,v=0;v<6;++v)s[y++]=t.boxes[b++];for(var b=12*g,y=12*m,_=0;_<12;++_)i[y++]=t.transforms[b++];a[m]=t.materials[g],o[m]=t.packIds[g],u[m]=t.entityIndexes[g],h[m]=t.visibilityFlags[g],l[m]=t.fragId2dbId[g],c[m]=t.polygonCounts[g],f&&(f[m]=t.geomDataIndexes[g]),d&&(d[m]=t.topoIndexes[g]);var x=t.packIds[g]+":"+t.entityIndexes[g],g=p[x];null==g?p[x]=m:Array.isArray(g)?g.push(m):p[x]=[g,m];for(var w=6*m,k=0;k<3;++k)s[w+k]<n[k]&&(n[k]=s[w+k]);for(var I=3;I<6;++I)s[w+I]>n[I]&&(n[I]=s[w+I])}return t.boxes=s,t.transforms=i,t.materials=a,t.packIds=o,t.entityIndexes=u,t.mesh2frag=p,t.visibilityFlags=h,t.fragId2dbId=l,t.polygonCounts=c,t.geomDataIndexes=f,t.topoIndexes=d,t.totalLength=r,n}},"./src/file-loaders/lmvtk/svf/Geoms.js":function(t,e,r){"use strict";r.r(e),r.d(e,"readGeometry",function(){return o});var e=r("./src/compat.js"),v=r("./src/file-loaders/lmvtk/common/VbUtils.js"),I=new Float32Array(3),S=1/Math.PI,A=Math.atan2;Object(e.isNodeJS)()||(A=function(t,e){var r=Math.abs(e),n=Math.abs(t),s=Math.min(r,n)/Math.max(r,n),i=s*s,s=((-.0464964749*i+.15931422)*i-.327622764)*i*s+s;return r<n&&(s=1.57079637-s),e<0&&(s=3.14159274-s),s=t<0?-s:s});function _(t,e,r,n,s){var i={x:e[t*n],y:e[t*n+1],z:e[t*n+2]},a={x:i.x-e[t*s],y:i.y-e[t*s+1],z:i.z-e[t*s+2]},n=(n=r[n].next==s?r[n].prev:r[n].next)<0?{x:a.x,y:a.y,z:a.z}:{x:e[t*n]-i.x,y:e[t*n+1]-i.y,z:e[t*n+2]-i.z};return{pos:i,next:a,prev:n}}function n(t,e,r,n){if(r)return null;var s,i,a={vertices:null,indices:null,colors:null,normals:null,uvs:[],attrs:[],lineWidth:1};n?(1<e.version?(a.vertexCount=t.readU16(),s=t.readU16(),i=t.readU16(),2<e.version&&(a.lineWidth=t.readF32())):(a.vertexCount=t.readU32V(),s=t.readU32V(),i=t.readU32V()),a.isLines=!0):(a.vertexCount=t.readU16(),s=t.readU16(),a.pointSize=t.readF32(),a.isPoints=!0),r=0!=t.stream.getUint8(),a.vbstride=3,r&&(a.vbstride+=3),a.vblayout={};var o=0;a.vblayout.position={offset:o,itemSize:3},o+=3,r&&(a.vblayout.color={offset:o,itemSize:3}),a.vb=new Float32Array(a.vertexCount*a.vbstride);var u,h,l=a.vb,c=a.vbstride,f=t.stream;if(f.getVector3Array(l,a.vertexCount,a.vblayout.position.offset,c),r)for(u=0,o=a.vblayout.color.offset,h=a.vertexCount;u<h;u++,o+=c)l[o]=f.getFloat32(),l[o+1]=f.getFloat32(),l[o+2]=f.getFloat32(),f.getFloat32();if(r=function(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.length)},n){var d,p=1<e.version?(d=new Uint16Array(r(f.getBytes(2*s))),new Uint16Array(r(f.getBytes(2*i)))):(d=new Int32Array(r(f.getBytes(4*s))),new Int32Array(r(f.getBytes(4*i)))),m=p[i-1]-i+1;a.indices=new Uint16Array(2*m);for(var g=0,b=0;b+1<i;b++)for(var y=p[b];y+1<p[b+1];y++)a.indices[g++]=d[y],a.indices[g++]=d[y+1]}else a.indices=new Uint16Array(r(f.getBytes(2*s)));return 1!=a.lineWidth&&function(t,e,r,n,s){s=t.vbstride,t.vblayout.prev={offset:s,itemSize:3},t.vblayout.next={offset:s+=3,itemSize:3},t.vblayout.side={offset:s+=3,itemSize:1},t.vbstride+=7;for(var i,a,o,u=0,h=new Array(t.vertexCount),l=0;l<t.vertexCount;++l)h[l]={prev:-1,next:-1,prev_seg:-1};for(m=0;m<n;++m)a=t.indices[i=2*m],o=t.indices[i+1],h[a].next=o,0<=h[a].prev&&++u,h[o].prev=a,h[o].prev_seg=m,0<=h[o].next&&++u;for(var c=2*n,f=new Array(c),d=new Uint16Array(6*(n+u)),p=0,m=0;m<n;++m)a=t.indices[i=2*m],o=t.indices[i+1],f[i]=_(e,r,h,a,o),f[i+1]=_(e,r,h,o,a),o=(a=i)+1,d[p++]=2*a+1,d[p++]=2*o,d[p++]=2*a,d[p++]=2*o,d[p++]=2*o+1,d[p++]=2*a,0<=h[a=t.indices[i]].prev&&(o=2*h[a].prev_seg+1,a=i,d[p++]=2*o,d[p++]=2*a,d[p++]=2*o+1,d[p++]=2*a+1,d[p++]=2*a,d[p++]=2*o);t.indices=d;var g=2*c;t.vb=new Float32Array(g*t.vbstride),s=t.vblayout.position.offset;for(var b=0;b<c;++b)for(var y=0;y<2;++y)t.vb[s]=f[b].pos.x,t.vb[s+1]=f[b].pos.y,t.vb[s+2]=f[b].pos.z,t.vb[s+=e]=f[b].prev.x,t.vb[s+1]=f[b].prev.y,t.vb[s+2]=f[b].prev.z,t.vb[s+=3]=f[b].next.x,t.vb[s+1]=f[b].next.y,t.vb[s+2]=f[b].next.z,t.vb[s+=3]=y?-1:1,s+=1;t.vertexCount=g,t.isWideLines=!0}(a,c,l,m,o),v.VBUtils.computeBounds3D(a),a}var s=function(t,e,r,n,s,i){if(!i){if("OCTM"!=t.getString(4))return null;if(5!=t.getInt32())return null;t.getString(3);t.getUint8()}var a={stream:null,vertices:null,indices:null,normals:null,colors:null,uvs:[],attrs:[]};a.vertexCount=t.getInt32(),a.triangleCount=t.getInt32(),a.texMapCount=t.getInt32(),a.attribMapCount=t.getInt32(),a.flags=t.getInt32(),a.comment=t.getString(t.getInt32());a.vbstride=3,1&a.flags&&(a.vbstride+=s?1:3),a.vbstride+=2*(a.texMapCount||0),a.vbstride+=3*(a.attribMapCount||0),a.vblayout={};var o=0;if(a.vblayout.position={offset:o,itemSize:3},o+=3,1&a.flags&&(a.vblayout.normal={offset:o,itemSize:s?2:3,bytesPerItem:s?2:4,normalize:s},o+=s?1:3),a.texMapCount)for(var u=0;u<a.texMapCount;u++){var h="uv";u&&(h+=(u+1).toString()),a.vblayout[h]={offset:o,itemSize:2},o+=2}return function(t,e,r,n,s,i){function a(){return t.getString(t.getInt32())}if(i||"INDX"==t.getString(4)){var o,u,h=e.vertexCount,l=e.triangleCount,c=e.vbstride,f=h*c,d=f+(3*l*2+3)/4|0;if(e.sharedBufferBytes=4*d,!s)if(r||(r=new ArrayBuffer(4*d),n=0),o=e.vb=new Float32Array(r,n,f),e.indices=new Uint16Array(r,n+4*f,3*l),t.getIndicesArray(o.buffer,n+4*f,3*l),i||"VERT"==t.getString(4)){if(e.vblayout.normal&&2===e.vblayout.normal.itemSize&&(u=new Uint16Array(o.buffer,o.byteOffset,o.byteLength/2)),t.getVector3Array(o,h,e.vblayout.position.offset,c),1&e.flags){if(!i&&"NORM"!=t.getString(4))return;if(u)for(I.length<3*h&&(I=new Float32Array(3*h)),t.getVector3Array(I,h,0,3),w=0,k=e.vblayout.normal.offset;w<h;w++,k+=c){var p=.5*(A(I[3*w+1],I[3*w])*S+1),m=.5*(I[3*w+2]+1);u[2*k]=65535*p|0,u[2*k+1]=65535*m|0}else t.getVector3Array(o,h,e.vblayout.normal.offset,c)}for(y=0;y<e.texMapCount;y++){if(!i&&"TEXC"!=t.getString(4))return;var g={name:a(),file:a()};e.uvs.push(g);g="uv";y&&(g+=(y+1).toString()),t.getVector2Array(o,h,e.vblayout[g].offset,c)}for(var b=c-3*(e.attribMapCount||0),y=0;y<e.attribMapCount;y++){if(!i&&"ATTR"!=t.getString(4))return;var v,_={name:a()};if(-1!=_.name.indexOf("Color"))v="color";else{if(-1==_.name.indexOf("UVW")){e.attrs.push(_),t.getBytes(16*h);continue}v="uvw"}e.vblayout[v]={offset:b,itemSize:3};for(var x=[0,0,0,0],w=0,k=b;w<h;w++,k+=c)t.getVector4(x,0),o[k]=x[0],o[k+1]=x[1],o[k+2]=x[2];b+=3}}}}(t,a,e,r,n,i),n||(v.VBUtils.deduceUVRepetition(a),v.VBUtils.computeBounds3D(a)),a},i=function(t,e,r){return n(t,e,r,!0)},a=function(t,e,r){return n(t,e,r,!1)};function o(t,e,r){e=t.seekToEntry(e);return e?"Autodesk.CloudPlatform.OpenCTM"==e.entryType||"9"==e.entryType?s(t.stream,r.dstBuffer,r.startOffset,r.estimateSizeOnly,r.packNormals,r.isD3M,r.packId):"Autodesk.CloudPlatform.Lines"==e.entryType||"12"==e.entryType?i(t,e,r.estimateSizeOnly):"Autodesk.CloudPlatform.Points"==e.entryType||"6"==e.entryType?a(t,e,r.estimateSizeOnly):null:null}},"./src/file-loaders/lmvtk/svf/Instances.js":function(t,e,r){"use strict";function n(t,e,r,n){e=t.seekToEntry(e);if(!e)return null;if(2<e.version)return null;return 1<e.version&&t.readU8(),{definition:t.stream.getUint32(),transform:t.readTransform(void 0,void 0,void 0,r,n),instanceNodePath:t.readPathID()}}r.r(e),r.d(e,"readInstance",function(){return n}),r.d(e,"readInstanceTree",function(){return s});var g={NT_Inner:0,NT_Geometry:1,NT_Camera:2,NT_Light:3};function s(t,e){for(var r=[],n=[],s=[],i=[],a=0,o=t.stream;o.offset<o.byteLength-8-1;){t.readTransform(a,r,12*a,void 0,void 0,void 0),e<5&&o.getUint8()&&o.getUint32();var u,h=o.getUint8();if(5<=e&&o.getUint8(),3<=e&&(n[a]=o.getVarints()),a)switch(h){case g.NT_Inner:break;case g.NT_Geometry:if(e<2){if(1===(u=o.getUint16()))s[a]=o.getUint32();else if(0<u){for(var l=[],c=0;c<u;c++)l.push(o.getUint32());s[a]=l}}else if(1===(u=o.getVarints()))s[a]=o.getVarints();else if(0<u){for(l=[],c=0;c<u;c++)l.push(o.getVarints());s[a]=l}break;case g.NT_Camera:case g.NT_Light:o.getUint8()&&o.getUint32();break;default:debug("Unrecognized instance tree node type.")}var f=0;h===g.NT_Inner&&(f=e<2?o.getUint16():o.getVarints()),i[a]=f,a++}var d=new Uint32Array(n.length);d.set(n);var p=new Float32Array(r.length);p.set(r);var m=new Uint32Array(i.length);return m.set(i),{dbIds:d,fragIds:s,transforms:p,childCounts:m}}},"./src/file-loaders/lmvtk/svf/Lights.js":function(t,e,r){"use strict";function n(t,e){e=t.seekToEntry(e);if(!e)return null;if(1<e.version)return null;e=t.stream;return{position:t.readVector3f(),dir:t.readVector3f(),r:e.getFloat32(),g:e.getFloat32(),b:e.getFloat32(),intensity:e.getFloat32(),spotAngle:e.getFloat32(),size:e.getFloat32(),type:e.getUint8()}}r.r(e),r.d(e,"readLightDefinition",function(){return n})},"./src/file-loaders/lmvtk/svf/PackReader.js":function(t,e,r){"use strict";r.r(e),r.d(e,"PackFileReader",function(){return a});var n,s,i,l,c,o=r("./src/file-loaders/lmvtk/common/InputStream.js"),f=r("./src/wgs/scene/LmvMatrix4.js");function a(t){var e=this.stream=new o.InputStream(t),r=e.getInt32();this.type=e.getString(r),this.version=e.getInt32(),this.types=null,this.entryOffsets=[];t=e.offset;e.seek(e.byteLength-8);r=e.getUint32();this.typesOffset=e.getUint32(),e.seek(this.typesOffset);var n=this.readU32V();this.types=[];for(var s=0;s<n;++s)this.types.push({entryClass:this.readString(),entryType:this.readString(),version:this.readU32V()});e.seek(r);for(var i=this.readU32V(),a=this.entryOffsets,s=0;s<i;++s)a.push(e.getUint32());e.seek(t)}a.prototype.readU32V=a.prototype.readVarint=function(){for(var t,e=0,r=0;e|=(127&(t=this.stream.getUint8()))<<r,r+=7,128&t;);return e},a.prototype.readU16=function(){return this.stream.getUint16()},a.prototype.readU8=function(){return this.stream.getUint8()},a.prototype.readString=function(){return this.stream.getString(this.readU32V())},a.prototype.readVector3f=function(){var t=this.stream;return{x:t.getFloat32(),y:t.getFloat32(),z:t.getFloat32()}},a.prototype.readF32=function(){return this.stream.getFloat32()},a.prototype.readVector3d=(n={x:0,y:0,z:0},function(){var t=this.stream;return n.x=t.getFloat64(),n.y=t.getFloat64(),n.z=t.getFloat64(),n}),a.prototype.readQuaternionf=(s={x:0,y:0,z:0,w:0},function(){var t=this.stream;return s.x=t.getFloat32(),s.y=t.getFloat32(),s.z=t.getFloat32(),s.w=t.getFloat32(),s}),a.prototype.readMatrix3f=(i=new f.LmvMatrix4,function(t){var e=this.stream;(t=t||i).identity();for(var r=0;r<3;++r)for(var n=0;n<3;++n)t.elements[4*r+n]=e.getFloat32();return t}),a.prototype.readTransform=(l={x:1,y:1,z:1},c=new f.LmvMatrix4(!0),function(t,e,r,n,s,i){var a=this.stream;switch(a.getUint8()){case 4:c.identity();break;case 0:h=this.readVector3d(),c.makeTranslation(h.x,h.y,h.z);break;case 1:u=this.readQuaternionf(),h=this.readVector3d(),l.x=1,l.y=1,l.z=1,c.compose(h,u,l);break;case 2:var o=a.getFloat32(),u=this.readQuaternionf(),h=this.readVector3d();l.x=o,l.y=o,l.z=o,c.compose(h,u,l);break;case 3:this.readMatrix3f(c),h=this.readVector3d(),c.setPosition(h)}if(i&&(i[0]=c.elements[12],i[1]=c.elements[13],i[2]=c.elements[14]),n&&c.multiplyMatrices(n,c),s&&(c.elements[12]-=s.x,c.elements[13]-=s.y,c.elements[14]-=s.z),void 0===t)return(new f.LmvMatrix4).copy(c);t=c.elements;e&&(e[r+0]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[4],e[r+4]=t[5],e[r+5]=t[6],e[r+6]=t[8],e[r+7]=t[9],e[r+8]=t[10],e[r+9]=t[12],e[r+10]=t[13],e[r+11]=t[14])}),a.prototype.getEntryCounts=function(){return this.entryOffsets.length},a.prototype.seekToEntry=function(t){if(this.getEntryCounts()<=t)return null;this.stream.seek(this.entryOffsets[t]);t=this.stream.getUint32();return t>=this.types.length?null:this.types[t]},a.prototype.readPathID=function(){var t,e=this.stream;if(this.version<2){if(!(t=e.getUint16()))return null;if(e.getUint16(),1==t)return"";for(var r=e.getUint16(),n=2;n<t;++n)r+="/"+e.getUint16()}else{if(!(t=this.readU32V()))return null;if(this.readU32V(),1==t)return"";for(r=this.readU32V(),n=2;n<t;++n)r+="/"+this.readU32V()}return r}},"./src/file-loaders/lmvtk/svf/Package.js":function(t,e,r){"use strict";r.r(e),r.d(e,"Package",function(){return d});var y=r("./src/compat.js"),n=r("./src/wgs/scene/BVHBuilder.js"),i=r("./src/wgs/scene/LmvVector3.js"),a=r("./src/file-loaders/net/Xhr.js"),v=r("./src/file-loaders/lmvtk/common/InputStream.js"),_=r("./src/file-loaders/lmvtk/svf/PackReader.js"),o=r("./src/file-loaders/lmvtk/svf/Fragments.js"),u=r("./src/file-loaders/lmvtk/svf/Instances.js"),x=r("./src/file-loaders/lmvtk/common/SvfPlacementUtils.js"),h=r("./src/file-loaders/lmvtk/svf/Cameras.js"),s=r("./src/file-loaders/lmvtk/svf/Lights.js");function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var f=r("./thirdparty/zlib/unzip.min.js").Zlib;function d(t){this.unzip=new f.Unzip(t),this.manifest=null,this.materials=null,this.metadata=null,this.fragments=null,this.geompacks=[],this.instances=[],this.cameras=[],this.lights=[],this.propertydb={attrs:[],avs:[],ids:[],values:[],offsets:[]},this.bbox=null,this.animations=null,this.pendingRequests=0,this.globalOffset={x:0,y:0,z:0},this.topologyPath=null}d.prototype.loadAsyncResource=function(e,t,r,n){var s;r?n(r):((s=this).pendingRequests++,a.ViewingService.getItem(e,e.basePath+t,function(t){s.pendingRequests--,n(t),0==s.pendingRequests&&s.postLoad(e)},e.onFailureCallback))},d.prototype.loadManifest=function(t){var e;if(t.isD3M=t.url.includes("0.d3m"),!(e=t.isD3M?this.unzip.decompress("files.json"):this.unzip.decompress("manifest.json")))return!1;t=new v.InputStream(e);this.manifest=JSON.parse(t.getString(e.byteLength))},d.prototype.applyLargeBoxOffset=function(t){!t||t.x===this.globalOffset.x&&t.y===this.globalOffset.y&&t.z===this.globalOffset.z||(this.bbox.empty()||this.bbox.translate({x:this.globalOffset.x-t.x,y:this.globalOffset.y-t.y,z:this.globalOffset.z-t.z}),this.verylargebbox=!0,this.globalOffset.copy(t),Object(x.calculatePlacementWithOffset)(this,this.placementTransform))},d.prototype.parseFragmentList=function(t,r,e,n){var s=this;this.loadAsyncResource(r,e,n,function(t){var e=new _.PackFileReader(t),t=s.fragments=new o.FragList,t=Object(o.readFragments)(e,t,r.globalOffset,r.placementTransform,r.fragmentTransformsDouble,void 0,s.bbox,s.globalOffset);s.applyLargeBoxOffset(t)})},d.prototype.parseGeometryMetadata=function(t,e,r,n){var s=this;this.loadAsyncResource(e,r,n,function(t){t=new _.PackFileReader(t);s.geomMetadata={},Object(o.readGeometryMetadata)(t,s.geomMetadata),s.numGeoms=s.geomMetadata.primCounts.length})},d.prototype.parseInstanceTree=function(t,e,r,n){var s=this;this.loadAsyncResource(t,e,r,function(t){t=new _.PackFileReader(t);s.instanceTransforms=Object(u.readInstanceTree)(t,n)})},d.prototype.loadRemainingSvf=function(t){var i=this,e=this.unzip;this.manifest=t.manifest;var r,n=this.manifest,s=n.assets;t.isD3M?(r=e.decompress("pl.json"),s=n.files,n.assets=n.files,n.typesets=n.tss):r=e.decompress("metadata.json");var a=new v.InputStream(r);3<r.byteLength&&0!==r[3]&&(t.url.includes("0.d3m")?this.metadata=JSON.parse(a.getString(r.byteLength)).pl:this.metadata=JSON.parse(a.getString(r.byteLength)).metadata,Object(x.initPlacement)(this,t)),this.packFileTotalSize=0,this.primitiveCount=0;for(var o=n.typesets,u={},h=0;h<o.length;h++){var l=o[h];u[l.id]=l.types}for(h=0;h<s.length;h++){var c,f,d,p,m,g,b=s[h];Object(y.isMobileDevice)()&&"Set.bin"===b.id||(0==(c=b.type).indexOf("Autodesk.CloudPlatform.")&&(c=c.substr(23)),p=b.URI,g=b.typeset?u[b.typeset]:null,m=b.usize||0,f=Math.round(m/1048576*1e5)/1e5|0,0!=p.indexOf("embed:/")&&("PackFile"==c||"CD"==c?"Autodesk.CloudPlatform.Geometry"!=(d=g?g[0].class:null)&&"5"!=d||(this.packFileTotalSize+=m,this.geompacks.push({id:b.id,uri:p,usize:m})):"PropertyAttributes"==c||"5.t"==c?this.propertydb.attrs.push({path:p}):"PropertyAVs"==c||"6.t"==c?this.propertydb.avs.push({path:p}):"PropertyIDs"==c||"7.t"==c?this.propertydb.ids.push({path:p}):"PropertyOffsets"==c||"8.t"==c?this.propertydb.offsets.push({path:p}):"PropertyValues"!=c&&"9.t"!=c||this.propertydb.values.push({path:p})),m=null,0==(p=b.URI).indexOf("embed:/")&&(p=p.substr(7),m=e.decompress(p)),"ProteinMaterials"==c||"4.t"==c?-1==p.indexOf("Protein")?this.loadAsyncResource(t,p,m,function(t){var e=new v.InputStream(t),t=t.byteLength;i.materials=0<t?JSON.parse(e.getString(t)):null}):this.loadAsyncResource(t,p,m,function(e){var t=new v.InputStream(e),r=e.byteLength;if(0<r)try{i.proteinMaterials=JSON.parse(t.getString(r))}catch(t){for(var n="",s=0;s<e.length;s++)n+=String.fromCharCode(e[s]);try{i.proteinMaterials=JSON.parse(n)}catch(t){console.error("Failed to parse Protein materials file either as UTF8 or ANSI")}}else i.proteinMaterials=null}):"StandardMaterials"==c?this.loadAsyncResource(t,p,m,function(t){var e=new v.InputStream(t),t=t.byteLength;0<t?(t=e.getString(t),i.stdSurfMats=JSON.parse(t)):i.stdSurfMats=null}):"MaterialX"==c?this.loadAsyncResource(t,p,m,function(t){var e=new v.InputStream(t),t=t.byteLength;i.mtlx=0<t?e.getString(t):null}):"FragmentList"==c||"2.t"==c?this.parseFragmentList(b,t,p,m):"GeometryMetadataList"==c||"3.t"==c?this.parseGeometryMetadata(b,t,p,m):"PackFile"==c||"CD"==c?-1!=p.indexOf("CameraDefinitions.bin")||-1!=p.indexOf("0.i")?this.loadAsyncResource(t,p,m,function(t){i.camDefPack=new _.PackFileReader(t)}):-1!=p.indexOf("CameraList.bin")||-1!=p.indexOf("1.i")?this.loadAsyncResource(t,p,m,function(t){i.camInstPack=new _.PackFileReader(t)}):-1!=p.indexOf("LightDefinitions.bin")?this.loadAsyncResource(t,p,m,function(t){i.lightDefPack=new _.PackFileReader(t)}):-1!=p.indexOf("LightList.bin")&&this.loadAsyncResource(t,p,m,function(t){i.lightInstPack=new _.PackFileReader(t)}):"Animations"==c?this.loadAsyncResource(t,p,m,function(t){var e=new v.InputStream(t),t=t.byteLength;i.animations=0<t?JSON.parse(e.getString(t)):null}):"Topology"==c?(i.topologyPath=t.basePath+p,i.topologySizeMB=f):!t.loadInstanceTree||"InstanceTree"!=c&&"InstanceTreeTree"!=c||(g=g?g[0].version:1,this.parseInstanceTree(t,p,m,g)))}0==this.pendingRequests&&this.postLoad(t),delete this.unzip},d.prototype.addTransparencyFlagsToMaterials=function(t){for(var e in t){var r=t[e],e=r.userassets,e=r.materials[e[0]];r.transparent=e.transparent}},d.prototype.postLoadOfCam=function(t){if(this.camDefPack&&this.camInstPack){for(var e=0,r=this.camInstPack.getEntryCounts();e<r;e++){var n=Object(u.readInstance)(this.camInstPack,e,this.placementTransform,this.globalOffset),s=Object(h.readCameraDefinition)(this.camDefPack,n);n.transform&&(n.transform.transformPoint(s.position),n.transform.transformPoint(s.target),n.transform.transformDirection(s.up));n=this.bbox;n&&!n.containsPoint(s.target)&&(n=(new i.LmvVector3).copy(n.center()).distanceTo(s.position),n=(new i.LmvVector3).copy(s.target).sub(s.position).normalize().multiplyScalar(n),s.target=(new i.LmvVector3).copy(s.position).add(n)),this.cameras.push(s)}delete this.camDefPack,delete this.camInstPack}},d.prototype.postLoadOfLight=function(t){if(this.lightDefPack&&this.lightInstPack){for(var e=0,r=this.lightInstPack.getEntryCounts();e<r;e++){var n=Object(u.readInstance)(this.lightInstPack,e,this.placementTransform,this.globalOffset);this.lights.push(Object(s.readLightDefinition)(this.lightDefPack,n.definition))}delete this.lightInstPack,delete this.lightDefPack}},d.prototype.postLoadOfFragments=function(t){var e=this.fragments;if(this.geomMetadata){e.polygonCounts=e.geomDataIndexes;var r=this.geomMetadata;null!=r.topoIndexes&&(e.topoIndexes=new Int32Array(e.length));for(var n=0,s=e.length;n<s;n++){var i=e.geomDataIndexes[n];e.entityIndexes[n]=r.entityIndexes[i],e.packIds[n]=r.packIds[i],e.polygonCounts[n]=r.primCounts[i],this.primitiveCount+=r.primCounts[i],null!=r.topoIndexes&&(e.topoIndexes[n]=r.topoIndexes[i])}e.geomDataIndexes=null,this.geomMetadata=null}this.calculateMesh2Frag(e)},d.prototype.calculateMesh2Frag=function(t){for(var e=t.mesh2frag={},r=t.packIds,n=t.entityIndexes,s=0,i=t.length;s<i;s++){var a=r[s]+":"+n[s],o=e[a];void 0===o?e[a]=s:Array.isArray(o)?o.push(s):e[a]=[o,s]}},d.prototype.postLoadOfBBox=function(t){if(!this.bbox||t.placementTransform){for(var e=[1/0,1/0,1/0,-1/0,-1/0,-1/0],t=this.fragments,r=t.boxes,n=0,s=t.length;n<s;n++){for(var i=6*n,a=0;a<3;a++)r[i+a]<e[a]&&(e[a]=r[i+a]);for(a=3;a<6;a++)r[i+a]>e[a]&&(e[a]=r[i+a])}this.bbox={min:{x:e[0],y:e[1],z:e[2]},max:{x:e[3],y:e[4],z:e[5]}}}},d.prototype.postLoadOfObjectIds=function(t){var e=new Set(t.objectIds);if(0<e.size){for(var r=new Set,n=new Set,s=0;s<this.fragments.length;++s)e.has(this.fragments.fragId2dbId[s])&&(r.add(this.fragments.packIds[s]),n.add(s));for(var i=new Set,a=0;a<this.geompacks.length;++a)r.has(parseInt(this.geompacks[a].id))&&i.add(this.geompacks[a]);this.geompacks=l(i);t=Object(o.filterFragments)(this.fragments,l(n));this.bbox={min:{x:t[0],y:t[1],z:t[2]},max:{x:t[3],y:t[4],z:t[5]}}}},d.prototype.postLoadComplete=function(t){var e,r;t.loadDoneCB("svf"),this.fragments.polygonCounts&&(e=performance.now(),(r=this.materials?this.materials.materials:null)&&this.addTransparencyFlagsToMaterials(r),this.bvh=new n.BVHBuilder(this.fragments,r),this.bvh.build(t.bvhOptions),r=performance.now(),t.worker.debug("BVH build time (worker thread):"+(r-e)),t.loadDoneCB("bvh")),t.loadDoneCB("done")},d.prototype.postLoad=function(t){Object(x.transformAnimations)(this),this.postLoadOfCam(t),this.postLoadOfLight(t),this.postLoadOfFragments(t),this.postLoadOfBBox(t),this.postLoadOfObjectIds(t),this.postLoadComplete(t)}},"./src/file-loaders/net/ErrorCodes.js":function(t,e,r){"use strict";r.r(e),r.d(e,"ErrorCodes",function(){return n}),r.d(e,"errorCodeString",function(){return s}),r.d(e,"getErrorCode",function(){return i});var n={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,BAD_DATA_MODEL_IS_EMPTY:11,RTC_ERROR:12,UNSUPORTED_FILE_EXTENSION:13,VIEWER_INTERNAL_ERROR:14,WEBGL_LOST_CONTEXT:15,LOAD_CANCELED:16};function s(t){return"ErrorCode:"+t+"."}function i(t){return 403===t||401===t?n.NETWORK_ACCESS_DENIED:404===t?n.NETWORK_FILE_NOT_FOUND:500<=t?n.NETWORK_SERVER_ERROR:n.NETWORK_UNHANDLED_RESPONSE_CODE}},"./src/file-loaders/net/Xhr.js":function(t,e,r){"use strict";r.r(e),r.d(e,"ViewingService",function(){return S}),r.d(e,"pathToURL",function(){return a}),r.d(e,"textToArrayBuffer",function(){return A});var n,l,i,s,m,g,b,y,v,_,x,w,k=r("./src/logger/Logger.js"),I=r("./src/file-loaders/net/ErrorCodes.js"),f=r("./src/file-loaders/lmvtk/common/StringUtils.js"),o=r("./src/file-loaders/net/endpoints.js"),u=r("./src/compat.js"),d=r("./node_modules/pako/index.js"),S={WORKER_REGISTER_FILE_PORT:"REGISTER_FILE_PORT",WORKER_READ_FILE:"READ_FILE"},p=!1;function h(t){var e=t.split("/");if(0==e.length)return t;for(var r=[],n=0;n<e.length;++n){var s=e[n];"."!==s&&(".."===s&&r.length?r.pop():r.push(s))}return 0==r.length?"":r.join("/")}function a(t,e){if(-1!==t.indexOf("://")||0===t.indexOf("urn:"))return t;if(e)return e+t;if("undefined"==typeof window)return t;var r=Object(u.getGlobal)(),e=(n=r.location.pathname).lastIndexOf("/"),n=n.substr(0,e+1);return r.location.protocol+"//"+r.location.host+n+t}function A(t,e){for(var r=t.length-e,n=new ArrayBuffer(r),s=new Uint8Array(n,0),i=0,a=e;i<r;i++,a++)s[i]=255&t.charCodeAt(a);return s}function O(t,e){return-1===e.indexOf("file://")&&(-1!==e.indexOf("://")||!!t)}function c(t,e){e.hasOwnProperty("responseType")||(e.responseType="arraybuffer"),e.hasOwnProperty("withCredentials")||(e.withCredentials=!!t.auth),e.headers=t.headers,e.queryParams=t.queryParams,e.endpoint=t.endpoint,e.escapeOssObjects=t.escapeOssObjects}S.simplifyPath=h,S.OSS_PREFIX="urn:adsk.objects:os.object:",S.generateUrl=function(t,e,r,n,s){if(r=r||"",Object(u.isNodeJS)()&&!O(t,r))return r;var i=(r=h(r)).indexOf("urn:"),a=r.indexOf("?");if(r=-1!=i?-1!==a?r.slice(0,i)+encodeURIComponent(r.slice(i,a))+r.slice(a):r.slice(0,i)+encodeURIComponent(r.slice(i)):encodeURI(r),s&&-1!==r.indexOf("/oss/v2/buckets")&&(i=r.indexOf("/objects/")+9,s=r.substring(i),r=r.substring(0,i)+encodeURIComponent(s)),!e||0!==decodeURIComponent(r).indexOf("urn:"))return O(null,r)?r:t+r;switch("items"!==e&&(r=r.substr(6)),e){case"items":return o.endpoint.getItemApi(t,r,n);case"bubbles":return o.endpoint.getManifestApi(t,r,n);case"thumbnails":return o.endpoint.getThumbnailApi(t,r,n)}},Object(u.isNodeJS)()?(m=r("./node_modules/node-libs-browser/mock/empty.js"),g=r("./node_modules/node-libs-browser/mock/empty.js"),b=r("./node_modules/node-libs-browser/mock/empty.js"),y=r("./node_modules/node-libs-browser/mock/empty.js"),v=r("./node_modules/node-libs-browser/mock/empty.js"),_=new b.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),x=new y.Agent({keepAlive:!0,keepAliveMsecs:100,maxSockets:10}),w=new b.Agent({maxSockets:10}),S.rawGet=function(t,e,o,u,h,l){if(!O(t,o=S.generateUrl(t,e,o,void 0,(l=l||{}).escapeOssObjects)))return s=u,i=h,a=l,0===(n=o).indexOf("file://")&&(n=n.substr(7)),void m.readFile(n,function(t,e){t?i(0,0,{httpStatusText:t,url:n}):31===e[0]&&139===e[1]?g.gunzip(e,null,function(t,e){t?i(0,0,{httpStatusText:t,url:n}):(e=r(e),a.ondata&&a.ondata(e),s(e))}):(e=r(e),a.ondata&&a.ondata(e),s(e))});function r(t){if("json"===a.responseType)try{return JSON.parse(t.toString("utf8"))}catch(t){i(t)}return t}var n,s,i,a;l.queryParams&&(e=-1===o.indexOf("?")?"?":"&",o=o+e+l.queryParams);var c=v.parse(o),f={host:c.hostname,port:c.port,method:l.method||"GET",path:c.path,headers:{},retryCount:0,agent:"https:"===c.protocol?_:x};if(f.host.endsWith(".api.autodesk.com")&&(f.path.startsWith("/derivativeservice")||f.path.startsWith("/modelderivative"))&&(f.agent=w),l.headers)for(var d in l.headers)f.headers[d]=l.headers[d];f.headers["accept-encoding"]||(f.headers["accept-encoding"]="gzip, deflate"),l.range&&(f.headers.Range="bytes="+l.range.min+"-"+l.range.max),(l.ondata||l.onprogress)&&(l.responseType="arraybuffer");var p=("https:"===c.protocol?b:y).request(f,function(r){var t,e=!(200<=r.statusCode&&r.statusCode<400),n=r;e||(t=r,e=c.pathname,"gzip"!==t.headers["content-encoding"]&&!(e.endsWith(".i")||(e.endsWith(".json.gz")||(e.endsWith("FragmentList.pack")||(e.endsWith("LightList.bin")||(e.endsWith("CameraList.bin")||(e.endsWith("CameraDefinitions.bin")||!!e.endsWith("LightDefinitions.bin"))))))))||l.skipDecompress||(n=r.pipe(g.createGunzip())),"json"!==l.responseType&&"text"!==l.responseType&&l.responseType||n.setEncoding("utf8");var s=[],i=Buffer.allocUnsafe(65536),a=0;n.on("data",function(t){var e;return l.onprogress?(t.length+a>i.length&&(e=Buffer.allocUnsafe(0|Math.ceil(1.5*i.length)),i.copy(e,0,0,a),i=e),t.copy(i,a,0,t.length),a+=t.length,void(l.onprogress(i,a)&&p.abort())):(s.push(t),void(l.ondata&&l.ondata(t)))}),n.on("end",function(){if(200<=r.statusCode&&r.statusCode<400)if("json"!==l.responseType)if("text"!==l.responseType&&""!==l.responseType){var t=l.onprogress?i:Buffer.concat(s);if(!l.skipDecompress&&31===t[0]&&139===t[1]){k.logger.warn("An LMV resource ("+o+") was double compressed, or Content-Encoding header missing");try{t=g.gunzipSync(t),a=t.length}catch(t){h(I.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:o,exception:t.toString(),stack:t.stack})}}200===p.status&&l.range&&(t=new Uint8Array(t,l.range.min,l.range.max-l.range.min)),u(t,a)}else{var e=s.join("");u(e)}else{e=JSON.parse(s.join(""));u(e)}else h&&h(r.statusCode,r.statusMessage,{url:o})})});p.on("error",function(t){h&&h(t.code,t.message,{url:o})}),l.postData&&p.write(l.postData),p.end()}):((n=new(r("./node_modules/pend/index.js"))).max=25,l={},i={},s={},S.registerProtocolPort=function(t,e){/^(http(s)?|file):/gi.test(t)?console.warn("http(s) or file protocol were not allowed to be handled"):e?(l[t]=e).onmessage=function(t){var e=t.data.url;if(i[e]){var r=i[e];if(t.data.error)r.onFailureWrapped(I.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:e,exception:t.data.error.message,stack:t.data.error.stack});else{var n=t.data.buffer;if(i[e]=void 0,31===n[0]&&139===n[1]&&e.match(/(.f2d|.gz)$/gi))try{n=d.ungzip(n),r.options&&r.options.ondata&&r.options.ondata(n),r.onSuccessWrapped(n)}catch(t){r.onFailureWrapped(I.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:e,exception:t.toString(),stack:t.stack})}else r.onSuccessWrapped(n)}}else s[e]&&(n=[],t.data&&t.data.buffer&&t.data.buffer.buffer instanceof ArrayBuffer&&n.push(t.data.buffer.buffer),s[e].postMessage(t.data,n),s[e]=void 0)}:l[t]&&l[t]instanceof MessagePort&&(l[t].onmessage=void 0,l[t]=void 0)},S.handlerProtocol=function(t,e,r,n,s){t=l[t];i[e]={onSuccessWrapped:r,onFailureWrapped:n,options:s},t.postMessage({operation:S.WORKER_READ_FILE,url:e})},S.forwardProtocolHandlerToWorker=function(t){var e,r={},n=new MessageChannel;for(e in n.port1.onmessage=function(t){var e=new URL(t.data.url);l[e.protocol].postMessage(t.data),s[e]=n.port1},l)l[e]instanceof MessagePort&&(r[e]=n.port2);t.doOperation({operation:S.WORKER_REGISTER_FILE_PORT,protocolPortMap:r},[n.port2])},S.rawGet=function(s,i,a,o,u,h){n.go(function(n){function t(){n();for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];u&&u.apply(u,e)}function e(){n();for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];o&&o.apply(o,e)}var r=/^(\w+:)\/\//gi.exec(a);r&&2==r.length&&l[r[1]]?S.handlerProtocol(r[1],a,e,t,h):S._rawGet(s,i,a,e,t,h)})},S._rawGet=function(t,e,r,n,s,i){r=S.generateUrl(t,e,r,(i=i||{}).apiData,i.escapeOssObjects),i.queryParams&&(e=-1===r.indexOf("?")?"?":"&",r=r+e+i.queryParams);var a=new XMLHttpRequest;function o(t){s&&s(a.status,a.statusText,{url:r})}function u(t){if("json"===i.responseType)try{if(t instanceof Uint8Array)return Object(f.blobToJson)(t);if("string"==typeof t)return JSON.parse(t)}catch(t){}return t}function h(t){if(200<=a.status&&a.status<400)if(a.response&&a.response instanceof ArrayBuffer){var e=200===a.status&&i.range?new Uint8Array(a.response,i.range.min,i.range.max-i.range.min):new Uint8Array(a.response);if(!i.skipDecompress&&31===e[0]&&139===e[1]){p||(p=!0,k.logger.warn("An LMV resource ("+r+") was not uncompressed by the browser. This hurts performance. Check the Content-Encoding header returned by the server and check whether you're getting double-compressed streams. The warning prints only once but it's likely the problem affects multiple resources."));try{e=d.ungzip(e)}catch(t){s(I.ErrorCodes.BAD_DATA,"Malformed data received when requesting file",{url:r,exception:t.toString(),stack:t.stack})}}n&&n(u(e))}else{e=a.response;e||i.responseType&&"text"!==i.responseType||(e=a.responseText),n&&n(u(e))}else o()}try{var l=!i.hasOwnProperty("asynchronous")||i.asynchronous;if(a.open(i.method||(i.noBody?"HEAD":"GET"),r,l),i.hasOwnProperty("responseType")&&(a.responseType=i.responseType),a.withCredentials=!0,i.hasOwnProperty("withCredentials")&&(a.withCredentials=i.withCredentials),i.range&&a.setRequestHeader("Range","bytes="+i.range.min+"-"+i.range.max),i.headers)for(var c in i.headers)a.setRequestHeader(c,i.headers[c]),"authorization"===c.toLocaleLowerCase()&&(a.withCredentials=!1);l&&(a.onload=h,a.onerror=o,a.ontimeout=o,(i.ondata||i.onprogress)&&(a.overrideMimeType("text/plain; charset=x-user-defined"),i._dlProgress={streamOffset:0},a.onreadystatechange=function(){var t,e;2<a.readyState&&200===a.status&&(i.ondata?(t=a.responseText,i._dlProgress.streamOffset>=t.length||(e=A(t,i._dlProgress.streamOffset),i._dlProgress.streamOffset=t.length,i.ondata(e))):i.onprogress&&i.onprogress(a.responseText)&&a.abort())})),a.send(i.postData),l||h()}catch(t){s(a.status,a.statusText,{url:r,exception:t})}}),S.defaultFailureCallback=function(t,e,r){403==t?this.raiseError(I.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:r.url,httpStatus:t,httpStatusText:e}):404==t?this.raiseError(I.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:r.url,httpStatus:t,httpStatusText:e}):500<=t&&t<600?this.raiseError(I.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:r.url,httpStatus:t,httpStatusText:e}):r.exception?this.raiseError(I.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:r.url,exception:r.exception.toString(),stack:r.exception.stack}):this.raiseError(I.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:r.url,httpStatus:t,httpStatusText:e,data:r})},S.getItem=function(t,e,r,n,s){var i;c(t,s=s||{}),s.range&&!t.supportsRangeRequests&&(i="start="+s.range.min+"&end="+s.range.max,s.queryParams?s.queryParams+="&"+i:s.queryParams=i,s.range=void 0),S.rawGet(t.endpoint,"items",e,r,n,s)},S.getManifest=function(t,e,r,n,s){(s=s||{}).hasOwnProperty("responseType")||(s.responseType="json"),c(t,s),S.rawGet(t.endpoint,"bubbles",e,r,n,s)},S.getThumbnail=function(t,e,r,n,s){c(t,s=s||{});var i,a,o=s.queryParams||"",u=[];-1===o.indexOf("guid=")&&s.guid&&u.push("guid="+encodeURIComponent(s.guid)),-1===o.indexOf("role=")&&(i=s.role||"rendered",u.push("role="+i)),-1===o.indexOf("width=")&&(a=s.size||400,u.push("width="+a)),-1===o.indexOf("height=")&&(a=s.size||400,u.push("height="+a)),-1===o.indexOf("acmsession=")&&s.acmsession&&u.push("acmsession="+s.acmsession);u=u.join("&");s.queryParams?s.queryParams=s.queryParams+"&"+u:s.queryParams=u,S.rawGet(t.endpoint,"thumbnails",e,r,n,s)},S.getACMSession=function(t,e,r,n){var s,i,a={};for(i in e)"oauth2AccessToken"===i?s=e[i]:-1!==i.indexOf("x-ads-acm")&&(a[i]=e[i]);a.application="autodesk";var o=new XMLHttpRequest;o.open("POST",t+"/oss-ext/v2/acmsessions",!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Authorization","Bearer "+s),o.responseType="json",o.onload=function(){var t;200===o.status&&o.response?(t="string"==typeof o.response?JSON.parse(o.response):o.response)&&t.acmsession?r(t.acmsession):n(o.status,"Can't get acm session from response."):n(o.status)},o.onerror=n,o.ontimeout=n,o.send(JSON.stringify(a)),delete a.application}},"./src/file-loaders/net/endpoints.js":function(t,e,r){"use strict";r.r(e),r.d(e,"getEnv",function(){return g}),r.d(e,"setEnv",function(){return b}),r.d(e,"isOffline",function(){return v}),r.d(e,"setOffline",function(){return _}),r.d(e,"setOfflineResourcePrefix",function(){return w}),r.d(e,"getOfflineResourcePrefix",function(){return k}),r.d(e,"endpoint",function(){return I}),r.d(e,"initLoadContext",function(){return S});var s=r("./src/compat.js"),i=r("./src/globals.js"),a=Object(s.getGlobal)(),o={},n=null;o.ENDPOINT_API_DERIVATIVE_SERVICE_V2="derivativeV2",o.ENDPOINT_API_MODEL_DERIVATIVE_V2="modelDerivativeV2",o.ENDPOINT_API_FLUENT="fluent",o.ENDPOINT_API_D3S="D3S";var u,h={derivativeV2:{baseURL:"/derivativeservice/v2",itemURL:"/derivativeservice/v2/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn"},derivativeV2_EU:{baseURL:"/derivativeservice/v2/regions/eu",itemURL:"/derivativeservice/v2/regions/eu/derivatives/:derivativeurn",manifestURL:"/derivativeservice/v2/regions/eu/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn"},modelDerivativeV2:{baseURL:"/modelderivative/v2/",itemURL:"/modelderivative/v2/designdata/:urn/manifest/:derivativeurn",manifestURL:"/modelderivative/v2/designdata/:urn/manifest",thumbnailsURL:"/modelderivative/v2/designdata/:urn/thumbnail"},fluent:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"},D3S_EU:{baseURL:"/modeldata",itemURL:"/modeldata/file/:derivativeurn",manifestURL:"/modeldata/manifest/:urn",thumbnailsURL:"/derivativeservice/v2/regions/eu/thumbnails/:urn",cdnURL:"/cdn",cdnWS:"/cdnws"}},l="",c=o.ENDPOINT_API_DERIVATIVE_SERVICE_V2,f=!1,d=!1,p="",m=!1;function g(){return u}function b(t){u=t}o.HTTP_REQUEST_HEADERS={},o.queryParams={},o.setEndpointAndApi=function(t,e){t&&(l=t),e&&(c=e)},o.getEndpointAndApi=function(){return l+h[c].baseURL},o.getApiEndpoint=function(){return l},o.getApiFlavor=function(){return c},o.getCdnUrl=function(){return n||(l?l+h[c].cdnURL:void 0)},o.getCdnWebSocketEndpoint=function(){return l+(h[c].cdnWS||"")},o.setCdnUrl=function(t){n=t},o.getCdnRedirectUrl=function(){var t=h[c].cdnRedirectURL;return t?l+t:null},o.setAcmSession=function(t){p=t},o.getAcmSession=function(){return p},o.getManifestApi=function(t,e,r){t=t||l;return t=(t+=h[r=r||c].manifestURL).replace(":urn",e=e||"")},o.getItemApi=function(t,e,r){var n=r||c,s=(t||l)+h[n].itemURL;e=e||"";r=decodeURIComponent(e);return-1!==s.indexOf(":urn")&&(t=(t=(t=r.split("/")[0]||"").split(":"))[t.length-1]||"",s=s.replace(":urn",t)),n===o.ENDPOINT_API_MODEL_DERIVATIVE_V2&&(e=encodeURIComponent(r)),s=s.replace(":derivativeurn",e)},o.getThumbnailApi=function(t,e,r){return((t||l)+h[r||c].thumbnailsURL).replace(":urn",e||"")},o.getUseCredentials=function(){return f},o.getDomainParam=function(){return console.warn("getDomainParam is deprecated, switch to getQueryParams instead."),this.getUseCredentials()&&!Object(s.isNodeJS)()?"domain="+encodeURIComponent(a.location.origin):""},o.addQueryParam=function(t,e){this.queryParams[t]=e},o.deleteQueryParam=function(t){delete this.queryParams[t]},o.getQueryParams=function(t){var e=this.getUseCredentials()&&!Object(s.isNodeJS)()?"domain="+encodeURIComponent(a.location.origin):"";Object(i.getParameterByName)("bypassds")&&(e=e?e+"&bypassds=1":"bypassds=1");var r,n=[];for(r in this.queryParams)n.push(encodeURIComponent(r)+"="+encodeURIComponent(this.queryParams[r]));return n.length&&(e?e+="&"+n.join("&"):e=n.join("&")),e&&t&&(t.queryParams?t.queryParams+="&"+e:t.queryParams=e),e},o.setUseCredentials=function(t){f=t},o.setUseCookie=function(t){d=t},o.getUseCookie=function(){return d},o.isOtgBackend=function(){return this.getApiFlavor()===this.ENDPOINT_API_FLUENT},o.isSVF2Backend=function(){return"D3S"===this.getApiFlavor()||"D3S_EU"===this.getApiFlavor()},o.setEscapeOssObjects=function(t){m=t},o.getEscapeOssObjects=function(){return m};var y=!(o.initLoadContext=function(t){for(var e in(t=t||{}).auth=this.getUseCredentials(),t.endpoint||(t.endpoint=this.getApiEndpoint()),t.api||(t.api=this.getApiFlavor()),t.headers||(t.headers={}),this.HTTP_REQUEST_HEADERS)t.headers[e]=this.HTTP_REQUEST_HEADERS[e];return t.api,this.ENDPOINT_API_FLUENT,this.getQueryParams(t),t.otg_cdn=n||this.getCdnUrl(),t.otg_ws=this.getCdnWebSocketEndpoint(),t.escapeOssObjects=this.getEscapeOssObjects(),t});function v(){return y}function _(t){y=t}var x="";function w(t){x=t}function k(){return x}var I=o,S=o.initLoadContext.bind(o)},"./src/file-loaders/workers/ConsolidationWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"doGeomMerge",function(){return n}),r.d(e,"register",function(){return s});var o=r("./src/wgs/scene/LmvMatrix4.js"),u=r("./src/wgs/scene/LmvVector3.js"),h=r("./src/wgs/scene/consolidation/GeomMergeTask.js");function n(t){for(var e=new o.LmvMatrix4,r=new u.LmvVector3,n=[],s=0;s<t.tasks.length;s++){var i=t.tasks[s],i=h.GeomMergeTask.prototype.run.call(i,e,r);n.push(i)}for(var a=[],s=0;s<n.length;s++)a.push(n[s].vb.buffer),a.push(n[s].vertexIds.buffer);t.worker.postMessage(n,a)}function s(t){t.register("MERGE_GEOMETRY",{doOperation:n})}},"./src/file-loaders/workers/DecompressWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"doDecompressDelta",function(){return n}),r.d(e,"register",function(){return s});var a=r("./src/file-loaders/lmvtk/fusion/base64.js"),o=r("./node_modules/pako/index.js");function n(t){for(var e=t.worker,r=(r=a.decode(t.delta)).split("").map(function(t){return t.charCodeAt(0)}),n=o.inflate(r),s="",i=0;i<n.length;i++)s+=String.fromCharCode(n[i]);s=JSON.parse(s),e.postMessage({cbId:t.cbId,index:t.index,res:s})}function s(t){t.register("DECOMPRESS_DELTA",{doOperation:n})}},"./src/file-loaders/workers/F2dParseWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return u});var n=r("./src/file-loaders/lmvtk/f2d/F2d.js"),s=r("./src/file-loaders/lmvtk/f2d/F2dGeometry.js"),h=r("./src/file-loaders/net/ErrorCodes.js");function i(e,t){try{t()}catch(t){e.raiseError(h.ErrorCodes.BAD_DATA,"",{exception:t.toString(),stack:t.stack}),e.postMessage(null)}}function l(t){return"geometry"===t.f2dLoadOptions.outputType?new s.F2DGeometry(t.metadata,t.f2dLoadOptions):new n.F2D(t.metadata,t.manifest,t.basePath,t.f2dLoadOptions)}function a(t){var e,r=t.worker;r.postMessage({progress:.01}),t.data?(r.postMessage({progress:.5}),e=l(t),t.loadDoneCB=function(t){t?r.postMessage({f2d:e}):(r.raiseError(h.ErrorCodes.BAD_DATA,"",{}),r.postMessage(null))},i(r,function(){e.load(t,t.data)})):r.postMessage(null)}function o(a){var o=a.worker,u=o.f2d;u||(o.postMessage({progress:.5}),(u=o.f2d=l(a)).F2D_MESH_COUNT_OLD=0,o.postMessage({f2dframe:u})),a.loadDoneCB=function(t,e){if(t)if(u.meshes.length||e){var r={f2dframe:!0,meshes:u.meshes,baseIndex:u.F2D_MESH_COUNT_OLD,bbox:u.bbox};a.finalFrame&&(r.cumulativeProps={maxObjectNumber:u.maxObjectNumber,viewports:u.viewports,clips:u.clips,strings:u.strings,stringDbIds:u.stringDbIds,stringBoxes:u.stringBoxes,linkBoxes:u.linkBoxes,hasPageShadow:u.hasPageShadow,minLineWidth:u.currentVbb.minLineWidth},null!==(t=a.f2dLoadOptions)&&void 0!==t&&t.extendStringsFetching&&(r.cumulativeProps.stringCharWidths=u.stringCharWidths,r.cumulativeProps.stringAngles=u.stringAngles,r.cumulativeProps.stringPositions=u.stringPositions,r.cumulativeProps.stringHeights=u.stringHeights),r.finalFrame=e);for(var n=[],s=0,i=u.meshes.length;s<i;++s)n.push(u.meshes[s].vb.buffer),n.push(u.meshes[s].indices.buffer);o.postMessage(r,n),u.F2D_MESH_COUNT_OLD+=u.meshes.length,u.meshes=[]}else;else o.raiseError(h.ErrorCodes.BAD_DATA,"",{}),o.postMessage(null)},i(o,function(){u.loadFrames(a)})}function u(t){t.register("PARSE_F2D",{doOperation:a}),t.register("PARSE_F2D_FRAME",{doOperation:o})}},"./src/file-loaders/workers/F2dStreamWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return s});var a=r("./src/file-loaders/net/Xhr.js"),w=r("./src/file-loaders/lmvtk/f2d/F2dProbe.js"),k=r("./src/logger/Logger.js"),o=r("./src/file-loaders/lmvtk/common/StringUtils.js"),I=r("./src/file-loaders/net/ErrorCodes.js"),S=r("./node_modules/pako/index.js"),A=!0;function u(t,e,r){e=t.basePath+e;a.ViewingService.getItem(t,e,r,null)}function n(e){var r,n;e.worker.postMessage({progress:.01});var s=0,g=new Uint8Array(65536),b=0,y=null;function v(t){var e;g.length<t.length+b&&(e=Math.max(2*g.length,t.length+b),(e=new Uint8Array(e)).set(g),g=e),g.set(t,b),b+=t.length}var _=v,x=function(t){y=t};function i(i,a,o){var u=i.worker,t=i.url,n=[],h=0,e=0;if(a&&a.assets)for(var r=a.assets,s=0;s<r.length;s++){if(-1!=t.indexOf(r[s].URI)){h=r[s].usize||0;break}"Autodesk.CloudPlatform.F2D"==r[s].type&&(e=r[s].usize||0)}0==h&&0<e&&(h=e);var l=new w.F2DProbe,c=!0,f=0,d=!1;function p(t){if(u.postMessage({type:"F2DAssetURL",urls:n}),n=null,A){var e={type:"F2DSTREAM",finalFrame:!0,finished:!0,progress:1};return d||(e.manifest=a,e.metadata=o,e.basePath=i.basePath,e.f2dSize=h,d=!0),u.debug("Total text bytes count : "+t.length),void u.postMessage(e)}var r;if(31==(g=g.length>b?new Uint8Array(g.buffer.slice(0,b)):g)[0]&&139==g[1])try{r=new Uint8Array(g.buffer,0,b),r=S.ungzip(r)}catch(t){console.error(t)}e={type:"F2DBLOB",metadata:o,manifest:a,f2dSize:h,basePath:i.basePath,progress:1,buffer:r.buffer},t=[];t.push(r.buffer),u.postMessage(e,t)}function m(){if(A){if(c&&(c=!1,31==g[0]&&139==g[1]))return k.logger.error("F2D streaming broken by non-streaming unzip!",Object(I.errorCodeString)(I.ErrorCodes.BAD_DATA)),void(A=!1);var t=new Uint8Array(g.buffer,f,b-f);try{var e,r,n,s=l.load(t);s.frameEnd>s.frameStart&&(e=g.buffer.slice(f+s.frameStart,f+s.frameEnd),f+=s.frameEnd,(r=[]).push(e),n={type:"F2DSTREAM",frames:e,finalFrame:!1},h&&(n.progress=f/h),d||(n.manifest=a,n.metadata=o,n.f2dSize=h,n.basePath=i.basePath,d=!0),u.postMessage(n,r))}catch(t){u.debug(t)}}}x=p,_=function(t){v(t),m()},0<b&&m(),null!=y&&p(y)}a.ViewingService.getItem(e,e.url,function(t){x(t)},e.onFailureCallback,{ondata:function(t){_(t)},responseType:""}),u(e,"metadata.json.gz",function(t){try{r=JSON.parse(Object(o.utf8ArrayToString)(t)),s++}catch(t){self.raiseError(I.ErrorCodes.BAD_DATA,"")}2===s&&i(e,n,r)}),u(e,"manifest.json.gz",function(t){try{t&&(n=JSON.parse(Object(o.utf8ArrayToString)(t))),s++}catch(t){}2===s&&i(e,n,r)})}function s(t){t.register("STREAM_F2D",{doOperation:n})}},"./src/file-loaders/workers/GeomWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return i});var g=r("./src/file-loaders/lmvtk/svf/PackReader.js"),b=r("./src/file-loaders/lmvtk/svf/Geoms.js"),y=r("./src/file-loaders/net/ErrorCodes.js"),n=r("./src/file-loaders/net/Xhr.js"),v=r("./src/wgs/scene/DeriveTopology.js");function s(p){var m=p.worker;var t={skipAssetCallback:p.skipAssetCallback};n.ViewingService.getItem(p,p.url,function(d){m.postMessage({url:p.url,workerId:p.workerId,progress:.5}),function(e,t){try{t()}catch(t){e.raiseError(y.ErrorCodes.BAD_DATA,"Unhandled exception while reading pack file",{url:e.url,exception:t.toString(),stack:t.stack})}}(p,function(){for(var t,e=new g.PackFileReader(d),r=!1,n={estimateSizeOnly:!0,packNormals:void 0===p.packNormals||p.packNormals,isD3M:p.url.includes(".m")},s=e.getEntryCounts(),i=p.inMemory||[],a=0,o=function(t){var e=i[t>>5];return!(e&&e&1<<(31&t))},u=0;u<s;u++)o(u)&&(a+=(t=Object(b.readGeometry)(e,u,n))&&t.sharedBufferBytes||0);var h=a?new ArrayBuffer(a):null,l=0,c={packId:p.packId,workerId:p.workerId,progress:1,meshes:[],sharedBuffer:h},f=h?[h]:[],n={dstBuffer:h,startOffset:0,estimateSizeOnly:!1,packNormals:void 0===p.packNormals||p.packNormals,isD3M:p.url.includes(".m")};for(u=0;u<s;u++)n.startOffset=l,o(u)&&((t=Object(b.readGeometry)(e,u,n))?(l+=t.sharedBufferBytes||0,c.meshes[u]=t,p.createWireframe&&(Object(v.createWireframe)(t),t.iblines&&f.push(t.iblines.buffer))):(r||(m.raiseError(y.ErrorCodes.BAD_DATA,"Unable to load geometry",{url:p.url}),r=!0),m.postMessage(c)));m.postMessage(c,f)})},p.onFailureCallback,t)}function i(t){t.register("LOAD_GEOMETRY",{doOperation:s})}},"./src/file-loaders/workers/MainWorker-web.js":function(t,e,r){"use strict";r.r(e);var n=r("./src/file-loaders/workers/MainWorker.js");self.addEventListener("message",function(t){t=t.data;t.worker=self,n.workerMain.dispatch(t)},!1),self.raiseError=function(t,e,r){self.postMessage({error:{code:t,msg:e,args:r}})},self.debug=function(t){self.postMessage({debug:1,message:t})}},"./src/file-loaders/workers/MainWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"WorkerMain",function(){return n}),r.d(e,"workerMain",function(){return o});var s=r("./src/file-loaders/net/Xhr.js"),i=r("./src/file-loaders/net/endpoints.js");function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._workers={}}var e,r,n;return e=t,(r=[{key:"dispatch",value:function(t){var e,r;t.hasOwnProperty("operation")&&(t.endpoint&&i.endpoint.setEndpointAndApi(t.endpoint,t.api),(e=this._workers[t.operation])&&(t.basePath="",!t.url||-1!=(r=t.url.lastIndexOf("/"))&&(t.basePath=t.url.substr(0,r+1)),t.raiseError=function(){t.worker.raiseError.apply(t.worker,arguments)},t.onFailureCallback=s.ViewingService.defaultFailureCallback.bind(t),e.doOperation(t)))}},{key:"register",value:function(t,e){this._workers[t]=e}},{key:"unregister",value:function(t){delete this._workers[t]}}])&&a(e.prototype,r),n&&a(e,n),t}(),o=new n;r("./src/file-loaders/workers/SvfWorker.js").register(o),r("./src/file-loaders/workers/GeomWorker.js").register(o),r("./src/file-loaders/workers/F2dParseWorker.js").register(o),r("./src/file-loaders/workers/F2dStreamWorker.js").register(o),r("./src/file-loaders/workers/OtgBvhWorker.js").register(o),r("./src/file-loaders/workers/OtgLoadWorker.js").register(o),r("./src/file-loaders/workers/PropWorker.js").register(o),r("./src/file-loaders/workers/ConsolidationWorker.js").register(o),o.register("REGISTER_FILE_PORT",{doOperation:function(t){if(t&&t.protocolPortMap)for(var e in t.protocolPortMap)s.ViewingService.registerProtocolPort(e,t.protocolPortMap[e])}}),r("./src/file-loaders/workers/DecompressWorker.js").register(o)},"./src/file-loaders/workers/OtgBvhWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return s});var i=r("./src/file-loaders/net/Xhr.js"),a=r("./src/wgs/scene/BVHBuilder.js"),o=r("./src/file-loaders/lmvtk/otg/OtgFragInfo.js");function n(r){var t,e,n,s;r.fragments_extra&&(e=(t=r).fragments_extra,n="",s=function(t){var e;t&&t.length&&((e=new o.OtgFragInfo(t,r)).count&&((t=new a.BVHBuilder(null,null,e)).build(r.bvhOptions),t={nodes:t.nodes.getRawData(),primitives:t.primitives},r.worker.postMessage({bvh:t,boxes:e.boxes,boxStride:e.boxStride},[t.nodes,t.primitives.buffer,e.boxes.buffer])))},i.ViewingService.getItem(t,e,s,t.onFailureCallback,{responseType:n||"arraybuffer"}))}function s(t){t.register("LOAD_OTG_BVH",{doOperation:n})}},"./src/file-loaders/workers/OtgLoadWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return v});var o=r("./src/file-loaders/net/Xhr.js"),a=r("./src/file-loaders/lmvtk/otg/OtgGeomCodec.js"),n=r("./src/file-loaders/lmvtk/otg/LocalDbCache.js"),u=r("./src/compat.js"),s=r("./src/file-loaders/lmvtk/otg/OtgWebSocket.js"),h=r("./node_modules/pako/index.js");function l(t){return t.worker.ctx||(t.worker.ctx={otgws:new s.OtgWs(t,d,i),localCache:new n.LocalDbCache(t.disableIndexedDb,t.isInlineWorker),numRequests:0,inprogress:{},_pendingMdata:[],_pendingTransferList:[],_pendingSends:[]}),t.worker.ctx}function c(t){return 31===t[0]&&139===t[1]}function f(n,s,i){var e={raiseError:function(t,e,r){r.hash=s,r.type=i,n.raiseError(t,e,r)}};return function(){o.ViewingService.defaultFailureCallback.apply(e,arguments);var t=l(n);delete t.inprogress[s],t.numRequests--,t.closeRequested&&!t.numRequests&&t.otgws.endSession()}}function i(t){var e,r=l(t),n=r.inprogress;for(e in r.inprogress={},n){var s=n[e];t.queryParams=s.queryParams,p(s.url,e,t,s.type)}}function d(t,e,r,n,s){var i=l(r);n||(i.localCache.store(e,t),n=t&&c(t),!t||Object(u.isNodeJS)()||r.disableIndexedDb||n||(t=t.slice())),c(t)&&(t=h.ungzip(t)),delete i.inprogress[e],i.numRequests--,"m"===s?t?r.worker.postMessage({material:t,hash:e},[t.buffer]):f(r,e,s)(-1,"",{}):(t=t&&function(t,e){if(c(t)&&(console.error("Double compressed OTG resource.",e),t=h.ungzip(t)),t=a.readLmvBufferGeom(t))return t.hash=e,t;console.error("Failed to parse geometry",e)}(t,e))?function(t,e){Array.isArray(e)||(e=[e]);for(var r=[],n=0;n<e.length;n++){var s,i=e[n].mesh;i&&(s=i.vb.buffer,r.push(s),i.indices&&i.indices.buffer!==s&&r.push(i.indices.buffer),i.iblines&&i.iblines.buffer!==s&&r.push(i.iblines.buffer))}(t=l(t))._pendingMdata.push.apply(t._pendingMdata,e),t._pendingTransferList.push.apply(t._pendingTransferList,r)}(r,t):f(r,e,s)(-1,"",{}),i.closeRequested&&!i.numRequests&&i.otgws.endSession()}function p(r,n,s,i){var a=l(s);a.localCache.open(function(){return a.localCache.get(n,function(t,e){e?d(e,n,s,!0,i):(a.inprogress[n]&&console.warn("Unexpected repeated request for same OTG resource."),a.inprogress[n]={url:r,type:i,queryParams:s.queryParams},a.otgws._wsUsable?a.otgws.startSession(s,function(){return a.otgws.requestResources([r],[n],i)}):o.ViewingService.getItem(s,r,function(t){return d(t,n,s,!1,i)},f(s,n),{responseType:"arraybuffer",withCredentials:!0}))})})}function m(t){for(var e=l(t),r=0;r<t.urls.length;r++)p(t.urls[r],t.hashes[r],t,t.type||"g"),e.numRequests++}function g(t){var e=l(t);e._pendingMdata.length&&(t.worker.postMessage(e._pendingMdata,e._pendingTransferList),e._pendingMdata=[],e._pendingTransferList=[])}function b(t){var e=l(t);e.otgws.startSession(t),e.localCache.open(null),e.flushMessages||(e.flushMessages=setInterval(function(){g(t)},66))}function y(t){var e=l(t);e.flushMessages&&g(t),t.endSession&&(e.numRequests?e.closeRequested=!0:(e.otgws.endSession(),clearInterval(e.flushMessages),e.flushMessages=null)),e.localCache&&e.localCache.open(function(){return e.localCache.updatePendingTimestamps()})}function v(t){t.register("LOAD_CDN_RESOURCE_OTG",{doOperation:m}),t.register("INIT_WORKER_OTG",{doOperation:b}),t.register("UPDATE_MRU_TIMESTAMPS_OTG",{doOperation:y})}},"./src/file-loaders/workers/PropWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return S});var u=r("./src/file-loaders/net/Xhr.js"),d=r("./src/file-loaders/lmvtk/common/Propdb.js"),y=r("./src/wgs/scene/InstanceTreeStorage.js");function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e){this.pdb=null,this.waitingCallbacks=[],this.error=!1,this.dbPath=t,this.dbFiles=null,this.isShared=e,this.timestamp=Date.now()}function a(t){this.data=t,this.refCount=1}var p=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.pdbCache={},this.fileCache={}}var e,r,n;return e=t,(r=[{key:"get",value:function(t){t=this.pdbCache[t];return t&&(t.timestamp=Date.now()),t}},{key:"set",value:function(t,e){e=new i(t,e);return this.pdbCache[t]=e}},{key:"getFile",value:function(t){t=this.fileCache[t];return t&&(t.timestamp=Date.now()),t}},{key:"setFile",value:function(t,e){this.fileCache[t]=new a(e)}},{key:"delete",value:function(t){var e=this.get(t);if(e&&e.pdb&&(e.pdb.refCount--,0===e.pdb.refCount&&(e.isShared||delete this.pdbCache[t],!e.isShared)))for(var r in e.dbFiles){r=e.dbFiles[r];this.unrefFileCacheEntry(r.storage)}}},{key:"unrefFileCacheEntry",value:function(t){for(var e in t){var r=this.fileCache[e];r&&(r.refCount--,0===r.refCount&&delete this.fileCache[e])}}}])&&s(e.prototype,r),n&&s(e,n),t}();function m(t,n,s,e,r){function i(t){r&&n.worker.pdbCache&&n.worker.pdbCache.setFile(o,t),e[o]=t,s(t)}var a=-1!==t.indexOf("://")||0===t.indexOf("urn:")?t:(n.dbPath||"")+t,o=u.ViewingService.generateUrl(n.endpoint,"items",a),t=n.worker.pdbCache&&n.worker.pdbCache.getFile(o);t?(t.refCount++,i(t.data)):u.ViewingService.getItem(n,a,i,function(t,e,r){404!==t&&n.onFailureCallback(t,e,r),s(null)})}function n(t){var e=t.worker,r=t.gltfTree,n=t.fragToDbId,s=t.dbToFragId,n=new y.InstanceTreeStorage(t.objectCount,n?n.length:0);!function t(e,r,n,s){var i,a=e.dbId,o=e.children,u=[];if(o)for(var h=0;h<o.length;h++)t(o[h],a,n,s)&&u.push(o[h].dbId);!n||void 0!==(l=n[a])&&(i=Array.isArray(l)?l:[l]);var l=u.length+(i?i.length:0);return l&&s.setNode(a,r,e.name.toString(),0,u,i),l}(r,0,s,n),n.flatten(),e.postMessage({cbId:t.cbId,result:{rootId:r.dbId,instanceTreeStorage:n,dbidOldToNew:t.needsDbIdRemap?dbidOldToNew:null}})}function o(g){var b=g.worker;!function(i,a){var o=i.worker,t=o.pdbCache;t||(o.pdbCache=t=new p);var u=t.get(i.dbPath),e=!1;if(u?e=!0:u=t.set(i.dbPath,!!i.sharedDbPath),u.pdb)a(u.pdb,u.dbidOldToNew);else if(u.error)a(null);else if(e)u.waitingCallbacks.push(a);else{var r=i.propertydb;if(!r)return o.propdbFailed=!0,a(null);var h={},l=[];if(r.avs.length)for(var n in r)i.skipExternalIds&&"ids"==n||(h[n]={},l.push({filename:r[n][0].path,isShared:r[n][0].isShared,storage:h[n]}));else l.push({filename:r.attrs.length?r.attrs[0]:"objects_attrs.json.gz",storage:(h={ids:{},attrs:{},offsets:{},values:{},avs:{}}).attrs}),l.push({filename:r.values.length?r.values[0]:"objects_vals.json.gz",storage:h.values}),l.push({filename:r.avs.length?r.avs[0]:"objects_avs.json.gz",storage:h.avs}),l.push({filename:r.offsets.length?r.offsets[0]:"objects_offs.json.gz",storage:h.offsets}),i.skipExternalIds||l.push({filename:r.ids.length?r.ids[0]:"objects_ids.json.gz",storage:h.ids});var c=l.length,f=0;l.forEach(function(t){m(t.filename,i,s,t.storage,t.isShared)})}function s(t){if(c--,o.postMessage({cbId:i.cbId,progress:{percent:95*(l.length-c)/l.length}}),t||f++,!c)if(f)for(u.error=!0,a(null);u.waitingCallbacks.length;)u.waitingCallbacks.shift()(null);else{l.forEach(function(t){t.storage=null});try{for(var e in u.pdb=new d.PropertyDatabase(h),u.pdb.refCount=0,u.loaded=!0,u.dbFiles=l,u.timestamp=Date.now(),u.byteSize=0,h)for(var r in h[e]){var n=h[e][r];u.byteSize+=n&&n.byteLength}for(var r in h.dbid){var s=h.dbid[r];u.dbidOldToNew=new Int32Array(s.buffer,s.byteOffset,s.byteLength/4);break}for(a(u.pdb,u.dbidOldToNew);u.waitingCallbacks.length;)u.waitingCallbacks.shift()(u.pdb)}catch(t){a(null,null,t&&t.message)}}}}(g,function(t,e,r){if(t){t.refCount++,g.skipInstanceTreeResult||t.rootsDone||(t.idroots=t.findRootNodes(),t.rootsDone=!0);var n,s=[0],i=[],a=g.fragToDbId;if(g.needsDbIdRemap)if(e)if(a){for(var o=e,u=[],h=0;h<a.length;h++){var l=a[h];if(Array.isArray(l)){u[h]=[];for(var c=0;c<l.length;c++)u[h][c]=o[l[c]]}else u[h]=o[l]}a=u}else console.warn("No frag->dbid mapping!.");else console.warn("ID remap required, but not loaded.");var f,d=t.idroots;if(d&&d.length){if(n=new y.InstanceTreeStorage(t.getObjectCount(),a?a.length:0),1==d.length&&t.nodeHasChild(d[0]))p=d[0],t.buildObjectTree(p,a,s,n);else{for(var p=-1e10,m=[],h=0;h<d.length;h++)t.buildObjectTree(d[h],a,s,n),m.push(d[h]);n.setNode(p,0,"",0,m,!1)}n.flatten(),i.push(n.nodes.buffer),i.push(n.children.buffer),i.push(n.strings.buf.buffer),i.push(n.strings.idx.buffer),g.fragBoxes&&((f=new y.InstanceTreeAccess(n,p)).computeBoxes(g.fragBoxes),i.push(f.nodeBoxes.buffer))}b.postMessage({cbId:g.cbId,result:{rootId:p,instanceTreeStorage:n,instanceBoxes:f?f.nodeBoxes:void 0,dbidOldToNew:g.needsDbIdRemap?e:null,maxTreeDepth:s[0],objectCount:t.getObjectCount()}},i)}else b.postMessage({cbId:g.cbId,error:{instanceTree:null,maxTreeDepth:0,err:r}})})}function h(t){var e,r=t.worker,n=r.pdbCache&&r.pdbCache.get(t.dbPath);n&&n.pdb&&(e=t.searchText,e=n.pdb.bruteForceSearch(e,t.attributeNames,t.searchOptions),r.postMessage({cbId:t.cbId,result:e}))}function l(e){var t=e.worker,r=t.pdbCache&&t.pdbCache.get(e.dbPath),n=t.pdbCache&&t.pdbCache.get(e.dbPath2),r=r&&r.pdb,n=n&&n.pdb;r&&n&&(n=r.findDifferences(n,e.diffOptions,function(t){e.worker.postMessage({cbId:e.cbId,progress:{percent:t}})}),t.postMessage({cbId:e.cbId,result:n}))}function c(t){var e=t.worker,r=e.pdbCache&&e.pdbCache.get(t.dbPath);r&&r.pdb&&(r=r.pdb.bruteForceFind(t.propertyName),e.postMessage({cbId:t.cbId,result:r}))}function f(t){var e=t.worker,r=e.pdbCache&&e.pdbCache.get(t.dbPath);r&&r.pdb&&(r=r.pdb.findLayers(),e.postMessage({cbId:t.cbId,result:r}))}function g(t){var e=t.worker,r=e.pdbCache&&e.pdbCache.get(t.dbPath);if(!r||!r.pdb)return t.gltfTree?(function t(e,r,n){if(!(0<Object.keys(n).length)){if(r==e.dbId)return n.name=e.name,void(n.dbId=r);var s=e.children;if(s)for(var i=0;i<s.length;i++)t(s[i],r,n)}}(t.gltfTree,t.dbId,u={}),u):void 0;var e=t.dbId,n=t.dbIds,s=t.propFilter,i=t.ignoreHidden;if(void 0===n)return u=r.pdb.getObjectProperties(e,s);var a=[];if(n&&n.length)for(var o=0;o<n.length;o++)(u=r.pdb.getObjectProperties(n[o],s,i))&&a.push(u);else for(var u,o=1,h=r.pdb.getObjectCount();o<=h;o++)(u=r.pdb.getObjectProperties(o,s,i))&&a.push(u);return a}function b(t){var e=g(t);e?t.worker.postMessage({cbId:t.cbId,result:e}):t.worker.postMessage({cbId:t.cbId,error:{msg:"Properties are not available."}})}function v(t){var e=g(t);e||t.worker.postMessage({cbId:t.cbId,error:{msg:"Properties are not available."}});for(var r={},n=[],s=0;s<e.length;++s){var i=e[s];i.properties.forEach(function(t){"Name"!==t.displayName||t.displayCategory||n.push(i.name);var e=t.displayCategory?"".concat(t.displayCategory,"/").concat(t.displayName):t.displayName;r.hasOwnProperty(e)||(r[e]=[]),t.parentName=i.name,t.dbId=i.dbId,r[e].push(t)}),i.hasOwnProperty("name")&&-1===n.indexOf(i.name)&&(r.hasOwnProperty("Name")||(r.Name=[]),r.Name.push({displayName:"Name",displayValue:i.name,displayCategory:null,attributeName:"Name",type:20,units:null,hidden:!1,precision:0,dbId:i.dbId,parentName:i.name}))}n=[],r.__selected_dbIds__=t.dbIds,t.worker.postMessage({cbId:t.cbId,result:r})}function _(t){var e=t.worker,r=e.pdbCache&&e.pdbCache.get(t.dbPath);r&&r.pdb&&(r=r.pdb.getExternalIdMapping(t.extIdFilter),e.postMessage({cbId:t.cbId,result:r}))}function x(t){var e=t.worker,r=e.pdbCache&&e.pdbCache.get(t.dbPath);r&&r.pdb&&(r=r.pdb.getLayerToNodeIdMapping(),e.postMessage({cbId:t.cbId,result:r}))}function w(t){var e=t.worker;t.clearCaches?e.pdbCache=null:e.pdbCache&&e.pdbCache.delete(t.dbPath)}function k(r){var n=r.worker,s=r.idsFile||{path:"objects_ids.json.gz"},i={},a=n.pdbCache.get(r.dbPath);a?a.pdb&&a.pdb.externalIdsLoaded()?n.postMessage({cbId:r.cbId}):m(s.path,r,function(t){var e;t&&(e=n.pdbCache,(a=e.get(r.dbPath))&&a.pdb||(e.unrefFileCacheEntry(i),n.postMessage({cbId:r.cbId,error:{propDbWasUnloaded:!0}})),a.pdb.setIdsBlob(t),a.byteSize+=t.byteLength,a.dbFiles.push({filename:s.path,storage:i}),n.postMessage({cbId:r.cbId}))},i,s.isShared):console.error("Delay-loading of externalIDs requires to load the propDb first.")}function I(e){var r=e.worker;if(e.userFunction)try{importScripts(e.userFunction)}catch(t){return console.error(t),void r.postMessage({cbId:e.cbId,error:{msg:"Error while importing 'userFunction'."}})}if(self.userFunction){var t,n=r.pdbCache&&r.pdbCache.get(e.dbPath);if(n&&n.pdb){try{t=self.userFunction(n.pdb,e.userData)}catch(t){return console.error(t),void r.postMessage({cbId:e.cbId,error:{msg:"Error while executing 'userFunction'."}})}finally{self.userFunction=void 0}r.postMessage({cbId:e.cbId,result:t})}}else r.postMessage({cbId:e.cbId,error:{msg:"function 'userFunction' was not found."}})}function S(t){t.register("BUILD_EXTERNAL_ID_MAPPING",{doOperation:_}),t.register("BUILD_LAYER_TO_NODE_ID_MAPPING",{doOperation:x}),t.register("GET_PROPERTIES",{doOperation:b}),t.register("GET_PROPERTY_SET",{doOperation:v}),t.register("SEARCH_PROPERTIES",{doOperation:h}),t.register("DIFF_PROPERTIES",{doOperation:l}),t.register("FIND_PROPERTY",{doOperation:c}),t.register("FIND_LAYERS",{doOperation:f}),t.register("LOAD_PROPERTYDB",{doOperation:o}),t.register("CREATE_TREE",{doOperation:n}),t.register("UNLOAD_PROPERTYDB",{doOperation:w}),t.register("USER_FUNCTION",{doOperation:I}),t.register("LOAD_EXTERNAL_IDS",{doOperation:k})}},"./src/file-loaders/workers/SvfWorker.js":function(t,e,r){"use strict";r.r(e),r.d(e,"register",function(){return c});var s=r("./src/file-loaders/lmvtk/svf/Package.js"),a=r("./src/file-loaders/lmvtk/common/InputStream.js"),o=r("./src/file-loaders/net/Xhr.js"),u=r("./src/file-loaders/net/ErrorCodes.js");function i(e,t){try{t()}catch(t){e.worker.raiseError(u.ErrorCodes.BAD_DATA,"Unhandled exception while loading SVF",{url:e.url,exception:t.toString(),stack:t.stack}),e.worker.postMessage(null)}}function h(a){var o=a.worker;i(a,function(){var i=a.svf;a.loadDoneCB=function(t,e){var r,n,s;"svf"==t?(r=[(n=i.fragments).transforms.buffer,n.packIds.buffer,n.entityIndexes.buffer,n.fragId2dbId.buffer,n.visibilityFlags.buffer],n=i.bvh?(s={nodes:i.bvh.nodes.getRawData(),primitives:i.bvh.primitives,useLeanNodes:32==i.bvh.nodes.bytes_per_node},r.push(s.nodes),r.push(s.primitives.buffer),r.push(n.boxes.buffer),r.push(n.polygonCounts.buffer),r.push(n.materials.buffer),{svf:i,bvh:s,progress:1}):{svf:i,progress:.8},o.postMessage(n,r)):"bvh"==t?(s={nodes:i.bvh.nodes.getRawData(),primitives:i.bvh.primitives,useLeanNodes:32==i.bvh.nodes.bytes_per_node},o.postMessage({bvh:s,basePath:i.basePath,progress:1},[s.nodes,s.primitives.buffer])):"mesh"==t?(s=[],e.mesh&&s.push(e.mesh.vb.buffer),o.postMessage(e,s)):"done"==t?o.postMessage({progress:1}):(o.raiseError(u.ErrorCodes.BAD_DATA,"Failure while loading SVF",{url:a.url}),o.postMessage(null))},i.loadRemainingSvf(a)})}function n(r){var n=r.worker;n.postMessage({progress:.01});var t={responseType:"arraybuffer"};o.ViewingService.getItem(r,r.url,function(e){n.postMessage({progress:.5}),i(r,function(){var t=new s.Package(new Uint8Array(e));(r.svf=t).loadManifest(r),r.interceptManifest?n.postMessage({manifest:t.manifest}):(r.manifest=t.manifest,h(r))})},r.onFailureCallback,t),r.isD3M?o.ViewingService.getItem(r,r.basePath+"0.m",function(){},function(){},t):o.ViewingService.getItem(r,r.basePath+"0.pf",function(){},function(){},t)}function l(t){var s=t.worker;function i(t){s.postMessage({"fetch-topology":{error:t,topology:null}})}o.ViewingService.getItem(t,t.path,function(t){s.postMessage({"status-topology":{}});var e=null;try{var r=new a.InputStream(t),n=t.byteLength;(e=0<n?JSON.parse(r.getString(n)):e)?s.postMessage({"fetch-topology":{error:null,topology:e}}):i("topology-no-content")}catch(t){i(t)}},i)}function c(t){t.register("LOAD_SVF",{doOperation:n}),t.register("LOAD_SVF_CONTD",{doOperation:h}),t.register("FETCH_TOPOLOGY",{doOperation:l})}},"./src/globals.js":function(t,e,r){"use strict";r.r(e),r.d(e,"DISABLE_FORGE_LOGO",function(){return a}),r.d(e,"DISABLE_FORGE_CANVAS_LOGO",function(){return u}),r.d(e,"getScript",function(){return h}),r.d(e,"injectCSS",function(){return l}),r.d(e,"getHtmlTemplate",function(){return c}),r.d(e,"isExperimentalFlagEnabled",function(){return f}),r.d(e,"getResourceUrl",function(){return d}),r.d(e,"getParameterByName",function(){return p}),r.d(e,"getParameterByNameFromPath",function(){return m}),r.d(e,"stringToDOM",function(){return g}),r.d(e,"toUrlSafeBase64",function(){return b}),r.d(e,"fromUrlSafeBase64",function(){return y});var n=r("./src/compat.js"),s=Object(n.getGlobal)(),i=s,o=i&&i.document;s.LOCALIZATION_REL_PATH="",s.LMV_VIEWER_VERSION="7.38.0",s.LMV_BUILD_TYPE="Production",s.LMV_RESOURCE_ROOT="",s.LMV_THIRD_PARTY_COOKIE=!Object(n.isNodeJS)()&&void 0,"v"===s.LMV_VIEWER_VERSION.charAt(0)&&(s.LMV_VIEWER_VERSION=s.LMV_VIEWER_VERSION.substr(1)),s.LMV_VECTOR_PDF=!1,s.LMV_RASTER_PDF=!0;var a=s.AEC_MODELTOSHEET_TRANSFORM=!1,u=!0;function h(t){t=t.toLowerCase();var e=o.getElementsByTagName("SCRIPT");if(e&&0<e.length)for(var r=0;r<e.length;++r)if(e[r].src&&-1!==e[r].src.toLowerCase().indexOf(t))return e[r];return null}function l(t,e,r){for(var n=0<t.indexOf("://")?t:d(t),s=o.getElementsByTagName("link"),i=0,a=s.length;i<a;i++)if(s[i].href===n)return void(e&&e());t=o.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href",n),e&&(t.onload=e),r&&(t.onerror=r),o.head.appendChild(t)}function c(t,e){var r=0<t.indexOf("://")?t:d(t),t=new XMLHttpRequest;function n(t){e(t,null)}t.onload=function(t){t=t.currentTarget.responseText;e(null,t)},t.onerror=n,t.ontimeout=n,t.open("GET",r,!0),t.send()}function f(t,e){return!(!e||!Array.isArray(e.experimental))&&-1!==e.experimental.indexOf(t)}function d(t){return s.LMV_RESOURCE_ROOT+t}function p(t){return"undefined"==typeof window?"":m(t,i.location.href)}function m(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function g(t){var e=o.createElement("div");return e.innerHTML=t,e.firstChild}function b(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function y(t){for(t=(t=t.replace(/-/g,"+")).replace(/_/g,"/");t.length%4;)t+="=";return Object(n.isNodeJS)()?Buffer.from(t,"base64").toString():atob(t)}},"./src/logger/Logger.js":function(t,e,r){"use strict";r.r(e),r.d(e,"LogLevels",function(){return h}),r.d(e,"Logger",function(){return l}),r.d(e,"logger",function(){return d}),r.d(e,"setLogger",function(){return p});var n=r("./src/compat.js"),s=r("./src/file-loaders/net/endpoints.js"),i=r("./src/analytics/index.js");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=Object(n.getGlobal)(),u=o,h={DEBUG:5,LOG:4,INFO:3,WARNING:2,ERROR:1,NONE:0};function l(){this.runtimeStats={},this.level=-1,this.setLevel(h.ERROR),this._reportError=this._reportError.bind(this)}function c(t,e){var r;"string"==typeof e?r={message:e}:"object"===a(e)&&(r=e),i.analytics.track(t,r)}function f(){}l.prototype.initialize=function(t){var e;t.eventCallback&&(this.callback=t.eventCallback),this.sessionId=t.sessionId,this.sessionId||(e=Date.now()+"",this.sessionId=parseFloat((1e4*Math.random()|0)+""+e.substring(4))),"number"==typeof t.logLevel&&this.setLevel(t.logLevel),this.environmentInfo={touch:Object(n.isTouchDevice)(),env:Object(s.getEnv)(),referer:"undefined"==typeof window?"":encodeURI(u.location.href),version:o.LMV_VIEWER_VERSION,build_type:o.LMV_BUILD_TYPE};t={category:"viewer_start",touch:this.environmentInfo.touch,env:this.environmentInfo.env,referer:this.environmentInfo.referer,version:this.environmentInfo.version,build_type:this.environmentInfo.build_type};this.track(t);var r=this;this.interval=setInterval(function(){r.reportRuntimeStats()},6e4)},l.prototype.shutdown=function(){clearInterval(this.interval),this.interval=void 0},l.prototype.track=function(t){this.updateRuntimeStats(t),!Object(s.isOffline)()&&this.sessionId&&(this.callback&&(t.timestamp=Date.now(),t.sessionId=this.sessionId,this.callback(t)),"error"===(null==t?void 0:t.category)&&c("viewer.error.tracked",t))},l.prototype.updateRuntimeStats=function(t){if(t.hasOwnProperty("aggregate"))switch(t.aggregate){case"count":0<this.runtimeStats[t.name]?this.runtimeStats[t.name]++:this.runtimeStats[t.name]=1,this.runtimeStats._nonempty=!0;break;case"last":this.runtimeStats[t.name]=t.value,this.runtimeStats._nonempty=!0;break;default:this.warn("unknown log aggregate type")}},l.prototype.reportRuntimeStats=function(){this.runtimeStats._nonempty&&(delete this.runtimeStats._nonempty,this.runtimeStats.category="misc_stats",this.track(this.runtimeStats),this.runtimeStats={})},l.prototype.setLevel=function(t){this.level!==t&&(this.level=t,this.debug=t>=h.DEBUG?console.log:f,this.log=t>=h.LOG?console.log:f,this.info=t>=h.INFO?console.info:f,this.warn=t>=h.WARNING?console.warn:f,this.error=t>=h.ERROR?this._reportError:f)},l.prototype._reportError=function(){console.error.apply(console,arguments);var t=Array.prototype.slice.call(arguments).join(" ");this.callback&&this.callback({category:"error",message:t}),c("viewer.error.logged",t)};var d=new l;function p(t){d=t}},"./src/wgs/scene/BVHBuilder.js":function(t,e,r){"use strict";function u(t,e){var r,n;this.bytes_per_node=e?32:36,t instanceof ArrayBuffer?(r=t.byteLength/this.bytes_per_node,n=t,this.nodeCount=r):(r=0|t,n=new ArrayBuffer(this.bytes_per_node*r),this.nodeCount=0),this.nodeCapacity=r,this.nodesRaw=n,this.is_lean_node=e,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}r.r(e),r.d(e,"NodeArray",function(){return u}),r.d(e,"BVHBuilder",function(){return i}),u.prototype.setLeftChild=function(t,e){this.nodesI[t*this.node_stride+6]=e},u.prototype.getLeftChild=function(t){return this.nodesI[t*this.node_stride+6]},u.prototype.setPrimStart=function(t,e){this.is_lean_node?this.nodesI[t*this.node_stride+6]=e:this.nodesI[t*this.node_stride+8]=e},u.prototype.getPrimStart=function(t){return this.is_lean_node?this.nodesI[t*this.node_stride+6]:this.nodesI[t*this.node_stride+8]},u.prototype.setPrimCount=function(t,e){this.nodesS[t*this.node_stride_short+14]=e},u.prototype.getPrimCount=function(t){return this.nodesS[t*this.node_stride_short+14]},u.prototype.setFlags=function(t,e,r,n){this.nodesS[t*this.node_stride_short+15]=n<<3|r<<2|3&e},u.prototype.getFlags=function(t){return this.nodesS[t*this.node_stride_short+15]},u.prototype.setBox0=function(t,e){var r=t*this.node_stride,t=this.nodesF;t[r]=e[0],t[1+r]=e[1],t[2+r]=e[2],t[3+r]=e[3],t[4+r]=e[4],t[5+r]=e[5]},u.prototype.getBoxThree=function(t,e){var r=t*this.node_stride,t=this.nodesF;e.min.x=t[r],e.min.y=t[1+r],e.min.z=t[2+r],e.max.x=t[3+r],e.max.y=t[4+r],e.max.z=t[5+r]},u.prototype.getBoxArray=function(t,e,r){var n=t*this.node_stride,t=this.nodesF;e[0+(r=r||0)]=t[n],e[1+r]=t[1+n],e[2+r]=t[2+n],e[3+r]=t[3+n],e[4+r]=t[4+n],e[5+r]=t[5+n]},u.prototype.setBoxThree=function(t,e){var r=t*this.node_stride,t=this.nodesF;t[r]=e.min.x,t[1+r]=e.min.y,t[2+r]=e.min.z,t[3+r]=e.max.x,t[4+r]=e.max.y,t[5+r]=e.max.z},u.prototype.makeEmpty=function(t){var e=t*this.node_stride,t=this.nodesI;t[6+e]=-1,t[7+e]=0,this.is_lean_node||(t[8+e]=-1)},u.prototype.realloc=function(t){var e,r;this.nodeCount+t>this.nodeCapacity&&((e=0|3*this.nodeCapacity/2)<this.nodeCount+t&&(e=this.nodeCount+t),r=new ArrayBuffer(e*this.bytes_per_node),(t=new Int32Array(r)).set(this.nodesI),this.nodeCapacity=e,this.nodesRaw=r,this.nodesF=new Float32Array(r),this.nodesI=t,this.nodesS=new Uint16Array(r))},u.prototype.nextNodes=function(t){this.realloc(t);var e=this.nodeCount;this.nodeCount+=t;for(var r=0;r<t;r++)this.makeEmpty(e+r);return e},u.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var n=3,E=1e-5,j=16,c=function(){function b(t,e,r){t[0]>e[r]&&(t[0]=e[r]),t[3]<e[r]&&(t[3]=e[r]),t[1]>e[r+1]&&(t[1]=e[r+1]),t[4]<e[r+1]&&(t[4]=e[r+1]),t[2]>e[r+2]&&(t[2]=e[r+2]),t[5]<e[r+2]&&(t[5]=e[r+2])}function y(t,e,r){t[0]>e[r]&&(t[0]=e[r]),t[1]>e[r+1]&&(t[1]=e[r+1]),t[2]>e[r+2]&&(t[2]=e[r+2]),t[3]<e[r+3]&&(t[3]=e[r+3]),t[4]<e[r+4]&&(t[4]=e[r+4]),t[5]<e[r+5]&&(t[5]=e[r+5])}function g(t,e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]>e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t[4]<e[4]&&(t[4]=e[4]),t[5]<e[5]&&(t[5]=e[5])}function v(t,e,r,n){for(var s=0;s<3;s++)t[e+s]=r[n+3+s]-r[n+s]}function _(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5]}var e=1/0;function x(t){t[0]=e,t[1]=e,t[2]=e,t[3]=-e,t[4]=-e,t[5]=-e}function w(t){var e=t[3]-t[0],r=t[4]-t[1],t=t[5]-t[2];return e<0||r<0||t<0?0:2*(e*r+r*t+t*e)}function k(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function t(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function r(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}k.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},t.prototype.reset=function(){this.num_prims=0,x(this.box_bbox),x(this.box_centroid)},r.prototype.reset=function(){this.NL=0,this.AL=0,x(this.BL),x(this.CL)};for(var I=[],n=0;n<j;n++)I.push(new t);var S=[];for(n=0;n<j-1;n++)S.push(new r);var A=new Float32Array(6),O=new Float32Array(6);function C(t,e,r,n,s,i,a){if(i[n]<t.scene_epsilon)a.best_cost=1/0;else{var o,u=j;for(r-e+1<u&&(u=r-e+1),o=0;o<u;o++)I[o].reset();for(o=0;o<u-1;o++)S[o].reset();for(function(t,e,r,n,s,i,a){for(var o=t.centroids,u=t.primitives,h=t.finfo.boxes,l=t.finfo.boxStride,c=a*(1-E)/i[n],f=s[n],d=t.sort_prims,p=e;p<=r;p++){var m=0|u[p],g=0|c*(o[3*m+n]-f);g<0?g=0:a<=g&&(g=a-1),d[p]=g,I[g].num_prims++,y(I[g].box_bbox,h,m*l),b(I[g].box_centroid,o,3*m)}}(t,e,r,n,s,i,a.num_bins=u),_(S[0].BL,I[0].box_bbox),_(S[0].CL,I[0].box_centroid),S[0].AL=w(S[0].BL),S[0].NL=I[0].num_prims,o=1;o<u-1;o++){var h=I[o],l=S[o];_(l.BL,S[o-1].BL),g(l.BL,h.box_bbox),l.AL=w(l.BL),_(l.CL,S[o-1].CL),g(l.CL,h.box_centroid),l.NL=S[o-1].NL+h.num_prims}_(A,I[o=u-1].box_bbox),_(O,I[o].box_centroid);var c=w(A),f=I[o].num_prims,d=o,p=c*f+S[o-1].AL*S[o-1].NL;for(_(a.vb_right,A),_(a.cb_right,I[o].box_centroid),_(a.vb_left,S[o-1].BL),_(a.cb_left,S[o-1].CL),a.num_left=S[o-1].NL,o-=1;1<=o;o--){h=I[o],g(A,h.box_bbox),g(O,h.box_centroid);var m=w(A)*(f+=h.num_prims)+S[o-1].AL*S[o-1].NL;m<=p&&(p=m,d=o,_(a.vb_right,A),_(a.cb_right,O),_(a.vb_left,S[o-1].BL),_(a.cb_left,S[o-1].CL),a.num_left=S[o-1].NL)}a.best_split=d,a.best_cost=p}}var T=new Float32Array(3);return{bvh_subdivide:function(t,e,r,n,s,i,a,o){v(T,0,i,0);var u=t.nodes,h=a?t.frags_per_leaf_node_transparent:t.frags_per_leaf_node,l=a?t.frags_per_inner_node_transparent:t.frags_per_inner_node,c=t.max_polys_per_node,f=0;T[1]>T[0]&&(f=1),T[2]>T[f]&&(f=2),u.setBox0(e,s);var d=0,p=0,s=n-r+1;if(t.finfo.hasPolygonCounts&&t.frags_per_inner_node)for(var m=s<=t.frags_per_inner_node?n:r+t.frags_per_inner_node-1,g=r;g<=m&&(p++,!(c<(d+=t.finfo.getPolygonCount(t.primitives[g]))));g++);if(s<=h&&d<c||1==s||15<o||T[f]<t.scene_epsilon)return u.setLeftChild(e,-1),u.setPrimStart(e,r),u.setPrimCount(e,n-r+1),void u.setFlags(e,0,0,a?1:0);l&&(f=function(t,e,r,n,s,i,a,o){var u=t.primitives,h=t.centroids,l=s-n+1;o<(l=l>t.frags_per_inner_node?t.frags_per_inner_node:l)&&(l=o),e.setPrimStart(r,n),e.setPrimCount(r,l),n+=l,x(i);for(var c=n;c<=s;c++)b(i,h,3*u[c]);return v(a,0,i,0),n=0,a[1]>a[0]&&(n=1),n=a[2]>a[n]?2:n}(t,u,e,r,n,i,T,p),r+=u.getPrimCount(e)),h=new k,C(t,r,n,f,i,T,h),h.num_bins<0?u.setPrimCount(e,u.getPrimCount(e)+n-r+1):(function(t,e,r,n){for(var s,i=t.primitives,a=t.sort_prims,o=0,u=0|e,h=0|n.best_split,l=e;l<=r;l++){var c=0|i[l];a[l]<h?i[u++]=c:a[o++]=c}for(s=0;s<o;s++)i[u+s]=a[s]}(t,r,n,h),s=u.nextNodes(2),l=.5*(h.vb_left[3+f]+h.vb_left[f]),i=.5*(h.vb_right[3+f]+h.vb_right[f]),u.setFlags(e,f,l<i?0:1,a?1:0),u.setLeftChild(e,s),t.recursion_stack.push([t,s+1,r+h.num_left,n,h.vb_right,h.cb_right,a,o+1]),t.recursion_stack.push([t,s,r,r+h.num_left-1,h.vb_left,h.cb_left,a,o+1]))},compute_boxes:function(t){var e=t.boxv_o,r=t.boxc_o,n=t.boxv_t,s=t.boxc_t;x(e),x(r),x(n),x(s);for(var i,a,o,u,h=t.centroids,l=t.finfo.boxes,c=t.finfo.boxStride,f=0,d=t.prim_count;f<d;f++){var p=t.primitives[f];o=l,u=c*p,(i=h)[a=3*p]=.5*(o[u]+o[u+3]),i[a+1]=.5*(o[u+1]+o[u+4]),i[a+2]=.5*(o[u+2]+o[u+5]),f>=t.first_transparent?(b(s,h,3*p),y(n,l,c*p)):(b(r,h,3*p),y(e,l,c*p))}v(T,0,t.boxv_o,0);var m=Math.max(T[0],T[1],T[2]);t.scene_epsilon=1e-5*m},box_area:function(t,e){var r=t[e+3]-t[e],n=t[e+4]-t[e+1],e=t[e+5]-t[e+2];return r<0||n<0||e<0?0:2*(r*n+n*e+e*r)}}}();function s(t,e){this.boxes=t.boxes,this.polygonCounts=t.polygonCounts,this.hasPolygonCounts=!!this.polygonCounts,this.materials=t.materials,this.materialDefs=e,this.count=t.length,this.boxStride=6,this.wantSort=!0}function i(t,e,r){this.finfo=r||new s(t,e),this.prim_count=this.finfo.getCount(),this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(n*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}s.prototype.getCount=function(){return this.count},s.prototype.isTransparent=function(t){return!(!this.materialDefs||!this.materialDefs[this.materials[t]])&&this.materialDefs[this.materials[t]].transparent},s.prototype.getPolygonCount=function(t){return this.polygonCounts[t]},i.prototype.sortPrimitives=function(t){var r=new Float32Array(this.work_buf),e=this.primitives,n=0,s=t;for(h=0,l=this.prim_count;h<l;h++){e[h]=h;var i=this.finfo.isTransparent(h);i&&n++,s?(r[h]=c.box_area(this.finfo.boxes,this.finfo.boxStride*h),i&&(r[h]=-r[h])):r[h]=i?-1:1}if(s)Array.prototype.sort.call(this.primitives,function(t,e){return r[e]-r[t]});else if(n&&n<this.prim_count){for(var a=new Int32Array(n),o=0,u=0,h=0,l=this.prim_count;h<l;h++)0<=r[h]?e[o++]=e[h]:a[u++]=e[h];e.set(a,this.prim_count-n)}this.first_transparent=this.prim_count-n},i.prototype.build=function(r){var t,e=r&&!!r.useSlimNodes,n=this;function s(t,e){r.hasOwnProperty(t)?n[t]=r[t]:n[t]=e}if(e?(s("frags_per_leaf_node",1),s("frags_per_inner_node",0),s("frags_per_leaf_node_transparent",1),s("frags_per_inner_node_transparent",0),s("max_polys_per_node",1/0)):(s("frags_per_leaf_node",0|256*(t=r.isWeakDevice?.5:1)),s("frags_per_inner_node",0|this.frags_per_leaf_node),s("frags_per_leaf_node_transparent",this.frags_per_leaf_node),s("frags_per_inner_node_transparent",0),s("max_polys_per_node",0|2e4*t)),this.nodes&&this.nodes.is_lean_node==e)this.nodes.nodeCount=0;else{for(var i=this.prim_count/this.frags_per_leaf_node,a=1;a<i;)a*=2;this.nodes=new u(a,!!r&&r.useSlimNodes)}this.sortPrimitives(this.finfo.wantSort),c.compute_boxes(this);var o,e=this.nodes.nextNodes(2);for(c.bvh_subdivide(this,e,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)o=this.recursion_stack.pop(),c.bvh_subdivide(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]);for(c.bvh_subdivide(this,e+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)o=this.recursion_stack.pop(),c.bvh_subdivide(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7])}},"./src/wgs/scene/DeriveTopology.js":function(t,e,r){"use strict";r.r(e),r.d(e,"MeshAccessor",function(){return o}),r.d(e,"createWireframe",function(){return m});var f=r("./src/wgs/scene/VertexEnumerator.js"),u=r("./src/wgs/scene/LmvVector3.js"),h=r("./src/wgs/scene/LmvBox3.js"),l=r("./extensions/CompGeom/point-list-3d.js");function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,s){var i=new Float32Array(3*Object(f.getVertexCount)(t));return Object(f.enumMeshVertices)(t,function(t,e,r,n){s&&s.expandByPoint(t),i[3*n]=t.x,i[3*n+1]=t.y,i[3*n+2]=t.z}),i}var s=new u.LmvVector3,i=new u.LmvVector3,a=new u.LmvVector3,d=new u.LmvVector3,p=new u.LmvVector3,o=function(){function o(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var n=t.boundingBox||r,r=new h.LmvBox3;n&&r.copy(n),this.geom=t,this.myVerts=c(t,n?null:r);var s=new l.UniquePointList3D(this.getV.bind(this),r,-1/65536);this.remap=new Array(Object(f.getVertexCount)(t));for(var i=0,a=0;i<this.myVerts.length;i+=3,a++)this.remap[a]=s.findOrAddPoint(this.myVerts[i],this.myVerts[i+1],this.myVerts[i+2],a);e&&function(t,e){for(var r=new u.LmvVector3,n=0;n<t.length;n+=3)r.x=t[n],r.y=t[n+1],r.z=t[n+2],r.applyMatrix4(e),t[n]=r.x,t[n+1]=r.y,t[n+2]=r.z}(this.myVerts,e)}var t,e,r;return t=o,(e=[{key:"getV",value:function(t,e){e.x=this.myVerts[3*t],e.y=this.myVerts[3*t+1],e.z=this.myVerts[3*t+2]}},{key:"getNormal",value:function(t,e,r,n){this.getV(t,s),this.getV(e,i),this.getV(r,a),i.sub(s),a.sub(s),i.cross(a),n.copy(i).normalize()}}])&&n(t.prototype,e),r&&n(t,r),o}();function m(t,e,r,u){if(!t.isLines&&!t.iblines){var n,h=new o(t,e,r),l={},c=[];for(n in Object(f.enumMeshTriangles)(t,function(t,e,r,n,s,i){a(n,s,i),a(s,i,n),a(i,n,s)}),l)for(var s in l[n])c.push(parseInt(n)),c.push(parseInt(s));1<c.length&&(t.iblines=new Uint16Array(c.length),t.iblines.set(c))}function a(t,e,r){var n,s,i=h.remap[t],a=h.remap[e],o=h.remap[r];i!==a&&i!==o&&a!==o&&(n=!1,a<i&&(s=i,i=a,a=s,n=!0),(o=l[i])?void 0===(s=o[a])?o[a]=n?-r-1:r:(u?(c.push(t),c.push(e)):(h.getNormal(t,e,r,d),s<0?h.getNormal(a,i,h.remap[-s-1],p):h.getNormal(i,a,h.remap[s],p),s=d.dot(p),Math.abs(s)<.25&&(c.push(t),c.push(e))),delete o[a]):(l[i]={},l[i][a]=r))}}},"./src/wgs/scene/InstanceTreeStorage.js":function(t,e,r){"use strict";r.r(e),r.d(e,"FlatStringStorage",function(){return n}),r.d(e,"InstanceTreeStorage",function(){return a}),r.d(e,"InstanceTreeAccess",function(){return u});var s=r("./src/file-loaders/lmvtk/common/StringUtils.js");function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var n=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t?(this.buf=t.buf,this.idx=t.idx,this.next=t.next):(this.buf=new Uint8Array(256),this.next=0,this.idx=[0])}var t,r,n;return t=e,(r=[{key:"allocate",value:function(t){this.buf.length-this.next<t&&(t=Math.max(3*this.buf.length/2,this.buf.length+t),(t=new Uint8Array(t)).set(this.buf),this.buf=t)}},{key:"add",value:function(t){if(null==t)return 0;if(!t.length)return this.idx.push(this.next),this.idx.length-1;var e=Object(s.utf16to8)(t,null);return this.allocate(e),this.next+=Object(s.utf16to8)(t,this.buf,this.next),this.idx.push(this.next),this.idx.length-1}},{key:"get",value:function(t){if(t){var e=this.idx[t-1],t=this.idx[t];return e===t?"":Object(s.utf8BlobToStr)(this.buf,e,t-e)}}},{key:"flatten",value:function(){this.idx=o(this.idx)}}])&&i(t.prototype,r),n&&i(t,n),e}(),l=5;function a(t,e){this.nodes=[],this.nextNode=0,this.children=[],this.nextChild=0,this.dbIdToIndex={},this.names=[],this.s2i={},this.strings=new n,this.nameSuffixes=[],this.getIndex(0)}function o(t){var e=new Int32Array(t.length);return e.set(t),e}function u(t,e,r){this.nodes=t.nodes,this.children=t.children,this.dbIdToIndex=t.dbIdToIndex,this.names=t.names,this.nameSuffixes=t.nameSuffixes,this.strings=new n(t.strings),this.rootId=e,this.numNodes=this.nodes.length/l,this.visibleIds=null,this.nodeBoxes=r}a.prototype.getIndex=function(t){var e=this.dbIdToIndex[t];if(e)return e;e=this.nextNode++,this.nodes.push(t);for(var r=1;r<l;r++)this.nodes.push(0);return this.dbIdToIndex[t]=e},a.prototype.setNode=function(t,e,r,n,s,i){var a,o=this.getIndex(t),u=o*l,h=s.length,t=i&&i.length;for(t&&(h+=i.length),this.nodes[1+u]=e,this.nodes[2+u]=this.nextChild,this.nodes[3+u]=t?-h:h,this.nodes[4+u]=n,a=0;a<s.length;a++)this.children[this.nextChild++]=this.getIndex(s[a]);if(t)for(a=0;a<i.length;a++)this.children[this.nextChild++]=-i[a]-1;this.nextChild>this.children.length&&console.error("Child index out of bounds -- should not happen"),this.processName(o,r)},a.prototype.processName=function(t,e){var r,n,s=-1,i=-1;e&&(i=e.lastIndexOf("]"),-1!==(s=e.lastIndexOf("["))&&-1!==i||(s=e.lastIndexOf(":"),i=e.length)),0<=s&&s<i?(r=e.slice(0,s+1),i=e.slice(s+1,i),(n=parseInt(i,10))&&n+""===i||(r=e,n=0)):(r=e,n=0);e=this.s2i[r];void 0===e&&(e=this.strings.add(r),this.s2i[r]=e),this.names[t]=e,this.nameSuffixes[t]=n},a.prototype.flatten=function(t,e,r,n,s,i){this.nodes=o(this.nodes),this.children=o(this.children),this.names=o(this.names),this.nameSuffixes=o(this.nameSuffixes),this.strings.flatten(),this.s2i=null},u.prototype.getNumNodes=function(){return this.numNodes},u.prototype.getIndex=function(t){return this.dbIdToIndex[t]},u.prototype.name=function(t,e){var r=this.dbIdToIndex[t],n=this.strings.get(this.names[r]),r=this.nameSuffixes[r];return n=r?"["===n.charAt(n.length-1)?n+r+"]":n+r:n,e&&(this.childCounts||this.computeChildCounts(),0<this.childCounts[t]&&(n+=" ("+this.childCounts[t]+")")),n},u.prototype.getParentId=function(t){t=this.dbIdToIndex[t];return this.nodes[t*l+1]},u.prototype.getNodeFlags=function(t){t=this.dbIdToIndex[t];return this.nodes[t*l+4]},u.prototype.setNodeFlags=function(t,e){t=this.dbIdToIndex[t];t&&(this.nodes[t*l+4]=e)},u.prototype.getNumChildren=function(t){t=this.dbIdToIndex[t];if(0<=(r=this.nodes[t*l+3]))return r;for(var e=this.nodes[t*l+2],r=Math.abs(r),n=0,s=0;s<r;s++){if(this.children[e+s]<0)break;n++}return n},u.prototype.getNumFragments=function(t){var e=this.dbIdToIndex[t],t=this.nodes[e*l+3];if(0<=t)return 0;for(var r=this.nodes[e*l+2],n=0,s=(t=Math.abs(t))-1;0<=s;s--){if(0<=this.children[r+s])break;n++}return n},u.prototype.getNodeBox=function(t,e){for(var r=6*this.getIndex(t),n=0;n<6;n++)e[n]=this.nodeBoxes[r+n]},u.prototype.getVisibleIds=function(){return this.visibleIds||(this.visibleIds=Object.keys(this.dbIdToIndex).map(function(t){return parseInt(t)})),this.visibleIds},u.prototype.enumNodeChildren=function(t,e){for(var r=this.dbIdToIndex[t],n=this.nodes[r*l+2],s=this.nodes[r*l+3],s=Math.abs(s),i=0;i<s;i++){var a=this.children[n+i];if(a<0)break;if(e(this.nodes[a*l+0],t,r))return t}},u.prototype.enumNodeFragments=function(t,e){var r=this.dbIdToIndex[t],n=this.nodes[r*l+2];if((s=this.nodes[r*l+3])<0)for(var s=-s,i=0;i<s;i++){var a=this.children[n+i];if(!(0<a)&&e(-a-1,t,r))return t}},u.prototype.computeBoxes=function(a){this.nodeBoxes||(this.nodeBoxes=new Float32Array(6*this.numNodes));var o=this,t=o.getIndex(o.rootId),u=o.nodeBoxes;function r(t,e,r){var n=o.getIndex(t);h(t,n);for(var s=6*r,i=6*n,a=0;a<3;a++)u[s+a]>u[i+a]&&(u[s+a]=u[i+a]),u[s+a+3]<u[i+a+3]&&(u[s+a+3]=u[i+a+3])}function n(t,e,r){for(var n=6*t,s=6*r,i=0;i<3;i++)u[s+i]>a[n+i]&&(u[s+i]=a[n+i]),u[s+i+3]<a[n+i+3]&&(u[s+i+3]=a[n+i+3])}function h(t,e){e*=6;u[e]=u[1+e]=u[2+e]=1/0,u[3+e]=u[4+e]=u[5+e]=-1/0,o.getNumChildren(t)&&o.enumNodeChildren(t,r,!0),o.getNumFragments(t)&&o.enumNodeFragments(t,n)}h(o.rootId,t)},u.prototype.computeChildCounts=function(){this.childCounts||(this.childCounts=new Uint32Array(this.numNodes));var n=this,s=(n.getIndex(n.rootId),n.childCounts);function r(t,e,r){t=i(t,n.getIndex(t));s[e]+=t}function i(t){var e=0;return 4===n.getNodeFlags(t)?e=1:(n.getNumChildren(t)&&n.enumNodeChildren(t,r,!0),n.getNumFragments(t)&&(e=1)),e+s[t]}i(n.rootId)}},"./src/wgs/scene/LmvBox3.js":function(t,e,r){"use strict";r.r(e),r.d(e,"LmvBox3",function(){return o});var n,s,i,a=r("./src/wgs/scene/LmvVector3.js"),o=function(t,e){this.min=void 0!==t?t:new a.LmvVector3(1/0,1/0,1/0),this.max=void 0!==e?e:new a.LmvVector3(-1/0,-1/0,-1/0)};o.prototype={constructor:o,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromArray:function(t,e){return this.min.x=t[e],this.min.y=t[e+1],this.min.z=t[e+2],this.max.x=t[e+3],this.max.y=t[e+4],this.max.z=t[e+5],this},copyToArray:function(t,e){t[e]=this.min.x,t[e+1]=this.min.y,t[e+2]=this.min.z,t[e+3]=this.max.x,t[e+4]=this.max.y,t[e+5]=this.max.z},setFromCenterAndSize:(i=new a.LmvVector3,function(t,e){e=i.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new a.LmvVector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new a.LmvVector3).subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return(e||new a.LmvVector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},clampPoint:function(t,e){return(e||new a.LmvVector3).copy(t).clamp(this.min,this.max)},distanceToPoint:(s=new a.LmvVector3,function(t){return s.copy(t).clamp(this.min,this.max).sub(t).length()}),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:(n=[new a.LmvVector3,new a.LmvVector3,new a.LmvVector3,new a.LmvVector3,new a.LmvVector3,new a.LmvVector3,new a.LmvVector3,new a.LmvVector3],function(t){return n[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),n[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),n[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),n[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),n[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),n[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),n[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),n[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(n),this}),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}},"./src/wgs/scene/LmvMatrix4.js":function(t,e,r){"use strict";r.r(e),r.d(e,"LmvMatrix4",function(){return n});var u,h,r=r("./src/wgs/scene/LmvVector3.js"),n=function(t){this.elements=new(t?Float64Array:Float32Array)([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.isDoublePrecision=!!t};n.prototype={constructor:n,set:function(t,e,r,n,s,i,a,o,u,h,l,c,f,d,p,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=s,g[5]=i,g[9]=a,g[13]=o,g[2]=u,g[6]=h,g[10]=l,g[14]=c,g[3]=f,g[7]=d,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){return this.elements.set(t.elements),this},makeRotationFromQuaternion:function(t){var e=this.elements,r=t.x,n=t.y,s=t.z,i=t.w,a=r+r,o=n+n,u=s+s,h=r*a,l=r*o,t=r*u,r=n*o,n=n*u,s=s*u,a=i*a,o=i*o,u=i*u;return e[0]=1-(r+s),e[4]=l-u,e[8]=t+o,e[1]=l+u,e[5]=1-(h+s),e[9]=n-a,e[2]=t-o,e[6]=n+a,e[10]=1-(h+r),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},multiply:function(t){return this.multiplyMatrices(this,t)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,s=this.elements,i=r[0],a=r[4],o=r[8],u=r[12],h=r[1],l=r[5],c=r[9],f=r[13],d=r[2],p=r[6],m=r[10],g=r[14],b=r[3],y=r[7],v=r[11],_=r[15],x=n[0],w=n[4],k=n[8],I=n[12],S=n[1],A=n[5],O=n[9],C=n[13],T=n[2],E=n[6],j=n[10],z=n[14],t=n[3],e=n[7],r=n[11],n=n[15];return s[0]=i*x+a*S+o*T+u*t,s[4]=i*w+a*A+o*E+u*e,s[8]=i*k+a*O+o*j+u*r,s[12]=i*I+a*C+o*z+u*n,s[1]=h*x+l*S+c*T+f*t,s[5]=h*w+l*A+c*E+f*e,s[9]=h*k+l*O+c*j+f*r,s[13]=h*I+l*C+c*z+f*n,s[2]=d*x+p*S+m*T+g*t,s[6]=d*w+p*A+m*E+g*e,s[10]=d*k+p*O+m*j+g*r,s[14]=d*I+p*C+m*z+g*n,s[3]=b*x+y*S+v*T+_*t,s[7]=b*w+y*A+v*E+_*e,s[11]=b*k+y*O+v*j+_*r,s[15]=b*I+y*C+v*z+_*n,this},multiplyToArray:function(t,e,r){var n=this.elements;return this.multiplyMatrices(t,e),r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],s=t[12],i=t[1],a=t[5],o=t[9],u=t[13],h=t[2],l=t[6],c=t[10],f=t[14];return t[3]*(+s*o*l-n*u*l-s*a*c+r*u*c+n*a*f-r*o*f)+t[7]*(+e*o*f-e*u*c+s*i*c-n*i*f+n*u*h-s*o*h)+t[11]*(+e*u*l-e*a*f-s*i*l+r*i*f+s*a*h-r*u*h)+t[15]*(-n*a*h-e*o*l+e*a*c+n*i*l-r*i*c+r*o*h)},transpose:function(){var t=this.elements,e=t[1];return t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArrayOffset:function(t,e){var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var r=this.elements,n=t.elements,s=n[0],i=n[4],a=n[8],o=n[12],u=n[1],h=n[5],l=n[9],c=n[13],f=n[2],d=n[6],p=n[10],m=n[14],g=n[3],b=n[7],t=n[11],n=n[15];r[0]=l*m*b-c*p*b+c*d*t-h*m*t-l*d*n+h*p*n,r[4]=o*p*b-a*m*b-o*d*t+i*m*t+a*d*n-i*p*n,r[8]=a*c*b-o*l*b+o*h*t-i*c*t-a*h*n+i*l*n,r[12]=o*l*d-a*c*d-o*h*p+i*c*p+a*h*m-i*l*m,r[1]=c*p*g-l*m*g-c*f*t+u*m*t+l*f*n-u*p*n,r[5]=a*m*g-o*p*g+o*f*t-s*m*t-a*f*n+s*p*n,r[9]=o*l*g-a*c*g-o*u*t+s*c*t+a*u*n-s*l*n,r[13]=a*c*f-o*l*f+o*u*p-s*c*p-a*u*m+s*l*m,r[2]=h*m*g-c*d*g+c*f*b-u*m*b-h*f*n+u*d*n,r[6]=o*d*g-i*m*g-o*f*b+s*m*b+i*f*n-s*d*n,r[10]=i*c*g-o*h*g+o*u*b-s*c*b-i*u*n+s*h*n,r[14]=o*h*f-i*c*f-o*u*d+s*c*d+i*u*m-s*h*m,r[3]=l*d*g-h*p*g-l*f*b+u*p*b+h*f*t-u*d*t,r[7]=i*p*g-a*d*g+a*f*b-s*p*b-i*f*t+s*d*t,r[11]=a*h*g-i*l*g-a*u*b+s*l*b+i*u*t-s*h*t,r[15]=i*l*f-a*h*f+a*u*d-s*l*d-i*u*p+s*h*p;r=s*r[0]+u*r[4]+f*r[8]+g*r[12];if(0!=r)return this.multiplyScalar(1/r),this;r="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(r);return console.warn(r),this.identity(),this},scale:function(t){var e=this.elements,r=t.x,n=t.y,t=t.z;return e[0]*=r,e[4]*=n,e[8]*=t,e[1]*=r,e[5]*=n,e[9]*=t,e[2]*=r,e[6]*=n,e[10]*=t,e[3]*=r,e[7]*=n,e[11]*=t,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],t=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(r,t)))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(1,0,0,0,0,e,-t,0,0,t,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,0,t,0,0,1,0,0,-t,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),t=Math.sin(t);return this.set(e,-t,0,0,t,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),s=1-r,i=t.x,a=t.y,o=t.z,e=s*i,t=s*a;return this.set(e*i+r,e*a-n*o,e*o+n*a,0,e*a+n*o,t*a+r,t*o-n*i,0,e*o-n*a,t*o+n*i,s*o*o+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},compose:function(t,e,r){return this.makeRotationFromQuaternion(e),this.scale(r),this.setPosition(t),this},decompose:(u=new r.LmvVector3,h=new n(!0),function(t,e,r){var n=this.elements,s=u.set(n[0],n[1],n[2]).length(),i=u.set(n[4],n[5],n[6]).length(),a=u.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],h.elements.set(this.elements);var o=1/s,t=1/i,n=1/a;return h.elements[0]*=o,h.elements[1]*=o,h.elements[2]*=o,h.elements[4]*=t,h.elements[5]*=t,h.elements[6]*=t,h.elements[8]*=n,h.elements[9]*=n,h.elements[10]*=n,e.setFromRotationMatrix(h),r.x=s,r.y=i,r.z=a,this}),transformPoint:function(t){var e=t.x,r=t.y,n=t.z,s=this.elements;return t.x=s[0]*e+s[4]*r+s[8]*n+s[12],t.y=s[1]*e+s[5]*r+s[9]*n+s[13],t.z=s[2]*e+s[6]*r+s[10]*n+s[14],t},transformDirection:function(t){var e=t.x,r=t.y,n=t.z,s=this.elements;t.x=s[0]*e+s[4]*r+s[8]*n,t.y=s[1]*e+s[5]*r+s[9]*n,t.z=s[2]*e+s[6]*r+s[10]*n;n=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0<n&&(t.x*=n=1/n,t.y*=n,t.z*=n),t},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t){return this.elements.set(t),this},toArray:function(){var t=this.elements;return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]},clone:function(){return new n(this.isDoublePrecision).fromArray(this.elements)}}},"./src/wgs/scene/LmvVector3.js":function(t,e,r){"use strict";r.r(e),r.d(e,"LmvVector3",function(){return h});var n,s,i,a,o,u,h=function(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0};h.prototype={constructor:h,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,t=t.elements;return this.x=t[0]*e+t[3]*r+t[6]*n,this.y=t[1]*e+t[4]*r+t[7]*n,this.z=t[2]*e+t[5]*r+t[8]*n,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,t=t.elements;return this.x=t[0]*e+t[4]*r+t[8]*n+t[12],this.y=t[1]*e+t[5]*r+t[9]*n+t[13],this.z=t[2]*e+t[6]*r+t[10]*n+t[14],this},applyProjection:function(t){var e=this.x,r=this.y,n=this.z,s=t.elements,t=1/(s[3]*e+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*r+s[8]*n+s[12])*t,this.y=(s[1]*e+s[5]*r+s[9]*n+s[13])*t,this.z=(s[2]*e+s[6]*r+s[10]*n+s[14])*t,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,s=t.x,i=t.y,a=t.z,o=t.w,u=o*e+i*n-a*r,h=o*r+a*e-s*n,t=o*n+s*r-i*e,n=-s*e-i*r-a*n;return this.x=u*o+n*-s+h*-a-t*-i,this.y=h*o+n*-i+t*-s-u*-a,this.z=t*o+n*-a+u*-i-h*-s,this},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,t=t.elements;return this.x=t[0]*e+t[4]*r+t[8]*n,this.y=t[1]*e+t[5]*r+t[9]*n,this.z=t[2]*e+t[6]*r+t[10]*n,this.normalize(),this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return 0!==t?(this.x*=t=1/t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},min:function(t){return this.x>t.x&&(this.x=t.x),this.y>t.y&&(this.y=t.y),this.z>t.z&&(this.z=t.z),this},max:function(t){return this.x<t.x&&(this.x=t.x),this.y<t.y&&(this.y=t.y),this.z<t.z&&(this.z=t.z),this},clamp:function(t,e){return this.x<t.x?this.x=t.x:this.x>e.x&&(this.x=e.x),this.y<t.y?this.y=t.y:this.y>e.y&&(this.y=e.y),this.z<t.z?this.z=t.z:this.z>e.z&&(this.z=e.z),this},clampScalar:function(t,e){return void 0===o&&(o=new h,u=new h),o.set(t,t,t),u.set(e,e,e),this.clamp(o,u)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){var e=this.length();return 0!==e&&t!==e&&this.multiplyScalar(t/e),this},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.subVectors(e,t).multiplyScalar(r).add(t),this},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var r=this.x,n=this.y,e=this.z;return this.x=n*t.z-e*t.y,this.y=e*t.x-r*t.z,this.z=r*t.y-n*t.x,this},crossVectors:function(t,e){var r=t.x,n=t.y,s=t.z,i=e.x,t=e.y,e=e.z;return this.x=n*e-s*t,this.y=s*i-r*e,this.z=r*t-n*i,this},projectOnVector:function(t){return(i=void 0===i?new h:i).copy(t).normalize(),a=this.dot(i),this.copy(i).multiplyScalar(a)},projectOnPlane:function(t){return(s=void 0===s?new h:s).copy(this).projectOnVector(t),this.sub(s)},reflect:function(t){return void 0===n&&(n=new h),this.sub(n.copy(t).multiplyScalar(2*this.dot(t)))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,t=this.z-t.z;return e*e+r*r+t*t},setEulerFromRotationMatrix:function(t,e){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(t,e){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},setFromMatrixPosition:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setFromMatrixScale:function(t){var e=this.set(t.elements[0],t.elements[1],t.elements[2]).length(),r=this.set(t.elements[4],t.elements[5],t.elements[6]).length(),t=this.set(t.elements[8],t.elements[9],t.elements[10]).length();return this.x=e,this.y=r,this.z=t,this},setFromMatrixColumn:function(t,e){t*=4,e=e.elements;return this.x=e[t],this.y=e[1+t],this.z=e[2+t],this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return this.x=t[e=void 0===e?0:e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return(t=void 0===t?[]:t)[e=void 0===e?0:e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromAttribute:function(t,e,r){return e=e*t.itemSize+(r=void 0===r?0:r),this.x=t.array[e],this.y=t.array[e+1],this.z=t.array[e+2],this}}},"./src/wgs/scene/MeshFlags.js":function(t,e,r){"use strict";r.r(e),r.d(e,"MeshFlags",function(){return n});var n={MESH_VISIBLE:1,MESH_HIGHLIGHTED:2,MESH_HIDE:4,MESH_ISLINE:8,MESH_MOVED:16,MESH_RENDERFLAG:32,MESH_NOTLOADED:64,MESH_ISPOINT:128,MESH_ISWIDELINE:256,MESH_TRAVERSED:512,MESH_DRAWN:1024}},"./src/wgs/scene/VertexEnumerator.js":function(t,e,r){"use strict";r.r(e),r.d(e,"getVertexCount",function(){return L}),r.d(e,"getIndicesCount",function(){return n}),r.d(e,"enumMeshVertices",function(){return s}),r.d(e,"enumMeshIndices",function(){return i}),r.d(e,"enumMeshTriangles",function(){return a}),r.d(e,"enumMeshLines",function(){return o}),r.d(e,"enumMeshEdges",function(){return u}),r.d(e,"VertexEnumerator",function(){return h});var d,p,m,C,T,E,j,z,P,y,v,M=r("./src/wgs/scene/LmvVector3.js");function L(t){return t.vb?t.vb.length/t.vbstride:t.attributes.position?t.attributes.position.array.length/3:0}function n(t){var e=t.attributes,e=t.ib||t.indices||(e.index?e.index.array:null);if(e){var r=t.offsets;if(!r||0===r.length)return e.length;for(var n=0,s=0,i=r.length;s<i;++s)n+=r[s].count;return n}return L(t)}function s(t,e,r){var n=t.attributes;d||(d=new M.LmvVector3,p=new M.LmvVector3,new M.LmvVector3),r&&(m=m||new THREE.Matrix3).getNormalMatrix(r);var s,i=t.vb||n.position.array,a=t.vb||n.normal&&n.normal.array,o=t.vb?t.vbstride:3;if(t.vblayout){if(!t.vblayout.position)return;s=t.vblayout.position.offset}else{if(!n.position)return;s=n.position.itemOffset||0}var u=0,n=t.vblayout?t.vblayout.normal:n.normal||null;n?u=n.offset||n.itemOffset||0:a=null,!n||n.array||3===n.itemSize&&4===n.bytesPerItem||(a=null);for(var h=L(t),l=s,c=u,f=0;f<h;f++,l+=o,c+=o)d.set(i[l],i[l+1],i[l+2]),r&&d.applyMatrix4(r),a&&(p.set(a[c],a[c+1],a[c+2]),r&&p.applyMatrix3(m)),e(d,a?p:null,null,f)}function i(t,e){var r=t.ib||t.indices||(attributes.index?attributes.index.array:null);if(r)for(var n=t.offsets,s=0,i=(n=!n||0===n.length?[{start:0,count:r.length,index:0}]:n).length;s<i;++s)for(var a=n[s].start,o=n[s].count,u=n[s].index,h=a,l=a+o;h<l;h+=3)e(u+r[h],u+r[h+1],u+r[h+2]);else for(var c=L(t),f=0;f<c;f++)e(3*f,3*f+1,3*f+2)}function a(t,e){var r=t.attributes;C||(C=new M.LmvVector3,T=new M.LmvVector3,E=new M.LmvVector3,j=new M.LmvVector3,z=new M.LmvVector3,P=new M.LmvVector3);var n,s=t.vb||r.position.array,i=t.vb||r.normal&&r.normal.array,a=t.vb?t.vbstride:3;if(t.vblayout){if(!t.vblayout.position)return;n=t.vblayout.position.offset}else{if(!r.position)return;n=r.position.itemOffset||0}var o=0,u=t.vblayout?t.vblayout.normal:r.normal||null;u?o=u.offset||u.itemOffset||0:i=null,!u||u.array||3===u.itemSize&&4===u.bytesPerItem||(i=null);var h=t.ib||t.indices||(r.index?r.index.array:null);if(h)for(var l=t.offsets,c=0,f=(l=!l||0===l.length?[{start:0,count:h.length,index:0}]:l).length;c<f;++c)for(var d=l[c].start,p=l[c].count,m=l[c].index,g=d,b=d+p;g<b;g+=3){var y,v,_=m+h[g],x=(y=m+h[g+1])*a+n,w=(v=m+h[g+2])*a+n;C.x=s[I=_*a+n],C.y=s[I+1],C.z=s[I+2],T.x=s[x],T.y=s[x+1],T.z=s[x+2],E.x=s[w],E.y=s[w+1],E.z=s[w+2],i?(A=y*a+o,O=v*a+o,j.x=i[S=_*a+o],j.y=i[S+1],j.z=i[S+2],z.x=i[A],z.y=i[A+1],z.z=i[A+2],P.x=i[O],P.y=i[O+1],P.z=i[O+2],e(C,T,E,_,y,v,j,z,P,g/3)):e(C,T,E,_,y,v,null,null,null,g/3)}else for(var k=L(t),g=0;g<k;g+=3){var I,S,A,O,x=(y=(_=g)+1)*a+n,w=(v=g+2)*a+n;C.x=s[I=_*a+n],C.y=s[I+1],C.z=s[I+2],T.x=s[x],T.y=s[x+1],T.z=s[x+2],E.x=s[w],E.y=s[w+1],E.z=s[w+2],i?(A=y*a+o,O=v*a+o,j.x=i[S=_*a+o],j.y=i[S+1],j.z=i[S+2],z.x=i[A],z.y=i[A+1],z.z=i[A+2],P.x=i[O],P.y=i[O+1],P.z=i[O+2],e(C,T,E,_,y,v,j,z,P,g/3)):e(C,T,E,_,y,v,null,null,null,g/3)}}function o(t,e){var r,n,s=t.attributes;y||(y=new M.LmvVector3,v=new M.LmvVector3);var i=2;t.lineWidth&&(i=6);var a=t.ib||t.indices||(s.index?s.index.array:null);if(a)for(var o=t.vb||s.position.array,u=t.vb?t.vbstride:3,h=t.offsets,l=0,c=(h=!h||0===h.length?[{start:0,count:a.length,index:0}]:h).length;l<c;++l)for(var f=h[l].start,d=h[l].count,p=h[l].index,m=f,g=f+d,b=f/i;m<g;m+=i,b++)r=p+a[m],n=p+a[m+1],y.x=o[r*u],y.y=o[r*u+1],y.z=o[r*u+2],v.x=o[n*u],v.y=o[n*u+1],v.z=o[n*u+2],e(y,v,r,n,b);else for(o=t.vb||s.position.array,u=t.vb?t.vbstride:3,m=0,g=o.length/u,b=0;m<g;m+=i,b++)n=(r=m)+1,y.x=o[r*u],y.y=o[r*u+1],y.z=o[r*u+2],v.x=o[n*u],v.y=o[n*u+1],v.z=o[n*u+2],e(y,v,r,n,b)}function u(t,e){var r,n,s=t.attributes;y||(y=new M.LmvVector3,v=new M.LmvVector3);var i=t.iblines;if(i)for(var a=t.vb||s.position.array,o=t.vb?t.vbstride:3,u=t.offsets,h=0,l=(u=!u||0===u.length?[{start:0,count:i.length,index:0}]:u).length;h<l;++h)for(var c=u[h].start,f=u[h].count,d=u[h].index,p=c,m=c+f;p<m;p+=2)r=d+i[p],n=d+i[p+1],y.x=a[r*o],y.y=a[r*o+1],y.z=a[r*o+2],v.x=a[n*o],v.y=a[n*o+1],v.z=a[n*o+2],e(y,v,r,n)}var h={getVertexCount:L,enumMeshVertices:s,enumMeshIndices:i,enumMeshTriangles:a,enumMeshLines:o,enumMeshEdges:u}},"./src/wgs/scene/consolidation/GeomMergeTask.js":function(t,e,r){"use strict";r.r(e),r.d(e,"GeomMergeTask",function(){return s}),r.d(e,"writeIdToBuffer",function(){return b});var n=1;function s(){this.vb=null,this.vbstride=0,this.posOffset=0,this.normalOffset=0,this.matrices=null,this.ranges=null,this.dbIds=null,this.id=n++}function b(t,e,r){e[r++]=255&t,e[r++]=t>>8&255,e[r++]=t>>16&255,e[r]=0}function y(t,e,r,n,s,i,a){for(var o,u,h,l,c,f,d=t.posOffset,p=n;p<s;p++){var m=p*t.vbstride+d;a.set(t.vb[m],t.vb[m+1],t.vb[m+2]),a.applyMatrix4(r),t.vb[m]=a.x,t.vb[m+1]=a.y,t.vb[m+2]=a.z}if(-1!==t.normalOffset)for(var g=2*t.vbstride,b=2*t.normalOffset,y=(f=r,(i=i).copy(f),i[12]=0,i[13]=0,i[14]=0,i.getInverse(i).transpose()),p=n;p<s;p++){var v=p*g+b;a.set(e[v],e[1+v],0),a.divideScalar(65535),h=u=c=l=h=u=void 0,u=2*(o=a).x-1,h=2*o.y-1,l=Math.sin(u*Math.PI),c=Math.cos(u*Math.PI),u=Math.sqrt(1-h*h),o.x=c*u,o.y=l*u,o.z=h,a.applyMatrix4(y),a.normalize(),(h=a).x=.5*(1+Math.atan2(h.y,h.x)/Math.PI),h.y=.5*(1+h.z),h.z=0,a.multiplyScalar(65535),e[v]=a.x,e[1+v]=a.y}}s.prototype.run=function(t,e){for(var r=this.vb,n=r.length/this.vbstride,s=t.clone(),i=new Uint8Array(3*n),a=-1!==this.normalOffset?new Uint16Array(r.buffer,r.byteOffset,2*r.length):null,o=this.ranges,u=this.matrices,h=o.length-1,l=0;l<h;l++){var c=o[l],f=o[l+1];!function(t,e,r){for(var n=16*t,s=0;s<16;s++)r.elements[s]=e[s+n]}(l,u,t),y(this,a,t,c,f,s,e);for(var d=3*c,p=f-c,m=this.dbIds[l],g=0;g<p;g++)b(m,i,d),d+=3}return{taskId:this.id,vb:this.vb,vertexIds:i}}},"./thirdparty/zlib/unzip.min.js":function(t,e){!function(){"use strict";function p(t){throw t}var m=void 0,i=this;function t(t,e){var r,n=t.split("."),s=i;n[0]in s||!s.execScript||s.execScript("var "+n[0]);for(;n.length&&(r=n.shift());)n.length||e===m?s=s[r]||(s[r]={}):s[r]=e}var e,g="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;for(new(g?Uint8Array:Array)(256),e=0;e<256;++e)for(var r=(r=e)>>>1;r;r>>>=1)0;var n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],b=g?new Uint32Array(n):n;function l(t){for(var e,r,n,s,i,a,o,u,h=t.length,l=0,c=Number.POSITIVE_INFINITY,f=0;f<h;++f)t[f]>l&&(l=t[f]),t[f]<c&&(c=t[f]);for(e=1<<l,r=new(g?Uint32Array:Array)(e),n=1,s=0,i=2;n<=l;){for(f=0;f<h;++f)if(t[f]===n){for(o=s,u=a=0;u<n;++u)a=a<<1|1&o,o>>=1;for(u=a;u<e;u+=i)r[u]=n<<16|f;++s}++n,s<<=1,i<<=1}return[r,l,c]}for(var s=[],a=0;a<288;a++)switch(!0){case a<=143:s.push([a+48,8]);break;case a<=255:s.push([a-144+400,9]);break;case a<=279:s.push([a-256,7]);break;case a<=287:s.push([a-280+192,8]);break;default:p("invalid literal: "+a)}var n=function(){for(var t,e=[],r=3;r<=258;r++)t=function(t){switch(!0){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case t<=12:return[265,t-11,1];case t<=14:return[266,t-13,1];case t<=16:return[267,t-15,1];case t<=18:return[268,t-17,1];case t<=22:return[269,t-19,2];case t<=26:return[270,t-23,2];case t<=30:return[271,t-27,2];case t<=34:return[272,t-31,2];case t<=42:return[273,t-35,3];case t<=50:return[274,t-43,3];case t<=58:return[275,t-51,3];case t<=66:return[276,t-59,3];case t<=82:return[277,t-67,4];case t<=98:return[278,t-83,4];case t<=114:return[279,t-99,4];case t<=130:return[280,t-115,4];case t<=162:return[281,t-131,5];case t<=194:return[282,t-163,5];case t<=226:return[283,t-195,5];case t<=257:return[284,t-227,5];case 258===t:return[285,t-258,0];default:p("invalid length: "+t)}}(r),e[r]=t[2]<<24|t[1]<<16|t[0];return e}();function y(t,e){switch(this.l=[],this.m=32768,this.d=this.f=this.c=this.t=0,this.input=g?new Uint8Array(t):t,this.u=!1,this.n=f,this.K=!1,e?(e.index&&(this.c=e.index),e.bufferSize&&(this.m=e.bufferSize),e.bufferType&&(this.n=e.bufferType),e.resize&&(this.K=e.resize)):e={},this.n){case c:this.a=32768,this.b=new(g?Uint8Array:Array)(32768+this.m+258);break;case f:this.a=0,this.b=new(g?Uint8Array:Array)(this.m),this.e=this.W,this.B=this.R,this.q=this.V;break;default:p(Error("invalid inflate mode"))}}g&&new Uint32Array(n);var c=0,f=1;y.prototype.r=function(){for(;!this.u;){var t=C(this,3);switch(1&t&&(this.u=!0),t>>>=1){case 0:var e,r,n=this.input,s=this.c,i=this.b,a=this.a,o=m,u=i.length,h=m;switch(this.d=this.f=0,(e=n[s++])===m&&p(Error("invalid uncompressed block header: LEN (first byte)")),o=e,(e=n[s++])===m&&p(Error("invalid uncompressed block header: LEN (second byte)")),o|=e<<8,(e=n[s++])===m&&p(Error("invalid uncompressed block header: NLEN (first byte)")),r=e,(e=n[s++])===m&&p(Error("invalid uncompressed block header: NLEN (second byte)")),o===~(r|=e<<8)&&p(Error("invalid uncompressed block header: length verify")),s+o>n.length&&p(Error("input buffer is broken")),this.n){case c:for(;a+o>i.length;){if(o-=h=u-a,g)i.set(n.subarray(s,s+h),a),a+=h,s+=h;else for(;h--;)i[a++]=n[s++];this.a=a,i=this.e(),a=this.a}break;case f:for(;a+o>i.length;)i=this.e({H:2});break;default:p(Error("invalid inflate mode"))}if(g)i.set(n.subarray(s,s+o),a),a+=o,s+=o;else for(;o--;)i[a++]=n[s++];this.c=s,this.a=a,this.b=i;break;case 1:this.q(k,O);break;case 2:!function(t){function e(t,e,r){for(var n,s,i,a=0;a<t;)switch(n=T(this,e),n){case 16:for(i=3+C(this,2);i--;)r[a++]=s;break;case 17:for(i=3+C(this,3);i--;)r[a++]=0;s=0;break;case 18:for(i=11+C(this,7);i--;)r[a++]=0;s=0;break;default:s=r[a++]=n}return r}var r,n,s,i,a=C(t,5)+257,o=C(t,5)+1,u=C(t,4)+4,h=new(g?Uint8Array:Array)(d.length);for(i=0;i<u;++i)h[d[i]]=C(t,3);r=l(h),n=new(g?Uint8Array:Array)(a),s=new(g?Uint8Array:Array)(o),t.q(l(e.call(t,a,r,n)),l(e.call(t,o,r,s)))}(this);break;default:p(Error("unknown BTYPE: "+t))}}return this.B()};for(var n=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=g?new Uint16Array(n):n,n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],h=g?new Uint16Array(n):n,n=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=g?new Uint8Array(n):n,n=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],_=g?new Uint16Array(n):n,n=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],x=g?new Uint8Array(n):n,o=new(g?Uint8Array:Array)(288),u=0,w=o.length;u<w;++u)o[u]=u<=143?8:u<=255?9:u<=279?7:8;for(var k=l(o),I=new(g?Uint8Array:Array)(30),S=0,A=I.length;S<A;++S)I[S]=5;var O=l(I);function C(t,e){for(var r,n=t.f,s=t.d,i=t.input,a=t.c;s<e;)(r=i[a++])===m&&p(Error("input buffer is broken")),n|=r<<s,s+=8;return r=n&(1<<e)-1,t.f=n>>>e,t.d=s-e,t.c=a,r}function T(t,e){for(var r,n=t.f,s=t.d,i=t.input,a=t.c,o=e[0],u=e[1];s<u&&(r=i[a++])!==m;)n|=r<<s,s+=8;return e=o[n&(1<<u)-1],t.f=n>>(o=e>>>16),t.d=s-o,t.c=a,65535&e}function E(t){t=t||{},this.files=[],this.v=t.comment}function j(t,e){e=e||{},this.input=g&&t instanceof Array?new Uint8Array(t):t,this.c=0,this.ba=e.verify||!1,this.j=e.password}(n=y.prototype).q=function(t,e){var r=this.b,n=this.a;this.C=t;for(var s,i,a,o,u=r.length-258;256!==(s=T(this,t));)if(s<256)u<=n&&(this.a=n,r=this.e(),n=this.a),r[n++]=s;else for(o=h[i=s-257],0<v[i]&&(o+=C(this,v[i])),s=T(this,e),a=_[s],0<x[s]&&(a+=C(this,x[s])),u<=n&&(this.a=n,r=this.e(),n=this.a);o--;)r[n]=r[n++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},n.V=function(t,e){var r=this.b,n=this.a;this.C=t;for(var s,i,a,o,u=r.length;256!==(s=T(this,t));)if(s<256)u<=n&&(u=(r=this.e()).length),r[n++]=s;else for(o=h[i=s-257],0<v[i]&&(o+=C(this,v[i])),s=T(this,e),a=_[s],0<x[s]&&(a+=C(this,x[s])),u<n+o&&(u=(r=this.e()).length);o--;)r[n]=r[n++-a];for(;8<=this.d;)this.d-=8,this.c--;this.a=n},n.e=function(){var t,e,r=new(g?Uint8Array:Array)(this.a-32768),n=this.a-32768,s=this.b;if(g)r.set(s.subarray(32768,r.length));else for(t=0,e=r.length;t<e;++t)r[t]=s[t+32768];if(this.l.push(r),this.t+=r.length,g)s.set(s.subarray(n,32768+n));else for(t=0;t<32768;++t)s[t]=s[n+t];return this.a=32768,s},n.W=function(t){var e,r=this.input.length/this.c+1|0,n=this.input,s=this.b;return t&&("number"==typeof t.H&&(r=t.H),"number"==typeof t.P&&(r+=t.P)),r=r<2?(n=(n.length-this.c)/this.C[2]/2*258|0)<s.length?s.length+n:s.length<<1:s.length*r,g?(e=new Uint8Array(r)).set(s):e=s,this.b=e},n.B=function(){var t,e,r,n,s,i=0,a=this.b,o=this.l,u=new(g?Uint8Array:Array)(this.t+(this.a-32768));if(0===o.length)return g?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);for(e=0,r=o.length;e<r;++e)for(n=0,s=(t=o[e]).length;n<s;++n)u[i++]=t[n];for(e=32768,r=this.a;e<r;++e)u[i++]=a[e];return this.l=[],this.buffer=u},n.R=function(){var t,e=this.a;return g?this.K?(t=new Uint8Array(e)).set(this.b.subarray(0,e)):t=this.b.subarray(0,e):(this.b.length>e&&(this.b.length=e),t=this.b),this.buffer=t},E.prototype.L=function(t){this.j=t},E.prototype.s=function(t){t=65535&t[2]|2;return t*(1^t)>>8&255},E.prototype.k=function(t,e){t[0]=(b[255&(t[0]^e)]^t[0]>>>8)>>>0,t[1]=1+(6681*(20173*(t[1]+(255&t[0]))>>>0)>>>0)>>>0,t[2]=(b[255&(t[2]^t[1]>>>24)]^t[2]>>>8)>>>0},E.prototype.T=function(t){var e,r,n=[305419896,591751049,878082192];for(g&&(n=new Uint32Array(n)),e=0,r=t.length;e<r;++e)this.k(n,255&t[e]);return n};var z=0,P=8,M=[80,75,1,2],L=[80,75,3,4],F=[80,75,5,6];function V(t,e){this.input=t,this.offset=e}function U(t,e){this.input=t,this.offset=e}V.prototype.parse=function(){var t=this.input,e=this.offset;t[e++]===M[0]&&t[e++]===M[1]&&t[e++]===M[2]&&t[e++]===M[3]||p(Error("invalid file header signature")),this.version=t[e++],this.ia=t[e++],this.Z=t[e++]|t[e++]<<8,this.I=t[e++]|t[e++]<<8,this.A=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.U=t[e++]|t[e++]<<8,this.p=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.z=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.J=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.h=t[e++]|t[e++]<<8,this.g=t[e++]|t[e++]<<8,this.F=t[e++]|t[e++]<<8,this.ea=t[e++]|t[e++]<<8,this.ga=t[e++]|t[e++]<<8,this.fa=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,this.$=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.filename=String.fromCharCode.apply(null,g?t.subarray(e,e+=this.h):t.slice(e,e+=this.h)),this.X=g?t.subarray(e,e+=this.g):t.slice(e,e+=this.g),this.v=g?t.subarray(e,e+this.F):t.slice(e,e+this.F),this.length=e-this.offset};var B=1;function D(t){var e,r,n,s,i=[],a={};if(!t.i){if(t.o===m){var o,u=t.input;if(!t.D)t:{for(var h=t.input,l=h.length-12;0<l;--l)if(h[l]===F[0]&&h[l+1]===F[1]&&h[l+2]===F[2]&&h[l+3]===F[3]){t.D=l;break t}p(Error("End of Central Directory Record not found"))}o=t.D,u[o++]===F[0]&&u[o++]===F[1]&&u[o++]===F[2]&&u[o++]===F[3]||p(Error("invalid signature")),t.ha=u[o++]|u[o++]<<8,t.ja=u[o++]|u[o++]<<8,t.ka=u[o++]|u[o++]<<8,t.aa=u[o++]|u[o++]<<8,t.Q=(u[o++]|u[o++]<<8|u[o++]<<16|u[o++]<<24)>>>0,t.o=(u[o++]|u[o++]<<8|u[o++]<<16|u[o++]<<24)>>>0,t.w=u[o++]|u[o++]<<8,t.v=g?u.subarray(o,o+t.w):u.slice(o,o+t.w)}for(e=t.o,n=0,s=t.aa;n<s;++n)(r=new V(t.input,e)).parse(),e+=r.length,a[(i[n]=r).filename]=n;t.Q<e-t.o&&p(Error("invalid file header size")),t.i=i,t.G=a}}function R(t,e,r){return r^=t.s(e),t.k(e,r),r}U.prototype.parse=function(){var t=this.input,e=this.offset;t[e++]===L[0]&&t[e++]===L[1]&&t[e++]===L[2]&&t[e++]===L[3]||p(Error("invalid local file header signature")),this.Z=t[e++]|t[e++]<<8,this.I=t[e++]|t[e++]<<8,this.A=t[e++]|t[e++]<<8,this.time=t[e++]|t[e++]<<8,this.U=t[e++]|t[e++]<<8,this.p=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.z=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.J=(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)>>>0,this.h=t[e++]|t[e++]<<8,this.g=t[e++]|t[e++]<<8,this.filename=String.fromCharCode.apply(null,g?t.subarray(e,e+=this.h):t.slice(e,e+=this.h)),this.X=g?t.subarray(e,e+=this.g):t.slice(e,e+=this.g),this.length=e-this.offset},(n=j.prototype).Y=function(){var t,e,r,n=[];for(this.i||D(this),t=0,e=(r=this.i).length;t<e;++t)n[t]=r[t].filename;return n},n.r=function(t,e){var r;this.G||D(this),(r=this.G[t])===m&&p(Error(t+" not found"));var n,s,i,a,o,u,h,t=e||{},l=this.input,e=this.i;if(e||D(this),e[r]===m&&p(Error("wrong index")),s=e[r].$,(n=new U(this.input,s)).parse(),s+=n.length,i=n.z,0!=(n.I&B)){for(t.password||this.j||p(Error("please set password")),o=this.S(t.password||this.j),h=(u=s)+12;u<h;++u)R(this,o,l[u]);for(h=(u=s+=12)+(i-=12);u<h;++u)l[u]=R(this,o,l[u])}switch(n.A){case z:a=g?this.input.subarray(s,s+i):this.input.slice(s,s+i);break;case P:a=new y(this.input,{index:s,bufferSize:n.J}).r();break;default:p(Error("unknown compression type"))}if(this.ba){for(var c=m,f="number"==typeof c?c:c=0,t=a.length,d=-1,f=7&t;f--;++c)d=d>>>8^b[255&(d^a[c])];for(f=t>>3;f--;c+=8)d=(d=(d=(d=(d=(d=(d=(d=d>>>8^b[255&(d^a[c])])>>>8^b[255&(d^a[c+1])])>>>8^b[255&(d^a[c+2])])>>>8^b[255&(d^a[c+3])])>>>8^b[255&(d^a[c+4])])>>>8^b[255&(d^a[c+5])])>>>8^b[255&(d^a[c+6])])>>>8^b[255&(d^a[c+7])];n.p!==(t=(4294967295^d)>>>0)&&p(Error("wrong crc: file=0x"+n.p.toString(16)+", data=0x"+t.toString(16)))}return a},n.L=function(t){this.j=t},n.k=E.prototype.k,n.S=E.prototype.T,n.s=E.prototype.s,t("Zlib.Unzip",j),t("Zlib.Unzip.prototype.decompress",j.prototype.r),t("Zlib.Unzip.prototype.getFilenames",j.prototype.Y),t("Zlib.Unzip.prototype.setPassword",j.prototype.L)}.call(this)}});