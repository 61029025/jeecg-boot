define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartographic-83b6e736","./Matrix4-05541d3e","./Cartesian2-26928b4a","./IntersectionTests-99cda578","./Plane-d5c19000","./EllipsoidRhumbLine-9f193f93","./EllipsoidGeodesic-d8f69ff3"],function(a,p,e,d,m,v,w,P,T,y,r){"use strict";var A={numberOfPoints:function(a,e,r){e=m.Cartesian3.distance(a,e);return Math.ceil(e/r)},numberOfPointsRhumbLine:function(a,e,r){e=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(e/(r*r))))}},o=new m.Cartographic;A.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,o).height}return t};var E=new v.Matrix4,b=new m.Cartesian3,M=new m.Cartesian3,R=new T.Plane(m.Cartesian3.UNIT_X,0),S=new m.Cartesian3,x=new T.Plane(m.Cartesian3.UNIT_X,0),D=new m.Cartesian3,N=new m.Cartesian3,G=[];function I(a,e,r){var t=G;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++){var o=e+i*n;t[i]=o}return t}var k=new m.Cartographic,V=new m.Cartographic,L=new m.Cartesian3,_=new m.Cartesian3,O=new m.Cartesian3,B=new r.EllipsoidGeodesic,U=new y.EllipsoidRhumbLine;A.wrapLongitude=function(a,e){var r=[],t=[];if(p.defined(a)&&0<a.length){e=p.defaultValue(e,v.Matrix4.IDENTITY);var n=v.Matrix4.inverseTransformation(e,E),e=v.Matrix4.multiplyByPoint(n,m.Cartesian3.ZERO,b),i=m.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(n,m.Cartesian3.UNIT_Y,M),M),o=T.Plane.fromPointNormal(e,i,R),n=m.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(n,m.Cartesian3.UNIT_X,S),S),s=T.Plane.fromPointNormal(e,n,x),c=1;r.push(m.Cartesian3.clone(a[0]));for(var l=r[0],u=a.length,h=1;h<u;++h){var f,g,C=a[h];(T.Plane.getPointDistance(s,l)<0||T.Plane.getPointDistance(s,C)<0)&&(f=P.IntersectionTests.lineSegmentPlane(l,C,o,D),p.defined(f)&&(g=m.Cartesian3.multiplyByScalar(i,5e-9,N),T.Plane.getPointDistance(o,l)<0&&m.Cartesian3.negate(g,g),r.push(m.Cartesian3.add(f,g,new m.Cartesian3)),t.push(c+1),m.Cartesian3.negate(g,g),r.push(m.Cartesian3.add(f,g,new m.Cartesian3)),c=1)),r.push(m.Cartesian3.clone(a[h])),c++,l=C}t.push(c)}return{positions:r,lengths:t}},A.generateArc=function(a){p.defined(a)||(a={});var e=a.positions,r=e.length,t=p.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),n=p.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],_);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,L),m.Cartesian3.multiplyByScalar(o,n,o),m.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}var c=a.minDistance;p.defined(c)||(g=p.defaultValue(a.granularity,d.CesiumMath.RADIANS_PER_DEGREE),c=d.CesiumMath.chordLength(g,t.maximumRadius));for(var l=0,u=0;u<r-1;u++)l+=A.numberOfPoints(e[u],e[u+1],c);var a=3*(l+1),h=new Array(a),f=0;for(u=0;u<r-1;u++)f=function(a,e,r,t,n,i,o,s){var c=t.scaleToGeodeticSurface(a,_),l=t.scaleToGeodeticSurface(e,O),u=A.numberOfPoints(a,e,r),c=t.cartesianToCartographic(c,k),l=t.cartesianToCartographic(l,V),h=I(u,n,i);B.setEndPoints(c,l);var f=B.surfaceDistance/u,g=s;c.height=n;var C=t.cartographicToCartesian(c,L);m.Cartesian3.pack(C,o,g),g+=3;for(var p=1;p<u;p++){var d=B.interpolateUsingSurfaceDistance(p*f,V);d.height=h[p],C=t.cartographicToCartesian(d,L),m.Cartesian3.pack(C,o,g),g+=3}return g}(e[u],e[u+1],c,t,i?n[u]:n,i?n[u+1]:n,h,f);G.length=0;var g=e[r-1],g=t.cartesianToCartographic(g,k);g.height=i?n[r-1]:n;g=t.cartographicToCartesian(g,L);return m.Cartesian3.pack(g,h,a-3),h};var z=new m.Cartographic,X=new m.Cartographic;A.generateRhumbArc=function(a){p.defined(a)||(a={});var e=a.positions,r=e.length,t=p.defaultValue(a.ellipsoid,w.Ellipsoid.WGS84),n=p.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],_);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,L),m.Cartesian3.multiplyByScalar(o,n,o),m.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}for(var c,l=p.defaultValue(a.granularity,d.CesiumMath.RADIANS_PER_DEGREE),u=0,h=t.cartesianToCartographic(e[0],z),f=0;f<r-1;f++)c=t.cartesianToCartographic(e[f+1],X),u+=A.numberOfPointsRhumbLine(h,c,l),h=m.Cartographic.clone(c,z);var s=3*(u+1),g=new Array(s),C=0;for(f=0;f<r-1;f++)C=function(a,e,r,t,n,i,o,s){var a=t.cartesianToCartographic(a,k),e=t.cartesianToCartographic(e,V),c=A.numberOfPointsRhumbLine(a,e,r);a.height=0,e.height=0;var l=I(c,n,i);U.ellipsoid.equals(t)||(U=new y.EllipsoidRhumbLine(void 0,void 0,t)),U.setEndPoints(a,e);var u=U.surfaceDistance/c,h=s;a.height=n;var f=t.cartographicToCartesian(a,L);m.Cartesian3.pack(f,o,h),h+=3;for(var g=1;g<c;g++){var C=U.interpolateUsingSurfaceDistance(g*u,V);C.height=l[g],f=t.cartographicToCartesian(C,L),m.Cartesian3.pack(f,o,h),h+=3}return h}(e[f],e[f+1],l,t,i?n[f]:n,i?n[f+1]:n,g,C);G.length=0;a=e[r-1],a=t.cartesianToCartographic(a,k);a.height=i?n[r-1]:n;a=t.cartographicToCartesian(a,L);return m.Cartesian3.pack(a,g,s-3),g},A.generateCartesianArc=function(a){for(var e=A.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},A.generateCartesianRhumbArc=function(a){for(var e=A.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=m.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=A});
