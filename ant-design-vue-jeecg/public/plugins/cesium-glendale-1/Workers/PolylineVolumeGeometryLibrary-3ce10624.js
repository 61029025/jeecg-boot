define(["exports","./when-54c2dc71","./Math-fc8cecf5","./Cartographic-83b6e736","./Matrix4-05541d3e","./Cartesian2-26928b4a","./Transforms-e2084567","./EllipsoidTangentPlane-d26ce9a9","./PolylinePipeline-7db07635"],function(a,V,G,R,L,m,f,x,_){"use strict";var j=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),q=[new R.Cartesian3,new R.Cartesian3],U=new R.Cartesian3,Y=new R.Cartesian3,Z=new R.Cartesian3,k=new R.Cartesian3,H=new R.Cartesian3,J=new R.Cartesian3,K=new R.Cartesian3,W=new R.Cartesian3,X=new R.Cartesian3,$=new R.Cartesian3,p=new R.Cartesian3,aa={},ea=new R.Cartographic;function ra(a,e,r,n){var t=a[0],a=a[1],a=R.Cartesian3.angleBetween(t,a),i=Math.ceil(a/n),s=new Array(i);if(e===r){for(l=0;l<i;l++)s[l]=e;return s.push(r),s}for(var o=(r-e)/i,l=1;l<i;l++){var C=e+l*o;s[l]=C}return s[0]=e,s.push(r),s}var g=new R.Cartesian3,h=new R.Cartesian3;var v=new R.Cartesian3(-1,0,0),M=new L.Matrix4,P=new L.Matrix4,z=new L.Matrix3,T=L.Matrix3.IDENTITY.clone(),E=new R.Cartesian3,B=new L.Cartesian4,b=new R.Cartesian3;function na(a,e,r,n,t,i,s,o,l,C){var c=E,u=B;M=f.Transforms.eastNorthUpToFixedFrame(a,t,M),c=L.Matrix4.multiplyByPointAsVector(M,v,c),c=R.Cartesian3.normalize(c,c);c=c,e=e,a=a,t=t,t=new x.EllipsoidTangentPlane(a,t),c=t.projectPointOntoPlane(R.Cartesian3.add(a,c,g),g),a=t.projectPointOntoPlane(R.Cartesian3.add(a,e,h),h),e=m.Cartesian2.angleBetween(c,a),c=0<=a.x*c.y-a.y*c.x?-e:e;V.defined(C)||(C=new R.Cartesian3),0==C.z?z=L.Matrix3.fromRotationZ(c,z):(e=R.Cartesian3.subtract(l[1],l[0],new R.Cartesian3),e=R.Cartesian3.normalize(e,e),C=new R.Cartesian3(0,0,1),R.Cartesian3.normalize(C,C),l=new R.Cartesian3,e.equals(new R.Cartesian3(0,0,-1))?l=new R.Cartesian3(0,0,-1):R.Cartesian3.cross(C,e,l),R.Cartesian3.normalize(l,l),c=R.Cartesian3.angleBetween(C,e),c=f.Quaternion.fromAxisAngle(l,c,new f.Quaternion),L.Matrix3.fromQuaternion(c,z)),b.z=i,M=L.Matrix4.multiplyTransformation(M,L.Matrix4.fromRotationTranslation(z,b,P),M);var y=T;y[0]=s;for(var d=0;d<o;d++)for(var w=0;w<r.length;w+=3)u=R.Cartesian3.fromArray(r,w,u),u=L.Matrix3.multiplyByVector(y,u,u),u=L.Matrix4.multiplyByPoint(M,u,u),n.push(u.x,u.y,u.z);return n}var c=new R.Cartesian3;function ta(a,e,r,n,t,i,s,o,l){for(var C=0;C<a.length;C+=3)n=na(R.Cartesian3.fromArray(a,C,c),e,r,n,t,i[C/3],s,1,o,l);return n}function ia(a,e,r){var n=a.length,t=new Array(3*n),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(V.defined(r)||(r=new R.Cartesian3),0===r.z)for(var l=0;l<n;l++)t[i++]=a[l].x-s,t[i++]=0,t[i++]=a[l].y-o;else for(l=0;l<n;l++)t[i++]=a[l].x-s,t[i++]=a[l].y-o,t[i++]=0;return t}var A=new f.Quaternion,S=new R.Cartesian3,D=new L.Matrix3;function sa(a,e,r,n,t,i,s,o,l,C){var c,u=R.Cartesian3.angleBetween(R.Cartesian3.subtract(e,a,$),R.Cartesian3.subtract(r,a,p)),y=n===j.BEVELED?0:Math.ceil(u/G.CesiumMath.toRadians(5)),d=t?L.Matrix3.fromQuaternion(f.Quaternion.fromAxisAngle(R.Cartesian3.negate(a,$),u/(y+1),A),D):L.Matrix3.fromQuaternion(f.Quaternion.fromAxisAngle(a,u/(y+1),A),D);if(e=R.Cartesian3.clone(e,S),0<y)for(var w=C?2:1,m=0;m<y;m++)e=L.Matrix3.multiplyByVector(d,e,e),c=R.Cartesian3.subtract(e,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=na(i.scaleToGeodeticSurface(e,p),c,o,s,i,l,1,w);else c=R.Cartesian3.subtract(e,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=na(i.scaleToGeodeticSurface(e,p),c,o,s,i,l,1,1),r=R.Cartesian3.clone(r,S),c=R.Cartesian3.subtract(r,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=na(i.scaleToGeodeticSurface(r,p),c,o,s,i,l,1,1);return s}aa.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var i=a[n],s=a[t];m.Cartesian2.equals(i,s)||r.push(s)}return r},aa.angleIsGreaterThanPi=function(a,e,r,n){n=new x.EllipsoidTangentPlane(r,n),a=n.projectPointOntoPlane(R.Cartesian3.add(r,a,g),g),e=n.projectPointOntoPlane(R.Cartesian3.add(r,e,h),h);return 0<=e.x*a.y-e.y*a.x};var oa=new R.Cartesian3,la=new R.Cartesian3;aa.computePositions=function(a,e,r,n,t){var i=n._ellipsoid,s=a.slice(0),o=[],l=new R.Cartesian3,C=new R.Cartesian3;R.Cartesian3.clone(s[0],l),R.Cartesian3.clone(s[1],C);s=new L.Matrix4;n._rootTransform.equals(new L.Matrix4)&&(n._rootTransform=L.Matrix4.IDENTITY),L.Matrix4.inverse(n._rootTransform,s),L.Matrix4.multiplyByPoint(s,l,l),L.Matrix4.multiplyByPoint(s,C,C),o.push(l),o.push(C);C=R.Cartesian3.clone(C,new R.Cartesian3);C.x=+C.x.toFixed(4),C.y=+C.y.toFixed(4),C.z=+C.z.toFixed(4);l=R.Cartesian3.clone(l,new R.Cartesian3);l.x=+l.x.toFixed(4),l.y=+l.y.toFixed(4),l.z=+l.z.toFixed(4);R.Cartesian3.subtract(C,l,new R.Cartesian3);var c=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];ea=e.cartesianToCartographic(t,ea),r[n]=ea.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,i),C=c[0].toFixed(2),l=c[1].toFixed(2),u=new R.Cartesian3(0,0,+(+C-+l).toFixed(2)),y=n._granularity,d=n._cornerType,w=(t?function(a,e,r){var n=a.length,t=new Array(6*n),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(V.defined(r)||(r=new R.Cartesian3),0===r.z){var l=a[0];t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o;for(var C=1;C<n;C++){var c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=0,t[i++]=u,t[i++]=c,t[i++]=0,t[i++]=u}l=a[0],t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o}else{l=a[0];t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0;for(C=1;C<n;C++){c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=u,t[i++]=0,t[i++]=c,t[i++]=u,t[i++]=0}l=a[0],t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0}return t}:ia)(e,r,u),e=t?ia(e,r,u):void 0,m=r.height/2,f=r.width/2,x=a.length,p=[],r=t?[]:void 0,g=U,h=Y,v=Z,M=k,P=H,z=J,T=K,E=W,B=X,b=a[0],A=a[1],M=i.geodeticSurfaceNormal(b,M);g=R.Cartesian3.subtract(A,b,g),g=R.Cartesian3.normalize(g,g),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E);var S,D=c[0],F=c[1];t&&(r=na(b,E,e,r,i,D+m,1,1,o,u)),B=R.Cartesian3.clone(b,B),b=A,h=R.Cartesian3.negate(g,h);for(var N=1;N<x-1;N++){var O=t?2:1,A=a[N+1],g=R.Cartesian3.subtract(A,b,g);g=R.Cartesian3.normalize(g,g),v=R.Cartesian3.add(g,h,v),v=R.Cartesian3.normalize(v,v),M=i.geodeticSurfaceNormal(b,M);var I=R.Cartesian3.multiplyByScalar(M,R.Cartesian3.dot(g,M),oa);R.Cartesian3.subtract(g,I,I),R.Cartesian3.normalize(I,I);var Q=R.Cartesian3.multiplyByScalar(M,R.Cartesian3.dot(h,M),la);R.Cartesian3.subtract(h,Q,Q),R.Cartesian3.normalize(Q,Q),!G.CesiumMath.equalsEpsilon(Math.abs(R.Cartesian3.dot(I,Q)),1,G.CesiumMath.EPSILON7)?(v=R.Cartesian3.cross(v,M,v),v=R.Cartesian3.cross(M,v,v),v=R.Cartesian3.normalize(v,v),I=1/Math.max(.25,R.Cartesian3.magnitude(R.Cartesian3.cross(v,h,$))),(Q=aa.angleIsGreaterThanPi(g,h,b,i))?(P=R.Cartesian3.add(b,R.Cartesian3.multiplyByScalar(v,I*f,v),P),z=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,f,z),z),q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(z,q[1]),S=ra(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,S,1,o,u),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E),T=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,f,T),T),d===j.ROUNDED||d===j.BEVELED?sa(P,z,T,d,Q,i,p,w,F+m,t):p=na(b,v=R.Cartesian3.negate(v,v),w,p,i,F+m,I,O)):(P=R.Cartesian3.add(b,R.Cartesian3.multiplyByScalar(v,I*f,v),P),z=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,-f,z),z),q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(z,q[1]),S=ra(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,S,1,o,u),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E),T=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,-f,T),T),d===j.ROUNDED||d===j.BEVELED?sa(P,z,T,d,Q,i,p,w,F+m,t):p=na(b,v,w,p,i,F+m,I,O)),B=R.Cartesian3.clone(T,B),h=R.Cartesian3.negate(g,h)):(p=na(B,E,w,p,i,D+m,1,1),B=b),D=F,F=c[N+1],b=A}q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(b,q[1]),S=ra(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,S,1,o,u),t&&(r=na(b,E,e,r,i,F+m,1,1,o,u)),x=p.length;e=t?x+r.length:x,e=new Float64Array(e);return e.set(p),t&&e.set(r,x),e},a.CornerType=j,a.PolylineVolumeGeometryLibrary=aa});
