define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian3-e5933291","./Cartesian2-062e3760","./Transforms-7e4f9763","./IntersectionTests-3bd26a70","./Plane-1b056faf","./EllipsoidRhumbLine-db1dc7f1","./EllipsoidGeodesic-86b7846e"],function(a,w,e,P,T,y,v,m,A,b,r){"use strict";var E={numberOfPoints:function(a,e,r){var t=T.Cartesian3.distance(a,e);return Math.ceil(t/r)},numberOfPointsRhumbLine:function(a,e,r){var t=Math.pow(a.longitude-e.longitude,2)+Math.pow(a.latitude-e.latitude,2);return Math.max(1,Math.ceil(Math.sqrt(t/(r*r))))}},o=new y.Cartographic;E.extractHeights=function(a,e){for(var r=a.length,t=new Array(r),n=0;n<r;n++){var i=a[n];t[n]=e.cartesianToCartographic(i,o).height}return t};var R=new v.Matrix4,M=new T.Cartesian3,S=new T.Cartesian3,D=new A.Plane(T.Cartesian3.UNIT_X,0),x=new T.Cartesian3,N=new A.Plane(T.Cartesian3.UNIT_X,0),G=new T.Cartesian3,I=new T.Cartesian3,k=[];function V(a,e,r){var t=k;if(t.length=a,e===r){for(i=0;i<a;i++)t[i]=e;return t}for(var n=(r-e)/a,i=0;i<a;i++){var o=e+i*n;t[i]=o}return t}var L=new y.Cartographic,_=new y.Cartographic,O=new T.Cartesian3,B=new T.Cartesian3,U=new T.Cartesian3,z=new r.EllipsoidGeodesic,X=new b.EllipsoidRhumbLine;E.wrapLongitude=function(a,e){var r=[],t=[];if(w.defined(a)&&0<a.length){e=w.defaultValue(e,v.Matrix4.IDENTITY);var n=v.Matrix4.inverseTransformation(e,R),i=v.Matrix4.multiplyByPoint(n,T.Cartesian3.ZERO,M),o=T.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(n,T.Cartesian3.UNIT_Y,S),S),s=A.Plane.fromPointNormal(i,o,D),c=T.Cartesian3.normalize(v.Matrix4.multiplyByPointAsVector(n,T.Cartesian3.UNIT_X,x),x),l=A.Plane.fromPointNormal(i,c,N),u=1;r.push(T.Cartesian3.clone(a[0]));for(var h=r[0],f=a.length,g=1;g<f;++g){var C,p,d=a[g];(A.Plane.getPointDistance(l,h)<0||A.Plane.getPointDistance(l,d)<0)&&(C=m.IntersectionTests.lineSegmentPlane(h,d,s,G),w.defined(C)&&(p=T.Cartesian3.multiplyByScalar(o,5e-9,I),A.Plane.getPointDistance(s,h)<0&&T.Cartesian3.negate(p,p),r.push(T.Cartesian3.add(C,p,new T.Cartesian3)),t.push(u+1),T.Cartesian3.negate(p,p),r.push(T.Cartesian3.add(C,p,new T.Cartesian3)),u=1)),r.push(T.Cartesian3.clone(a[g])),u++,h=d}t.push(u)}return{positions:r,lengths:t}},E.generateArc=function(a){w.defined(a)||(a={});var e=a.positions,r=e.length,t=w.defaultValue(a.ellipsoid,y.Ellipsoid.WGS84),n=w.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],B);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,O),T.Cartesian3.multiplyByScalar(o,n,o),T.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}var c,l=a.minDistance;w.defined(l)||(c=w.defaultValue(a.granularity,P.CesiumMath.RADIANS_PER_DEGREE),l=P.CesiumMath.chordLength(c,t.maximumRadius));for(var u=0,h=0;h<r-1;h++)u+=E.numberOfPoints(e[h],e[h+1],l);var f=3*(u+1),g=new Array(f),C=0;for(h=0;h<r-1;h++)C=function(a,e,r,t,n,i,o,s){var c=t.scaleToGeodeticSurface(a,B),l=t.scaleToGeodeticSurface(e,U),u=E.numberOfPoints(a,e,r),h=t.cartesianToCartographic(c,L),f=t.cartesianToCartographic(l,_),g=V(u,n,i);z.setEndPoints(h,f);var C=z.surfaceDistance/u,p=s;h.height=n;var d=t.cartographicToCartesian(h,O);T.Cartesian3.pack(d,o,p),p+=3;for(var v=1;v<u;v++){var m=z.interpolateUsingSurfaceDistance(v*C,_);m.height=g[v],d=t.cartographicToCartesian(m,O),T.Cartesian3.pack(d,o,p),p+=3}return p}(e[h],e[h+1],l,t,i?n[h]:n,i?n[h+1]:n,g,C);k.length=0;var p=e[r-1],d=t.cartesianToCartographic(p,L);d.height=i?n[r-1]:n;var v=t.cartographicToCartesian(d,O);return T.Cartesian3.pack(v,g,f-3),g};var q=new y.Cartographic,W=new y.Cartographic;E.generateRhumbArc=function(a){w.defined(a)||(a={});var e=a.positions,r=e.length,t=w.defaultValue(a.ellipsoid,y.Ellipsoid.WGS84),n=w.defaultValue(a.height,0),i=Array.isArray(n);if(r<1)return[];if(1===r){var o,s=t.scaleToGeodeticSurface(e[0],B);return 0!==(n=i?n[0]:n)&&(o=t.geodeticSurfaceNormal(s,O),T.Cartesian3.multiplyByScalar(o,n,o),T.Cartesian3.add(s,o,s)),[s.x,s.y,s.z]}for(var c,l=w.defaultValue(a.granularity,P.CesiumMath.RADIANS_PER_DEGREE),u=0,h=t.cartesianToCartographic(e[0],q),f=0;f<r-1;f++)c=t.cartesianToCartographic(e[f+1],W),u+=E.numberOfPointsRhumbLine(h,c,l),h=y.Cartographic.clone(c,q);var g=3*(u+1),C=new Array(g),p=0;for(f=0;f<r-1;f++)p=function(a,e,r,t,n,i,o,s){var c=t.cartesianToCartographic(a,L),l=t.cartesianToCartographic(e,_),u=E.numberOfPointsRhumbLine(c,l,r);c.height=0,l.height=0;var h=V(u,n,i);X.ellipsoid.equals(t)||(X=new b.EllipsoidRhumbLine(void 0,void 0,t)),X.setEndPoints(c,l);var f=X.surfaceDistance/u,g=s;c.height=n;var C=t.cartographicToCartesian(c,O);T.Cartesian3.pack(C,o,g),g+=3;for(var p=1;p<u;p++){var d=X.interpolateUsingSurfaceDistance(p*f,_);d.height=h[p],C=t.cartographicToCartesian(d,O),T.Cartesian3.pack(C,o,g),g+=3}return g}(e[f],e[f+1],l,t,i?n[f]:n,i?n[f+1]:n,C,p);k.length=0;var d=e[r-1],v=t.cartesianToCartographic(d,L);v.height=i?n[r-1]:n;var m=t.cartographicToCartesian(v,O);return T.Cartesian3.pack(m,C,g-3),C},E.generateCartesianArc=function(a){for(var e=E.generateArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=T.Cartesian3.unpack(e,3*n);return t},E.generateCartesianRhumbArc=function(a){for(var e=E.generateRhumbArc(a),r=e.length/3,t=new Array(r),n=0;n<r;n++)t[n]=T.Cartesian3.unpack(e,3*n);return t},a.PolylinePipeline=E});
