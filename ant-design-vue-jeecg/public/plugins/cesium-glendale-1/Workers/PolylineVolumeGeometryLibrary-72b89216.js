define(["exports","./when-54c2dc71","./Math-fc8cecf5","./Cartesian2-57a76c50","./Transforms-9d269426","./EllipsoidTangentPlane-61c9e054","./PolylinePipeline-cf18bf91"],function(a,V,G,R,L,m,_){"use strict";var j=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),q=[new R.Cartesian3,new R.Cartesian3],U=new R.Cartesian3,Y=new R.Cartesian3,Z=new R.Cartesian3,k=new R.Cartesian3,H=new R.Cartesian3,J=new R.Cartesian3,K=new R.Cartesian3,W=new R.Cartesian3,X=new R.Cartesian3,$=new R.Cartesian3,f=new R.Cartesian3,aa={},ea=new R.Cartographic;function na(a,e,n,r){var t=a[0],a=a[1],a=R.Cartesian3.angleBetween(t,a),i=Math.ceil(a/r),s=new Array(i);if(e===n){for(l=0;l<i;l++)s[l]=e;return s.push(n),s}for(var o=(n-e)/i,l=1;l<i;l++){var C=e+l*o;s[l]=C}return s[0]=e,s.push(n),s}var x=new R.Cartesian3,p=new R.Cartesian3;var g=new R.Cartesian3(-1,0,0),h=new L.Matrix4,v=new L.Matrix4,M=new L.Matrix3,P=L.Matrix3.IDENTITY.clone(),z=new R.Cartesian3,T=new L.Cartesian4,E=new R.Cartesian3;function ra(a,e,n,r,t,i,s,o,l,C){var c=z,u=T;h=L.Transforms.eastNorthUpToFixedFrame(a,t,h),c=L.Matrix4.multiplyByPointAsVector(h,g,c),c=R.Cartesian3.normalize(c,c);c=c,e=e,a=a,t=t,t=new m.EllipsoidTangentPlane(a,t),c=t.projectPointOntoPlane(R.Cartesian3.add(a,c,x),x),a=t.projectPointOntoPlane(R.Cartesian3.add(a,e,p),p),e=R.Cartesian2.angleBetween(c,a),c=0<=a.x*c.y-a.y*c.x?-e:e;V.defined(C)||(C=new R.Cartesian3),0==C.z?M=L.Matrix3.fromRotationZ(c,M):(e=R.Cartesian3.subtract(l[1],l[0],new R.Cartesian3),e=R.Cartesian3.normalize(e,e),C=new R.Cartesian3(0,0,1),R.Cartesian3.normalize(C,C),l=new R.Cartesian3,e.equals(new R.Cartesian3(0,0,-1))?l=new R.Cartesian3(0,0,-1):R.Cartesian3.cross(C,e,l),R.Cartesian3.normalize(l,l),c=R.Cartesian3.angleBetween(C,e),c=L.Quaternion.fromAxisAngle(l,c,new L.Quaternion),L.Matrix3.fromQuaternion(c,M)),E.z=i,h=L.Matrix4.multiplyTransformation(h,L.Matrix4.fromRotationTranslation(M,E,v),h);var y=P;y[0]=s;for(var d=0;d<o;d++)for(var w=0;w<n.length;w+=3)u=R.Cartesian3.fromArray(n,w,u),u=L.Matrix3.multiplyByVector(y,u,u),u=L.Matrix4.multiplyByPoint(h,u,u),r.push(u.x,u.y,u.z);return r}var c=new R.Cartesian3;function ta(a,e,n,r,t,i,s,o,l){for(var C=0;C<a.length;C+=3){r=ra(R.Cartesian3.fromArray(a,C,c),e,n,r,t,i[C/3],s,1,o,l)}return r}function ia(a,e,n){var r=a.length,t=new Array(3*r),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(V.defined(n)||(n=new R.Cartesian3),0===n.z)for(var l=0;l<r;l++)t[i++]=a[l].x-s,t[i++]=0,t[i++]=a[l].y-o;else for(l=0;l<r;l++)t[i++]=a[l].x-s,t[i++]=a[l].y-o,t[i++]=0;return t}var B=new L.Quaternion,A=new R.Cartesian3,S=new L.Matrix3;function sa(a,e,n,r,t,i,s,o,l,C){var c,u=R.Cartesian3.angleBetween(R.Cartesian3.subtract(e,a,$),R.Cartesian3.subtract(n,a,f)),y=r===j.BEVELED?0:Math.ceil(u/G.CesiumMath.toRadians(5)),d=t?L.Matrix3.fromQuaternion(L.Quaternion.fromAxisAngle(R.Cartesian3.negate(a,$),u/(y+1),B),S):L.Matrix3.fromQuaternion(L.Quaternion.fromAxisAngle(a,u/(y+1),B),S);if(e=R.Cartesian3.clone(e,A),0<y)for(var w=C?2:1,m=0;m<y;m++)e=L.Matrix3.multiplyByVector(d,e,e),c=R.Cartesian3.subtract(e,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,w);else c=R.Cartesian3.subtract(e,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,1),n=R.Cartesian3.clone(n,A),c=R.Cartesian3.subtract(n,a,$),c=R.Cartesian3.normalize(c,c),t||(c=R.Cartesian3.negate(c,c)),s=ra(i.scaleToGeodeticSurface(n,f),c,o,s,i,l,1,1);return s}aa.removeDuplicatesFromShape=function(a){for(var e=a.length,n=[],r=e-1,t=0;t<e;r=t++){var i=a[r],s=a[t];R.Cartesian2.equals(i,s)||n.push(s)}return n},aa.angleIsGreaterThanPi=function(a,e,n,r){r=new m.EllipsoidTangentPlane(n,r),a=r.projectPointOntoPlane(R.Cartesian3.add(n,a,x),x),e=r.projectPointOntoPlane(R.Cartesian3.add(n,e,p),p);return 0<=e.x*a.y-e.y*a.x};var oa=new R.Cartesian3,la=new R.Cartesian3;aa.computePositions=function(a,e,n,r,t){var i=r._ellipsoid,s=a.slice(0),o=[],l=new R.Cartesian3,C=new R.Cartesian3;R.Cartesian3.clone(s[0],l),R.Cartesian3.clone(s[1],C);s=new L.Matrix4;r._rootTransform.equals(new L.Matrix4)&&(r._rootTransform=L.Matrix4.IDENTITY),L.Matrix4.inverse(r._rootTransform,s),L.Matrix4.multiplyByPoint(s,l,l),L.Matrix4.multiplyByPoint(s,C,C),o.push(l),o.push(C);C=R.Cartesian3.clone(C,new R.Cartesian3);C.x=+C.x.toFixed(4),C.y=+C.y.toFixed(4),C.z=+C.z.toFixed(4);l=R.Cartesian3.clone(l,new R.Cartesian3);l.x=+l.x.toFixed(4),l.y=+l.y.toFixed(4),l.z=+l.z.toFixed(4);R.Cartesian3.subtract(C,l,new R.Cartesian3);var c=function(a,e){for(var n=new Array(a.length),r=0;r<a.length;r++){var t=a[r];ea=e.cartesianToCartographic(t,ea),n[r]=ea.height,a[r]=e.scaleToGeodeticSurface(t,t)}return n}(a,i),C=c[0].toFixed(2),l=c[1].toFixed(2),u=new R.Cartesian3(0,0,+(+C-+l).toFixed(2)),y=r._granularity,d=r._cornerType,w=(t?function(a,e,n){var r=a.length,t=new Array(6*r),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(V.defined(n)||(n=new R.Cartesian3),0===n.z){var l=a[0];t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o;for(var C=1;C<r;C++){var c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=0,t[i++]=u,t[i++]=c,t[i++]=0,t[i++]=u}l=a[0],t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o}else{l=a[0];t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0;for(C=1;C<r;C++){c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=u,t[i++]=0,t[i++]=c,t[i++]=u,t[i++]=0}l=a[0],t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0}return t}:ia)(e,n,u),e=t?ia(e,n,u):void 0,m=n.height/2,f=n.width/2,x=a.length,p=[],n=t?[]:void 0,g=U,h=Y,v=Z,M=k,P=H,z=J,T=K,E=W,B=X,A=a[0],S=a[1],M=i.geodeticSurfaceNormal(A,M);g=R.Cartesian3.subtract(S,A,g),g=R.Cartesian3.normalize(g,g),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E);var b,D=c[0],F=c[1];t&&(n=ra(A,E,e,n,i,D+m,1,1,o,u)),B=R.Cartesian3.clone(A,B),A=S,h=R.Cartesian3.negate(g,h);for(var N=1;N<x-1;N++){var O=t?2:1,S=a[N+1],g=R.Cartesian3.subtract(S,A,g);g=R.Cartesian3.normalize(g,g),v=R.Cartesian3.add(g,h,v),v=R.Cartesian3.normalize(v,v),M=i.geodeticSurfaceNormal(A,M);var I=R.Cartesian3.multiplyByScalar(M,R.Cartesian3.dot(g,M),oa);R.Cartesian3.subtract(g,I,I),R.Cartesian3.normalize(I,I);var Q=R.Cartesian3.multiplyByScalar(M,R.Cartesian3.dot(h,M),la);R.Cartesian3.subtract(h,Q,Q),R.Cartesian3.normalize(Q,Q),!G.CesiumMath.equalsEpsilon(Math.abs(R.Cartesian3.dot(I,Q)),1,G.CesiumMath.EPSILON7)?(v=R.Cartesian3.cross(v,M,v),v=R.Cartesian3.cross(M,v,v),v=R.Cartesian3.normalize(v,v),I=1/Math.max(.25,R.Cartesian3.magnitude(R.Cartesian3.cross(v,h,$))),(Q=aa.angleIsGreaterThanPi(g,h,A,i))?(P=R.Cartesian3.add(A,R.Cartesian3.multiplyByScalar(v,I*f,v),P),z=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,f,z),z),q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(z,q[1]),b=na(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,b,1,o,u),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E),T=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,f,T),T),d===j.ROUNDED||d===j.BEVELED?sa(P,z,T,d,Q,i,p,w,F+m,t):p=ra(A,v=R.Cartesian3.negate(v,v),w,p,i,F+m,I,O)):(P=R.Cartesian3.add(A,R.Cartesian3.multiplyByScalar(v,I*f,v),P),z=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,-f,z),z),q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(z,q[1]),b=na(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,b,1,o,u),E=R.Cartesian3.cross(M,g,E),E=R.Cartesian3.normalize(E,E),T=R.Cartesian3.add(P,R.Cartesian3.multiplyByScalar(E,-f,T),T),d===j.ROUNDED||d===j.BEVELED?sa(P,z,T,d,Q,i,p,w,F+m,t):p=ra(A,v,w,p,i,F+m,I,O)),B=R.Cartesian3.clone(T,B),h=R.Cartesian3.negate(g,h)):(p=ra(B,E,w,p,i,D+m,1,1),B=A),D=F,F=c[N+1],A=S}q[0]=R.Cartesian3.clone(B,q[0]),q[1]=R.Cartesian3.clone(A,q[1]),b=na(q,D+m,F+m,y),p=ta(_.PolylinePipeline.generateArc({positions:q,granularity:y,ellipsoid:i}),E,w,p,i,b,1,o,u),t&&(n=ra(A,E,e,n,i,F+m,1,1,o,u)),x=p.length;e=t?x+n.length:x,e=new Float64Array(e);return e.set(p),t&&e.set(n,x),e},a.CornerType=j,a.PolylineVolumeGeometryLibrary=aa});
