define(["exports","./when-54c2dc71","./Math-fc8cecf5","./Cartesian3-e5933291","./Cartesian2-062e3760","./Transforms-7e4f9763","./EllipsoidTangentPlane-49bc3591","./PolylinePipeline-7f74434e"],function(a,H,J,K,A,W,S,X){"use strict";var $=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),aa=[new K.Cartesian3,new K.Cartesian3],ea=new K.Cartesian3,ra=new K.Cartesian3,na=new K.Cartesian3,ta=new K.Cartesian3,ia=new K.Cartesian3,sa=new K.Cartesian3,oa=new K.Cartesian3,la=new K.Cartesian3,Ca=new K.Cartesian3,ca=new K.Cartesian3,f=new K.Cartesian3,ua={},ya=new A.Cartographic;function da(a,e,r,n){var t=a[0],i=a[1],s=K.Cartesian3.angleBetween(t,i),o=Math.ceil(s/n),l=new Array(o);if(e===r){for(c=0;c<o;c++)l[c]=e;return l.push(r),l}for(var C=(r-e)/o,c=1;c<o;c++){var u=e+c*C;l[c]=u}return l[0]=e,l.push(r),l}var b=new K.Cartesian3,D=new K.Cartesian3;var F=new K.Cartesian3(-1,0,0),N=new W.Matrix4,O=new W.Matrix4,I=new W.Matrix3,Q=W.Matrix3.IDENTITY.clone(),V=new K.Cartesian3,G=new W.Cartesian4,R=new K.Cartesian3;function wa(a,e,r,n,t,i,s,o,l,C){var c=V,u=G;N=W.Transforms.eastNorthUpToFixedFrame(a,t,N),c=W.Matrix4.multiplyByPointAsVector(N,F,c),c=K.Cartesian3.normalize(c,c);var y,d,w,m,f,x,p,g,v,h,M,P,z=(y=c,d=e,w=a,m=t,f=new S.EllipsoidTangentPlane(w,m),x=f.projectPointOntoPlane(K.Cartesian3.add(w,y,b),b),p=f.projectPointOntoPlane(K.Cartesian3.add(w,d,D),D),g=A.Cartesian2.angleBetween(x,p),0<=p.x*x.y-p.y*x.x?-g:g);H.defined(C)||(C=new K.Cartesian3),0==C.z?I=W.Matrix3.fromRotationZ(z,I):(v=K.Cartesian3.subtract(l[1],l[0],new K.Cartesian3),v=K.Cartesian3.normalize(v,v),h=new K.Cartesian3(0,0,1),K.Cartesian3.normalize(h,h),M=new K.Cartesian3,v.equals(new K.Cartesian3(0,0,-1))?M=new K.Cartesian3(0,0,-1):K.Cartesian3.cross(h,v,M),K.Cartesian3.normalize(M,M),z=K.Cartesian3.angleBetween(h,v),P=W.Quaternion.fromAxisAngle(M,z,new W.Quaternion),W.Matrix3.fromQuaternion(P,I)),R.z=i,N=W.Matrix4.multiplyTransformation(N,W.Matrix4.fromRotationTranslation(I,R,O),N);var T=Q;T[0]=s;for(var E=0;E<o;E++)for(var B=0;B<r.length;B+=3)u=K.Cartesian3.fromArray(r,B,u),u=W.Matrix3.multiplyByVector(T,u,u),u=W.Matrix4.multiplyByPoint(N,u,u),n.push(u.x,u.y,u.z);return n}var c=new K.Cartesian3;function ma(a,e,r,n,t,i,s,o,l){for(var C=0;C<a.length;C+=3){n=wa(K.Cartesian3.fromArray(a,C,c),e,r,n,t,i[C/3],s,1,o,l)}return n}function fa(a,e,r){var n=a.length,t=new Array(3*n),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(H.defined(r)||(r=new K.Cartesian3),0===r.z)for(var l=0;l<n;l++)t[i++]=a[l].x-s,t[i++]=0,t[i++]=a[l].y-o;else for(l=0;l<n;l++)t[i++]=a[l].x-s,t[i++]=a[l].y-o,t[i++]=0;return t}var x=new W.Quaternion,p=new K.Cartesian3,g=new W.Matrix3;function xa(a,e,r,n,t,i,s,o,l,C){var c,u=K.Cartesian3.angleBetween(K.Cartesian3.subtract(e,a,ca),K.Cartesian3.subtract(r,a,f)),y=n===$.BEVELED?0:Math.ceil(u/J.CesiumMath.toRadians(5)),d=t?W.Matrix3.fromQuaternion(W.Quaternion.fromAxisAngle(K.Cartesian3.negate(a,ca),u/(y+1),x),g):W.Matrix3.fromQuaternion(W.Quaternion.fromAxisAngle(a,u/(y+1),x),g);if(e=K.Cartesian3.clone(e,p),0<y)for(var w=C?2:1,m=0;m<y;m++)e=W.Matrix3.multiplyByVector(d,e,e),c=K.Cartesian3.subtract(e,a,ca),c=K.Cartesian3.normalize(c,c),t||(c=K.Cartesian3.negate(c,c)),s=wa(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,w);else c=K.Cartesian3.subtract(e,a,ca),c=K.Cartesian3.normalize(c,c),t||(c=K.Cartesian3.negate(c,c)),s=wa(i.scaleToGeodeticSurface(e,f),c,o,s,i,l,1,1),r=K.Cartesian3.clone(r,p),c=K.Cartesian3.subtract(r,a,ca),c=K.Cartesian3.normalize(c,c),t||(c=K.Cartesian3.negate(c,c)),s=wa(i.scaleToGeodeticSurface(r,f),c,o,s,i,l,1,1);return s}ua.removeDuplicatesFromShape=function(a){for(var e=a.length,r=[],n=e-1,t=0;t<e;n=t++){var i=a[n],s=a[t];A.Cartesian2.equals(i,s)||r.push(s)}return r},ua.angleIsGreaterThanPi=function(a,e,r,n){var t=new S.EllipsoidTangentPlane(r,n),i=t.projectPointOntoPlane(K.Cartesian3.add(r,a,b),b),s=t.projectPointOntoPlane(K.Cartesian3.add(r,e,D),D);return 0<=s.x*i.y-s.y*i.x};var pa=new K.Cartesian3,ga=new K.Cartesian3;ua.computePositions=function(a,e,r,n,t){var i=n._ellipsoid,s=a.slice(0),o=[],l=new K.Cartesian3,C=new K.Cartesian3;K.Cartesian3.clone(s[0],l),K.Cartesian3.clone(s[1],C);var c=new W.Matrix4;n._rootTransform.equals(new W.Matrix4)&&(n._rootTransform=W.Matrix4.IDENTITY),W.Matrix4.inverse(n._rootTransform,c),W.Matrix4.multiplyByPoint(c,l,l),W.Matrix4.multiplyByPoint(c,C,C),o.push(l),o.push(C);var u=K.Cartesian3.clone(C,new K.Cartesian3);u.x=+u.x.toFixed(4),u.y=+u.y.toFixed(4),u.z=+u.z.toFixed(4);var y=K.Cartesian3.clone(l,new K.Cartesian3);y.x=+y.x.toFixed(4),y.y=+y.y.toFixed(4),y.z=+y.z.toFixed(4);K.Cartesian3.subtract(u,y,new K.Cartesian3);var d=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];ya=e.cartesianToCartographic(t,ya),r[n]=ya.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,i),w=d[0].toFixed(2),m=d[1].toFixed(2),f=new K.Cartesian3(0,0,+(w-m).toFixed(2)),x=n._granularity,p=n._cornerType,g=(t?function(a,e,r){var n=a.length,t=new Array(6*n),i=0,s=e.x+e.width/2,o=e.y+e.height/2;if(H.defined(r)||(r=new K.Cartesian3),0===r.z){var l=a[0];t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o;for(var C=1;C<n;C++){var c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=0,t[i++]=u,t[i++]=c,t[i++]=0,t[i++]=u}l=a[0],t[i++]=l.x-s,t[i++]=0,t[i++]=l.y-o}else{l=a[0];t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0;for(C=1;C<n;C++){c=(l=a[C]).x-s,u=l.y-o;t[i++]=c,t[i++]=u,t[i++]=0,t[i++]=c,t[i++]=u,t[i++]=0}l=a[0],t[i++]=l.x-s,t[i++]=l.y-o,t[i++]=0}return t}:fa)(e,r,f),v=t?fa(e,r,f):void 0,h=r.height/2,M=r.width/2,P=a.length,z=[],T=t?[]:void 0,E=ea,B=ra,A=na,S=ta,b=ia,D=sa,F=oa,N=la,O=Ca,I=a[0],Q=a[1],S=i.geodeticSurfaceNormal(I,S);E=K.Cartesian3.subtract(Q,I,E),E=K.Cartesian3.normalize(E,E),N=K.Cartesian3.cross(S,E,N),N=K.Cartesian3.normalize(N,N);var V,G=d[0],R=d[1];t&&(T=wa(I,N,v,T,i,G+h,1,1,o,f)),O=K.Cartesian3.clone(I,O),I=Q,B=K.Cartesian3.negate(E,B);for(var L=1;L<P-1;L++){var _=t?2:1,Q=a[L+1],E=K.Cartesian3.subtract(Q,I,E);E=K.Cartesian3.normalize(E,E),A=K.Cartesian3.add(E,B,A),A=K.Cartesian3.normalize(A,A),S=i.geodeticSurfaceNormal(I,S);var j=K.Cartesian3.multiplyByScalar(S,K.Cartesian3.dot(E,S),pa);K.Cartesian3.subtract(E,j,j),K.Cartesian3.normalize(j,j);var q,U,Y=K.Cartesian3.multiplyByScalar(S,K.Cartesian3.dot(B,S),ga);K.Cartesian3.subtract(B,Y,Y),K.Cartesian3.normalize(Y,Y),!J.CesiumMath.equalsEpsilon(Math.abs(K.Cartesian3.dot(j,Y)),1,J.CesiumMath.EPSILON7)?(A=K.Cartesian3.cross(A,S,A),A=K.Cartesian3.cross(S,A,A),A=K.Cartesian3.normalize(A,A),q=1/Math.max(.25,K.Cartesian3.magnitude(K.Cartesian3.cross(A,B,ca))),(U=ua.angleIsGreaterThanPi(E,B,I,i))?(b=K.Cartesian3.add(I,K.Cartesian3.multiplyByScalar(A,q*M,A),b),D=K.Cartesian3.add(b,K.Cartesian3.multiplyByScalar(N,M,D),D),aa[0]=K.Cartesian3.clone(O,aa[0]),aa[1]=K.Cartesian3.clone(D,aa[1]),V=da(aa,G+h,R+h,x),z=ma(X.PolylinePipeline.generateArc({positions:aa,granularity:x,ellipsoid:i}),N,g,z,i,V,1,o,f),N=K.Cartesian3.cross(S,E,N),N=K.Cartesian3.normalize(N,N),F=K.Cartesian3.add(b,K.Cartesian3.multiplyByScalar(N,M,F),F),p===$.ROUNDED||p===$.BEVELED?xa(b,D,F,p,U,i,z,g,R+h,t):z=wa(I,A=K.Cartesian3.negate(A,A),g,z,i,R+h,q,_)):(b=K.Cartesian3.add(I,K.Cartesian3.multiplyByScalar(A,q*M,A),b),D=K.Cartesian3.add(b,K.Cartesian3.multiplyByScalar(N,-M,D),D),aa[0]=K.Cartesian3.clone(O,aa[0]),aa[1]=K.Cartesian3.clone(D,aa[1]),V=da(aa,G+h,R+h,x),z=ma(X.PolylinePipeline.generateArc({positions:aa,granularity:x,ellipsoid:i}),N,g,z,i,V,1,o,f),N=K.Cartesian3.cross(S,E,N),N=K.Cartesian3.normalize(N,N),F=K.Cartesian3.add(b,K.Cartesian3.multiplyByScalar(N,-M,F),F),p===$.ROUNDED||p===$.BEVELED?xa(b,D,F,p,U,i,z,g,R+h,t):z=wa(I,A,g,z,i,R+h,q,_)),O=K.Cartesian3.clone(F,O),B=K.Cartesian3.negate(E,B)):(z=wa(O,N,g,z,i,G+h,1,1),O=I),G=R,R=d[L+1],I=Q}aa[0]=K.Cartesian3.clone(O,aa[0]),aa[1]=K.Cartesian3.clone(I,aa[1]),V=da(aa,G+h,R+h,x),z=ma(X.PolylinePipeline.generateArc({positions:aa,granularity:x,ellipsoid:i}),N,g,z,i,V,1,o,f),t&&(T=wa(I,N,v,T,i,R+h,1,1,o,f)),P=z.length;var Z=t?P+T.length:P,k=new Float64Array(Z);return k.set(z),t&&k.set(T,P),k},a.CornerType=$,a.PolylineVolumeGeometryLibrary=ua});
