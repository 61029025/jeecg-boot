<script>
// This starter template is using Vue 3 <script setup> SFCs
// Check out https://v3.vuejs.org/api/sfc-script-setup.html#sfc-script-setup
import * as Cesium from "cesium"
import "@plugins/cesium/Widgets/widgets.css";
import {PathGraphics, TimeInterval, TimeIntervalCollection, VelocityOrientationProperty} from "cesium";


export default {
  data() {
    return {}
  },
  mounted() {
    const viewer = new Cesium.Viewer("cesiumContainer",
      {
        terrainProvider: new Cesium.CesiumTerrainProvider({
          url: "http://data.marsgis.cn/terrain",
          requestVertexNormals: true
        }),
        // terrainProvider: Cesium.createWorldTerrain(),
        animation: false, //是否显示动画控件，左下角仪表
        baseLayerPicker: false, //是否显示图层选择控件,是否显示geocoder小器件，右上角查询按钮
        geocoder: false, //是否显示地名查找控件
        timeline: false, //是否显示时间线控件
        sceneModePicker: true, //是否显示投影方式控件,//是否显示3D/2D选择器
        navigationHelpButton: false, //是否显示帮助信息控件
        infoBox: true, //是否显示点击要素之后显示的信息
        fullscreenButton: true, //是否显示全屏按钮
        selectionIndicator: true, //是否显示选中指示框
      });
    viewer.scene.globe.depthTestAgainstTerrain = true;
    viewer._cesiumWidget._creditContainer.style.display = "none";

    // var hpr = new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(ex), Cesium.Math.toRadians(ey), Cesium.Math.toRadians(ez));
    var position = Cesium.Cartesian3.fromDegrees(106.8696354977, 29.82850288424, 202);

    var heading = Cesium.Math.toRadians(120.0);
    var pitch = Cesium.Math.toRadians(0.0);
    var roll = Cesium.Math.toRadians(0.0);
    var orientation = Cesium.Transforms.headingPitchRollQuaternion(position, new Cesium.HeadingPitchRoll(heading, pitch, roll));


    const powerStation = viewer.entities.add({
      position: position,
      orientation: orientation,
      // Attach the 3D model instead of the green point.
      model: {
        uri: "/models/powerStation.gltf",
        scale: 0.1
      }
    });
    viewer.trackedEntity = powerStation;
    //
    let border = []
    let _polygonArrStr = '106.8728218395259,29.83400459978465,0 106.8728809967861,29.83401885444357,0 106.8729597531465,29.83401107493862,0 106.8730317249418,29.83398600997846,0 106.8730995400862,29.83395695153121,0 106.8731845557426,29.83390679441208,0 106.8732376962069,29.83387205414611,0 106.8732760977986,29.83384037596889,0 106.8733118593196,29.83379362758586,0 106.873343098842,29.83375102779146,0 106.8733712003169,29.83370389827783,0 106.8733947800671,29.83366091740819,0 106.8734140403944,29.83360737531574,0 106.8734254403693,29.83356816039377,0 106.8734446997653,29.83351462013171,0 106.8734517804643,29.83346484467146,0 106.8734816592356,29.83333664537311,0 106.873502072702,29.83323929623878,0 106.8735264756637,29.83314435556625,0 106.8735404542475,29.83308630345721,0 106.8735528119058,29.83304105343135,0 106.8735712891314,29.83295207732536,0 106.8735943265072,29.83280557925212,0 106.8736057231501,29.832642125696,0 106.8735794794092,29.83250654764908,0 106.8735050129023,29.83235403013718,0 106.8734280555835,29.83219938566139,0 106.873351098216,29.83204474074809,0 106.8733295048956,29.8319919393717,0 106.8732859544853,29.83189395971745,0 106.8732352731938,29.8317950535719,0 106.8731809633536,29.8317015442281,0 106.8731123673114,29.83159512368949,0 106.8730829143625,29.83155664043217,0 106.8730534617166,29.83151815720912,0 106.8730240089497,29.83147967380669,0 106.872919152381,29.83135741904018,0 106.8728733150598,29.83130249911204,0 106.8728394289075,29.83126308671352,0 106.8728021145558,29.83123891928014,0 106.8727439829864,29.83119738742366,0 106.8726980300239,29.83115209830643,0 106.8726233981875,29.83110376119421,0 106.8725774441791,29.8310584706134,0 106.8725193089516,29.83101693614547,0 106.8724733539252,29.83097164465978,0 106.8724482167966,29.83094371812604,0 106.8723900799972,29.83090218196343,0 106.8723146667468,29.83081840090812,0 106.8722852100079,29.83077991238219,0 106.8722557532058,29.83074142382413,0 106.872196839161,29.83066444599921,0 106.8721465619748,29.83060858990948,0 106.8720876469323,29.8305316106776,0 106.8720287313814,29.83045463069883,0 106.8719949545324,29.83040557905568,0 106.8719360382079,29.83032859791121,0 106.8719022609608,29.83027954562445,0 106.8718563001728,29.83023424760211,0 106.8717765613957,29.83013989591591,0 106.8717011403853,29.83005610425394,0 106.8716594966832,29.83002136577786,0 106.8716300369537,29.82998287307176,0 106.8716048960236,29.82995494181582,0 106.8715337914614,29.82988170888991,0 106.8714878272249,29.82983640704945,0 106.8714583666166,29.82979791317692,0 106.871412401942,29.82975261036388,0 106.8713707558354,29.82971786903313,0 106.8713369756024,29.82966881243757,0 106.8712953284755,29.82963407038874,0 106.8712701859105,29.82960613725943,0 106.8712199003535,29.82955027040696,0 106.8711904383389,29.82951177465893,0 106.8711444711054,29.82946646902393,0 106.8711150087218,29.82942797279799,0 106.8710812268292,29.82937891427447,0 106.8709425503824,29.82920755366934,0 106.8709130870573,29.82916905607827,0 106.8708498405947,29.82908149804812,0 106.8708160577442,29.82903243746781,0 106.8707822747473,29.82898337664363,0 106.8707528107316,29.82894487800476,0 106.8707190274481,29.82889581671959,0 106.8706722866132,29.8288150677883,0 106.8706550100973,29.82877281796498,0 106.8706334144702,29.82872000571208,0 106.8706161379872,29.82867775594189,0 106.87059886153,29.82863550622247,0 106.8705693969671,29.82859700644395,0 106.8705434822792,29.82853363178081,0 106.8705218867283,29.82848081959521,0 106.8704959721124,29.82841744505794,0 106.870474376621,29.82836463297592,0 106.8704736077029,29.82832919658209,0 106.8704642006523,29.82827263575075,0 106.8704591127169,29.82822663761055,0 106.8704497057504,29.82817007746288,0 106.8704513372956,29.82812536143391,0 106.8704467456559,29.82806899608494,0 106.8704284515593,29.82800053307139,0 106.8702409205613,29.82761510069407,0 106.8700472432205,29.82721503198247,0 106.8699589509662,29.8270681074014,0 106.869861014616,29.82693019348788,0 106.8697505533943,29.82673317452706,0 106.8696294478218,29.82651631420327,0 106.8695226262422,29.82628028155671,0 106.8694221890032,29.82606996985562,0 106.8692957691317,29.82575451626475,0 106.8692680137131,29.82564664849058,0 106.8692284521967,29.82549907579724,0 106.8692162990143,29.82542217656154,0 106.8692068961086,29.82536562521124,0 106.8691924096678,29.82526308568437,0 106.869195198411,29.82520279549951,0 106.8692023059682,29.82515306812428,0 106.8692315004038,29.82498958812695,0 106.8692609639974,29.82486876977017,0 106.8693244335635,29.82474713915641,0 106.869406113127,29.82464918320288,0 106.8695269080858,29.82456494592191,0 106.8697382261007,29.82447905481494,0 106.8704217265639,29.82428025750609,0 106.8710684884149,29.82406810659224,0 106.8714794106926,29.82390020400316,0 106.8715747735871,29.8237655437822,0 106.871596312033,29.82364440721571,0 106.871597125326,29.8235589942805,0 106.8715738808744,29.82347522261792,0 106.8715566154181,29.82343300247762,0 106.8715307174435,29.82336967272677,0 106.8714562706048,29.82328990291918,0 106.8713807354694,29.82323747192758,0 106.8713218968652,29.82321279910269,0 106.8712122526629,29.82319408176098,0 106.8711257402859,29.82318566714066,0 106.8710366680933,29.82320037634748,0 106.870971456431,29.82320848123857,0 106.8709105596818,29.82322714269796,0 106.8708618409591,29.82324207223183,0 106.8708131210864,29.82325700208333,0 106.8707644000632,29.82327193225255,0 106.8707156778892,29.82328686273961,0 106.8706791354659,29.82329806082499,0 106.8706182300874,29.82331672466767,0 106.8705695044589,29.82333165610891,0 106.8705207776782,29.82334658786841,0 106.8704720497447,29.8233615199463,0 106.8704355030007,29.82337271922515,0 106.8703745904186,29.82339138505765,0 106.8703380420939,29.82340258476867,0 106.870264943198,29.82342498482032,0 106.8702040254173,29.82344365209349,0 106.870143106131,29.82346231977361,0 106.8700821847403,29.82348098804415,0 106.8700212615435,29.82349965681368,0 106.8699481516813,29.82352205988613,0 106.8698994100281,29.82353699575895,0 106.869838481708,29.82355566593511,0 106.86977755128,29.82357433670277,0 106.8697044324375,29.82359674226572,0 106.8696434983266,29.82361541404213,0 106.8695703747036,29.82363782092618,0 106.8695338120632,29.82364902459279,0 106.8694715759802,29.82367185442912,0 106.8694337419083,29.82368940095446,0 106.8693674953961,29.82371187127375,0 106.8693187398764,29.82372681111589,0 106.86927651383,29.82374190735412,0 106.8692255438747,29.82376725207621,0 106.8691637867761,29.82379441819748,0 106.8691323435261,29.82380769512746,0 106.8690902809631,29.82382305570197,0 106.8690447497161,29.82384503883816,0 106.8690021969732,29.8238641402123,0 106.8689459292765,29.82388858628509,0 106.868889290752,29.82391782657778,0 106.8688448422457,29.82394333208439,0 106.8688125850713,29.82396510198053,0 106.8687559421778,29.82399434441903,0 106.868687105182,29.82402732424476,0 106.8686304585128,29.82405656845054,0 106.8685981975281,29.82407834046764,0 106.8685293543374,29.82411132277788,0 106.8684727030081,29.82414056961228,0 106.8684282447754,29.82416608017656,0 106.8683715902461,29.82419532821129,0 106.8683225295362,29.8242190448606,0 106.8682815480686,29.82424431312693,0 106.8682286747403,29.8242669879801,0 106.8681686130546,29.82430460856317,0 106.8681269843876,29.82433025407152,0 106.8680801311363,29.82435329490622,0 106.8680280700593,29.82439570037302,0 106.8679800426081,29.82444608258551,0 106.867883289047,29.8245717209936,0 106.8678352958788,29.82470087831645,0 106.867808376359,29.82479716644862,0 106.8677956848281,29.82494826504542,0 106.8677807266036,29.8250431296551,0 106.8677612936236,29.82514713234004,0 106.8677355284597,29.82525815959188,0 106.8677284089433,29.82530790341993,0 106.8677334893454,29.82535390681945,0 106.8677391079797,29.82540798812284,0 106.8677817702966,29.82550556565129,0 106.8678084511363,29.82560439756299,0 106.8678257314134,29.82564665978627,0 106.8678473318302,29.82569948773207,0 106.8678524118625,29.8257454926675,0 106.867869692202,29.82578775505002,0 106.8678956128474,29.82585114894977,0 106.8679050137857,29.82590772011701,0 106.8679144147693,29.82596429163867,0 106.8679360152799,29.8260171198523,0 106.8679576159255,29.82606994839078,0 106.8679792165817,29.82612277694889,0 106.8679964970641,29.82616503968757,0 106.8680180977395,29.82621786828239,0 106.8680440186145,29.82628126274647,0 106.8680699393806,29.82634465693618,0 106.8680915400943,29.82639748560517,0 106.8681088206237,29.82643974843461,0 106.8681304213587,29.82649257714539,0 106.8681477020305,29.82653484031473,0 106.8681736228655,29.8265982346395,0 106.8681952236377,29.82665106342389,0 106.8682211445063,29.82671445781559,0 106.8682384252208,29.82675672107009,0 106.868264346121,29.82682011552536,0 106.8682816267944,29.82686237867026,0 106.8683075477274,29.82692577319174,0 106.8683370269824,29.82696429019979,0 106.8683543076441,29.82700655328163,0 106.8683881067955,29.82705563552344,0 106.8684053874353,29.82709789852131,0 106.8684269882327,29.82715072725771,0 106.8684554808117,29.82719885577174,0 106.8684807924141,29.82723861577666,0 106.8685162445844,29.82730428626584,0 106.8685970613065,29.82746804026637,0 106.8686778660232,29.82761512036863,0 106.8688028321652,29.82790316435407,0 106.8688566081754,29.82803519238302,0 106.8689433380155,29.82823074859761,0 106.8690110534799,29.82836830068696,0 106.8691578366516,29.82864382908138,0 106.8692712747057,29.82883043381234,0 106.8693850593028,29.82894282025443,0 106.8694497022704,29.82901368476709,0 106.8695284483108,29.82907930204307,0 106.869599300356,29.82915307985942,0 106.8697201544608,29.82923890422816,0 106.8697496280693,29.82927741177872,0 106.8697791021366,29.82931591894562,0 106.8698207688009,29.82935067312432,0 106.8698710749182,29.82940655676571,0 106.8699127406638,29.82944131004519,0 106.8699587258924,29.8294866277737,0 106.869988198197,29.82952513365331,0 106.8700176703561,29.82956363931742,0 106.8700471423935,29.82960214482362,0 106.8700931266791,29.82964746099334,0 106.8701685815685,29.82973128138864,0 106.8702145643623,29.82977659634473,0 106.870264866814,29.82983247522185,0 106.8703324477653,29.82993061151926,0 106.8704078992715,29.83001442774885,0 106.8704538798761,29.83005974015864,0 106.8704876694505,29.83010880697838,0 106.8705466089265,29.83018581126431,0 106.8705890376449,29.8302560060263,0 106.8706479760205,29.83033300920374,0 106.8706982743066,29.83038888311068,0 106.8707442526721,29.83043419221827,0 106.870782360627,29.83049382111714,0 106.8708534863192,29.83056706544363,0 106.8708786345926,29.83059500140105,0 106.870920291269,29.83062974465239,0 106.8709662675531,29.83067505149461,0 106.8710122430806,29.83072035794912,0 106.8710955534314,29.83078984175001,0 106.8711372082943,29.83082458306897,0 106.8711788623675,29.83085932395054,0 106.8712205160755,29.83089406460849,0 106.8712456623232,29.83092199829548,0 106.8712708085138,29.83094993199235,0 106.8713254203435,29.83101636222201,0 106.8714792961385,29.83119886918268,0 106.8716412525753,29.83137292567163,0 106.8717753399001,29.83154910454052,0 106.8719919142923,29.83173745475234,0 106.8720535637173,29.83179718532142,0 106.8721304899358,29.83189142785626,0 106.8722246313208,29.8320106130095,0 106.8723160318796,29.83218592313118,0 106.8723550837962,29.83229273794952,0 106.8723727642603,29.83240182951182,0 106.8724115209538,29.83256066952632,0 106.8724663693777,29.83271775894679,0 106.872511756994,29.83283944963909,0 106.8725256264435,29.83291954358102,0 106.8725362423055,29.83299155180993,0 106.8725447301813,29.83307889800522,0 106.8725545892383,29.83315888149367,0 106.8725560021258,29.83325384321184,0 106.8725532341654,29.83331418912964,0 106.8725461463192,29.83336397202179,0 106.8725390584927,29.8334137558773,0 106.8725319704359,29.83346354008522,0 106.8725157985326,29.83354868129858,0 106.8725019482653,29.83364045134726,0 106.8725084798763,29.83373723156297,0 106.8725639244237,29.83383417417088,0 106.8726467809745,29.83391462740941,0 106.8727308993159,29.8339694125084,0 106.872799518326,29.83399481917176,0'
    let coordinates = _polygonArrStr.split(" ");
    for (var i = 0; i < coordinates.length; i++) {
      var coordStr = coordinates[i];
      var coord = coordStr.trim().split(",");
      // border.push(parseFloat(coord[0]),parseFloat(coord[1]),parseFloat(coord[2]));
      border.push(parseFloat(coord[0]), parseFloat(coord[1]))
    }
    //_polygonArr 为polygon的坐标
    let waterPrimitive = new Cesium.Primitive({
      allowPicking: false,
      geometryInstances: new Cesium.GeometryInstance({
        geometry: new Cesium.PolygonGeometry({
          //polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(border)),
          polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArray(border)),
          // rectangle:Cesium.Rectangle.fromDegrees(-180, -90, 180.0, 90.0),
          vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,
          // extrudedHeight: 0,
          height: 191,
          perPositionHeight: false
          // perPositionHeight : true//注释掉此属性水面就贴地了
        })
        //通过extrudedHeight属性控制的是这个水面的高度也就是厚度，而height控制的是水体整个距离地面抬高的高度。
      }),

      // 使用内置的水面shader
      appearance: new Cesium.EllipsoidSurfaceAppearance({
        aboveGround: true,
        material: new Cesium.Material({
          fabric: {
            type: 'Water',
            uniforms: {
              blendColor: new Cesium.Color(0.0, 0.0, 1.0, 0.3),
              //设置水面使用的图片，
              //此图片在Cesium源码Source\Assets\Textures文件夹中
              normalMap: '/models/waterNormals.jpeg',
              //频率速度设置
              frequency: 200.0,
              animationSpeed: 0.01,
              amplitude: 10.0
            }
          }
        })
        //frameShader代码也可以根据需要进行修改
        //fragmentShaderSource: 'varying vec3 v_positionMC;
        //vec3 v_positionEC;vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec3 normalEC = normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s = v_st.s;\nmaterialInput.st = v_st;\nmaterialInput.str = vec3(v_st, 0.0);\nmaterialInput.normalEC = normalEC;\nmaterialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC = -v_positionEC;\nmaterialInput.positionToEyeEC = positionToEyeEC;\nczm_material material = czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor = czm_phong(normalize(positionToEyeEC), material);\
        // gl_FragColor.a=0.5;\n#endif\n}\n' //重写shader，修改水面的透明度
      })
    });
    //添加水面数据到viewer中
    viewer.scene.primitives.add(waterPrimitive);

  }
}

</script>

<template>
  <div id="cesiumContainer"></div>
</template>

<style>
#toolbar {
  background: rgba(42, 42, 42, 0.8);
  padding: 4px;
  border-radius: 4px;
}

#toolbar input {
  vertical-align: middle;
  padding-top: 2px;
  padding-bottom: 2px;
}

#toolbar .header {
  font-weight: bold;
}
</style>
